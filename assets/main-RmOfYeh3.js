(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var il={},Bs={};Bs.byteLength=hg;Bs.toByteArray=pg;Bs.fromByteArray=_g;var Yt=[],Nt=[],ug=typeof Uint8Array<"u"?Uint8Array:Array,ao="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ii=0,dg=ao.length;Ii<dg;++Ii)Yt[Ii]=ao[Ii],Nt[ao.charCodeAt(Ii)]=Ii;Nt[45]=62;Nt[95]=63;function eh(s){var e=s.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function hg(s){var e=eh(s),t=e[0],n=e[1];return(t+n)*3/4-n}function fg(s,e,t){return(e+t)*3/4-t}function pg(s){var e,t=eh(s),n=t[0],i=t[1],r=new ug(fg(s,n,i)),a=0,o=i>0?n-4:n,l;for(l=0;l<o;l+=4)e=Nt[s.charCodeAt(l)]<<18|Nt[s.charCodeAt(l+1)]<<12|Nt[s.charCodeAt(l+2)]<<6|Nt[s.charCodeAt(l+3)],r[a++]=e>>16&255,r[a++]=e>>8&255,r[a++]=e&255;return i===2&&(e=Nt[s.charCodeAt(l)]<<2|Nt[s.charCodeAt(l+1)]>>4,r[a++]=e&255),i===1&&(e=Nt[s.charCodeAt(l)]<<10|Nt[s.charCodeAt(l+1)]<<4|Nt[s.charCodeAt(l+2)]>>2,r[a++]=e>>8&255,r[a++]=e&255),r}function gg(s){return Yt[s>>18&63]+Yt[s>>12&63]+Yt[s>>6&63]+Yt[s&63]}function mg(s,e,t){for(var n,i=[],r=e;r<t;r+=3)n=(s[r]<<16&16711680)+(s[r+1]<<8&65280)+(s[r+2]&255),i.push(gg(n));return i.join("")}function _g(s){for(var e,t=s.length,n=t%3,i=[],r=16383,a=0,o=t-n;a<o;a+=r)i.push(mg(s,a,a+r>o?o:a+r));return n===1?(e=s[t-1],i.push(Yt[e>>2]+Yt[e<<4&63]+"==")):n===2&&(e=(s[t-2]<<8)+s[t-1],i.push(Yt[e>>10]+Yt[e>>4&63]+Yt[e<<2&63]+"=")),i.join("")}var va={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */va.read=function(s,e,t,n,i){var r,a,o=i*8-n-1,l=(1<<o)-1,u=l>>1,d=-7,p=t?i-1:0,m=t?-1:1,w=s[e+p];for(p+=m,r=w&(1<<-d)-1,w>>=-d,d+=o;d>0;r=r*256+s[e+p],p+=m,d-=8);for(a=r&(1<<-d)-1,r>>=-d,d+=n;d>0;a=a*256+s[e+p],p+=m,d-=8);if(r===0)r=1-u;else{if(r===l)return a?NaN:(w?-1:1)*(1/0);a=a+Math.pow(2,n),r=r-u}return(w?-1:1)*a*Math.pow(2,r-n)};va.write=function(s,e,t,n,i,r){var a,o,l,u=r*8-i-1,d=(1<<u)-1,p=d>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:r-1,E=n?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=d):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+p>=1?e+=m/l:e+=m*Math.pow(2,1-p),e*l>=2&&(a++,l/=2),a+p>=d?(o=0,a=d):a+p>=1?(o=(e*l-1)*Math.pow(2,i),a=a+p):(o=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;s[t+w]=o&255,w+=E,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;s[t+w]=a&255,w+=E,a/=256,u-=8);s[t+w-E]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(s){const e=Bs,t=va,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=o,s.SlowBuffer=G,s.INSPECT_MAX_BYTES=50;const i=2147483647;s.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=r(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function r(){try{const b=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(b,f),b.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function a(b){if(b>i)throw new RangeError('The value "'+b+'" is invalid for option "size"');const f=new Uint8Array(b);return Object.setPrototypeOf(f,o.prototype),f}function o(b,f,g){if(typeof b=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(b)}return l(b,f,g)}o.poolSize=8192;function l(b,f,g){if(typeof b=="string")return m(b,f);if(ArrayBuffer.isView(b))return E(b);if(b==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b);if(j(b,ArrayBuffer)||b&&j(b.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(j(b,SharedArrayBuffer)||b&&j(b.buffer,SharedArrayBuffer)))return C(b,f,g);if(typeof b=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const T=b.valueOf&&b.valueOf();if(T!=null&&T!==b)return o.from(T,f,g);const L=I(b);if(L)return L;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof b[Symbol.toPrimitive]=="function")return o.from(b[Symbol.toPrimitive]("string"),f,g);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b)}o.from=function(b,f,g){return l(b,f,g)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function u(b){if(typeof b!="number")throw new TypeError('"size" argument must be of type number');if(b<0)throw new RangeError('The value "'+b+'" is invalid for option "size"')}function d(b,f,g){return u(b),b<=0?a(b):f!==void 0?typeof g=="string"?a(b).fill(f,g):a(b).fill(f):a(b)}o.alloc=function(b,f,g){return d(b,f,g)};function p(b){return u(b),a(b<0?0:B(b)|0)}o.allocUnsafe=function(b){return p(b)},o.allocUnsafeSlow=function(b){return p(b)};function m(b,f){if((typeof f!="string"||f==="")&&(f="utf8"),!o.isEncoding(f))throw new TypeError("Unknown encoding: "+f);const g=Y(b,f)|0;let T=a(g);const L=T.write(b,f);return L!==g&&(T=T.slice(0,L)),T}function w(b){const f=b.length<0?0:B(b.length)|0,g=a(f);for(let T=0;T<f;T+=1)g[T]=b[T]&255;return g}function E(b){if(j(b,Uint8Array)){const f=new Uint8Array(b);return C(f.buffer,f.byteOffset,f.byteLength)}return w(b)}function C(b,f,g){if(f<0||b.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(b.byteLength<f+(g||0))throw new RangeError('"length" is outside of buffer bounds');let T;return f===void 0&&g===void 0?T=new Uint8Array(b):g===void 0?T=new Uint8Array(b,f):T=new Uint8Array(b,f,g),Object.setPrototypeOf(T,o.prototype),T}function I(b){if(o.isBuffer(b)){const f=B(b.length)|0,g=a(f);return g.length===0||b.copy(g,0,0,f),g}if(b.length!==void 0)return typeof b.length!="number"||de(b.length)?a(0):w(b);if(b.type==="Buffer"&&Array.isArray(b.data))return w(b.data)}function B(b){if(b>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return b|0}function G(b){return+b!=b&&(b=0),o.alloc(+b)}o.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==o.prototype},o.compare=function(f,g){if(j(f,Uint8Array)&&(f=o.from(f,f.offset,f.byteLength)),j(g,Uint8Array)&&(g=o.from(g,g.offset,g.byteLength)),!o.isBuffer(f)||!o.isBuffer(g))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===g)return 0;let T=f.length,L=g.length;for(let V=0,z=Math.min(T,L);V<z;++V)if(f[V]!==g[V]){T=f[V],L=g[V];break}return T<L?-1:L<T?1:0},o.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(f,g){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return o.alloc(0);let T;if(g===void 0)for(g=0,T=0;T<f.length;++T)g+=f[T].length;const L=o.allocUnsafe(g);let V=0;for(T=0;T<f.length;++T){let z=f[T];if(j(z,Uint8Array))V+z.length>L.length?(o.isBuffer(z)||(z=o.from(z)),z.copy(L,V)):Uint8Array.prototype.set.call(L,z,V);else if(o.isBuffer(z))z.copy(L,V);else throw new TypeError('"list" argument must be an Array of Buffers');V+=z.length}return L};function Y(b,f){if(o.isBuffer(b))return b.length;if(ArrayBuffer.isView(b)||j(b,ArrayBuffer))return b.byteLength;if(typeof b!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof b);const g=b.length,T=arguments.length>2&&arguments[2]===!0;if(!T&&g===0)return 0;let L=!1;for(;;)switch(f){case"ascii":case"latin1":case"binary":return g;case"utf8":case"utf-8":return _(b).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g*2;case"hex":return g>>>1;case"base64":return $(b).length;default:if(L)return T?-1:_(b).length;f=(""+f).toLowerCase(),L=!0}}o.byteLength=Y;function K(b,f,g){let T=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((g===void 0||g>this.length)&&(g=this.length),g<=0)||(g>>>=0,f>>>=0,g<=f))return"";for(b||(b="utf8");;)switch(b){case"hex":return Se(this,f,g);case"utf8":case"utf-8":return ze(this,f,g);case"ascii":return ut(this,f,g);case"latin1":case"binary":return vt(this,f,g);case"base64":return x(this,f,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return dt(this,f,g);default:if(T)throw new TypeError("Unknown encoding: "+b);b=(b+"").toLowerCase(),T=!0}}o.prototype._isBuffer=!0;function ee(b,f,g){const T=b[f];b[f]=b[g],b[g]=T}o.prototype.swap16=function(){const f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let g=0;g<f;g+=2)ee(this,g,g+1);return this},o.prototype.swap32=function(){const f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let g=0;g<f;g+=4)ee(this,g,g+3),ee(this,g+1,g+2);return this},o.prototype.swap64=function(){const f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let g=0;g<f;g+=8)ee(this,g,g+7),ee(this,g+1,g+6),ee(this,g+2,g+5),ee(this,g+3,g+4);return this},o.prototype.toString=function(){const f=this.length;return f===0?"":arguments.length===0?ze(this,0,f):K.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(f){if(!o.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:o.compare(this,f)===0},o.prototype.inspect=function(){let f="";const g=s.INSPECT_MAX_BYTES;return f=this.toString("hex",0,g).replace(/(.{2})/g,"$1 ").trim(),this.length>g&&(f+=" ... "),"<Buffer "+f+">"},n&&(o.prototype[n]=o.prototype.inspect),o.prototype.compare=function(f,g,T,L,V){if(j(f,Uint8Array)&&(f=o.from(f,f.offset,f.byteLength)),!o.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof f);if(g===void 0&&(g=0),T===void 0&&(T=f?f.length:0),L===void 0&&(L=0),V===void 0&&(V=this.length),g<0||T>f.length||L<0||V>this.length)throw new RangeError("out of range index");if(L>=V&&g>=T)return 0;if(L>=V)return-1;if(g>=T)return 1;if(g>>>=0,T>>>=0,L>>>=0,V>>>=0,this===f)return 0;let z=V-L,he=T-g;const Pe=Math.min(z,he),Me=this.slice(L,V),$e=f.slice(g,T);for(let Te=0;Te<Pe;++Te)if(Me[Te]!==$e[Te]){z=Me[Te],he=$e[Te];break}return z<he?-1:he<z?1:0};function ae(b,f,g,T,L){if(b.length===0)return-1;if(typeof g=="string"?(T=g,g=0):g>2147483647?g=2147483647:g<-2147483648&&(g=-2147483648),g=+g,de(g)&&(g=L?0:b.length-1),g<0&&(g=b.length+g),g>=b.length){if(L)return-1;g=b.length-1}else if(g<0)if(L)g=0;else return-1;if(typeof f=="string"&&(f=o.from(f,T)),o.isBuffer(f))return f.length===0?-1:M(b,f,g,T,L);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?L?Uint8Array.prototype.indexOf.call(b,f,g):Uint8Array.prototype.lastIndexOf.call(b,f,g):M(b,[f],g,T,L);throw new TypeError("val must be string, number or Buffer")}function M(b,f,g,T,L){let V=1,z=b.length,he=f.length;if(T!==void 0&&(T=String(T).toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(b.length<2||f.length<2)return-1;V=2,z/=2,he/=2,g/=2}function Pe($e,Te){return V===1?$e[Te]:$e.readUInt16BE(Te*V)}let Me;if(L){let $e=-1;for(Me=g;Me<z;Me++)if(Pe(b,Me)===Pe(f,$e===-1?0:Me-$e)){if($e===-1&&($e=Me),Me-$e+1===he)return $e*V}else $e!==-1&&(Me-=Me-$e),$e=-1}else for(g+he>z&&(g=z-he),Me=g;Me>=0;Me--){let $e=!0;for(let Te=0;Te<he;Te++)if(Pe(b,Me+Te)!==Pe(f,Te)){$e=!1;break}if($e)return Me}return-1}o.prototype.includes=function(f,g,T){return this.indexOf(f,g,T)!==-1},o.prototype.indexOf=function(f,g,T){return ae(this,f,g,T,!0)},o.prototype.lastIndexOf=function(f,g,T){return ae(this,f,g,T,!1)};function A(b,f,g,T){g=Number(g)||0;const L=b.length-g;T?(T=Number(T),T>L&&(T=L)):T=L;const V=f.length;T>V/2&&(T=V/2);let z;for(z=0;z<T;++z){const he=parseInt(f.substr(z*2,2),16);if(de(he))return z;b[g+z]=he}return z}function R(b,f,g,T){return q(_(f,b.length-g),b,g,T)}function P(b,f,g,T){return q(v(f),b,g,T)}function F(b,f,g,T){return q($(f),b,g,T)}function N(b,f,g,T){return q(D(f,b.length-g),b,g,T)}o.prototype.write=function(f,g,T,L){if(g===void 0)L="utf8",T=this.length,g=0;else if(T===void 0&&typeof g=="string")L=g,T=this.length,g=0;else if(isFinite(g))g=g>>>0,isFinite(T)?(T=T>>>0,L===void 0&&(L="utf8")):(L=T,T=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const V=this.length-g;if((T===void 0||T>V)&&(T=V),f.length>0&&(T<0||g<0)||g>this.length)throw new RangeError("Attempt to write outside buffer bounds");L||(L="utf8");let z=!1;for(;;)switch(L){case"hex":return A(this,f,g,T);case"utf8":case"utf-8":return R(this,f,g,T);case"ascii":case"latin1":case"binary":return P(this,f,g,T);case"base64":return F(this,f,g,T);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,f,g,T);default:if(z)throw new TypeError("Unknown encoding: "+L);L=(""+L).toLowerCase(),z=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function x(b,f,g){return f===0&&g===b.length?e.fromByteArray(b):e.fromByteArray(b.slice(f,g))}function ze(b,f,g){g=Math.min(b.length,g);const T=[];let L=f;for(;L<g;){const V=b[L];let z=null,he=V>239?4:V>223?3:V>191?2:1;if(L+he<=g){let Pe,Me,$e,Te;switch(he){case 1:V<128&&(z=V);break;case 2:Pe=b[L+1],(Pe&192)===128&&(Te=(V&31)<<6|Pe&63,Te>127&&(z=Te));break;case 3:Pe=b[L+1],Me=b[L+2],(Pe&192)===128&&(Me&192)===128&&(Te=(V&15)<<12|(Pe&63)<<6|Me&63,Te>2047&&(Te<55296||Te>57343)&&(z=Te));break;case 4:Pe=b[L+1],Me=b[L+2],$e=b[L+3],(Pe&192)===128&&(Me&192)===128&&($e&192)===128&&(Te=(V&15)<<18|(Pe&63)<<12|(Me&63)<<6|$e&63,Te>65535&&Te<1114112&&(z=Te))}}z===null?(z=65533,he=1):z>65535&&(z-=65536,T.push(z>>>10&1023|55296),z=56320|z&1023),T.push(z),L+=he}return Pt(T)}const ct=4096;function Pt(b){const f=b.length;if(f<=ct)return String.fromCharCode.apply(String,b);let g="",T=0;for(;T<f;)g+=String.fromCharCode.apply(String,b.slice(T,T+=ct));return g}function ut(b,f,g){let T="";g=Math.min(b.length,g);for(let L=f;L<g;++L)T+=String.fromCharCode(b[L]&127);return T}function vt(b,f,g){let T="";g=Math.min(b.length,g);for(let L=f;L<g;++L)T+=String.fromCharCode(b[L]);return T}function Se(b,f,g){const T=b.length;(!f||f<0)&&(f=0),(!g||g<0||g>T)&&(g=T);let L="";for(let V=f;V<g;++V)L+=be[b[V]];return L}function dt(b,f,g){const T=b.slice(f,g);let L="";for(let V=0;V<T.length-1;V+=2)L+=String.fromCharCode(T[V]+T[V+1]*256);return L}o.prototype.slice=function(f,g){const T=this.length;f=~~f,g=g===void 0?T:~~g,f<0?(f+=T,f<0&&(f=0)):f>T&&(f=T),g<0?(g+=T,g<0&&(g=0)):g>T&&(g=T),g<f&&(g=f);const L=this.subarray(f,g);return Object.setPrototypeOf(L,o.prototype),L};function oe(b,f,g){if(b%1!==0||b<0)throw new RangeError("offset is not uint");if(b+f>g)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(f,g,T){f=f>>>0,g=g>>>0,T||oe(f,g,this.length);let L=this[f],V=1,z=0;for(;++z<g&&(V*=256);)L+=this[f+z]*V;return L},o.prototype.readUintBE=o.prototype.readUIntBE=function(f,g,T){f=f>>>0,g=g>>>0,T||oe(f,g,this.length);let L=this[f+--g],V=1;for(;g>0&&(V*=256);)L+=this[f+--g]*V;return L},o.prototype.readUint8=o.prototype.readUInt8=function(f,g){return f=f>>>0,g||oe(f,1,this.length),this[f]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(f,g){return f=f>>>0,g||oe(f,2,this.length),this[f]|this[f+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(f,g){return f=f>>>0,g||oe(f,2,this.length),this[f]<<8|this[f+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(f,g){return f=f>>>0,g||oe(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(f,g){return f=f>>>0,g||oe(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},o.prototype.readBigUInt64LE=fe(function(f){f=f>>>0,He(f,"offset");const g=this[f],T=this[f+7];(g===void 0||T===void 0)&&Dt(f,this.length-8);const L=g+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24,V=this[++f]+this[++f]*2**8+this[++f]*2**16+T*2**24;return BigInt(L)+(BigInt(V)<<BigInt(32))}),o.prototype.readBigUInt64BE=fe(function(f){f=f>>>0,He(f,"offset");const g=this[f],T=this[f+7];(g===void 0||T===void 0)&&Dt(f,this.length-8);const L=g*2**24+this[++f]*2**16+this[++f]*2**8+this[++f],V=this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+T;return(BigInt(L)<<BigInt(32))+BigInt(V)}),o.prototype.readIntLE=function(f,g,T){f=f>>>0,g=g>>>0,T||oe(f,g,this.length);let L=this[f],V=1,z=0;for(;++z<g&&(V*=256);)L+=this[f+z]*V;return V*=128,L>=V&&(L-=Math.pow(2,8*g)),L},o.prototype.readIntBE=function(f,g,T){f=f>>>0,g=g>>>0,T||oe(f,g,this.length);let L=g,V=1,z=this[f+--L];for(;L>0&&(V*=256);)z+=this[f+--L]*V;return V*=128,z>=V&&(z-=Math.pow(2,8*g)),z},o.prototype.readInt8=function(f,g){return f=f>>>0,g||oe(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},o.prototype.readInt16LE=function(f,g){f=f>>>0,g||oe(f,2,this.length);const T=this[f]|this[f+1]<<8;return T&32768?T|4294901760:T},o.prototype.readInt16BE=function(f,g){f=f>>>0,g||oe(f,2,this.length);const T=this[f+1]|this[f]<<8;return T&32768?T|4294901760:T},o.prototype.readInt32LE=function(f,g){return f=f>>>0,g||oe(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},o.prototype.readInt32BE=function(f,g){return f=f>>>0,g||oe(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},o.prototype.readBigInt64LE=fe(function(f){f=f>>>0,He(f,"offset");const g=this[f],T=this[f+7];(g===void 0||T===void 0)&&Dt(f,this.length-8);const L=this[f+4]+this[f+5]*2**8+this[f+6]*2**16+(T<<24);return(BigInt(L)<<BigInt(32))+BigInt(g+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24)}),o.prototype.readBigInt64BE=fe(function(f){f=f>>>0,He(f,"offset");const g=this[f],T=this[f+7];(g===void 0||T===void 0)&&Dt(f,this.length-8);const L=(g<<24)+this[++f]*2**16+this[++f]*2**8+this[++f];return(BigInt(L)<<BigInt(32))+BigInt(this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+T)}),o.prototype.readFloatLE=function(f,g){return f=f>>>0,g||oe(f,4,this.length),t.read(this,f,!0,23,4)},o.prototype.readFloatBE=function(f,g){return f=f>>>0,g||oe(f,4,this.length),t.read(this,f,!1,23,4)},o.prototype.readDoubleLE=function(f,g){return f=f>>>0,g||oe(f,8,this.length),t.read(this,f,!0,52,8)},o.prototype.readDoubleBE=function(f,g){return f=f>>>0,g||oe(f,8,this.length),t.read(this,f,!1,52,8)};function ie(b,f,g,T,L,V){if(!o.isBuffer(b))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>L||f<V)throw new RangeError('"value" argument is out of bounds');if(g+T>b.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(f,g,T,L){if(f=+f,g=g>>>0,T=T>>>0,!L){const he=Math.pow(2,8*T)-1;ie(this,f,g,T,he,0)}let V=1,z=0;for(this[g]=f&255;++z<T&&(V*=256);)this[g+z]=f/V&255;return g+T},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(f,g,T,L){if(f=+f,g=g>>>0,T=T>>>0,!L){const he=Math.pow(2,8*T)-1;ie(this,f,g,T,he,0)}let V=T-1,z=1;for(this[g+V]=f&255;--V>=0&&(z*=256);)this[g+V]=f/z&255;return g+T},o.prototype.writeUint8=o.prototype.writeUInt8=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,1,255,0),this[g]=f&255,g+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,2,65535,0),this[g]=f&255,this[g+1]=f>>>8,g+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,2,65535,0),this[g]=f>>>8,this[g+1]=f&255,g+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,4,4294967295,0),this[g+3]=f>>>24,this[g+2]=f>>>16,this[g+1]=f>>>8,this[g]=f&255,g+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,4,4294967295,0),this[g]=f>>>24,this[g+1]=f>>>16,this[g+2]=f>>>8,this[g+3]=f&255,g+4};function De(b,f,g,T,L){At(f,T,L,b,g,7);let V=Number(f&BigInt(4294967295));b[g++]=V,V=V>>8,b[g++]=V,V=V>>8,b[g++]=V,V=V>>8,b[g++]=V;let z=Number(f>>BigInt(32)&BigInt(4294967295));return b[g++]=z,z=z>>8,b[g++]=z,z=z>>8,b[g++]=z,z=z>>8,b[g++]=z,g}function Ot(b,f,g,T,L){At(f,T,L,b,g,7);let V=Number(f&BigInt(4294967295));b[g+7]=V,V=V>>8,b[g+6]=V,V=V>>8,b[g+5]=V,V=V>>8,b[g+4]=V;let z=Number(f>>BigInt(32)&BigInt(4294967295));return b[g+3]=z,z=z>>8,b[g+2]=z,z=z>>8,b[g+1]=z,z=z>>8,b[g]=z,g+8}o.prototype.writeBigUInt64LE=fe(function(f,g=0){return De(this,f,g,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=fe(function(f,g=0){return Ot(this,f,g,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(f,g,T,L){if(f=+f,g=g>>>0,!L){const Pe=Math.pow(2,8*T-1);ie(this,f,g,T,Pe-1,-Pe)}let V=0,z=1,he=0;for(this[g]=f&255;++V<T&&(z*=256);)f<0&&he===0&&this[g+V-1]!==0&&(he=1),this[g+V]=(f/z>>0)-he&255;return g+T},o.prototype.writeIntBE=function(f,g,T,L){if(f=+f,g=g>>>0,!L){const Pe=Math.pow(2,8*T-1);ie(this,f,g,T,Pe-1,-Pe)}let V=T-1,z=1,he=0;for(this[g+V]=f&255;--V>=0&&(z*=256);)f<0&&he===0&&this[g+V+1]!==0&&(he=1),this[g+V]=(f/z>>0)-he&255;return g+T},o.prototype.writeInt8=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,1,127,-128),f<0&&(f=255+f+1),this[g]=f&255,g+1},o.prototype.writeInt16LE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,2,32767,-32768),this[g]=f&255,this[g+1]=f>>>8,g+2},o.prototype.writeInt16BE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,2,32767,-32768),this[g]=f>>>8,this[g+1]=f&255,g+2},o.prototype.writeInt32LE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,4,2147483647,-2147483648),this[g]=f&255,this[g+1]=f>>>8,this[g+2]=f>>>16,this[g+3]=f>>>24,g+4},o.prototype.writeInt32BE=function(f,g,T){return f=+f,g=g>>>0,T||ie(this,f,g,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[g]=f>>>24,this[g+1]=f>>>16,this[g+2]=f>>>8,this[g+3]=f&255,g+4},o.prototype.writeBigInt64LE=fe(function(f,g=0){return De(this,f,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=fe(function(f,g=0){return Ot(this,f,g,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function tt(b,f,g,T,L,V){if(g+T>b.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("Index out of range")}function wt(b,f,g,T,L){return f=+f,g=g>>>0,L||tt(b,f,g,4),t.write(b,f,g,T,23,4),g+4}o.prototype.writeFloatLE=function(f,g,T){return wt(this,f,g,!0,T)},o.prototype.writeFloatBE=function(f,g,T){return wt(this,f,g,!1,T)};function Ze(b,f,g,T,L){return f=+f,g=g>>>0,L||tt(b,f,g,8),t.write(b,f,g,T,52,8),g+8}o.prototype.writeDoubleLE=function(f,g,T){return Ze(this,f,g,!0,T)},o.prototype.writeDoubleBE=function(f,g,T){return Ze(this,f,g,!1,T)},o.prototype.copy=function(f,g,T,L){if(!o.isBuffer(f))throw new TypeError("argument should be a Buffer");if(T||(T=0),!L&&L!==0&&(L=this.length),g>=f.length&&(g=f.length),g||(g=0),L>0&&L<T&&(L=T),L===T||f.length===0||this.length===0)return 0;if(g<0)throw new RangeError("targetStart out of bounds");if(T<0||T>=this.length)throw new RangeError("Index out of range");if(L<0)throw new RangeError("sourceEnd out of bounds");L>this.length&&(L=this.length),f.length-g<L-T&&(L=f.length-g+T);const V=L-T;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(g,T,L):Uint8Array.prototype.set.call(f,this.subarray(T,L),g),V},o.prototype.fill=function(f,g,T,L){if(typeof f=="string"){if(typeof g=="string"?(L=g,g=0,T=this.length):typeof T=="string"&&(L=T,T=this.length),L!==void 0&&typeof L!="string")throw new TypeError("encoding must be a string");if(typeof L=="string"&&!o.isEncoding(L))throw new TypeError("Unknown encoding: "+L);if(f.length===1){const z=f.charCodeAt(0);(L==="utf8"&&z<128||L==="latin1")&&(f=z)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(g<0||this.length<g||this.length<T)throw new RangeError("Out of range index");if(T<=g)return this;g=g>>>0,T=T===void 0?this.length:T>>>0,f||(f=0);let V;if(typeof f=="number")for(V=g;V<T;++V)this[V]=f;else{const z=o.isBuffer(f)?f:o.from(f,L),he=z.length;if(he===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(V=0;V<T-g;++V)this[V+g]=z[V%he]}return this};const Xe={};function Vt(b,f,g){Xe[b]=class extends g{constructor(){super(),Object.defineProperty(this,"message",{value:f.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${b}]`,this.stack,delete this.name}get code(){return b}set code(L){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:L,writable:!0})}toString(){return`${this.name} [${b}]: ${this.message}`}}}Vt("ERR_BUFFER_OUT_OF_BOUNDS",function(b){return b?`${b} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Vt("ERR_INVALID_ARG_TYPE",function(b,f){return`The "${b}" argument must be of type number. Received type ${typeof f}`},TypeError),Vt("ERR_OUT_OF_RANGE",function(b,f,g){let T=`The value of "${b}" is out of range.`,L=g;return Number.isInteger(g)&&Math.abs(g)>2**32?L=bt(String(g)):typeof g=="bigint"&&(L=String(g),(g>BigInt(2)**BigInt(32)||g<-(BigInt(2)**BigInt(32)))&&(L=bt(L)),L+="n"),T+=` It must be ${f}. Received ${L}`,T},RangeError);function bt(b){let f="",g=b.length;const T=b[0]==="-"?1:0;for(;g>=T+4;g-=3)f=`_${b.slice(g-3,g)}${f}`;return`${b.slice(0,g)}${f}`}function ue(b,f,g){He(f,"offset"),(b[f]===void 0||b[f+g]===void 0)&&Dt(f,b.length-(g+1))}function At(b,f,g,T,L,V){if(b>g||b<f){const z=typeof f=="bigint"?"n":"";let he;throw f===0||f===BigInt(0)?he=`>= 0${z} and < 2${z} ** ${(V+1)*8}${z}`:he=`>= -(2${z} ** ${(V+1)*8-1}${z}) and < 2 ** ${(V+1)*8-1}${z}`,new Xe.ERR_OUT_OF_RANGE("value",he,b)}ue(T,L,V)}function He(b,f){if(typeof b!="number")throw new Xe.ERR_INVALID_ARG_TYPE(f,"number",b)}function Dt(b,f,g){throw Math.floor(b)!==b?(He(b,g),new Xe.ERR_OUT_OF_RANGE("offset","an integer",b)):f<0?new Xe.ERR_BUFFER_OUT_OF_BOUNDS:new Xe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${f}`,b)}const Zn=/[^+/0-9A-Za-z-_]/g;function S(b){if(b=b.split("=")[0],b=b.trim().replace(Zn,""),b.length<2)return"";for(;b.length%4!==0;)b=b+"=";return b}function _(b,f){f=f||1/0;let g;const T=b.length;let L=null;const V=[];for(let z=0;z<T;++z){if(g=b.charCodeAt(z),g>55295&&g<57344){if(!L){if(g>56319){(f-=3)>-1&&V.push(239,191,189);continue}else if(z+1===T){(f-=3)>-1&&V.push(239,191,189);continue}L=g;continue}if(g<56320){(f-=3)>-1&&V.push(239,191,189),L=g;continue}g=(L-55296<<10|g-56320)+65536}else L&&(f-=3)>-1&&V.push(239,191,189);if(L=null,g<128){if((f-=1)<0)break;V.push(g)}else if(g<2048){if((f-=2)<0)break;V.push(g>>6|192,g&63|128)}else if(g<65536){if((f-=3)<0)break;V.push(g>>12|224,g>>6&63|128,g&63|128)}else if(g<1114112){if((f-=4)<0)break;V.push(g>>18|240,g>>12&63|128,g>>6&63|128,g&63|128)}else throw new Error("Invalid code point")}return V}function v(b){const f=[];for(let g=0;g<b.length;++g)f.push(b.charCodeAt(g)&255);return f}function D(b,f){let g,T,L;const V=[];for(let z=0;z<b.length&&!((f-=2)<0);++z)g=b.charCodeAt(z),T=g>>8,L=g%256,V.push(L),V.push(T);return V}function $(b){return e.toByteArray(S(b))}function q(b,f,g,T){let L;for(L=0;L<T&&!(L+g>=f.length||L>=b.length);++L)f[L+g]=b[L];return L}function j(b,f){return b instanceof f||b!=null&&b.constructor!=null&&b.constructor.name!=null&&b.constructor.name===f.name}function de(b){return b!==b}const be=function(){const b="0123456789abcdef",f=new Array(256);for(let g=0;g<16;++g){const T=g*16;for(let L=0;L<16;++L)f[T+L]=b[g]+b[L]}return f}();function fe(b){return typeof BigInt>"u"?ye:b}function ye(){throw new Error("BigInt not supported")}})(il);globalThis.Buffer=il.Buffer;class Q{static showStatus(e,t="info"){const n=document.getElementById("status");n&&(n.innerHTML=`<div class="status ${t}">${e}</div>`)}static showLoading(e){const t=document.getElementById("status");t&&(t.innerHTML=`<div class="status"><span class="loading"></span>${e}</div>`)}static clearStatus(){const e=document.getElementById("status");e&&(e.innerHTML="")}static selectAllFields(){document.querySelectorAll('#fieldsContainer input[type="checkbox"]').forEach(t=>t.checked=!0)}static deselectAllFields(){document.querySelectorAll('#fieldsContainer input[type="checkbox"]').forEach(t=>t.checked=!1)}static getSelectedFields(){const e=[];return document.querySelectorAll('#fieldsContainer input[type="checkbox"]:checked').forEach(n=>{e.push(n.value)}),e}}class yg{static exportToJSON(e){console.log("Export button clicked");try{const t=Q.getSelectedFields();if(console.log("Found checkboxes:",t.length),t.length===0){Q.showStatus("âš ï¸ Please select at least one field to export","error");return}if(!e){Q.showStatus("âŒ No data to export. Please upload and parse a FIT file first.","error");return}Q.showLoading("ðŸ”„ Generating JSON..."),console.log("Starting export with fields:",t);const n=this.buildExportData(e,t);console.log("Export data prepared:",n);const i=JSON.stringify(n,null,2);console.log("JSON string length:",i.length),this.downloadJSON(i,t.length)}catch(t){console.error("Export error:",t),Q.showStatus(`âŒ Export failed: ${t.message}`,"error")}}static testExport(){console.log("Testing export functionality...");const e={metadata:{exportDate:new Date().toISOString(),testMode:!0},data:{sample:[{field1:"value1",field2:123},{field1:"value2",field2:456}]}};try{const t=JSON.stringify(e,null,2);this.downloadFile(t,"test_export.json","application/json"),Q.showStatus("âœ… Test export successful! Check your downloads.","success")}catch(t){console.error("Test export failed:",t),Q.showStatus(`âŒ Test export failed: ${t.message}`,"error")}}static buildExportData(e,t){const n={metadata:{exportDate:new Date().toISOString(),selectedFields:t,totalRecords:{},fileHeader:e.header||{}},data:{}};return t.forEach(i=>{const[r,a]=i.split(".");console.log(`Processing ${r}.${a}`);const o=e[r];o&&Array.isArray(o)&&(n.data[r]||(n.data[r]=[],n.metadata.totalRecords[r]=o.length),o.forEach((l,u)=>{n.data[r][u]||(n.data[r][u]={}),n.data[r][u][a]=l[a]}))}),n}static downloadJSON(e,t){try{this.downloadFile(e,"garmin_data_export.json","application/json"),Q.showStatus(`âœ… JSON exported successfully! (${t} fields)`,"success")}catch(n){console.error("Download error:",n);const i=window.open();i&&(i.document.write("<pre>"+e+"</pre>"),i.document.title="Garmin Data Export"),Q.showStatus("âœ… JSON opened in new window (download failed)","success")}}static downloadFile(e,t,n){const i=new Blob([e],{type:n}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=t,a.style.display="none",document.body.appendChild(a),console.log("Triggering download..."),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(r)},1e3)}}const vg="modulepreload",wg=function(s){return"/"+s},tu={},sl=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=wg(l),l in tu)return;tu[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":vg,u||(p.as="script"),p.crossOrigin="",p.href=l,o&&p.setAttribute("nonce",o),document.head.appendChild(p),u)return new Promise((m,w)=>{p.addEventListener("load",m),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})},ac=class ac{static matchWorkout(e,t,n,i={}){const r={...this.DEFAULT_CONFIG,...i},o=this.findCandidateWorkouts(e,n,r.dateToleranceDays).map(d=>({plannedWorkout:d,confidence:this.calculateMatchConfidence(e,d,r),matchReasons:this.generateMatchReasons(e,d)})).sort((d,p)=>p.confidence-d.confidence),l=o.length>0?o[0]:void 0,u=l?l.confidence>=75:!1;return{fitFile:{fileName:e.fileName||"unknown.fit",activityData:e,lapData:t},matches:o,recommendation:{bestMatch:l==null?void 0:l.plannedWorkout,confidence:(l==null?void 0:l.confidence)||0,shouldAutoMatch:u,alternatives:o.slice(1,4).map(d=>d.plannedWorkout)}}}static createTrackedWorkout(e,t,n){const i={...e,status:t?"completed":"planned",actualWorkout:t,actualLaps:n,completedAt:t?t.date+"T12:00:00Z":void 0,uploadedAt:t?new Date().toISOString():void 0};return t&&(i.comparison=this.generateWorkoutComparison(e,t)),i}static generateWorkoutComparison(e,t){const n=e.durationMin,i=t.duration,r=i-n,a=n>0?r/n*100:0,o=this.estimatePlannedZones(e),l={zone1:t.zone1Minutes,zone2:t.zone2Minutes,zone3:t.zone3Minutes,zone4:t.zone4Minutes,zone5:t.zone5Minutes},u=this.calculateZoneCompliance(o,l),d=Math.min(100,Math.max(0,t.trainingLoad/5)),p=d-e.expectedFatigue,m=t.trainingLoad-e.expectedFatigue*5,w=this.calculateAdherenceScore(a,p,u.compliance.overallCompliance);return{durationVariance:{planned:n,actual:i,difference:r,percentageChange:a},intensityVariance:{plannedFatigue:e.expectedFatigue,actualFatigue:d,difference:p,zoneCompliance:u},performance:{trainingLoadVariance:m,hrDrift:t.hrDrift,paceConsistency:this.calculatePaceConsistency(t),powerConsistency:void 0},adherence:{score:w,category:this.getAdherenceCategory(w),feedback:this.generateAdherenceFeedback(a,p,u)}}}static findCandidateWorkouts(e,t,n){const i=new Date(e.date);return t.filter(r=>{const a=new Date(r.date);return Math.abs((i.getTime()-a.getTime())/(1e3*60*60*24))<=n})}static calculateMatchConfidence(e,t,n){let i=0;const r=new Date(e.date),a=new Date(t.date),o=Math.abs((r.getTime()-a.getTime())/(1e3*60*60*24)),l=Math.max(0,30-o*15);i+=l;const u=this.calculateTypeMatchScore(e.sport,t.workoutType);i+=u*n.typeMatchWeight*100;const d=Math.abs(e.duration-t.durationMin),p=Math.max(0,30-d/t.durationMin*30);return i+=p*n.durationMatchWeight*100,Math.min(100,Math.max(0,i))}static calculateTypeMatchScore(e,t){const n=e.toLowerCase(),i=t.toLowerCase();return n===i||(n==="running"||n==="run")&&i==="run"||(n==="cycling"||n==="bike")&&i==="bike"||n==="strength"&&i==="strength"?1:n.includes("run")&&i==="run"||n.includes("bike")&&i==="bike"||n.includes("swim")&&i==="swim"?.8:i==="brick"&&(n.includes("run")||n.includes("bike"))?.6:.1}static generateMatchReasons(e,t){const n=[],i=new Date(e.date),r=new Date(t.date),a=Math.abs((i.getTime()-r.getTime())/(1e3*60*60*24));a===0?n.push("Same date"):a===1&&n.push("Adjacent date (1 day difference)");const o=this.calculateTypeMatchScore(e.sport,t.workoutType);o>=.8?n.push("Matching workout type"):o>=.5&&n.push("Similar workout type");const u=Math.abs(e.duration-t.durationMin)/t.durationMin*100;return u<=10?n.push("Very similar duration"):u<=25&&n.push("Similar duration"),n}static estimatePlannedZones(e){const t=e.durationMin,n=e.expectedFatigue;return n<=40?{zone1:t*.3,zone2:t*.7,zone3:0,zone4:0,zone5:0}:n<=65?{zone1:t*.2,zone2:t*.6,zone3:t*.2,zone4:0,zone5:0}:n<=85?{zone1:t*.1,zone2:t*.4,zone3:t*.3,zone4:t*.2,zone5:0}:{zone1:t*.05,zone2:t*.25,zone3:t*.3,zone4:t*.3,zone5:t*.1}}static calculateZoneCompliance(e,t){const n={zone1Variance:t.zone1-e.zone1,zone2Variance:t.zone2-e.zone2,zone3Variance:t.zone3-e.zone3,zone4Variance:t.zone4-e.zone4,zone5Variance:t.zone5-e.zone5,overallCompliance:0},i=Object.values(e).reduce((a,o)=>a+o,0),r=Object.values(n).slice(0,5).reduce((a,o)=>a+Math.abs(o),0);return n.overallCompliance=i>0?Math.max(0,100-r/i*100):100,{plannedZones:e,actualZones:t,compliance:n}}static calculateAdherenceScore(e,t,n){const i=Math.max(0,100-Math.abs(e)),r=Math.max(0,100-Math.abs(t)*2),a=n;return Math.round(i*.3+r*.4+a*.3)}static getAdherenceCategory(e){return e>=85?"excellent":e>=70?"good":e>=50?"fair":"poor"}static generateAdherenceFeedback(e,t,n){const i=[];return Math.abs(e)<=5?i.push("Duration matched plan perfectly"):e>5?i.push(`Workout was ${Math.round(e)}% longer than planned`):i.push(`Workout was ${Math.round(Math.abs(e))}% shorter than planned`),Math.abs(t)<=5?i.push("Intensity matched plan well"):t>5?i.push("Workout was more intense than planned"):i.push("Workout was less intense than planned"),n.compliance.overallCompliance>=80?i.push("Excellent heart rate zone distribution"):n.compliance.overallCompliance>=60?i.push("Good heart rate zone distribution"):i.push("Heart rate zones deviated from plan"),i}static calculatePaceConsistency(e){return e.avgPace?.05:void 0}};ac.DEFAULT_CONFIG={dateToleranceDays:1,typeMatchWeight:.4,durationMatchWeight:.3,autoMatchEnabled:!0};let Pi=ac;const mt=[{type:"run",tag:"zone1",description:"Easy recovery run, conversational pace",durationMin:25,fatigueScore:25,recoveryImpact:"low",phase:"recovery"},{type:"run",tag:"zone2",description:"Aerobic base run, comfortable effort",durationMin:35,fatigueScore:45,recoveryImpact:"low"},{type:"run",tag:"zone3",description:"Tempo run, comfortably hard effort",durationMin:30,fatigueScore:65,recoveryImpact:"medium"},{type:"run",tag:"threshold",description:"Lactate threshold intervals",durationMin:40,fatigueScore:75,recoveryImpact:"high",phase:"build"},{type:"run",tag:"strides",description:"Easy run with 4-6 x 20s strides",durationMin:35,fatigueScore:50,recoveryImpact:"medium"},{type:"run",tag:"intervals",description:"VO2max intervals, 3-5 min efforts",durationMin:45,fatigueScore:85,recoveryImpact:"high",phase:"build"},{type:"bike",tag:"zone1",description:"Recovery spin, very easy effort",durationMin:30,fatigueScore:20,recoveryImpact:"restorative",phase:"recovery"},{type:"bike",tag:"zone2",description:"Aerobic base ride, conversational",durationMin:45,fatigueScore:45,recoveryImpact:"low"},{type:"bike",tag:"zone3",description:"Tempo ride, moderate effort",durationMin:40,fatigueScore:60,recoveryImpact:"medium"},{type:"bike",tag:"threshold",description:"FTP intervals, sustained efforts",durationMin:50,fatigueScore:80,recoveryImpact:"high",phase:"build"},{type:"bike",tag:"intervals",description:"High-intensity intervals",durationMin:45,fatigueScore:85,recoveryImpact:"high",phase:"build"},{type:"brick",tag:"zone2",description:"Easy brick: 25 min bike + 10 min run",durationMin:40,fatigueScore:55,recoveryImpact:"medium"},{type:"brick",tag:"zone3",description:"Race pace brick: 30 min bike + 15 min run",durationMin:50,fatigueScore:70,recoveryImpact:"high",phase:"build"},{type:"brick",tag:"threshold",description:"Hard brick: Threshold bike + tempo run",durationMin:60,fatigueScore:85,recoveryImpact:"high",phase:"peak"},{type:"strength",tag:"strength",description:"Core strength + bodyweight exercises",durationMin:30,fatigueScore:30,recoveryImpact:"low"},{type:"strength",tag:"strength",description:"Full body strength training",durationMin:45,fatigueScore:40,recoveryImpact:"medium"},{type:"mobility",tag:"mobility",description:"Yoga flow for recovery",durationMin:20,fatigueScore:10,recoveryImpact:"restorative"},{type:"mobility",tag:"mobility",description:"Dynamic stretching + foam rolling",durationMin:15,fatigueScore:5,recoveryImpact:"restorative"},{type:"rest",tag:"zone1",description:"Complete rest or gentle walk",durationMin:0,fatigueScore:0,recoveryImpact:"restorative"},{type:"swim",tag:"zone2",description:"Aerobic swim, steady pace",durationMin:35,fatigueScore:40,recoveryImpact:"low"},{type:"swim",tag:"threshold",description:"Swim intervals, race pace",durationMin:45,fatigueScore:70,recoveryImpact:"medium",phase:"build"}];class Le{static getWorkoutsByPhase(e){return mt.filter(t=>!t.phase||t.phase===e)}static getWorkoutsByType(e){return mt.filter(t=>t.type===e)}static getWorkoutByTypeAndTag(e,t){return mt.find(n=>n.type===e&&n.tag===t)}static getRecoveryWorkouts(){return mt.filter(e=>e.recoveryImpact==="restorative"||e.fatigueScore<=20)}static getEasyWorkouts(){return mt.filter(e=>e.fatigueScore<=50&&e.recoveryImpact!=="high")}static getHardWorkouts(){return mt.filter(e=>e.fatigueScore>=70)}static adjustWorkoutForFitnessLevel(e,t){if(!e)return console.warn("No workout provided to adjustWorkoutForFitnessLevel, using fallback"),{type:"rest",tag:"zone1",description:"Rest day - recovery",durationMin:0,fatigueScore:0,recoveryImpact:"restorative"};const i={beginner:{duration:.7,fatigue:.8},intermediate:{duration:1,fatigue:1},advanced:{duration:1.3,fatigue:1.1}}[t];return{...e,durationMin:Math.round(e.durationMin*i.duration),fatigueScore:Math.min(100,Math.round(e.fatigueScore*i.fatigue))}}}const oc=class oc{static generateEnhancedPlan(e){const t=this.analyzeActivityPattern(e),n=this.calculateEnhancedReadinessMetrics(e,t),i=[],r=[],a=[];this.addActivityPatternInsights(t,i);const o=new Date;for(let l=0;l<e.planDuration;l++){const u=new Date(o);u.setDate(o.getDate()+l);const d=this.selectEnhancedWorkoutForDay(e,n,t,a,l,i,r);d&&a.push({date:this.formatDate(u),workoutType:d.type,description:d.description,expectedFatigue:d.fatigueScore,durationMin:d.durationMin,workoutId:`${d.type}-${d.tag}`,completed:!1})}return this.addEnhancedRecommendations(n,t,i,r),{plan:a,readinessMetrics:n,recommendations:i,warnings:r,generatedAt:new Date().toISOString()}}static generatePlan(e){const t=this.calculateReadinessMetrics(e),n=[],i=[],r=[],a=new Date;for(let o=0;o<e.planDuration;o++){const l=new Date(a);l.setDate(a.getDate()+o);const u=this.selectWorkoutForDay(e,t,r,o,n,i);u&&r.push({date:this.formatDate(l),workoutType:u.type,description:u.description,expectedFatigue:u.fatigueScore,durationMin:u.durationMin,workoutId:`${u.type}-${u.tag}`,completed:!1})}return this.addGeneralRecommendations(t,n,i),{plan:r,readinessMetrics:t,recommendations:n,warnings:i,generatedAt:new Date().toISOString()}}static calculateReadinessMetrics(e){const t=this.average(e.recentFatigueScores),n=e.recentWorkouts.reduce((d,p)=>d+(p.trainingLoad||0),0),i=e.recentWorkouts.filter(d=>d.fatigue>60).length;let r=70,a=0,o=0;if(e.recoveryMetrics.bodyBattery&&(a+=e.recoveryMetrics.bodyBattery,o++),e.recoveryMetrics.sleepScore&&(a+=e.recoveryMetrics.sleepScore,o++),e.recoveryMetrics.hrv){const d=Math.min(100,e.recoveryMetrics.hrv*2);a+=d,o++}o>0&&(r=a/o);let l=100;t>60&&(l-=20),t>75&&(l-=10),i>=3&&(l-=15),i>=4&&(l-=15),r>80&&(l+=10),r<40&&(l-=20);let u;if(e.user.eventDate){const d=new Date(e.user.eventDate),p=new Date;u=Math.ceil((d.getTime()-p.getTime())/(1e3*60*60*24))}return{score:Math.max(0,Math.min(100,l)),fatigue7DayAvg:t,recoveryScore:r,trainingLoad7Day:n,daysUntilRace:u,recentHardDays:i}}static selectWorkoutForDay(e,t,n,i,r,a){if(i===0&&e.availabilityToday===!1)return Le.getWorkoutByTypeAndTag("rest","zone1")||null;const o=n.filter(p=>p.expectedFatigue>60).length,l=n[n.length-1],u=l&&l.expectedFatigue>60,d=this.determinePhase(e,t);return t.score<40?(a.push("Low readiness detected - recommending recovery"),this.selectRecoveryWorkout()):u?this.selectEasyWorkout(d,e.user.fitnessLevel):o>=this.MAX_HARD_WORKOUTS_PER_WEEK?this.selectEasyWorkout(d,e.user.fitnessLevel):t.recentHardDays>=3?(r.push("Taking extra recovery due to recent high training load"),this.selectRecoveryWorkout()):t.score>70&&o<this.MAX_HARD_WORKOUTS_PER_WEEK?this.selectHardWorkout(d,e.user.fitnessLevel):t.score>50?this.selectModerateWorkout(d,e.user.fitnessLevel):this.selectEasyWorkout(d,e.user.fitnessLevel)}static determinePhase(e,t){if(e.currentPhase)return e.currentPhase;if(!t.daysUntilRace)return"base";const n=t.daysUntilRace;return n<=14?"taper":n<=28?"peak":n<=84?"build":"base"}static selectRecoveryWorkout(){const e=Le.getRecoveryWorkouts();return e.length===0?(console.warn("No recovery workouts found, using fallback rest day"),{type:"rest",tag:"zone1",description:"Complete rest day",durationMin:0,fatigueScore:0,recoveryImpact:"restorative"}):this.randomChoice(e)}static selectEasyWorkout(e,t){const n=Le.getEasyWorkouts().filter(o=>!o.phase||o.phase===e),i=n.length>0?n:Le.getEasyWorkouts(),r=i.length>0?i:Le.getRecoveryWorkouts(),a=this.randomChoice(r);return Le.adjustWorkoutForFitnessLevel(a,t)}static selectModerateWorkout(e,t){const n=mt.filter(o=>o.fatigueScore>=45&&o.fatigueScore<=65&&(!o.phase||o.phase===e)),i=n.length>0?n:mt.filter(o=>o.fatigueScore>=45&&o.fatigueScore<=65),r=i.length>0?i:Le.getEasyWorkouts(),a=this.randomChoice(r);return Le.adjustWorkoutForFitnessLevel(a,t)}static selectHardWorkout(e,t){const n=Le.getHardWorkouts().filter(l=>!l.phase||l.phase===e),i=n.length>0?n:Le.getHardWorkouts();let r=i;if(e==="build"||e==="peak"){const l=i.filter(u=>u.type==="brick");l.length>0&&Math.random()<.4&&(r=l)}const a=r.length>0?r:mt.filter(l=>l.fatigueScore>=45&&l.fatigueScore<=65),o=this.randomChoice(a);return Le.adjustWorkoutForFitnessLevel(o,t)}static addGeneralRecommendations(e,t,n){e.score>85&&t.push("Excellent readiness - good opportunity for quality training"),e.fatigue7DayAvg>70&&n.push("High average fatigue - consider reducing training intensity"),e.recentHardDays>=3&&n.push("High recent training load - prioritizing recovery"),e.daysUntilRace&&e.daysUntilRace<=7&&t.push("Race week detected - focusing on taper and preparation"),e.recoveryScore<30&&n.push("Poor recovery metrics - ensure adequate sleep and nutrition")}static average(e){return e.length===0?0:e.reduce((t,n)=>t+n,0)/e.length}static randomChoice(e){if(e.length===0)throw new Error("Cannot select from empty array");return e[Math.floor(Math.random()*e.length)]}static formatDate(e){return e.toISOString().split("T")[0]}static analyzeActivityPattern(e){const t=e.historicalActivities||[];if(t.length===0)return{preferredSports:["running"],averageWeeklyDistance:0,averageWeeklyDuration:0,averageTrainingLoad:0,consistencyScore:0,strongDays:[],preferredIntensityDistribution:{easy:.7,moderate:.2,hard:.1}};const n=t.reduce((C,I)=>(C[I.sport]=(C[I.sport]||0)+1,C),{}),i=Object.entries(n).sort(([,C],[,I])=>I-C).slice(0,3).map(([C])=>C),r=t.filter(C=>{const I=new Date(C.date),B=new Date;return B.setDate(B.getDate()-56),I>=B}),a=this.groupActivitiesByWeek(r),o=a.map(C=>C.reduce((I,B)=>I+B.distance,0)),l=a.map(C=>C.reduce((I,B)=>I+B.duration,0)),u=a.map(C=>C.reduce((I,B)=>I+B.trainingLoad,0)),d=a.filter(C=>C.length>0).length,p=a.length>0?d/a.length*100:0,m=t.reduce((C,I)=>{const B=new Date(I.date).getDay(),G=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][B];return C[G]||(C[G]={count:0,totalLoad:0}),C[G].count++,C[G].totalLoad+=I.trainingLoad,C},{}),w=Object.entries(m).filter(([,C])=>C.count>=3).sort(([,C],[,I])=>I.totalLoad/I.count-C.totalLoad/C.count).slice(0,3).map(([C])=>C),E=this.analyzeIntensityDistribution(t);return{preferredSports:i,averageWeeklyDistance:this.average(o),averageWeeklyDuration:this.average(l),averageTrainingLoad:this.average(u),consistencyScore:p,strongDays:w,preferredIntensityDistribution:E}}static calculateEnhancedReadinessMetrics(e,t){const n=this.calculateReadinessMetrics(e);let i=n.score;t.consistencyScore>80?i+=5:t.consistencyScore<40&&(i-=10);const r=this.analyzeRecentProgression(e.historicalActivities||[]);return r>.1?i+=5:r<-.2&&(i-=15),{...n,score:Math.max(0,Math.min(100,i))}}static selectEnhancedWorkoutForDay(e,t,n,i,r,a,o){const l=new Date;l.setDate(l.getDate()+r);const u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][l.getDay()],d=n.strongDays.includes(u),p=this.selectWorkoutForDay(e,t,i,r,a,o);if(!p)return null;if(e.excludedExercises&&e.excludedExercises.length>0&&this.isWorkoutExcluded(p,e.excludedExercises)){const w=this.findAlternativeWorkout(p,e.excludedExercises,t,l);return w?(a.push(`Swapped ${p.type} for ${w.type} due to exercise restrictions`),w):(a.push(`No suitable alternative found for ${p.type}, suggesting rest day`),Le.getWorkoutByTypeAndTag("rest","zone1")||null)}const m=this.enhanceWorkoutWithPattern(p,n,d);if(n.preferredSports.length>0&&Math.random()<.7){const w=this.randomChoice(n.preferredSports),E=mt.filter(C=>C.type.toLowerCase().includes(w.toLowerCase())||C.description.toLowerCase().includes(w.toLowerCase()));if(E.length>0){const C=E.find(I=>Math.abs(I.fatigueScore-m.fatigueScore)<=10);if(C)return C}}return m}static addActivityPatternInsights(e,t){e.consistencyScore>80?t.push(`Excellent consistency (${e.consistencyScore.toFixed(0)}%) - maintaining current training frequency`):e.consistencyScore<40&&t.push(`Low consistency detected (${e.consistencyScore.toFixed(0)}%) - focusing on sustainable routine`),e.strongDays.length>0&&t.push(`Your strongest days: ${e.strongDays.join(", ")} - scheduling key workouts accordingly`),e.averageWeeklyDistance>0&&t.push(`Based on your average ${e.averageWeeklyDistance.toFixed(1)}km/week - adjusting distances appropriately`),e.preferredSports.length>0&&t.push(`Incorporating your preferred activities: ${e.preferredSports.join(", ")}`)}static addEnhancedRecommendations(e,t,n,i){if(this.addGeneralRecommendations(e,n,i),t.averageTrainingLoad>0){const a=e.trainingLoad7Day,o=t.averageTrainingLoad;a>o*1.3?i.push("Current training load is 30% above your historical average - consider reducing intensity"):a<o*.7&&n.push("Training load is below your historical average - opportunity to increase volume")}const r=t.preferredIntensityDistribution.easy;r<.6?i.push("Historical data shows high intensity focus - adding more easy/recovery sessions"):r>.85&&n.push("Good easy training base - can handle more intensity for progression")}static groupActivitiesByWeek(e){const t=[],n=[...e].sort((a,o)=>new Date(a.date).getTime()-new Date(o.date).getTime());if(n.length===0)return[];let i=[],r=this.getWeekStart(new Date(n[0].date));for(const a of n){const o=new Date(a.date),l=this.getWeekStart(o);l.getTime()!==r.getTime()&&(i.length>0&&t.push(i),i=[],r=l),i.push(a)}return i.length>0&&t.push(i),t}static getWeekStart(e){const t=new Date(e);return t.setDate(e.getDate()-e.getDay()),t.setHours(0,0,0,0),t}static analyzeIntensityDistribution(e){if(e.length===0)return{easy:.7,moderate:.2,hard:.1};const t=e.length,n=e.filter(a=>a.trainingLoad<150).length,i=e.filter(a=>a.trainingLoad>300).length,r=t-n-i;return{easy:n/t,moderate:r/t,hard:i/t}}static analyzeRecentProgression(e){if(e.length<6)return 0;const t=[...e].sort((o,l)=>new Date(o.date).getTime()-new Date(l.date).getTime()),n=t.slice(0,Math.floor(t.length/2)),i=t.slice(Math.floor(t.length/2)),r=this.average(n.map(o=>o.trainingLoad)),a=this.average(i.map(o=>o.trainingLoad));return r>0?(a-r)/r:0}static enhanceWorkoutWithPattern(e,t,n){let i=e.durationMin;if(t.averageWeeklyDuration>0){const a=t.averageWeeklyDuration/4;a>45?i=Math.min(e.durationMin*1.2,e.durationMin+15):a<30&&(i=Math.max(e.durationMin*.8,e.durationMin-10))}let r=e.fatigueScore;return n&&e.fatigueScore<80&&(r=Math.min(100,e.fatigueScore+5)),{...e,durationMin:Math.round(i),fatigueScore:r,description:n?`${e.description} (scheduled on your strong day)`:e.description}}static exportPlanToCSV(e){const t=["Date","Workout Type","Description","Duration (min)","Expected Fatigue"],n=e.map(r=>[r.date,r.workoutType,r.description,r.durationMin.toString(),r.expectedFatigue.toString()]);return[t,...n].map(r=>r.map(a=>`"${a}"`).join(",")).join(`
`)}static isWorkoutExcluded(e,t){if(!e||!t||t.length===0)return!1;const n={swimming:["swim","easy_swim","tempo_swim","interval_swim"],running:["run","easy_run","tempo_run","interval_run","long_run","recovery_run","fartlek","hill_repeats","track_workout"],cycling:["bike","easy_bike","tempo_bike","interval_bike","endurance_bike","recovery_bike"],strength:["strength","strength_training","resistance"],yoga:["yoga","mobility","flexibility"],hiit:["hiit","interval","crosstraining"]};for(const i of t)if((n[i]||[]).includes(e.type))return!0;return!1}static findAlternativeWorkout(e,t,n,i){const r=mt,a=r.filter(o=>{if(this.isWorkoutExcluded(o,t))return!1;const l=Math.abs(o.fatigueScore-e.fatigueScore)<=20,u=Math.abs(o.durationMin-e.durationMin)<=30;return l&&u});if(a.length===0){const o=r.filter(u=>!this.isWorkoutExcluded(u,t)),l=o.filter(u=>u.fatigueScore>=30&&u.fatigueScore<=50);return l.length>0?l[0]:o.length>0?o[0]:null}return a[0]}};oc.MAX_HARD_WORKOUTS_PER_WEEK=2;let Do=oc;var th={},qi={},ji={};Object.defineProperty(ji,"__esModule",{value:!0});ji.getMessageName=kg;ji.getFieldObject=Eg;var nu=1e3,iu=3600,su=1609.344,ru=100,bg=14.5037738,nh=ji.FIT={scConst:180/Math.pow(2,31),options:{speedUnits:{"m/s":{multiplier:1,offset:0},mph:{multiplier:iu/su,offset:0},"km/h":{multiplier:iu/nu,offset:0}},lengthUnits:{m:{multiplier:1,offset:0},mi:{multiplier:1/su,offset:0},km:{multiplier:1/nu,offset:0}},temperatureUnits:{"Â°C":{multiplier:1,offset:0},kelvin:{multiplier:1,offset:-273.15},fahrenheit:{multiplier:9/5,offset:32}},pressureUnits:{cbar:{multiplier:1,offset:0},bar:{multiplier:1/ru,offset:0},psi:{multiplier:1/ru*bg,offset:0}}},messages:{0:{name:"file_id",0:{field:"type",type:"file",scale:null,offset:"",units:""},1:{field:"manufacturer",type:"manufacturer",scale:null,offset:"",units:""},2:{field:"product",type:"uint16",scale:null,offset:"",units:""},3:{field:"serial_number",type:"uint32z",scale:null,offset:"",units:""},4:{field:"time_created",type:"date_time",scale:null,offset:"",units:""},5:{field:"number",type:"uint16",scale:null,offset:"",units:""},8:{field:"product_name",type:"string",scale:null,offset:"",units:""}},1:{name:"capabilities",0:{field:"languages",type:"uint8z",scale:null,offset:"",units:""},1:{field:"sports",type:"sport_bits_0",scale:null,offset:"",units:""},21:{field:"workouts_supported",type:"workout_capabilities",scale:null,offset:"",units:""},23:{field:"connectivity_supported",type:"connectivity_capabilities",scale:null,offset:"",units:""}},2:{name:"device_settings",0:{field:"active_time_zone",type:"uint8",scale:null,offset:"",units:""},1:{field:"utc_offset",type:"uint32",scale:null,offset:"",units:""},2:{field:"time_offset",type:"uint32",scale:null,offset:"",units:"s"},5:{field:"time_zone_offset",type:"sint8",scale:4,offset:"",units:"hr"},55:{field:"display_orientation",type:"display_orientation",scale:null,offset:"",units:""},56:{field:"mounting_side",type:"side",scale:null,offset:"",units:""},94:{field:"number_of_screens",type:"uint8",scale:null,offset:"",units:""},95:{field:"smart_notification_display_orientation",type:"display_orientation",scale:null,offset:"",units:""}},3:{name:"user_profile",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},0:{field:"friendly_name",type:"string",scale:null,offset:0,units:""},1:{field:"gender",type:"gender",scale:null,offset:0,units:""},2:{field:"age",type:"uint8",scale:null,offset:0,units:"years"},3:{field:"height",type:"uint8",scale:100,offset:0,units:"m"},4:{field:"weight",type:"uint16",scale:10,offset:0,units:"kg"},5:{field:"language",type:"language",scale:null,offset:0,units:""},6:{field:"elev_setting",type:"display_measure",scale:null,offset:0,units:""},7:{field:"weight_setting",type:"display_measure",scale:null,offset:0,units:""},8:{field:"resting_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},9:{field:"default_max_running_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},10:{field:"default_max_biking_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},11:{field:"default_max_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},12:{field:"hr_setting",type:"display_heart",scale:null,offset:0,units:""},13:{field:"speed_setting",type:"display_measure",scale:null,offset:0,units:""},14:{field:"dist_setting",type:"display_measure",scale:null,offset:0,units:""},16:{field:"power_setting",type:"display_power",scale:null,offset:0,units:""},17:{field:"activity_class",type:"activity_class",scale:null,offset:0,units:""},18:{field:"position_setting",type:"display_position",scale:null,offset:0,units:""},21:{field:"temperature_setting",type:"display_measure",scale:null,offset:0,units:""},22:{field:"local_id",type:"user_local_id",scale:null,offset:0,units:""},23:{field:"global_id",type:"byte",scale:null,offset:0,units:""},28:{field:"wake_time",type:"localtime_into_day",scale:null,offset:0,units:""},29:{field:"sleep_time",type:"localtime_into_day",scale:null,offset:0,units:""},30:{field:"height_setting",type:"display_measure",scale:null,offset:0,units:""}},4:{name:"hrm_profile",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"enabled",type:"bool",scale:null,offset:"",units:""},1:{field:"hrm_ant_id",type:"uint16z",scale:null,offset:"",units:""},2:{field:"log_hrv",type:"bool",scale:null,offset:"",units:""},3:{field:"hrm_ant_id_trans_type",type:"uint8z",scale:null,offset:"",units:""}},5:{name:"sdm_profile",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"enabled",type:"bool",scale:null,offset:"",units:""},1:{field:"sdm_ant_id",type:"uint16z",scale:null,offset:"",units:""},2:{field:"sdm_cal_factor",type:"uint16",scale:10,offset:"",units:"%"},3:{field:"odometer",type:"uint32",scale:100,offset:"",units:"m"},4:{field:"speed_source",type:"bool",scale:null,offset:"",units:""},5:{field:"sdm_ant_id_trans_type",type:"uint8z",scale:null,offset:"",units:""},7:{field:"odometer_rollover",type:"uint8",scale:null,offset:"",units:""}},6:{name:"bike_profile",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},0:{field:"name",type:"string",scale:null,offset:0,units:""},1:{field:"sport",type:"sport",scale:null,offset:0,units:""},2:{field:"sub_sport",type:"sub_sport",scale:null,offset:0,units:""},3:{field:"odometer",type:"uint32",scale:100,offset:0,units:"m"},4:{field:"bike_spd_ant_id",type:"uint16z",scale:null,offset:0,units:""},5:{field:"bike_cad_ant_id",type:"uint16z",scale:null,offset:0,units:""},6:{field:"bike_spdcad_ant_id",type:"uint16z",scale:null,offset:0,units:""},7:{field:"bike_power_ant_id",type:"uint16z",scale:null,offset:0,units:""},8:{field:"custom_wheelsize",type:"uint16",scale:1e3,offset:0,units:"m"},9:{field:"auto_wheelsize",type:"uint16",scale:1e3,offset:0,units:"m"},10:{field:"bike_weight",type:"uint16",scale:10,offset:0,units:"kg"},11:{field:"power_cal_factor",type:"uint16",scale:10,offset:0,units:"%"},12:{field:"auto_wheel_cal",type:"bool",scale:null,offset:0,units:""},13:{field:"auto_power_zero",type:"bool",scale:null,offset:0,units:""},14:{field:"id",type:"uint8",scale:null,offset:0,units:""},15:{field:"spd_enabled",type:"bool",scale:null,offset:0,units:""},16:{field:"cad_enabled",type:"bool",scale:null,offset:0,units:""},17:{field:"spdcad_enabled",type:"bool",scale:null,offset:0,units:""},18:{field:"power_enabled",type:"bool",scale:null,offset:0,units:""},19:{field:"crank_length",type:"uint8",scale:2,offset:-110,units:"mm"},20:{field:"enabled",type:"bool",scale:null,offset:0,units:""},21:{field:"bike_spd_ant_id_trans_type",type:"uint8z",scale:null,offset:0,units:""},22:{field:"bike_cad_ant_id_trans_type",type:"uint8z",scale:null,offset:0,units:""},23:{field:"bike_spdcad_ant_id_trans_type",type:"uint8z",scale:null,offset:0,units:""},24:{field:"bike_power_ant_id_trans_type",type:"uint8z",scale:null,offset:0,units:""},37:{field:"odometer_rollover",type:"uint8",scale:null,offset:0,units:""},38:{field:"front_gear_num",type:"uint8z",scale:null,offset:0,units:""},39:{field:"front_gear",type:"uint8z",scale:null,offset:0,units:""},40:{field:"rear_gear_num",type:"uint8z",scale:null,offset:0,units:""},41:{field:"rear_gear",type:"uint8z",scale:null,offset:0,units:""},44:{field:"shimano_di2_enabled",type:"bool",scale:null,offset:0,units:""}},7:{name:"zones_target",1:{field:"max_heart_rate",type:"uint8",scale:null,offset:"",units:""},2:{field:"threshold_heart_rate",type:"uint8",scale:null,offset:"",units:""},3:{field:"functional_threshold_power",type:"uint16",scale:null,offset:"",units:""},5:{field:"hr_calc_type",type:"hr_zone_calc",scale:null,offset:"",units:""},7:{field:"pwr_calc_type",type:"pwr_zone_calc",scale:null,offset:"",units:""}},8:{name:"hr_zone",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},1:{field:"high_bpm",type:"uint8",scale:null,offset:0,units:"bpm"},2:{field:"name",type:"string",scale:null,offset:0,units:""}},9:{name:"power_zone",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},1:{field:"high_value",type:"uint16",scale:null,offset:0,units:"watts"},2:{field:"name",type:"string",scale:null,offset:0,units:""}},10:{name:"met_zone",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},1:{field:"high_bpm",type:"uint8",scale:null,offset:0,units:""},2:{field:"calories",type:"uint16",scale:10,offset:0,units:"kcal / min"},3:{field:"fat_calories",type:"uint8",scale:10,offset:0,units:"kcal / min"}},12:{name:"sport",0:{field:"sport",type:"sport",scale:null,offset:"",units:""},1:{field:"sub_sport",type:"sub_sport",scale:null,offset:"",units:""},3:{field:"name",type:"string",scale:null,offset:"",units:""}},15:{name:"goal",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"sport",type:"sport",scale:null,offset:"",units:""},1:{field:"sub_sport",type:"sub_sport",scale:null,offset:"",units:""},2:{field:"start_date",type:"date_time",scale:null,offset:"",units:""},3:{field:"end_date",type:"date_time",scale:null,offset:"",units:""},4:{field:"type",type:"goal",scale:null,offset:"",units:""},5:{field:"value",type:"uint32",scale:null,offset:"",units:""},6:{field:"repeat",type:"bool",scale:null,offset:"",units:""},7:{field:"target_value",type:"uint32",scale:null,offset:"",units:""},8:{field:"recurrence",type:"goal_recurrence",scale:null,offset:"",units:""},9:{field:"recurrence_value",type:"uint16",scale:null,offset:"",units:""},10:{field:"enabled",type:"bool",scale:null,offset:"",units:""}},18:{name:"session",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"event",type:"event",scale:null,offset:0,units:""},1:{field:"event_type",type:"event_type",scale:null,offset:0,units:""},2:{field:"start_time",type:"date_time",scale:null,offset:0,units:""},3:{field:"start_position_lat",type:"sint32",scale:null,offset:0,units:"semicircles"},4:{field:"start_position_long",type:"sint32",scale:null,offset:0,units:"semicircles"},5:{field:"sport",type:"sport",scale:null,offset:0,units:""},6:{field:"sub_sport",type:"sub_sport",scale:null,offset:0,units:""},7:{field:"total_elapsed_time",type:"uint32",scale:1e3,offset:0,units:"s"},8:{field:"total_timer_time",type:"uint32",scale:1e3,offset:0,units:"s"},9:{field:"total_distance",type:"uint32",scale:100,offset:0,units:"m"},10:{field:"total_cycles",type:"uint32",scale:null,offset:0,units:"cycles"},11:{field:"total_calories",type:"uint16",scale:null,offset:0,units:"kcal"},13:{field:"total_fat_calories",type:"uint16",scale:null,offset:0,units:"kcal"},14:{field:"avg_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},15:{field:"max_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},16:{field:"avg_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},17:{field:"max_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},18:{field:"avg_cadence",type:"uint8",scale:null,offset:0,units:"rpm"},19:{field:"max_cadence",type:"uint8",scale:null,offset:0,units:"rpm"},20:{field:"avg_power",type:"uint16",scale:null,offset:0,units:"watts"},21:{field:"max_power",type:"uint16",scale:null,offset:0,units:"watts"},22:{field:"total_ascent",type:"uint16",scale:null,offset:0,units:"m"},23:{field:"total_descent",type:"uint16",scale:null,offset:0,units:"m"},24:{field:"total_training_effect",type:"uint8",scale:10,offset:0,units:""},25:{field:"first_lap_index",type:"uint16",scale:null,offset:0,units:""},26:{field:"num_laps",type:"uint16",scale:null,offset:0,units:""},27:{field:"event_group",type:"uint8",scale:null,offset:0,units:""},28:{field:"trigger",type:"session_trigger",scale:null,offset:0,units:""},29:{field:"nec_lat",type:"sint32",scale:null,offset:0,units:"semicircles"},30:{field:"nec_long",type:"sint32",scale:null,offset:0,units:"semicircles"},31:{field:"swc_lat",type:"sint32",scale:null,offset:0,units:"semicircles"},32:{field:"swc_long",type:"sint32",scale:null,offset:0,units:"semicircles"},34:{field:"normalized_power",type:"uint16",scale:null,offset:0,units:"watts"},35:{field:"training_stress_score",type:"uint16",scale:10,offset:0,units:"tss"},36:{field:"intensity_factor",type:"uint16",scale:1e3,offset:0,units:"if"},37:{field:"left_right_balance",type:"left_right_balance_100",scale:100,offset:0,units:"%"},41:{field:"avg_stroke_count",type:"uint32",scale:10,offset:0,units:"strokes/lap"},42:{field:"avg_stroke_distance",type:"uint16",scale:100,offset:0,units:"m"},43:{field:"swim_stroke",type:"swim_stroke",scale:null,offset:0,units:"swim_stroke"},44:{field:"pool_length",type:"uint16",scale:100,offset:0,units:"m"},45:{field:"threshold_power",type:"uint16",scale:null,offset:0,units:"watts"},46:{field:"pool_length_unit",type:"display_measure",scale:null,offset:0,units:""},47:{field:"num_active_lengths",type:"uint16",scale:null,offset:0,units:"lengths"},48:{field:"total_work",type:"uint32",scale:null,offset:0,units:"J"},49:{field:"avg_altitude",type:"uint16",scale:5,offset:-500,units:"m"},50:{field:"max_altitude",type:"uint16",scale:5,offset:-500,units:"m"},51:{field:"gps_accuracy",type:"uint8",scale:null,offset:0,units:"m"},52:{field:"avg_grade",type:"sint16",scale:100,offset:0,units:"%"},53:{field:"avg_pos_grade",type:"sint16",scale:100,offset:0,units:"%"},54:{field:"avg_neg_grade",type:"sint16",scale:100,offset:0,units:"%"},55:{field:"max_pos_grade",type:"sint16",scale:100,offset:0,units:"%"},56:{field:"max_neg_grade",type:"sint16",scale:100,offset:0,units:"%"},57:{field:"avg_temperature",type:"sint8",scale:null,offset:0,units:"C"},58:{field:"max_temperature",type:"sint8",scale:null,offset:0,units:"C"},59:{field:"total_moving_time",type:"uint32",scale:1e3,offset:0,units:"s"},60:{field:"avg_pos_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},61:{field:"avg_neg_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},62:{field:"max_pos_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},63:{field:"max_neg_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},64:{field:"min_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},65:{field:"time_in_hr_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},66:{field:"time_in_speed_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},67:{field:"time_in_cadence_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},68:{field:"time_in_power_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},69:{field:"avg_lap_time",type:"uint32",scale:1e3,offset:0,units:"s"},70:{field:"best_lap_index",type:"uint16",scale:null,offset:0,units:""},71:{field:"min_altitude",type:"uint16",scale:5,offset:-500,units:"m"},82:{field:"player_score",type:"uint16",scale:null,offset:0,units:""},83:{field:"opponent_score",type:"uint16",scale:null,offset:0,units:""},84:{field:"opponent_name",type:"string",scale:null,offset:0,units:""},85:{field:"stroke_count",type:"uint16",scale:null,offset:0,units:"counts"},86:{field:"zone_count",type:"uint16",scale:null,offset:0,units:"counts"},87:{field:"max_ball_speed",type:"uint16",scale:100,offset:0,units:"m/s"},88:{field:"avg_ball_speed",type:"uint16",scale:100,offset:0,units:"m/s"},89:{field:"avg_vertical_oscillation",type:"uint16",scale:10,offset:0,units:"mm"},90:{field:"avg_stance_time_percent",type:"uint16",scale:100,offset:0,units:"percent"},91:{field:"avg_stance_time",type:"uint16",scale:10,offset:0,units:"ms"},92:{field:"avg_fractional_cadence",type:"uint8",scale:128,offset:0,units:"rpm"},93:{field:"max_fractional_cadence",type:"uint8",scale:128,offset:0,units:"rpm"},94:{field:"total_fractional_cycles",type:"uint8",scale:128,offset:0,units:"cycles"},95:{field:"avg_total_hemoglobin_conc",type:"uint16",scale:100,offset:0,units:"g/dL"},96:{field:"min_total_hemoglobin_conc",type:"uint16",scale:100,offset:0,units:"g/dL"},97:{field:"max_total_hemoglobin_conc",type:"uint16",scale:100,offset:0,units:"g/dL"},98:{field:"avg_saturated_hemoglobin_percent",type:"uint16",scale:10,offset:0,units:"%"},99:{field:"min_saturated_hemoglobin_percent",type:"uint16",scale:10,offset:0,units:"%"},100:{field:"max_saturated_hemoglobin_percent",type:"uint16",scale:10,offset:0,units:"%"},101:{field:"avg_left_torque_effectiveness",type:"uint8",scale:2,offset:0,units:"percent"},102:{field:"avg_right_torque_effectiveness",type:"uint8",scale:2,offset:0,units:"percent"},103:{field:"avg_left_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},104:{field:"avg_right_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},105:{field:"avg_combined_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},111:{field:"sport_index",type:"uint8",scale:null,offset:0,units:""},112:{field:"time_standing",type:"uint32",scale:1e3,offset:0,units:"s"},113:{field:"stand_count",type:"uint16",scale:null,offset:0,units:""},114:{field:"avg_left_pco",type:"sint8",scale:null,offset:0,units:"mm"},115:{field:"avg_right_pco",type:"sint8",scale:null,offset:0,units:"mm"},116:{field:"avg_left_power_phase",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},117:{field:"avg_left_power_phase_peak",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},118:{field:"avg_right_power_phase",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},119:{field:"avg_right_power_phase_peak",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},120:{field:"avg_power_position",type:"uint16",scale:null,offset:0,units:"watts"},121:{field:"max_power_position",type:"uint16",scale:null,offset:0,units:"watts"},122:{field:"avg_cadence_position",type:"uint8",scale:null,offset:0,units:"rpm"},123:{field:"max_cadence_position",type:"uint8",scale:null,offset:0,units:"rpm"},124:{field:"enhanced_avg_speed",type:"uint32",scale:1e3,offset:0,units:"m/s"},125:{field:"enhanced_max_speed",type:"uint32",scale:1e3,offset:0,units:"m/s"},126:{field:"enhanced_avg_altitude",type:"uint32",scale:5,offset:-500,units:"m"},127:{field:"enhanced_min_altitude",type:"uint32",scale:5,offset:-500,units:"m"},128:{field:"enhanced_max_altitude",type:"uint32",scale:5,offset:-500,units:"m"},129:{field:"avg_lev_motor_power",type:"uint16",scale:null,offset:0,units:"watts"},130:{field:"max_lev_motor_power",type:"uint16",scale:null,offset:0,units:"watts"},131:{field:"lev_battery_consumption",type:"uint8",scale:2,offset:0,units:"percent"},132:{field:"avg_vertical_ratio",type:"uint16",scale:100,offset:0,units:"percent"},133:{field:"avg_stance_time_balance",type:"uint16",scale:100,offset:0,units:"percent"},134:{field:"avg_step_length",type:"uint16",scale:10,offset:0,units:"mm"},137:{field:"total_anaerobic_effect",type:"uint8",scale:10,offset:0,units:""},139:{field:"avg_vam",type:"uint16",scale:1e3,offset:0,units:"m/s"},192:{field:"workout_feel",type:"uint8",scale:null,offset:0,units:""},193:{field:"workout_rpe",type:"uint8",scale:10,offset:0,units:""}},19:{name:"lap",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"event",type:"event",scale:null,offset:0,units:""},1:{field:"event_type",type:"event_type",scale:null,offset:0,units:""},2:{field:"start_time",type:"date_time",scale:null,offset:0,units:""},3:{field:"start_position_lat",type:"sint32",scale:null,offset:0,units:"semicircles"},4:{field:"start_position_long",type:"sint32",scale:null,offset:0,units:"semicircles"},5:{field:"end_position_lat",type:"sint32",scale:null,offset:0,units:"semicircles"},6:{field:"end_position_long",type:"sint32",scale:null,offset:0,units:"semicircles"},7:{field:"total_elapsed_time",type:"uint32",scale:1e3,offset:0,units:"s"},8:{field:"total_timer_time",type:"uint32",scale:1e3,offset:0,units:"s"},9:{field:"total_distance",type:"uint32",scale:100,offset:0,units:"m"},10:{field:"total_cycles",type:"uint32",scale:null,offset:0,units:"cycles"},11:{field:"total_calories",type:"uint16",scale:null,offset:0,units:"kcal"},12:{field:"total_fat_calories",type:"uint16",scale:null,offset:0,units:"kcal"},13:{field:"avg_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},14:{field:"max_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},15:{field:"avg_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},16:{field:"max_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},17:{field:"avg_cadence",type:"uint8",scale:null,offset:0,units:"rpm"},18:{field:"max_cadence",type:"uint8",scale:null,offset:0,units:"rpm"},19:{field:"avg_power",type:"uint16",scale:null,offset:0,units:"watts"},20:{field:"max_power",type:"uint16",scale:null,offset:0,units:"watts"},21:{field:"total_ascent",type:"uint16",scale:null,offset:0,units:"m"},22:{field:"total_descent",type:"uint16",scale:null,offset:0,units:"m"},23:{field:"intensity",type:"intensity",scale:null,offset:0,units:""},24:{field:"lap_trigger",type:"lap_trigger",scale:null,offset:0,units:""},25:{field:"sport",type:"sport",scale:null,offset:0,units:""},26:{field:"event_group",type:"uint8",scale:null,offset:0,units:""},32:{field:"num_lengths",type:"uint16",scale:null,offset:0,units:"lengths"},33:{field:"normalized_power",type:"uint16",scale:null,offset:0,units:"watts"},34:{field:"left_right_balance",type:"left_right_balance_100",scale:100,offset:0,units:"%"},35:{field:"first_length_index",type:"uint16",scale:null,offset:0,units:""},37:{field:"avg_stroke_distance",type:"uint16",scale:100,offset:0,units:"m"},38:{field:"swim_stroke",type:"swim_stroke",scale:null,offset:0,units:""},39:{field:"sub_sport",type:"sub_sport",scale:null,offset:0,units:""},40:{field:"num_active_lengths",type:"uint16",scale:null,offset:0,units:"lengths"},41:{field:"total_work",type:"uint32",scale:null,offset:0,units:"J"},42:{field:"avg_altitude",type:"uint16",scale:5,offset:-500,units:"m"},43:{field:"max_altitude",type:"uint16",scale:5,offset:-500,units:"m"},44:{field:"gps_accuracy",type:"uint8",scale:null,offset:0,units:"m"},45:{field:"avg_grade",type:"sint16",scale:100,offset:0,units:"%"},46:{field:"avg_pos_grade",type:"sint16",scale:100,offset:0,units:"%"},47:{field:"avg_neg_grade",type:"sint16",scale:100,offset:0,units:"%"},48:{field:"max_pos_grade",type:"sint16",scale:100,offset:0,units:"%"},49:{field:"max_neg_grade",type:"sint16",scale:100,offset:0,units:"%"},50:{field:"avg_temperature",type:"sint8",scale:null,offset:0,units:"C"},51:{field:"max_temperature",type:"sint8",scale:null,offset:0,units:"C"},52:{field:"total_moving_time",type:"uint32",scale:1e3,offset:0,units:"s"},53:{field:"avg_pos_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},54:{field:"avg_neg_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},55:{field:"max_pos_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},56:{field:"max_neg_vertical_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},57:{field:"time_in_hr_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},58:{field:"time_in_speed_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},59:{field:"time_in_cadence_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},60:{field:"time_in_power_zone",type:"uint32_array",scale:1e3,offset:0,units:"s"},61:{field:"repetition_num",type:"uint16",scale:null,offset:0,units:""},62:{field:"min_altitude",type:"uint16",scale:5,offset:-500,units:"m"},63:{field:"min_heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},71:{field:"wkt_step_index",type:"message_index",scale:null,offset:0,units:""},74:{field:"opponent_score",type:"uint16",scale:null,offset:0,units:""},75:{field:"stroke_count",type:"uint16",scale:null,offset:0,units:"counts"},76:{field:"zone_count",type:"uint16",scale:null,offset:0,units:"counts"},77:{field:"avg_vertical_oscillation",type:"uint16",scale:10,offset:0,units:"mm"},78:{field:"avg_stance_time_percent",type:"uint16",scale:100,offset:0,units:"percent"},79:{field:"avg_stance_time",type:"uint16",scale:10,offset:0,units:"ms"},80:{field:"avg_fractional_cadence",type:"uint8",scale:128,offset:0,units:"rpm"},81:{field:"max_fractional_cadence",type:"uint8",scale:128,offset:0,units:"rpm"},82:{field:"total_fractional_cycles",type:"uint8",scale:128,offset:0,units:"cycles"},83:{field:"player_score",type:"uint16",scale:null,offset:0,units:""},84:{field:"avg_total_hemoglobin_conc",type:"uint16",scale:100,offset:0,units:"g/dL"},85:{field:"min_total_hemoglobin_conc",type:"uint16",scale:100,offset:0,units:"g/dL"},86:{field:"max_total_hemoglobin_conc",type:"uint16",scale:100,offset:0,units:"g/dL"},87:{field:"avg_saturated_hemoglobin_percent",type:"uint16",scale:10,offset:0,units:"%"},88:{field:"min_saturated_hemoglobin_percent",type:"uint16",scale:10,offset:0,units:"%"},89:{field:"max_saturated_hemoglobin_percent",type:"uint16",scale:10,offset:0,units:"%"},91:{field:"avg_left_torque_effectiveness",type:"uint8",scale:2,offset:0,units:"percent"},92:{field:"avg_right_torque_effectiveness",type:"uint8",scale:2,offset:0,units:"percent"},93:{field:"avg_left_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},94:{field:"avg_right_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},95:{field:"avg_combined_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},98:{field:"time_standing",type:"uint32",scale:1e3,offset:0,units:"s"},99:{field:"stand_count",type:"uint16",scale:null,offset:0,units:""},100:{field:"avg_left_pco",type:"sint8",scale:null,offset:0,units:"mm"},101:{field:"avg_right_pco",type:"sint8",scale:null,offset:0,units:"mm"},102:{field:"avg_left_power_phase",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},103:{field:"avg_left_power_phase_peak",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},104:{field:"avg_right_power_phase",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},105:{field:"avg_right_power_phase_peak",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},106:{field:"avg_power_position",type:"uint16",scale:null,offset:0,units:"watts"},107:{field:"max_power_position",type:"uint16",scale:null,offset:0,units:"watts"},108:{field:"avg_cadence_position",type:"uint8",scale:null,offset:0,units:"rpm"},109:{field:"max_cadence_position",type:"uint8",scale:null,offset:0,units:"rpm"},110:{field:"enhanced_avg_speed",type:"uint32",scale:1e3,offset:0,units:"m/s"},111:{field:"enhanced_max_speed",type:"uint32",scale:1e3,offset:0,units:"m/s"},112:{field:"enhanced_avg_altitude",type:"uint32",scale:5,offset:-500,units:"m"},113:{field:"enhanced_min_altitude",type:"uint32",scale:5,offset:-500,units:"m"},114:{field:"enhanced_max_altitude",type:"uint32",scale:5,offset:-500,units:"m"},115:{field:"avg_lev_motor_power",type:"uint16",scale:null,offset:0,units:"watts"},116:{field:"max_lev_motor_power",type:"uint16",scale:null,offset:0,units:"watts"},117:{field:"lev_battery_consumption",type:"uint8",scale:2,offset:0,units:"percent"},118:{field:"avg_vertical_ratio",type:"uint16",scale:100,offset:0,units:"percent"},119:{field:"avg_stance_time_balance",type:"uint16",scale:100,offset:0,units:"percent"},120:{field:"avg_step_length",type:"uint16",scale:10,offset:0,units:"mm"},121:{field:"avg_vam",type:"uint16",scale:1e3,offset:0,units:"m/s"}},20:{name:"record",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"position_lat",type:"sint32",scale:null,offset:0,units:"semicircles"},1:{field:"position_long",type:"sint32",scale:null,offset:0,units:"semicircles"},2:{field:"altitude",type:"uint16",scale:5,offset:-500,units:"m"},3:{field:"heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},4:{field:"cadence",type:"uint8",scale:null,offset:0,units:"rpm"},5:{field:"distance",type:"uint32",scale:100,offset:0,units:"m"},6:{field:"speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},7:{field:"power",type:"uint16",scale:null,offset:0,units:"watts"},8:{field:"compressed_speed_distance",type:"byte",scale:"100,16",offset:0,units:"m/s,m"},9:{field:"grade",type:"sint16",scale:100,offset:0,units:"%"},10:{field:"resistance",type:"uint8",scale:null,offset:0,units:""},11:{field:"time_from_course",type:"sint32",scale:1e3,offset:0,units:"s"},12:{field:"cycle_length",type:"uint8",scale:100,offset:0,units:"m"},13:{field:"temperature",type:"sint8",scale:null,offset:0,units:"C"},17:{field:"speed_1s",type:"uint8",scale:16,offset:0,units:"m/s"},18:{field:"cycles",type:"uint8",scale:null,offset:0,units:"cycles"},19:{field:"total_cycles",type:"uint32",scale:null,offset:0,units:"cycles"},28:{field:"compressed_accumulated_power",type:"uint16",scale:null,offset:0,units:"watts"},29:{field:"accumulated_power",type:"uint32",scale:null,offset:0,units:"watts"},30:{field:"left_right_balance",type:"left_right_balance",scale:null,offset:0,units:""},31:{field:"gps_accuracy",type:"uint8",scale:null,offset:0,units:"m"},32:{field:"vertical_speed",type:"sint16",scale:1e3,offset:0,units:"m/s"},33:{field:"calories",type:"uint16",scale:null,offset:0,units:"kcal"},39:{field:"vertical_oscillation",type:"uint16",scale:10,offset:0,units:"mm"},40:{field:"stance_time_percent",type:"uint16",scale:100,offset:0,units:"percent"},41:{field:"stance_time",type:"uint16",scale:10,offset:0,units:"ms"},42:{field:"activity_type",type:"activity_type",scale:null,offset:0,units:""},43:{field:"left_torque_effectiveness",type:"uint8",scale:2,offset:0,units:"percent"},44:{field:"right_torque_effectiveness",type:"uint8",scale:2,offset:0,units:"percent"},45:{field:"left_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},46:{field:"right_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},47:{field:"combined_pedal_smoothness",type:"uint8",scale:2,offset:0,units:"percent"},48:{field:"time128",type:"uint8",scale:128,offset:0,units:"s"},49:{field:"stroke_type",type:"stroke_type",scale:null,offset:0,units:""},50:{field:"zone",type:"uint8",scale:null,offset:0,units:""},51:{field:"ball_speed",type:"uint16",scale:100,offset:0,units:"m/s"},52:{field:"cadence256",type:"uint16",scale:256,offset:0,units:"rpm"},53:{field:"fractional_cadence",type:"uint8",scale:128,offset:0,units:"rpm"},54:{field:"total_hemoglobin_conc",type:"uint16",scale:100,offset:0,units:"g/dL"},55:{field:"total_hemoglobin_conc_min",type:"uint16",scale:100,offset:0,units:"g/dL"},56:{field:"total_hemoglobin_conc_max",type:"uint16",scale:100,offset:0,units:"g/dL"},57:{field:"saturated_hemoglobin_percent",type:"uint16",scale:10,offset:0,units:"%"},58:{field:"saturated_hemoglobin_percent_min",type:"uint16",scale:10,offset:0,units:"%"},59:{field:"saturated_hemoglobin_percent_max",type:"uint16",scale:10,offset:0,units:"%"},62:{field:"device_index",type:"device_index",scale:null,offset:0,units:""},67:{field:"left_pco",type:"sint8",scale:null,offset:0,units:"mm"},68:{field:"right_pco",type:"sint8",scale:null,offset:0,units:"mm"},69:{field:"left_power_phase",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},70:{field:"left_power_phase_peak",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},71:{field:"right_power_phase",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},72:{field:"right_power_phase_peak",type:"uint8",scale:"0,7111111",offset:0,units:"degrees"},73:{field:"enhanced_speed",type:"uint32",scale:1e3,offset:0,units:"m/s"},78:{field:"enhanced_altitude",type:"uint32",scale:5,offset:-500,units:"m"},81:{field:"battery_soc",type:"uint8",scale:2,offset:0,units:"percent"},82:{field:"motor_power",type:"uint16",scale:null,offset:0,units:"watts"},83:{field:"vertical_ratio",type:"uint16",scale:100,offset:0,units:"percent"},84:{field:"stance_time_balance",type:"uint16",scale:100,offset:0,units:"percent"},85:{field:"step_length",type:"uint16",scale:10,offset:0,units:"mm"},91:{field:"absolute_pressure",type:"uint32",scale:null,offset:0,units:"Pa"},92:{field:"depth",type:"uint32",scale:null,offset:0,units:"m"},93:{field:"next_stop_depth",type:"uint32",scale:null,offset:0,units:"m"},94:{field:"next_stop_time",type:"uint32",scale:null,offset:0,units:"s"},95:{field:"time_to_surface",type:"uint32",scale:null,offset:0,units:"s"},96:{field:"ndl_time",type:"uint32",scale:null,offset:0,units:"s"},97:{field:"cns_load",type:"uint8",scale:null,offset:0,units:"percent"},98:{field:"n2_load",type:"uint16",scale:null,offset:0,units:"percent"}},21:{name:"event",253:{field:"timestamp",type:"date_time",scale:null,offset:"",units:"s"},0:{field:"event",type:"event",scale:null,offset:"",units:""},1:{field:"event_type",type:"event_type",scale:null,offset:"",units:""},2:{field:"data16",type:"uint16",scale:null,offset:"",units:""},3:{field:"data",type:"uint32",scale:null,offset:"",units:""},4:{field:"event_group",type:"uint8",scale:null,offset:"",units:""},7:{field:"score",type:"uint16",scale:null,offset:"",units:""},8:{field:"opponent_score",type:"uint16",scale:null,offset:"",units:""},9:{field:"front_gear_num",type:"uint8z",scale:null,offset:"",units:""},10:{field:"front_gear",type:"uint8z",scale:null,offset:"",units:""},11:{field:"rear_gear_num",type:"uint8z",scale:null,offset:"",units:""},12:{field:"rear_gear",type:"uint8z",scale:null,offset:"",units:""},13:{field:"device_index",type:"device_index",scale:null,offset:"",units:""}},23:{name:"device_info",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"device_index",type:"uint8",scale:null,offset:0,units:""},1:{field:"device_type",type:"antplus_device_type",scale:null,offset:0,units:""},2:{field:"manufacturer",type:"manufacturer",scale:null,offset:0,units:""},3:{field:"serial_number",type:"uint32z",scale:null,offset:0,units:""},4:{field:"product",type:"uint16",scale:null,offset:0,units:""},5:{field:"software_version",type:"uint16",scale:100,offset:0,units:""},6:{field:"hardware_version",type:"uint8",scale:null,offset:0,units:""},7:{field:"cum_operating_time",type:"uint32",scale:null,offset:0,units:"s"},10:{field:"battery_voltage",type:"uint16",scale:256,offset:0,units:"V"},11:{field:"battery_status",type:"battery_status",scale:null,offset:0,units:""},18:{field:"sensor_position",type:"body_location",scale:null,offset:0,units:""},19:{field:"descriptor",type:"string",scale:null,offset:0,units:""},20:{field:"ant_transmission_type",type:"uint8z",scale:null,offset:0,units:""},21:{field:"ant_device_number",type:"uint16z",scale:null,offset:0,units:""},22:{field:"ant_network",type:"ant_network",scale:null,offset:0,units:""},25:{field:"source_type",type:"source_type",scale:null,offset:0,units:""},27:{field:"product_name",type:"string",scale:null,offset:0,units:""}},26:{name:"workout",4:{field:"sport",type:"sport",scale:null,offset:"",units:""},5:{field:"capabilities",type:"workout_capabilities",scale:null,offset:"",units:""},6:{field:"num_valid_steps",type:"uint16",scale:null,offset:"",units:""},8:{field:"wkt_name",type:"string",scale:null,offset:"",units:""}},27:{name:"workout_step",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},0:{field:"wkt_step_name",type:"string",scale:null,offset:0,units:""},1:{field:"duration_type",type:"wkt_step_duration",scale:null,offset:0,units:""},2:{field:"duration_value",type:"uint32",scale:null,offset:0,units:""},3:{field:"target_type",type:"wkt_step_target",scale:null,offset:0,units:""},4:{field:"target_value",type:"uint32",scale:null,offset:0,units:""},5:{field:"custom_target_value_low",type:"uint32",scale:null,offset:0,units:""},6:{field:"custom_target_value_high",type:"uint32",scale:null,offset:0,units:""},7:{field:"intensity",type:"intensity",scale:null,offset:0,units:""}},30:{name:"weight_scale",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"weight",type:"weight",scale:100,offset:0,units:"kg"},1:{field:"percent_fat",type:"uint16",scale:100,offset:0,units:"%"},2:{field:"percent_hydration",type:"uint16",scale:100,offset:0,units:"%"},3:{field:"visceral_fat_mass",type:"uint16",scale:100,offset:0,units:"kg"},4:{field:"bone_mass",type:"uint16",scale:100,offset:0,units:"kg"},5:{field:"muscle_mass",type:"uint16",scale:100,offset:0,units:"kg"},7:{field:"basal_met",type:"uint16",scale:4,offset:0,units:"kcal/day"},8:{field:"physique_rating",type:"uint8",scale:null,offset:0,units:""},9:{field:"active_met",type:"uint16",scale:4,offset:0,units:"kcal/day"},10:{field:"metabolic_age",type:"uint8",scale:null,offset:0,units:"years"},11:{field:"visceral_fat_rating",type:"uint8",scale:null,offset:0,units:""},12:{field:"user_profile_index",type:"message_index",scale:null,offset:0,units:""}},31:{name:"course",4:{field:"sport",type:"sport",scale:null,offset:"",units:""},5:{field:"name",type:"string",scale:null,offset:"",units:""},6:{field:"capabilities",type:"course_capabilities",scale:null,offset:"",units:""}},32:{name:"course_point",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},1:{field:"timestamp",type:"date_time",scale:null,offset:0,units:""},2:{field:"position_lat",type:"sint32",scale:null,offset:0,units:"semicircles"},3:{field:"position_long",type:"sint32",scale:null,offset:0,units:"semicircles"},4:{field:"distance",type:"uint32",scale:100,offset:0,units:"m"},5:{field:"type",type:"course_point",scale:null,offset:0,units:""},6:{field:"name",type:"string",scale:null,offset:0,units:""},8:{field:"favorite",type:"bool",scale:null,offset:0,units:""}},33:{name:"totals",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"timer_time",type:"uint32",scale:null,offset:0,units:"s"},1:{field:"distance",type:"uint32",scale:null,offset:0,units:"m"},2:{field:"calories",type:"uint32",scale:null,offset:0,units:"kcal"},3:{field:"sport",type:"sport",scale:null,offset:0,units:""},4:{field:"elapsed_time",type:"uint32",scale:null,offset:0,units:"s"},5:{field:"sessions",type:"uint16",scale:null,offset:0,units:""},6:{field:"active_time",type:"uint32",scale:null,offset:0,units:"s"},9:{field:"sport_index",type:"uint8",scale:null,offset:0,units:""}},34:{name:"activity",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:""},0:{field:"total_timer_time",type:"uint32",scale:1e3,offset:0,units:"s"},1:{field:"num_sessions",type:"uint16",scale:null,offset:0,units:""},2:{field:"type",type:"activity",scale:null,offset:0,units:""},3:{field:"event",type:"event",scale:null,offset:0,units:""},4:{field:"event_type",type:"event_type",scale:null,offset:0,units:""},5:{field:"local_timestamp",type:"local_date_time",scale:null,offset:0,units:""},6:{field:"event_group",type:"uint8",scale:null,offset:0,units:""}},35:{name:"software",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},3:{field:"version",type:"uint16",scale:100,offset:"",units:""},5:{field:"part_number",type:"string",scale:null,offset:"",units:""}},37:{name:"file_capabilities",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},0:{field:"type",type:"file",scale:null,offset:0,units:""},1:{field:"flags",type:"file_flags",scale:null,offset:0,units:""},2:{field:"directory",type:"string",scale:null,offset:0,units:""},3:{field:"max_count",type:"uint16",scale:null,offset:0,units:""},4:{field:"max_size",type:"uint32",scale:null,offset:0,units:"bytes"}},38:{name:"mesg_capabilities",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"file",type:"file",scale:null,offset:"",units:""},1:{field:"mesg_num",type:"mesg_num",scale:null,offset:"",units:""},2:{field:"count_type",type:"mesg_count",scale:null,offset:"",units:""},3:{field:"count",type:"uint16",scale:null,offset:"",units:""}},39:{name:"field_capabilities",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"file",type:"file",scale:null,offset:"",units:""},1:{field:"mesg_num",type:"mesg_num",scale:null,offset:"",units:""},2:{field:"field_num",type:"uint8",scale:null,offset:"",units:""},3:{field:"count",type:"uint16",scale:null,offset:"",units:""}},49:{name:"file_creator",0:{field:"software_version",type:"uint16",scale:null,offset:"",units:""},1:{field:"hardware_version",type:"uint8",scale:null,offset:"",units:""}},51:{name:"blood_pressure",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"systolic_pressure",type:"uint16",scale:null,offset:0,units:"mmHg"},1:{field:"diastolic_pressure",type:"uint16",scale:null,offset:0,units:"mmHg"},2:{field:"mean_arterial_pressure",type:"uint16",scale:null,offset:0,units:"mmHg"},3:{field:"map_3_sample_mean",type:"uint16",scale:null,offset:0,units:"mmHg"},4:{field:"map_morning_values",type:"uint16",scale:null,offset:0,units:"mmHg"},5:{field:"map_evening_values",type:"uint16",scale:null,offset:0,units:"mmHg"},6:{field:"heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},7:{field:"heart_rate_type",type:"hr_type",scale:null,offset:0,units:""},8:{field:"status",type:"bp_status",scale:null,offset:0,units:""},9:{field:"user_profile_index",type:"message_index",scale:null,offset:0,units:""}},55:{name:"monitoring",253:{field:"timestamp",type:"uint32",scale:null,offset:0,units:""},0:{field:"device_index",type:"device_index",scale:null,offset:0,units:""},1:{field:"calories",type:"uint16",scale:null,offset:0,units:"kcal"},2:{field:"distance",type:"float32",scale:null,offset:0,units:"m"},3:{field:"cycles",type:"float32",scale:null,offset:0,units:"cycles"},4:{field:"active_time",type:"float32",scale:null,offset:0,units:"s"},5:{field:"activity_type",type:"activity_type",scale:null,offset:0,units:""},6:{field:"activity_subtype",type:"activity_subtype",scale:null,offset:0,units:""},7:{field:"activity_level",type:"activity_level",scale:null,offset:0,units:"s"},8:{field:"distance16",type:"uint16",scale:null,offset:0,units:"m"},9:{field:"cycles16",type:"uint16",scale:null,offset:0,units:"cycles"},10:{field:"active_time16",type:"uint16",scale:null,offset:0,units:""},11:{field:"local_timestamp",type:"uint32",scale:null,offset:0,units:""},12:{field:"temperature",type:"float32",scale:null,offset:0,units:"C"},14:{field:"temperature_min",type:"float32",scale:null,offset:0,units:"C"},15:{field:"temperature_max",type:"float32",scale:null,offset:0,units:"C"},16:{field:"activity_time",type:"int32",scale:null,offset:0,units:""},19:{field:"active_calories",type:"uint16",scale:null,offset:0,units:"kcal"},24:{field:"current_activity_type_intensity",type:"uint8",scale:null,offset:0,units:""},25:{field:"timestamp_min8",type:"uint8",scale:null,offset:0,units:""},26:{field:"timestamp16",type:"uint16",scale:null,offset:0,units:""},27:{field:"heart_rate",type:"uint8",scale:null,offset:0,units:"bpm"},28:{field:"intensity",type:"uint8",scale:null,offset:0,units:""},29:{field:"duration_min",type:"uint16",scale:null,offset:0,units:""},30:{field:"duration",type:"uint32",scale:null,offset:0,units:""},31:{field:"ascent",type:"float32",scale:null,offset:0,units:"m"},32:{field:"descent",type:"float32",scale:null,offset:0,units:"m"},33:{field:"moderate_activity_minutes",type:"uint16",scale:null,offset:0,units:""},34:{field:"vigorous_activity_inutes",type:"uint16",scale:null,offset:0,units:""}},78:{name:"hrv",0:{field:"time",type:"uint16_array",scale:1e3,offset:0,units:"s"}},101:{name:"length",254:{field:"message_index",type:"message_index",scale:null,offset:0,units:""},253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"event",type:"event",scale:null,offset:0,units:""},1:{field:"event_type",type:"event_type",scale:null,offset:0,units:""},2:{field:"start_time",type:"date_time",scale:null,offset:0,units:""},3:{field:"total_elapsed_time",type:"uint32",scale:1e3,offset:0,units:"s"},4:{field:"total_timer_time",type:"uint32",scale:1e3,offset:0,units:"s"},5:{field:"total_strokes",type:"uint16",scale:null,offset:0,units:"strokes"},6:{field:"avg_speed",type:"uint16",scale:1e3,offset:0,units:"m/s"},7:{field:"swim_stroke",type:"swim_stroke",scale:null,offset:0,units:"swim_stroke"},9:{field:"avg_swimming_cadence",type:"uint8",scale:null,offset:0,units:"strokes/min"},10:{field:"event_group",type:"uint8",scale:null,offset:0,units:""},11:{field:"total_calories",type:"uint16",scale:null,offset:0,units:"kcal"},12:{field:"length_type",type:"length_type",scale:null,offset:0,units:"length_type"},18:{field:"player_score",type:"uint16",scale:null,offset:0,units:""},19:{field:"opponent_score",type:"uint16",scale:null,offset:0,units:""},20:{field:"stroke_count",type:"uint16",scale:null,offset:0,units:"counts"},21:{field:"zone_count",type:"uint16",scale:null,offset:0,units:"counts"}},103:{name:"monitoring_info",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:""},0:{field:"local_timestamp",type:"uint32",scale:null,offset:0,units:""},1:{field:"activity_type",type:"activity_type",scale:null,offset:0,units:""},3:{field:"cycles_to_distance",type:"float32",scale:null,offset:0,units:"cycles"},4:{field:"cycles_to_calories",type:"float32",scale:null,offset:0,units:"kcal"},5:{field:"resting_metabolic_rate",type:"uint16",scale:null,offset:0,units:""}},108:{name:"o_hr_settings",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:""},0:{field:"enabled",type:"byte",scale:null,offset:0,units:""}},206:{name:"field_description",0:{field:"developer_data_index",type:"uint8",scale:null,offset:0,units:""},1:{field:"field_definition_number",type:"uint8",scale:null,offset:0,units:""},2:{field:"fit_base_type_id",type:"uint8",scale:null,offset:0,units:""},3:{field:"field_name",type:"string",scale:null,offset:0,units:""},6:{field:"scale",type:"uint8",scale:null,offset:0,units:""},7:{field:"offset",type:"sint8",scale:null,offset:0,units:""},8:{field:"units",type:"string",scale:null,offset:0,units:""},15:{field:"native_field_num",type:"uint8",scale:null,offset:0,units:""}},227:{name:"stress_level",0:{field:"stress_level_value",type:"uint16",scale:null,offset:0,units:""},1:{field:"stress_level_time",type:"date_time",scale:null,offset:0,units:"s"},2:{field:"field_two",type:"sint8",scale:null,offset:0,units:""},3:{field:"body_battery",type:"uint8",scale:null,offset:0,units:""},4:{field:"field_four",type:"uint8",scale:null,offset:0,units:""}},207:{name:"developer_data_id",0:{field:"developer_id",type:"uint8",scale:null,offset:0,units:""},1:{field:"application_id",type:"byte_array",scale:null,offset:0,units:""},2:{field:"manufacturer_id",type:"manufacturer",scale:null,offset:0,units:""},3:{field:"developer_data_index",type:"uint8",scale:null,offset:0,units:""},4:{field:"application_version",type:"uint8",scale:null,offset:0,units:""}},258:{name:"dive_settings",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"name",type:"string",scale:null,offset:0,units:""},1:{field:"model",type:"tissue_model_type",scale:null,offset:0,units:""},2:{field:"gf_low",type:"uint8",scale:null,offset:0,units:"percent"},3:{field:"gf_high",type:"uint8",scale:null,offset:0,units:"percent"},4:{field:"water_type",type:"water_type",scale:null,offset:0,units:""},5:{field:"water_density",type:"float32",scale:null,offset:0,units:"kg/m^3"},6:{field:"po2_warn",type:"uint8",scale:null,offset:0,units:"percent"},7:{field:"po2_critical",type:"uint8",scale:null,offset:0,units:"percent"},8:{field:"po2_deco",type:"uint8",scale:null,offset:0,units:"percent"},9:{field:"safety_stop_enabled",type:"bool",scale:null,offset:0,units:""},10:{field:"bottom_depth",type:"float32",scale:null,offset:0,units:""},11:{field:"bottom_time",type:"uint32",scale:null,offset:0,units:""},12:{field:"apnea_countdown_enabled",type:"bool",scale:null,offset:0,units:""},13:{field:"apnea_countdown_time",type:"uint32",scale:null,offset:0,units:""},14:{field:"backlight_mode",type:"dive_backlight_mode",scale:null,offset:0,units:""},15:{field:"backlight_brightness",type:"uint8",scale:null,offset:0,units:""},16:{field:"backlight_timeout",type:"backlight_timeout",scale:null,offset:0,units:""},17:{field:"repeat_dive_time",type:"uint16",scale:null,offset:0,units:"s"},18:{field:"safety_stop_time",type:"uint16",scale:null,offset:0,units:"s"},19:{field:"heart_rate_source_type",type:"source_type",scale:null,offset:0,units:""},20:{field:"heart_rate_source",type:"uint8",scale:null,offset:0,units:""}},259:{name:"dive_gas",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"helium_content",type:"uint8",scale:null,offset:"",units:"percent"},1:{field:"oxygen_content",type:"uint8",scale:null,offset:"",units:"percent"},2:{field:"status",type:"dive_gas_status",scale:null,offset:"",units:""}},262:{name:"dive_alarm",254:{field:"message_index",type:"message_index",scale:null,offset:"",units:""},0:{field:"depth",type:"uint32",scale:null,offset:"",units:"m"},1:{field:"time",type:"sint32",scale:null,offset:"",units:"s"},2:{field:"enabled",type:"bool",scale:null,offset:"",units:""},3:{field:"alarm_type",type:"dive_alarm_type",scale:null,offset:"",units:""},4:{field:"sound",type:"tone",scale:null,offset:"",units:""},5:{field:"dive_types",type:"sub_sport",scale:null,offset:"",units:""}},268:{name:"dive_summary",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"reference_mesg",type:"mesg_num",scale:null,offset:0,units:""},1:{field:"reference_index",type:"message_index",scale:null,offset:0,units:""},2:{field:"avg_depth",type:"uint32",scale:null,offset:0,units:"m"},3:{field:"max_depth",type:"uint32",scale:null,offset:0,units:"m"},4:{field:"surface_interval",type:"uint32",scale:null,offset:0,units:"s"},5:{field:"start_cns",type:"uint8",scale:null,offset:0,units:"percent"},6:{field:"end_cns",type:"uint8",scale:null,offset:0,units:"percent"},7:{field:"start_n2",type:"uint16",scale:null,offset:0,units:"percent"},8:{field:"end_n2",type:"uint16",scale:null,offset:0,units:"percent"},9:{field:"o2_toxicity",type:"uint16",scale:null,offset:0,units:"OTUs"},10:{field:"dive_number",type:"uint32",scale:null,offset:0,units:""},11:{field:"bottom_time",type:"uint32",scale:null,offset:0,units:"s"}},319:{name:"tank_update",253:{field:"timestamp",type:"date_time",scale:null,offset:0,units:"s"},0:{field:"sensor",type:"uint32",scale:null,offset:0,units:""},1:{field:"pressure",type:"uint16",scale:null,offset:0,units:"cbar"}},323:{name:"tank_summary",0:{field:"sensor",type:"uint32",scale:null,offset:0,units:""},1:{field:"start_pressure",type:"uint16",scale:null,offset:0,units:"cbar"},2:{field:"end_pressure",type:"uint16",scale:null,offset:0,units:"cbar"},3:{field:"volume_used",type:"uint16",scale:null,offset:0,units:"cbar"}}},types:{file:{1:"device",2:"settings",3:"sport",4:"activity",5:"workout",6:"course",7:"schedules",9:"weight",10:"totals",11:"goals",14:"blood_pressure",15:"monitoring_a",20:"activity_summary",28:"monitoring_daily",32:"monitoring_b",34:"segment",35:"segment_list",40:"exd_configuration",247:"mfg_range_min",254:"mfg_range_max"},mesg_num:{0:"file_id",1:"capabilities",2:"device_settings",3:"user_profile",4:"hrm_profile",5:"sdm_profile",6:"bike_profile",7:"zones_target",8:"hr_zone",9:"power_zone",10:"met_zone",12:"sport",15:"goal",18:"session",19:"lap",20:"record",21:"event",23:"device_info",26:"workout",27:"workout_step",28:"schedule",30:"weight_scale",31:"course",32:"course_point",33:"totals",34:"activity",35:"software",37:"file_capabilities",38:"mesg_capabilities",39:"field_capabilities",49:"file_creator",51:"blood_pressure",53:"speed_zone",55:"monitoring",72:"training_file",78:"hrv",80:"ant_rx",81:"ant_tx",82:"ant_channel_id",101:"length",103:"monitoring_info",105:"pad",106:"slave_device",127:"connectivity",128:"weather_conditions",129:"weather_alert",131:"cadence_zone",132:"hr",142:"segment_lap",145:"memo_glob",148:"segment_id",149:"segment_leaderboard_entry",150:"segment_point",151:"segment_file",158:"workout_session",159:"watchface_settings",160:"gps_metadata",161:"camera_event",162:"timestamp_correlation",164:"gyroscope_data",165:"accelerometer_data",167:"three_d_sensor_calibration",169:"video_frame",174:"obdii_data",177:"nmea_sentence",178:"aviation_attitude",184:"video",185:"video_title",186:"video_description",187:"video_clip",200:"exd_screen_configuration",201:"exd_data_field_configuration",202:"exd_data_concept_configuration",206:"field_description",207:"developer_data_id",208:"magnetometer_data",209:"barometer_data",210:"one_d_sensor_calibration",225:"set",227:"stress_level",258:"dive_settings",259:"dive_gas",262:"dive_alarm",264:"exercise_title",268:"dive_summary",285:"jump",317:"climb_pro",319:"tank_pressure",323:"tank_summary",65280:"mfg_range_min",65534:"mfg_range_max"},checksum:{0:"clear",1:"ok"},file_flags:{0:0,2:"read",4:"write",8:"erase"},mesg_count:{0:"num_per_file",1:"max_per_file",2:"max_per_file_type"},date_time:{0:0,268435456:"min"},local_date_time:{0:0,268435456:"min"},message_index:{0:0,4095:"mask",28672:"reserved",32768:"selected"},gender:{0:"female",1:"male"},language:{0:"english",1:"french",2:"italian",3:"german",4:"spanish",5:"croatian",6:"czech",7:"danish",8:"dutch",9:"finnish",10:"greek",11:"hungarian",12:"norwegian",13:"polish",14:"portuguese",15:"slovakian",16:"slovenian",17:"swedish",18:"russian",19:"turkish",20:"latvian",21:"ukrainian",22:"arabic",23:"farsi",24:"bulgarian",25:"romanian",26:"chinese",27:"japanese",28:"korean",29:"taiwanese",30:"thai",31:"hebrew",32:"brazilian_portuguese",33:"indonesian",34:"malaysian",35:"vietnamese",36:"burmese",37:"mongolian",254:"custom"},language_bits_0:{0:0,1:"english",2:"french",4:"italian",8:"german",16:"spanish",32:"croatian",64:"czech",128:"danish"},language_bits_1:{0:0,1:"dutch",2:"finnish",4:"greek",8:"hungarian",16:"norwegian",32:"polish",64:"portuguese",128:"slovakian"},language_bits_2:{0:0,1:"slovenian",2:"swedish",4:"russian",8:"turkish",16:"latvian",32:"ukrainian",64:"arabic",128:"farsi"},language_bits_3:{0:0,1:"bulgarian",2:"romanian",4:"chinese",8:"japanese",16:"korean",32:"taiwanese",64:"thai",128:"hebrew"},language_bits_4:{0:0,1:"brazilian_portuguese",2:"indonesian",4:"malaysian",8:"vietnamese",16:"burmese",32:"mongolian"},time_zone:{0:"almaty",1:"bangkok",2:"bombay",3:"brasilia",4:"cairo",5:"cape_verde_is",6:"darwin",7:"eniwetok",8:"fiji",9:"hong_kong",10:"islamabad",11:"kabul",12:"magadan",13:"mid_atlantic",14:"moscow",15:"muscat",16:"newfoundland",17:"samoa",18:"sydney",19:"tehran",20:"tokyo",21:"us_alaska",22:"us_atlantic",23:"us_central",24:"us_eastern",25:"us_hawaii",26:"us_mountain",27:"us_pacific",28:"other",29:"auckland",30:"kathmandu",31:"europe_western_wet",32:"europe_central_cet",33:"europe_eastern_eet",34:"jakarta",35:"perth",36:"adelaide",37:"brisbane",38:"tasmania",39:"iceland",40:"amsterdam",41:"athens",42:"barcelona",43:"berlin",44:"brussels",45:"budapest",46:"copenhagen",47:"dublin",48:"helsinki",49:"lisbon",50:"london",51:"madrid",52:"munich",53:"oslo",54:"paris",55:"prague",56:"reykjavik",57:"rome",58:"stockholm",59:"vienna",60:"warsaw",61:"zurich",62:"quebec",63:"ontario",64:"manitoba",65:"saskatchewan",66:"alberta",67:"british_columbia",68:"boise",69:"boston",70:"chicago",71:"dallas",72:"denver",73:"kansas_city",74:"las_vegas",75:"los_angeles",76:"miami",77:"minneapolis",78:"new_york",79:"new_orleans",80:"phoenix",81:"santa_fe",82:"seattle",83:"washington_dc",84:"us_arizona",85:"chita",86:"ekaterinburg",87:"irkutsk",88:"kaliningrad",89:"krasnoyarsk",90:"novosibirsk",91:"petropavlovsk_kamchatskiy",92:"samara",93:"vladivostok",94:"mexico_central",95:"mexico_mountain",96:"mexico_pacific",97:"cape_town",98:"winkhoek",99:"lagos",100:"riyahd",101:"venezuela",102:"australia_lh",103:"santiago",253:"manual",254:"automatic"},display_measure:{0:"metric",1:"statute",2:"nautical"},display_heart:{0:"bpm",1:"max",2:"reserve"},display_power:{0:"watts",1:"percent_ftp"},display_position:{0:"degree",1:"degree_minute",2:"degree_minute_second",3:"austrian_grid",4:"british_grid",5:"dutch_grid",6:"hungarian_grid",7:"finnish_grid",8:"german_grid",9:"icelandic_grid",10:"indonesian_equatorial",11:"indonesian_irian",12:"indonesian_southern",13:"india_zone_0",14:"india_zone_IA",15:"india_zone_IB",16:"india_zone_IIA",17:"india_zone_IIB",18:"india_zone_IIIA",19:"india_zone_IIIB",20:"india_zone_IVA",21:"india_zone_IVB",22:"irish_transverse",23:"irish_grid",24:"loran",25:"maidenhead_grid",26:"mgrs_grid",27:"new_zealand_grid",28:"new_zealand_transverse",29:"qatar_grid",30:"modified_swedish_grid",31:"swedish_grid",32:"south_african_grid",33:"swiss_grid",34:"taiwan_grid",35:"united_states_grid",36:"utm_ups_grid",37:"west_malayan",38:"borneo_rso",39:"estonian_grid",40:"latvian_grid",41:"swedish_ref_99_grid"},switch:{0:"off",1:"on",2:"auto"},sport:{0:"generic",1:"running",2:"cycling",3:"transition",4:"fitness_equipment",5:"swimming",6:"basketball",7:"soccer",8:"tennis",9:"american_football",10:"training",11:"walking",12:"cross_country_skiing",13:"alpine_skiing",14:"snowboarding",15:"rowing",16:"mountaineering",17:"hiking",18:"multisport",19:"paddling",20:"flying",21:"e_biking",22:"motorcycling",23:"boating",24:"driving",25:"golf",26:"hang_gliding",27:"horseback_riding",28:"hunting",29:"fishing",30:"inline_skating",31:"rock_climbing",32:"sailing",33:"ice_skating",34:"sky_diving",35:"snowshoeing",36:"snowmobiling",37:"stand_up_paddleboarding",38:"surfing",39:"wakeboarding",40:"water_skiing",41:"kayaking",42:"rafting",43:"windsurfing",44:"kitesurfing",45:"tactical",46:"jumpmaster",47:"boxing",48:"floor_climbing",53:"diving",254:"all"},sport_bits_0:{0:0,1:"generic",2:"running",4:"cycling",8:"transition",16:"fitness_equipment",32:"swimming",64:"basketball",128:"soccer"},sport_bits_1:{0:0,1:"tennis",2:"american_football",4:"training",8:"walking",16:"cross_country_skiing",32:"alpine_skiing",64:"snowboarding",128:"rowing"},sport_bits_2:{0:0,1:"mountaineering",2:"hiking",4:"multisport",8:"paddling",16:"flying",32:"e_biking",64:"motorcycling",128:"boating"},sport_bits_3:{0:0,1:"driving",2:"golf",4:"hang_gliding",8:"horseback_riding",16:"hunting",32:"fishing",64:"inline_skating",128:"rock_climbing"},sport_bits_4:{0:0,1:"sailing",2:"ice_skating",4:"sky_diving",8:"snowshoeing",16:"snowmobiling",32:"stand_up_paddleboarding",64:"surfing",128:"wakeboarding"},sport_bits_5:{0:0,1:"water_skiing",2:"kayaking",4:"rafting",8:"windsurfing",16:"kitesurfing",32:"tactical",64:"jumpmaster",128:"boxing"},sport_bits_6:{0:0,1:"floor_climbing"},sub_sport:{0:"generic",1:"treadmill",2:"street",3:"trail",4:"track",5:"spin",6:"indoor_cycling",7:"road",8:"mountain",9:"downhill",10:"recumbent",11:"cyclocross",12:"hand_cycling",13:"track_cycling",14:"indoor_rowing",15:"elliptical",16:"stair_climbing",17:"lap_swimming",18:"open_water",19:"flexibility_training",20:"strength_training",21:"warm_up",22:"match",23:"exercise",24:"challenge",25:"indoor_skiing",26:"cardio_training",27:"indoor_walking",28:"e_bike_fitness",29:"bmx",30:"casual_walking",31:"speed_walking",32:"bike_to_run_transition",33:"run_to_bike_transition",34:"swim_to_bike_transition",35:"atv",36:"motocross",37:"backcountry",38:"resort",39:"rc_drone",40:"wingsuit",41:"whitewater",42:"skate_skiing",43:"yoga",44:"pilates",45:"indoor_running",46:"gravel_cycling",47:"e_bike_mountain",48:"commuting",49:"mixed_surface",50:"navigate",51:"track_me",52:"map",53:"single_gas_diving",54:"multi_gas_diving",55:"gauge_diving",56:"apnea_diving",57:"apnea_hunting",58:"virtual_activity",59:"obstacle",254:"all"},sport_event:{0:"uncategorized",1:"geocaching",2:"fitness",3:"recreation",4:"race",5:"special_event",6:"training",7:"transportation",8:"touring"},activity:{0:"manual",1:"auto_multi_sport"},intensity:{0:"active",1:"rest",2:"warmup",3:"cooldown",4:"recovery",5:"interval",6:"other"},session_trigger:{0:"activity_end",1:"manual",2:"auto_multi_sport",3:"fitness_equipment"},autolap_trigger:{0:"time",1:"distance",2:"position_start",3:"position_lap",4:"position_waypoint",5:"position_marked",6:"off"},lap_trigger:{0:"manual",1:"time",2:"distance",3:"position_start",4:"position_lap",5:"position_waypoint",6:"position_marked",7:"session_end",8:"fitness_equipment"},time_mode:{0:"hour12",1:"hour24",2:"military",3:"hour_12_with_seconds",4:"hour_24_with_seconds",5:"utc"},backlight_mode:{0:"off",1:"manual",2:"key_and_messages",3:"auto_brightness",4:"smart_notifications",5:"key_and_messages_night",6:"key_and_messages_and_smart_notifications"},date_mode:{0:"day_month",1:"month_day"},backlight_timeout:{0:"infinite"},event:{0:"timer",3:"workout",4:"workout_step",5:"power_down",6:"power_up",7:"off_course",8:"session",9:"lap",10:"course_point",11:"battery",12:"virtual_partner_pace",13:"hr_high_alert",14:"hr_low_alert",15:"speed_high_alert",16:"speed_low_alert",17:"cad_high_alert",18:"cad_low_alert",19:"power_high_alert",20:"power_low_alert",21:"recovery_hr",22:"battery_low",23:"time_duration_alert",24:"distance_duration_alert",25:"calorie_duration_alert",26:"activity",27:"fitness_equipment",28:"length",32:"user_marker",33:"sport_point",36:"calibration",42:"front_gear_change",43:"rear_gear_change",44:"rider_position_change",45:"elev_high_alert",46:"elev_low_alert",47:"comm_timeout"},event_type:{0:"start",1:"stop",2:"consecutive_depreciated",3:"marker",4:"stop_all",5:"begin_depreciated",6:"end_depreciated",7:"end_all_depreciated",8:"stop_disable",9:"stop_disable_all"},timer_trigger:{0:"manual",1:"auto",2:"fitness_equipment"},fitness_equipment_state:{0:"ready",1:"in_use",2:"paused",3:"unknown"},tone:{0:"off",1:"tone",2:"vibrate",3:"tone_and_vibrate"},autoscroll:{0:"none",1:"slow",2:"medium",3:"fast"},activity_class:{0:0,100:"level_max",127:"level",128:"athlete"},hr_zone_calc:{0:"custom",1:"percent_max_hr",2:"percent_hrr"},pwr_zone_calc:{0:"custom",1:"percent_ftp"},wkt_step_duration:{0:"time",1:"distance",2:"hr_less_than",3:"hr_greater_than",4:"calories",5:"open",6:"repeat_until_steps_cmplt",7:"repeat_until_time",8:"repeat_until_distance",9:"repeat_until_calories",10:"repeat_until_hr_less_than",11:"repeat_until_hr_greater_than",12:"repeat_until_power_less_than",13:"repeat_until_power_greater_than",14:"power_less_than",15:"power_greater_than",16:"training_peaks_tss",17:"repeat_until_power_last_lap_less_than",18:"repeat_until_max_power_last_lap_less_than",19:"power_3s_less_than",20:"power_10s_less_than",21:"power_30s_less_than",22:"power_3s_greater_than",23:"power_10s_greater_than",24:"power_30s_greater_than",25:"power_lap_less_than",26:"power_lap_greater_than",27:"repeat_until_training_peaks_tss",28:"repetition_time",29:"reps"},wkt_step_target:{0:"speed",1:"heart_rate",2:"open",3:"cadence",4:"power",5:"grade",6:"resistance",7:"power_3s",8:"power_10s",9:"power_30s",10:"power_lap",11:"swim_stroke",12:"speed_lap",13:"heart_rate_lap"},goal:{0:"time",1:"distance",2:"calories",3:"frequency",4:"steps",5:"ascent",6:"active_minutes"},goal_recurrence:{0:"off",1:"daily",2:"weekly",3:"monthly",4:"yearly",5:"custom"},goal_source:{0:"auto",1:"community",2:"user"},schedule:{0:"workout",1:"course"},course_point:{0:"generic",1:"summit",2:"valley",3:"water",4:"food",5:"danger",6:"left",7:"right",8:"straight",9:"first_aid",10:"fourth_category",11:"third_category",12:"second_category",13:"first_category",14:"hors_category",15:"sprint",16:"left_fork",17:"right_fork",18:"middle_fork",19:"slight_left",20:"sharp_left",21:"slight_right",22:"sharp_right",23:"u_turn",24:"segment_start",25:"segment_end"},manufacturer:{0:0,1:"garmin",2:"garmin_fr405_antfs",3:"zephyr",4:"dayton",5:"idt",6:"srm",7:"quarq",8:"ibike",9:"saris",10:"spark_hk",11:"tanita",12:"echowell",13:"dynastream_oem",14:"nautilus",15:"dynastream",16:"timex",17:"metrigear",18:"xelic",19:"beurer",20:"cardiosport",21:"a_and_d",22:"hmm",23:"suunto",24:"thita_elektronik",25:"gpulse",26:"clean_mobile",27:"pedal_brain",28:"peaksware",29:"saxonar",30:"lemond_fitness",31:"dexcom",32:"wahoo_fitness",33:"octane_fitness",34:"archinoetics",35:"the_hurt_box",36:"citizen_systems",37:"magellan",38:"osynce",39:"holux",40:"concept2",42:"one_giant_leap",43:"ace_sensor",44:"brim_brothers",45:"xplova",46:"perception_digital",47:"bf1systems",48:"pioneer",49:"spantec",50:"metalogics",51:"4iiiis",52:"seiko_epson",53:"seiko_epson_oem",54:"ifor_powell",55:"maxwell_guider",56:"star_trac",57:"breakaway",58:"alatech_technology_ltd",59:"mio_technology_europe",60:"rotor",61:"geonaute",62:"id_bike",63:"specialized",64:"wtek",65:"physical_enterprises",66:"north_pole_engineering",67:"bkool",68:"cateye",69:"stages_cycling",70:"sigmasport",71:"tomtom",72:"peripedal",73:"wattbike",76:"moxy",77:"ciclosport",78:"powerbahn",79:"acorn_projects_aps",80:"lifebeam",81:"bontrager",82:"wellgo",83:"scosche",84:"magura",85:"woodway",86:"elite",87:"nielsen_kellerman",88:"dk_city",89:"tacx",90:"direction_technology",91:"magtonic",92:"1partcarbon",93:"inside_ride_technologies",94:"sound_of_motion",95:"stryd",96:"icg",97:"mipulse",98:"bsx_athletics",99:"look",100:"campagnolo_srl",101:"body_bike_smart",102:"praxisworks",103:"limits_technology",104:"topaction_technology",105:"cosinuss",106:"fitcare",107:"magene",108:"giant_manufacturing_co",109:"tigrasport",110:"salutron",111:"technogym",112:"bryton_sensors",113:"latitude_limited",114:"soaring_technology",115:"igpsport",116:"thinkrider",117:"gopher_sport",118:"waterrower",119:"orangetheory",120:"inpeak",121:"kinetic",122:"johnson_health_tech",123:"polar_electro",124:"seesense",125:"nci_technology",255:"development",257:"healthandlife",258:"lezyne",259:"scribe_labs",260:"zwift",261:"watteam",262:"recon",263:"favero_electronics",264:"dynovelo",265:"strava",266:"precor",267:"bryton",268:"sram",269:"navman",270:"cobi",271:"spivi",272:"mio_magellan",273:"evesports",274:"sensitivus_gauge",275:"podoon",276:"life_time_fitness",277:"falco_e_motors",278:"minoura",279:"cycliq",280:"luxottica",281:"trainer_road",282:"the_sufferfest",283:"fullspeedahead",284:"virtualtraining",285:"feedbacksports",286:"omata",287:"vdo",288:"magneticdays",289:"hammerhead",290:"kinetic_by_kurt",291:"shapelog",292:"dabuziduo",293:"jetblack",294:"coros",295:"virtugo",296:"velosense",5759:"actigraphcorp"},garmin_product:{0:"hrm_bike",1:"hrm1",2:"axh01",3:"axb01",4:"axb02",5:"hrm2ss",6:"dsi_alf02",7:"hrm3ss",8:"hrm_run_single_byte_product_id",9:"bsm",10:"bcm",11:"axs01",12:"hrm_tri_single_byte_product_id",14:"fr225_single_byte_product_id",473:"fr301_china",474:"fr301_japan",475:"fr301_korea",494:"fr301_taiwan",717:"fr405",782:"fr50",987:"fr405_japan",988:"fr60",1011:"dsi_alf01",1018:"fr310xt",1036:"edge500",1124:"fr110",1169:"edge800",1199:"edge500_taiwan",1213:"edge500_japan",1253:"chirp",1274:"fr110_japan",1325:"edge200",1328:"fr910xt",1333:"edge800_taiwan",1334:"edge800_japan",1341:"alf04",1345:"fr610",1360:"fr210_japan",1380:"vector_ss",1381:"vector_cp",1386:"edge800_china",1387:"edge500_china",1410:"fr610_japan",1422:"edge500_korea",1436:"fr70",1446:"fr310xt_4t",1461:"amx",1482:"fr10",1497:"edge800_korea",1499:"swim",1537:"fr910xt_china",1551:"fenix",1555:"edge200_taiwan",1561:"edge510",1567:"edge810",1570:"tempe",1600:"fr910xt_japan",1623:"fr620",1632:"fr220",1664:"fr910xt_korea",1688:"fr10_japan",1721:"edge810_japan",1735:"virb_elite",1736:"edge_touring",1742:"edge510_japan",1743:"hrm_tri",1752:"hrm_run",1765:"fr920xt",1821:"edge510_asia",1822:"edge810_china",1823:"edge810_taiwan",1836:"edge1000",1837:"vivo_fit",1853:"virb_remote",1885:"vivo_ki",1903:"fr15",1907:"vivo_active",1918:"edge510_korea",1928:"fr620_japan",1929:"fr620_china",1930:"fr220_japan",1931:"fr220_china",1936:"approach_s6",1956:"vivo_smart",1967:"fenix2",1988:"epix",2050:"fenix3",2052:"edge1000_taiwan",2053:"edge1000_japan",2061:"fr15_japan",2067:"edge520",2070:"edge1000_china",2072:"fr620_russia",2073:"fr220_russia",2079:"vector_s",2100:"edge1000_korea",2130:"fr920xt_taiwan",2131:"fr920xt_china",2132:"fr920xt_japan",2134:"virbx",2135:"vivo_smart_apac",2140:"etrex_touch",2147:"edge25",2148:"fr25",2150:"vivo_fit2",2153:"fr225",2156:"fr630",2157:"fr230",2158:"fr735xt",2160:"vivo_active_apac",2161:"vector_2",2162:"vector_2s",2172:"virbxe",2173:"fr620_taiwan",2174:"fr220_taiwan",2175:"truswing",2188:"fenix3_china",2189:"fenix3_twn",2192:"varia_headlight",2193:"varia_taillight_old",2204:"edge_explore_1000",2219:"fr225_asia",2225:"varia_radar_taillight",2226:"varia_radar_display",2238:"edge20",2262:"d2_bravo",2266:"approach_s20",2276:"varia_remote",2327:"hrm4_run",2337:"vivo_active_hr",2348:"vivo_smart_hr",2368:"vivo_move",2398:"varia_vision",2406:"vivo_fit3",2413:"fenix3_hr",2417:"virb_ultra_30",2429:"index_smart_scale",2431:"fr235",2432:"fenix3_chronos",2441:"oregon7xx",2444:"rino7xx",2496:"nautix",2530:"edge_820",2531:"edge_explore_820",2544:"fenix5s",2547:"d2_bravo_titanium",2567:"varia_ut800",2593:"running_dynamics_pod",2604:"fenix5x",2606:"vivo_fit_jr",2691:"fr935",2697:"fenix5",2859:"descent",10007:"sdm4",10014:"edge_remote",20119:"training_center",65531:"connectiq_simulator",65532:"android_antplus_plugin",65534:"connect"},antplus_device_type:{0:0,1:"antfs",11:"bike_power",12:"environment_sensor_legacy",15:"multi_sport_speed_distance",16:"control",17:"fitness_equipment",18:"blood_pressure",19:"geocache_node",20:"light_electric_vehicle",25:"env_sensor",26:"racquet",27:"control_hub",31:"muscle_oxygen",35:"bike_light_main",36:"bike_light_shared",38:"exd",40:"bike_radar",119:"weight_scale",120:"heart_rate",121:"bike_speed_cadence",122:"bike_cadence",123:"bike_speed",124:"stride_speed_distance"},ant_network:{0:"public",1:"antplus",2:"antfs",3:"private"},workout_capabilities:{0:0,1:"interval",2:"custom",4:"fitness_equipment",8:"firstbeat",16:"new_leaf",32:"tcx",128:"speed",256:"heart_rate",512:"distance",1024:"cadence",2048:"power",4096:"grade",8192:"resistance",16384:"protected"},battery_status:{0:0,1:"new",2:"good",3:"ok",4:"low",5:"critical",6:"charging",7:"unknown"},hr_type:{0:"normal",1:"irregular"},course_capabilities:{0:0,1:"processed",2:"valid",4:"time",8:"distance",16:"position",32:"heart_rate",64:"power",128:"cadence",256:"training",512:"navigation",1024:"bikeway"},weight:{0:0,65534:"calculating"},workout_hr:{0:0,100:"bpm_offset"},workout_power:{0:0,1e3:"watts_offset"},bp_status:{0:"no_error",1:"error_incomplete_data",2:"error_no_measurement",3:"error_data_out_of_range",4:"error_irregular_heart_rate"},user_local_id:{0:"local_min",15:"local_max",16:"stationary_min",255:"stationary_max",256:"portable_min",65534:"portable_max"},swim_stroke:{0:"freestyle",1:"backstroke",2:"breaststroke",3:"butterfly",4:"drill",5:"mixed",6:"im"},activity_type:{0:"generic",1:"running",2:"cycling",3:"transition",4:"fitness_equipment",5:"swimming",6:"walking",8:"sedentary",254:"all"},activity_subtype:{0:"generic",1:"treadmill",2:"street",3:"trail",4:"track",5:"spin",6:"indoor_cycling",7:"road",8:"mountain",9:"downhill",10:"recumbent",11:"cyclocross",12:"hand_cycling",13:"track_cycling",14:"indoor_rowing",15:"elliptical",16:"stair_climbing",17:"lap_swimming",18:"open_water",254:"all"},activity_level:{0:"low",1:"medium",2:"high"},side:{0:"right",1:"left"},left_right_balance:{0:0,127:"mask",128:"right"},left_right_balance_100:{0:0,16383:"mask",32768:"right"},length_type:{0:"idle",1:"active"},day_of_week:{0:"sunday",1:"monday",2:"tuesday",3:"wednesday",4:"thursday",5:"friday",6:"saturday"},connectivity_capabilities:{0:0,1:"bluetooth",2:"bluetooth_le",4:"ant",8:"activity_upload",16:"course_download",32:"workout_download",64:"live_track",128:"weather_conditions",256:"weather_alerts",512:"gps_ephemeris_download",1024:"explicit_archive",2048:"setup_incomplete",4096:"continue_sync_after_software_update",8192:"connect_iq_app_download",16384:"golf_course_download",32768:"device_initiates_sync",65536:"connect_iq_watch_app_download",131072:"connect_iq_widget_download",262144:"connect_iq_watch_face_download",524288:"connect_iq_data_field_download",1048576:"connect_iq_app_managment",2097152:"swing_sensor",4194304:"swing_sensor_remote",8388608:"incident_detection",16777216:"audio_prompts",33554432:"wifi_verification",67108864:"true_up",134217728:"find_my_watch",268435456:"remote_manual_sync",536870912:"live_track_auto_start",1073741824:"live_track_messaging",2147483648:"instant_input"},weather_report:{0:"current",1:"hourly_forecast",2:"daily_forecast"},weather_status:{0:"clear",1:"partly_cloudy",2:"mostly_cloudy",3:"rain",4:"snow",5:"windy",6:"thunderstorms",7:"wintry_mix",8:"fog",11:"hazy",12:"hail",13:"scattered_showers",14:"scattered_thunderstorms",15:"unknown_precipitation",16:"light_rain",17:"heavy_rain",18:"light_snow",19:"heavy_snow",20:"light_rain_snow",21:"heavy_rain_snow",22:"cloudy"},weather_severity:{0:"unknown",1:"warning",2:"watch",3:"advisory",4:"statement"},weather_severe_type:{0:"unspecified",1:"tornado",2:"tsunami",3:"hurricane",4:"extreme_wind",5:"typhoon",6:"inland_hurricane",7:"hurricane_force_wind",8:"waterspout",9:"severe_thunderstorm",10:"wreckhouse_winds",11:"les_suetes_wind",12:"avalanche",13:"flash_flood",14:"tropical_storm",15:"inland_tropical_storm",16:"blizzard",17:"ice_storm",18:"freezing_rain",19:"debris_flow",20:"flash_freeze",21:"dust_storm",22:"high_wind",23:"winter_storm",24:"heavy_freezing_spray",25:"extreme_cold",26:"wind_chill",27:"cold_wave",28:"heavy_snow_alert",29:"lake_effect_blowing_snow",30:"snow_squall",31:"lake_effect_snow",32:"winter_weather",33:"sleet",34:"snowfall",35:"snow_and_blowing_snow",36:"blowing_snow",37:"snow_alert",38:"arctic_outflow",39:"freezing_drizzle",40:"storm",41:"storm_surge",42:"rainfall",43:"areal_flood",44:"coastal_flood",45:"lakeshore_flood",46:"excessive_heat",47:"heat",48:"weather",49:"high_heat_and_humidity",50:"humidex_and_health",51:"humidex",52:"gale",53:"freezing_spray",54:"special_marine",55:"squall",56:"strong_wind",57:"lake_wind",58:"marine_weather",59:"wind",60:"small_craft_hazardous_seas",61:"hazardous_seas",62:"small_craft",63:"small_craft_winds",64:"small_craft_rough_bar",65:"high_water_level",66:"ashfall",67:"freezing_fog",68:"dense_fog",69:"dense_smoke",70:"blowing_dust",71:"hard_freeze",72:"freeze",73:"frost",74:"fire_weather",75:"flood",76:"rip_tide",77:"high_surf",78:"smog",79:"air_quality",80:"brisk_wind",81:"air_stagnation",82:"low_water",83:"hydrological",84:"special_weather"},stroke_type:{0:"no_event",1:"other",2:"serve",3:"forehand",4:"backhand",5:"smash"},body_location:{0:"left_leg",1:"left_calf",2:"left_shin",3:"left_hamstring",4:"left_quad",5:"left_glute",6:"right_leg",7:"right_calf",8:"right_shin",9:"right_hamstring",10:"right_quad",11:"right_glute",12:"torso_back",13:"left_lower_back",14:"left_upper_back",15:"right_lower_back",16:"right_upper_back",17:"torso_front",18:"left_abdomen",19:"left_chest",20:"right_abdomen",21:"right_chest",22:"left_arm",23:"left_shoulder",24:"left_bicep",25:"left_tricep",26:"left_brachioradialis",27:"left_forearm_extensors",28:"right_arm",29:"right_shoulder",30:"right_bicep",31:"right_tricep",32:"right_brachioradialis",33:"right_forearm_extensors",34:"neck",35:"throat",36:"waist_mid_back",37:"waist_front",38:"waist_left",39:"waist_right"},segment_lap_status:{0:"end",1:"fail"},segment_leaderboard_type:{0:"overall",1:"personal_best",2:"connections",3:"group",4:"challenger",5:"kom",6:"qom",7:"pr",8:"goal",9:"rival",10:"club_leader"},segment_delete_status:{0:"do_not_delete",1:"delete_one",2:"delete_all"},segment_selection_type:{0:"starred",1:"suggested"},source_type:{0:"ant",1:"antplus",2:"bluetooth",3:"bluetooth_low_energy",4:"wifi",5:"local"},display_orientation:{0:"auto",1:"portrait",2:"landscape",3:"portrait_flipped",4:"landscape_flipped"},workout_equipment:{0:"none",1:"swim_fins",2:"swim_kickboard",3:"swim_paddles",4:"swim_pull_buoy",5:"swim_snorkel"},watchface_mode:{0:"digital",1:"analog",2:"connect_iq",3:"disabled"},digital_watchface_layout:{0:"traditional",1:"modern",2:"bold"},analog_watchface_layout:{0:"minimal",1:"traditional",2:"modern"},rider_position_type:{0:"seated",1:"standing",2:"transition_to_seated",3:"transition_to_standing"},power_phase_type:{0:"power_phase_start_angle",1:"power_phase_end_angle",2:"power_phase_arc_length",3:"power_phase_center"},camera_event_type:{0:"video_start",1:"video_split",2:"video_end",3:"photo_taken",4:"video_second_stream_start",5:"video_second_stream_split",6:"video_second_stream_end",7:"video_split_start",8:"video_second_stream_split_start",11:"video_pause",12:"video_second_stream_pause",13:"video_resume",14:"video_second_stream_resume"},sensor_type:{0:"accelerometer",1:"gyroscope",2:"compass",3:"barometer"},bike_light_network_config_type:{0:"auto",4:"individual",5:"high_visibility",6:"trail"},comm_timeout_type:{0:"wildcard_pairing_timeout",1:"pairing_timeout",2:"connection_lost",3:"connection_timeout"},camera_orientation_type:{0:"camera_orientation_0",1:"camera_orientation_90",2:"camera_orientation_180",3:"camera_orientation_270"},attitude_stage:{0:"failed",1:"aligning",2:"degraded",3:"valid"},attitude_validity:{0:0,1:"track_angle_heading_valid",2:"pitch_valid",4:"roll_valid",8:"lateral_body_accel_valid",16:"normal_body_accel_valid",32:"turn_rate_valid",64:"hw_fail",128:"mag_invalid",256:"no_gps",512:"gps_invalid",1024:"solution_coasting",2048:"true_track_angle",4096:"magnetic_heading"},auto_sync_frequency:{0:"never",1:"occasionally",2:"frequent",3:"once_a_day",4:"remote"},exd_layout:{0:"full_screen",1:"half_vertical",2:"half_horizontal",3:"half_vertical_right_split",4:"half_horizontal_bottom_split",5:"full_quarter_split",6:"half_vertical_left_split",7:"half_horizontal_top_split"},exd_display_type:{0:"numerical",1:"simple",2:"graph",3:"bar",4:"circle_graph",5:"virtual_partner",6:"balance",7:"string_list",8:"string",9:"simple_dynamic_icon",10:"gauge"},exd_data_units:{0:"no_units",1:"laps",2:"miles_per_hour",3:"kilometers_per_hour",4:"feet_per_hour",5:"meters_per_hour",6:"degrees_celsius",7:"degrees_farenheit",8:"zone",9:"gear",10:"rpm",11:"bpm",12:"degrees",13:"millimeters",14:"meters",15:"kilometers",16:"feet",17:"yards",18:"kilofeet",19:"miles",20:"time",21:"enum_turn_type",22:"percent",23:"watts",24:"watts_per_kilogram",25:"enum_battery_status",26:"enum_bike_light_beam_angle_mode",27:"enum_bike_light_battery_status",28:"enum_bike_light_network_config_type",29:"lights",30:"seconds",31:"minutes",32:"hours",33:"calories",34:"kilojoules",35:"milliseconds",36:"second_per_mile",37:"second_per_kilometer",38:"centimeter",39:"enum_course_point",40:"bradians",41:"enum_sport",42:"inches_hg",43:"mm_hg",44:"mbars",45:"hecto_pascals",46:"feet_per_min",47:"meters_per_min",48:"meters_per_sec",49:"eight_cardinal"},exd_qualifiers:{0:"no_qualifier",1:"instantaneous",2:"average",3:"lap",4:"maximum",5:"maximum_average",6:"maximum_lap",7:"last_lap",8:"average_lap",9:"to_destination",10:"to_go",11:"to_next",12:"next_course_point",13:"total",14:"three_second_average",15:"ten_second_average",16:"thirty_second_average",17:"percent_maximum",18:"percent_maximum_average",19:"lap_percent_maximum",20:"elapsed",21:"sunrise",22:"sunset",23:"compared_to_virtual_partner",24:"maximum_24h",25:"minimum_24h",26:"minimum",27:"first",28:"second",29:"third",30:"shifter",31:"last_sport",32:"moving",33:"stopped",34:"estimated_total",242:"zone_9",243:"zone_8",244:"zone_7",245:"zone_6",246:"zone_5",247:"zone_4",248:"zone_3",249:"zone_2",250:"zone_1"},exd_descriptors:{0:"bike_light_battery_status",1:"beam_angle_status",2:"batery_level",3:"light_network_mode",4:"number_lights_connected",5:"cadence",6:"distance",7:"estimated_time_of_arrival",8:"heading",9:"time",10:"battery_level",11:"trainer_resistance",12:"trainer_target_power",13:"time_seated",14:"time_standing",15:"elevation",16:"grade",17:"ascent",18:"descent",19:"vertical_speed",20:"di2_battery_level",21:"front_gear",22:"rear_gear",23:"gear_ratio",24:"heart_rate",25:"heart_rate_zone",26:"time_in_heart_rate_zone",27:"heart_rate_reserve",28:"calories",29:"gps_accuracy",30:"gps_signal_strength",31:"temperature",32:"time_of_day",33:"balance",34:"pedal_smoothness",35:"power",36:"functional_threshold_power",37:"intensity_factor",38:"work",39:"power_ratio",40:"normalized_power",41:"training_stress_Score",42:"time_on_zone",43:"speed",44:"laps",45:"reps",46:"workout_step",47:"course_distance",48:"navigation_distance",49:"course_estimated_time_of_arrival",50:"navigation_estimated_time_of_arrival",51:"course_time",52:"navigation_time",53:"course_heading",54:"navigation_heading",55:"power_zone",56:"torque_effectiveness",57:"timer_time",58:"power_weight_ratio",59:"left_platform_center_offset",60:"right_platform_center_offset",61:"left_power_phase_start_angle",62:"right_power_phase_start_angle",63:"left_power_phase_finish_angle",64:"right_power_phase_finish_angle",65:"gears",66:"pace",67:"training_effect",68:"vertical_oscillation",69:"vertical_ratio",70:"ground_contact_time",71:"left_ground_contact_time_balance",72:"right_ground_contact_time_balance",73:"stride_length",74:"running_cadence",75:"performance_condition",76:"course_type",77:"time_in_power_zone",78:"navigation_turn",79:"course_location",80:"navigation_location",81:"compass",82:"gear_combo",83:"muscle_oxygen",84:"icon",85:"compass_heading",86:"gps_heading",87:"gps_elevation",88:"anaerobic_training_effect",89:"course",90:"off_course",91:"glide_ratio",92:"vertical_distance",93:"vmg",94:"ambient_pressure",95:"pressure",96:"vam"},auto_activity_detect:{0:"none",1:"running",2:"cycling",4:"swimming",8:"walking",16:"elliptical",32:"sedentary"},supported_exd_screen_layouts:{0:0,1:"full_screen",2:"half_vertical",4:"half_horizontal",8:"half_vertical_right_split",16:"half_horizontal_bottom_split",32:"full_quarter_split",64:"half_vertical_left_split",128:"half_horizontal_top_split"},fit_base_type:{0:"enum",1:"sint8",2:"uint8",7:"string",10:"uint8z",13:"byte",131:"sint16",132:"uint16",133:"sint32",134:"uint32",136:"float32",137:"float64",139:"uint16z",140:"uint32z",142:"sint64",143:"uint64",144:"uint64z"},turn_type:{0:"arriving_idx",1:"arriving_left_idx",2:"arriving_right_idx",3:"arriving_via_idx",4:"arriving_via_left_idx",5:"arriving_via_right_idx",6:"bear_keep_left_idx",7:"bear_keep_right_idx",8:"continue_idx",9:"exit_left_idx",10:"exit_right_idx",11:"ferry_idx",12:"roundabout_45_idx",13:"roundabout_90_idx",14:"roundabout_135_idx",15:"roundabout_180_idx",16:"roundabout_225_idx",17:"roundabout_270_idx",18:"roundabout_315_idx",19:"roundabout_360_idx",20:"roundabout_neg_45_idx",21:"roundabout_neg_90_idx",22:"roundabout_neg_135_idx",23:"roundabout_neg_180_idx",24:"roundabout_neg_225_idx",25:"roundabout_neg_270_idx",26:"roundabout_neg_315_idx",27:"roundabout_neg_360_idx",28:"roundabout_generic_idx",29:"roundabout_neg_generic_idx",30:"sharp_turn_left_idx",31:"sharp_turn_right_idx",32:"turn_left_idx",33:"turn_right_idx",34:"uturn_left_idx",35:"uturn_right_idx",36:"icon_inv_idx",37:"icon_idx_cnt"},bike_light_beam_angle_mode:{0:"manual",1:"auto"},fit_base_unit:{0:"other",1:"kilogram",2:"pound"},set_type:{0:"rest",1:"active"},exercise_category:{0:"bench_press",1:"calf_raise",2:"cardio",3:"carry",4:"chop",5:"core",6:"crunch",7:"curl",8:"deadlift",9:"flye",10:"hip_raise",11:"hip_stability",12:"hip_swing",13:"hyperextension",14:"lateral_raise",15:"leg_curl",16:"leg_raise",17:"lunge",18:"olympic_lift",19:"plank",20:"plyo",21:"pull_up",22:"push_up",23:"row",24:"shoulder_press",25:"shoulder_stability",26:"shrug",27:"sit_up",28:"squat",29:"total_body",30:"triceps_extension",31:"warm_up",32:"run",65534:"unknown"},bench_press_exercise_name:{0:"alternating_dumbbell_chest_press_on_swiss_ball",1:"barbell_bench_press",2:"barbell_board_bench_press",3:"barbell_floor_press",4:"close_grip_barbell_bench_press",5:"decline_dumbbell_bench_press",6:"dumbbell_bench_press",7:"dumbbell_floor_press",8:"incline_barbell_bench_press",9:"incline_dumbbell_bench_press",10:"incline_smith_machine_bench_press",11:"isometric_barbell_bench_press",12:"kettlebell_chest_press",13:"neutral_grip_dumbbell_bench_press",14:"neutral_grip_dumbbell_incline_bench_press",15:"one_arm_floor_press",16:"weighted_one_arm_floor_press",17:"partial_lockout",18:"reverse_grip_barbell_bench_press",19:"reverse_grip_incline_bench_press",20:"single_arm_cable_chest_press",21:"single_arm_dumbbell_bench_press",22:"smith_machine_bench_press",23:"swiss_ball_dumbbell_chest_press",24:"triple_stop_barbell_bench_press",25:"wide_grip_barbell_bench_press",26:"alternating_dumbbell_chest_press"},calf_raise_exercise_name:{0:"3_way_calf_raise",1:"3_way_weighted_calf_raise",2:"3_way_single_leg_calf_raise",3:"3_way_weighted_single_leg_calf_raise",4:"donkey_calf_raise",5:"weighted_donkey_calf_raise",6:"seated_calf_raise",7:"weighted_seated_calf_raise",8:"seated_dumbbell_toe_raise",9:"single_leg_bent_knee_calf_raise",10:"weighted_single_leg_bent_knee_calf_raise",11:"single_leg_decline_push_up",12:"single_leg_donkey_calf_raise",13:"weighted_single_leg_donkey_calf_raise",14:"single_leg_hip_raise_with_knee_hold",15:"single_leg_standing_calf_raise",16:"single_leg_standing_dumbbell_calf_raise",17:"standing_barbell_calf_raise",18:"standing_calf_raise",19:"weighted_standing_calf_raise",20:"standing_dumbbell_calf_raise"},cardio_exercise_name:{0:"bob_and_weave_circle",1:"weighted_bob_and_weave_circle",2:"cardio_core_crawl",3:"weighted_cardio_core_crawl",4:"double_under",5:"weighted_double_under",6:"jump_rope",7:"weighted_jump_rope",8:"jump_rope_crossover",9:"weighted_jump_rope_crossover",10:"jump_rope_jog",11:"weighted_jump_rope_jog",12:"jumping_jacks",13:"weighted_jumping_jacks",14:"ski_moguls",15:"weighted_ski_moguls",16:"split_jacks",17:"weighted_split_jacks",18:"squat_jacks",19:"weighted_squat_jacks",20:"triple_under",21:"weighted_triple_under"},carry_exercise_name:{0:"bar_holds",1:"farmers_walk",2:"farmers_walk_on_toes",3:"hex_dumbbell_hold",4:"overhead_carry"},chop_exercise_name:{0:"cable_pull_through",1:"cable_rotational_lift",2:"cable_woodchop",3:"cross_chop_to_knee",4:"weighted_cross_chop_to_knee",5:"dumbbell_chop",6:"half_kneeling_rotation",7:"weighted_half_kneeling_rotation",8:"half_kneeling_rotational_chop",9:"half_kneeling_rotational_reverse_chop",10:"half_kneeling_stability_chop",11:"half_kneeling_stability_reverse_chop",12:"kneeling_rotational_chop",13:"kneeling_rotational_reverse_chop",14:"kneeling_stability_chop",15:"kneeling_woodchopper",16:"medicine_ball_wood_chops",17:"power_squat_chops",18:"weighted_power_squat_chops",19:"standing_rotational_chop",20:"standing_split_rotational_chop",21:"standing_split_rotational_reverse_chop",22:"standing_stability_reverse_chop"},core_exercise_name:{0:"abs_jabs",1:"weighted_abs_jabs",2:"alternating_plate_reach",3:"barbell_rollout",4:"weighted_barbell_rollout",5:"body_bar_oblique_twist",6:"cable_core_press",7:"cable_side_bend",8:"side_bend",9:"weighted_side_bend",10:"crescent_circle",11:"weighted_crescent_circle",12:"cycling_russian_twist",13:"weighted_cycling_russian_twist",14:"elevated_feet_russian_twist",15:"weighted_elevated_feet_russian_twist",16:"half_turkish_get_up",17:"kettlebell_windmill",18:"kneeling_ab_wheel",19:"weighted_kneeling_ab_wheel",20:"modified_front_lever",21:"open_knee_tucks",22:"weighted_open_knee_tucks",23:"side_abs_leg_lift",24:"weighted_side_abs_leg_lift",25:"swiss_ball_jackknife",26:"weighted_swiss_ball_jackknife",27:"swiss_ball_pike",28:"weighted_swiss_ball_pike",29:"swiss_ball_rollout",30:"weighted_swiss_ball_rollout",31:"triangle_hip_press",32:"weighted_triangle_hip_press",33:"trx_suspended_jackknife",34:"weighted_trx_suspended_jackknife",35:"u_boat",36:"weighted_u_boat",37:"windmill_switches",38:"weighted_windmill_switches",39:"alternating_slide_out",40:"weighted_alternating_slide_out",41:"ghd_back_extensions",42:"weighted_ghd_back_extensions",43:"overhead_walk",44:"inchworm",45:"weighted_modified_front_lever",46:"russian_twist",47:"abdominal_leg_rotations",48:"arm_and_leg_extension_on_knees",49:"bicycle",50:"bicep_curl_with_leg_extension",51:"cat_cow",52:"corkscrew",53:"criss_cross",54:"criss_cross_with_ball",55:"double_leg_stretch",56:"knee_folds",57:"lower_lift",58:"neck_pull",59:"pelvic_clocks",60:"roll_over",61:"roll_up",62:"rolling",63:"rowing_1",64:"rowing_2",65:"scissors",66:"single_leg_circles",67:"single_leg_stretch",68:"snake_twist_1_and_2",69:"swan",70:"swimming",71:"teaser",72:"the_hundred"},crunch_exercise_name:{0:"bicycle_crunch",1:"cable_crunch",2:"circular_arm_crunch",3:"crossed_arms_crunch",4:"weighted_crossed_arms_crunch",5:"cross_leg_reverse_crunch",6:"weighted_cross_leg_reverse_crunch",7:"crunch_chop",8:"weighted_crunch_chop",9:"double_crunch",10:"weighted_double_crunch",11:"elbow_to_knee_crunch",12:"weighted_elbow_to_knee_crunch",13:"flutter_kicks",14:"weighted_flutter_kicks",15:"foam_roller_reverse_crunch_on_bench",16:"weighted_foam_roller_reverse_crunch_on_bench",17:"foam_roller_reverse_crunch_with_dumbbell",18:"foam_roller_reverse_crunch_with_medicine_ball",19:"frog_press",20:"hanging_knee_raise_oblique_crunch",21:"weighted_hanging_knee_raise_oblique_crunch",22:"hip_crossover",23:"weighted_hip_crossover",24:"hollow_rock",25:"weighted_hollow_rock",26:"incline_reverse_crunch",27:"weighted_incline_reverse_crunch",28:"kneeling_cable_crunch",29:"kneeling_cross_crunch",30:"weighted_kneeling_cross_crunch",31:"kneeling_oblique_cable_crunch",32:"knees_to_elbow",33:"leg_extensions",34:"weighted_leg_extensions",35:"leg_levers",36:"mcgill_curl_up",37:"weighted_mcgill_curl_up",38:"modified_pilates_roll_up_with_ball",39:"weighted_modified_pilates_roll_up_with_ball",40:"pilates_crunch",41:"weighted_pilates_crunch",42:"pilates_roll_up_with_ball",43:"weighted_pilates_roll_up_with_ball",44:"raised_legs_crunch",45:"weighted_raised_legs_crunch",46:"reverse_crunch",47:"weighted_reverse_crunch",48:"reverse_crunch_on_a_bench",49:"weighted_reverse_crunch_on_a_bench",50:"reverse_curl_and_lift",51:"weighted_reverse_curl_and_lift",52:"rotational_lift",53:"weighted_rotational_lift",54:"seated_alternating_reverse_crunch",55:"weighted_seated_alternating_reverse_crunch",56:"seated_leg_u",57:"weighted_seated_leg_u",58:"side_to_side_crunch_and_weave",59:"weighted_side_to_side_crunch_and_weave",60:"single_leg_reverse_crunch",61:"weighted_single_leg_reverse_crunch",62:"skater_crunch_cross",63:"weighted_skater_crunch_cross",64:"standing_cable_crunch",65:"standing_side_crunch",66:"step_climb",67:"weighted_step_climb",68:"swiss_ball_crunch",69:"swiss_ball_reverse_crunch",70:"weighted_swiss_ball_reverse_crunch",71:"swiss_ball_russian_twist",72:"weighted_swiss_ball_russian_twist",73:"swiss_ball_side_crunch",74:"weighted_swiss_ball_side_crunch",75:"thoracic_crunches_on_foam_roller",76:"weighted_thoracic_crunches_on_foam_roller",77:"triceps_crunch",78:"weighted_bicycle_crunch",79:"weighted_crunch",80:"weighted_swiss_ball_crunch",81:"toes_to_bar",82:"weighted_toes_to_bar",83:"crunch",84:"straight_leg_crunch_with_ball"},curl_exercise_name:{0:"alternating_dumbbell_biceps_curl",1:"alternating_dumbbell_biceps_curl_on_swiss_ball",2:"alternating_incline_dumbbell_biceps_curl",3:"barbell_biceps_curl",4:"barbell_reverse_wrist_curl",5:"barbell_wrist_curl",6:"behind_the_back_barbell_reverse_wrist_curl",7:"behind_the_back_one_arm_cable_curl",8:"cable_biceps_curl",9:"cable_hammer_curl",10:"cheating_barbell_biceps_curl",11:"close_grip_ez_bar_biceps_curl",12:"cross_body_dumbbell_hammer_curl",13:"dead_hang_biceps_curl",14:"decline_hammer_curl",15:"dumbbell_biceps_curl_with_static_hold",16:"dumbbell_hammer_curl",17:"dumbbell_reverse_wrist_curl",18:"dumbbell_wrist_curl",19:"ez_bar_preacher_curl",20:"forward_bend_biceps_curl",21:"hammer_curl_to_press",22:"incline_dumbbell_biceps_curl",23:"incline_offset_thumb_dumbbell_curl",24:"kettlebell_biceps_curl",25:"lying_concentration_cable_curl",26:"one_arm_preacher_curl",27:"plate_pinch_curl",28:"preacher_curl_with_cable",29:"reverse_ez_bar_curl",30:"reverse_grip_wrist_curl",31:"reverse_grip_barbell_biceps_curl",32:"seated_alternating_dumbbell_biceps_curl",33:"seated_dumbbell_biceps_curl",34:"seated_reverse_dumbbell_curl",35:"split_stance_offset_pinky_dumbbell_curl",36:"standing_alternating_dumbbell_curls",37:"standing_dumbbell_biceps_curl",38:"standing_ez_bar_biceps_curl",39:"static_curl",40:"swiss_ball_dumbbell_overhead_triceps_extension",41:"swiss_ball_ez_bar_preacher_curl",42:"twisting_standing_dumbbell_biceps_curl",43:"wide_grip_ez_bar_biceps_curl"},deadlift_exercise_name:{0:"barbell_deadlift",1:"barbell_straight_leg_deadlift",2:"dumbbell_deadlift",3:"dumbbell_single_leg_deadlift_to_row",4:"dumbbell_straight_leg_deadlift",5:"kettlebell_floor_to_shelf",6:"one_arm_one_leg_deadlift",7:"rack_pull",8:"rotational_dumbbell_straight_leg_deadlift",9:"single_arm_deadlift",10:"single_leg_barbell_deadlift",11:"single_leg_barbell_straight_leg_deadlift",12:"single_leg_deadlift_with_barbell",13:"single_leg_rdl_circuit",14:"single_leg_romanian_deadlift_with_dumbbell",15:"sumo_deadlift",16:"sumo_deadlift_high_pull",17:"trap_bar_deadlift",18:"wide_grip_barbell_deadlift"},flye_exercise_name:{0:"cable_crossover",1:"decline_dumbbell_flye",2:"dumbbell_flye",3:"incline_dumbbell_flye",4:"kettlebell_flye",5:"kneeling_rear_flye",6:"single_arm_standing_cable_reverse_flye",7:"swiss_ball_dumbbell_flye",8:"arm_rotations",9:"hug_a_tree"},hip_raise_exercise_name:{0:"barbell_hip_thrust_on_floor",1:"barbell_hip_thrust_with_bench",2:"bent_knee_swiss_ball_reverse_hip_raise",3:"weighted_bent_knee_swiss_ball_reverse_hip_raise",4:"bridge_with_leg_extension",5:"weighted_bridge_with_leg_extension",6:"clam_bridge",7:"front_kick_tabletop",8:"weighted_front_kick_tabletop",9:"hip_extension_and_cross",10:"weighted_hip_extension_and_cross",11:"hip_raise",12:"weighted_hip_raise",13:"hip_raise_with_feet_on_swiss_ball",14:"weighted_hip_raise_with_feet_on_swiss_ball",15:"hip_raise_with_head_on_bosu_ball",16:"weighted_hip_raise_with_head_on_bosu_ball",17:"hip_raise_with_head_on_swiss_ball",18:"weighted_hip_raise_with_head_on_swiss_ball",19:"hip_raise_with_knee_squeeze",20:"weighted_hip_raise_with_knee_squeeze",21:"incline_rear_leg_extension",22:"weighted_incline_rear_leg_extension",23:"kettlebell_swing",24:"marching_hip_raise",25:"weighted_marching_hip_raise",26:"marching_hip_raise_with_feet_on_a_swiss_ball",27:"weighted_marching_hip_raise_with_feet_on_a_swiss_ball",28:"reverse_hip_raise",29:"weighted_reverse_hip_raise",30:"single_leg_hip_raise",31:"weighted_single_leg_hip_raise",32:"single_leg_hip_raise_with_foot_on_bench",33:"weighted_single_leg_hip_raise_with_foot_on_bench",34:"single_leg_hip_raise_with_foot_on_bosu_ball",35:"weighted_single_leg_hip_raise_with_foot_on_bosu_ball",36:"single_leg_hip_raise_with_foot_on_foam_roller",37:"weighted_single_leg_hip_raise_with_foot_on_foam_roller",38:"single_leg_hip_raise_with_foot_on_medicine_ball",39:"weighted_single_leg_hip_raise_with_foot_on_medicine_ball",40:"single_leg_hip_raise_with_head_on_bosu_ball",41:"weighted_single_leg_hip_raise_with_head_on_bosu_ball",42:"weighted_clam_bridge",43:"single_leg_swiss_ball_hip_raise_and_leg_curl",44:"clams",45:"inner_thigh_circles",46:"inner_thigh_side_lift",47:"leg_circles",48:"leg_lift",49:"leg_lift_in_external_rotation"},hip_stability_exercise_name:{0:"band_side_lying_leg_raise",1:"dead_bug",2:"weighted_dead_bug",3:"external_hip_raise",4:"weighted_external_hip_raise",5:"fire_hydrant_kicks",6:"weighted_fire_hydrant_kicks",7:"hip_circles",8:"weighted_hip_circles",9:"inner_thigh_lift",10:"weighted_inner_thigh_lift",11:"lateral_walks_with_band_at_ankles",12:"pretzel_side_kick",13:"weighted_pretzel_side_kick",14:"prone_hip_internal_rotation",15:"weighted_prone_hip_internal_rotation",16:"quadruped",17:"quadruped_hip_extension",18:"weighted_quadruped_hip_extension",19:"quadruped_with_leg_lift",20:"weighted_quadruped_with_leg_lift",21:"side_lying_leg_raise",22:"weighted_side_lying_leg_raise",23:"sliding_hip_adduction",24:"weighted_sliding_hip_adduction",25:"standing_adduction",26:"weighted_standing_adduction",27:"standing_cable_hip_abduction",28:"standing_hip_abduction",29:"weighted_standing_hip_abduction",30:"standing_rear_leg_raise",31:"weighted_standing_rear_leg_raise",32:"supine_hip_internal_rotation",33:"weighted_supine_hip_internal_rotation"},hip_swing_excercise_name:{0:"single_arm_kettlebell_swing",1:"single_arm_dumbbell_swing",2:"step_out_swing"},hyperextension_exercise_name:{0:"back_extension_with_opposite_arm_and_leg_reach",1:"weighted_back_extension_with_opposite_arm_and_leg_reach",2:"base_rotations",3:"weighted_base_rotations",4:"bent_knee_reverse_hyperextension",5:"weighted_bent_knee_reverse_hyperextension",6:"hollow_hold_and_roll",7:"weighted_hollow_hold_and_roll",8:"kicks",9:"weighted_kicks",10:"knee_raises",11:"weighted_knee_raises",12:"kneeling_superman",13:"weighted_kneeling_superman",14:"lat_pull_down_with_row",15:"medicine_ball_deadlift_to_reach",16:"one_arm_one_leg_row",17:"one_arm_row_with_band",18:"overhead_lunge_with_medicine_ball",19:"plank_knee_tucks",20:"weighted_plank_knee_tucks",21:"side_step",22:"weighted_side_step",23:"single_leg_back_extension",24:"weighted_single_leg_back_extension",25:"spine_extension",26:"weighted_spine_extension",27:"static_back_extension",28:"weighted_static_back_extension",29:"superman_from_floor",30:"weighted_superman_from_floor",31:"swiss_ball_back_extension",32:"weighted_swiss_ball_back_extension",33:"swiss_ball_hyperextension",34:"weighted_swiss_ball_hyperextension",35:"swiss_ball_opposite_arm_and_leg_lift",36:"weighted_swiss_ball_opposite_arm_and_leg_lift",37:"superman_on_swiss_ball",38:"cobra",39:"supine_floor_barre"},lateral_raise_exercise_name:{0:"45_degree_cable_external_rotation",1:"alternating_lateral_raise_with_static_hold",2:"bar_muscle_up",3:"bent_over_lateral_raise",4:"cable_diagonal_raise",5:"cable_front_raise",6:"calorie_row",7:"combo_shoulder_raise",8:"dumbbell_diagonal_raise",9:"dumbbell_v_raise",10:"front_raise",11:"leaning_dumbbell_lateral_raise",12:"lying_dumbbell_raise",13:"muscle_up",14:"one_arm_cable_lateral_raise",15:"overhand_grip_rear_lateral_raise",16:"plate_raises",17:"ring_dip",18:"weighted_ring_dip",19:"ring_muscle_up",20:"weighted_ring_muscle_up",21:"rope_climb",22:"weighted_rope_climb",23:"scaption",24:"seated_lateral_raise",25:"seated_rear_lateral_raise",26:"side_lying_lateral_raise",27:"standing_lift",28:"suspended_row",29:"underhand_grip_rear_lateral_raise",30:"wall_slide",31:"weighted_wall_slide",32:"arm_circles",33:"shaving_the_head"},leg_curl_exercise_name:{0:"leg_curl",1:"weighted_leg_curl",2:"good_morning",3:"seated_barbell_good_morning",4:"single_leg_barbell_good_morning",5:"single_leg_sliding_leg_curl",6:"sliding_leg_curl",7:"split_barbell_good_morning",8:"split_stance_extension",9:"staggered_stance_good_morning",10:"swiss_ball_hip_raise_and_leg_curl",11:"zercher_good_morning"},leg_raise_exercise_name:{0:"hanging_knee_raise",1:"hanging_leg_raise",2:"weighted_hanging_leg_raise",3:"hanging_single_leg_raise",4:"weighted_hanging_single_leg_raise",5:"kettlebell_leg_raises",6:"leg_lowering_drill",7:"weighted_leg_lowering_drill",8:"lying_straight_leg_raise",9:"weighted_lying_straight_leg_raise",10:"medicine_ball_leg_drops",11:"quadruped_leg_raise",12:"weighted_quadruped_leg_raise",13:"reverse_leg_raise",14:"weighted_reverse_leg_raise",15:"reverse_leg_raise_on_swiss_ball",16:"weighted_reverse_leg_raise_on_swiss_ball",17:"single_leg_lowering_drill",18:"weighted_single_leg_lowering_drill",19:"weighted_hanging_knee_raise",20:"lateral_stepover",21:"weighted_lateral_stepover"},lunge_exercise_name:{0:"overhead_lunge",1:"lunge_matrix",2:"weighted_lunge_matrix",3:"alternating_barbell_forward_lunge",4:"alternating_dumbbell_lunge_with_reach",5:"back_foot_elevated_dumbbell_split_squat",6:"barbell_box_lunge",7:"barbell_bulgarian_split_squat",8:"barbell_crossover_lunge",9:"barbell_front_split_squat",10:"barbell_lunge",11:"barbell_reverse_lunge",12:"barbell_side_lunge",13:"barbell_split_squat",14:"core_control_rear_lunge",15:"diagonal_lunge",16:"drop_lunge",17:"dumbbell_box_lunge",18:"dumbbell_bulgarian_split_squat",19:"dumbbell_crossover_lunge",20:"dumbbell_diagonal_lunge",21:"dumbbell_lunge",22:"dumbbell_lunge_and_rotation",23:"dumbbell_overhead_bulgarian_split_squat",24:"dumbbell_reverse_lunge_to_high_knee_and_press",25:"dumbbell_side_lunge",26:"elevated_front_foot_barbell_split_squat",27:"front_foot_elevated_dumbbell_split_squat",28:"gunslinger_lunge",29:"lawnmower_lunge",30:"low_lunge_with_isometric_adduction",31:"low_side_to_side_lunge",32:"lunge",33:"weighted_lunge",34:"lunge_with_arm_reach",35:"lunge_with_diagonal_reach",36:"lunge_with_side_bend",37:"offset_dumbbell_lunge",38:"offset_dumbbell_reverse_lunge",39:"overhead_bulgarian_split_squat",40:"overhead_dumbbell_reverse_lunge",41:"overhead_dumbbell_split_squat",42:"overhead_lunge_with_rotation",43:"reverse_barbell_box_lunge",44:"reverse_box_lunge",45:"reverse_dumbbell_box_lunge",46:"reverse_dumbbell_crossover_lunge",47:"reverse_dumbbell_diagonal_lunge",48:"reverse_lunge_with_reach_back",49:"weighted_reverse_lunge_with_reach_back",50:"reverse_lunge_with_twist_and_overhead_reach",51:"weighted_reverse_lunge_with_twist_and_overhead_reach",52:"reverse_sliding_box_lunge",53:"weighted_reverse_sliding_box_lunge",54:"reverse_sliding_lunge",55:"weighted_reverse_sliding_lunge",56:"runners_lunge_to_balance",57:"weighted_runners_lunge_to_balance",58:"shifting_side_lunge",59:"side_and_crossover_lunge",60:"weighted_side_and_crossover_lunge",61:"side_lunge",62:"weighted_side_lunge",63:"side_lunge_and_press",64:"side_lunge_jump_off",65:"side_lunge_sweep",66:"weighted_side_lunge_sweep",67:"side_lunge_to_crossover_tap",68:"weighted_side_lunge_to_crossover_tap",69:"side_to_side_lunge_chops",70:"weighted_side_to_side_lunge_chops",71:"siff_jump_lunge",72:"weighted_siff_jump_lunge",73:"single_arm_reverse_lunge_and_press",74:"sliding_lateral_lunge",75:"weighted_sliding_lateral_lunge",76:"walking_barbell_lunge",77:"walking_dumbbell_lunge",78:"walking_lunge",79:"weighted_walking_lunge",80:"wide_grip_overhead_barbell_split_squat"},olympic_lift_exercise_name:{0:"barbell_hang_power_clean",1:"barbell_hang_squat_clean",2:"barbell_power_clean",3:"barbell_power_snatch",4:"barbell_squat_clean",5:"clean_and_jerk",6:"barbell_hang_power_snatch",7:"barbell_hang_pull",8:"barbell_high_pull",9:"barbell_snatch",10:"barbell_split_jerk",11:"clean",12:"dumbbell_clean",13:"dumbbell_hang_pull",14:"one_hand_dumbbell_split_snatch",15:"push_jerk",16:"single_arm_dumbbell_snatch",17:"single_arm_hang_snatch",18:"single_arm_kettlebell_snatch",19:"split_jerk",20:"squat_clean_and_jerk"},plank_exercise_name:{0:"45_degree_plank",1:"weighted_45_degree_plank",2:"90_degree_static_hold",3:"weighted_90_degree_static_hold",4:"bear_crawl",5:"weighted_bear_crawl",6:"cross_body_mountain_climber",7:"weighted_cross_body_mountain_climber",8:"elbow_plank_pike_jacks",9:"weighted_elbow_plank_pike_jacks",10:"elevated_feet_plank",11:"weighted_elevated_feet_plank",12:"elevator_abs",13:"weighted_elevator_abs",14:"extended_plank",15:"weighted_extended_plank",16:"full_plank_passe_twist",17:"weighted_full_plank_passe_twist",18:"inching_elbow_plank",19:"weighted_inching_elbow_plank",20:"inchworm_to_side_plank",21:"weighted_inchworm_to_side_plank",22:"kneeling_plank",23:"weighted_kneeling_plank",24:"kneeling_side_plank_with_leg_lift",25:"weighted_kneeling_side_plank_with_leg_lift",26:"lateral_roll",27:"weighted_lateral_roll",28:"lying_reverse_plank",29:"weighted_lying_reverse_plank",30:"medicine_ball_mountain_climber",31:"weighted_medicine_ball_mountain_climber",32:"modified_mountain_climber_and_extension",33:"weighted_modified_mountain_climber_and_extension",34:"mountain_climber",35:"weighted_mountain_climber",36:"mountain_climber_on_sliding_discs",37:"weighted_mountain_climber_on_sliding_discs",38:"mountain_climber_with_feet_on_bosu_ball",39:"weighted_mountain_climber_with_feet_on_bosu_ball",40:"mountain_climber_with_hands_on_bench",41:"mountain_climber_with_hands_on_swiss_ball",42:"weighted_mountain_climber_with_hands_on_swiss_ball",43:"plank",44:"plank_jacks_with_feet_on_sliding_discs",45:"weighted_plank_jacks_with_feet_on_sliding_discs",46:"plank_knee_twist",47:"weighted_plank_knee_twist",48:"plank_pike_jumps",49:"weighted_plank_pike_jumps",50:"plank_pikes",51:"weighted_plank_pikes",52:"plank_to_stand_up",53:"weighted_plank_to_stand_up",54:"plank_with_arm_raise",55:"weighted_plank_with_arm_raise",56:"plank_with_knee_to_elbow",57:"weighted_plank_with_knee_to_elbow",58:"plank_with_oblique_crunch",59:"weighted_plank_with_oblique_crunch",60:"plyometric_side_plank",61:"weighted_plyometric_side_plank",62:"rolling_side_plank",63:"weighted_rolling_side_plank",64:"side_kick_plank",65:"weighted_side_kick_plank",66:"side_plank",67:"weighted_side_plank",68:"side_plank_and_row",69:"weighted_side_plank_and_row",70:"side_plank_lift",71:"weighted_side_plank_lift",72:"side_plank_with_elbow_on_bosu_ball",73:"weighted_side_plank_with_elbow_on_bosu_ball",74:"side_plank_with_feet_on_bench",75:"weighted_side_plank_with_feet_on_bench",76:"side_plank_with_knee_circle",77:"weighted_side_plank_with_knee_circle",78:"side_plank_with_knee_tuck",79:"weighted_side_plank_with_knee_tuck",80:"side_plank_with_leg_lift",81:"weighted_side_plank_with_leg_lift",82:"side_plank_with_reach_under",83:"weighted_side_plank_with_reach_under",84:"single_leg_elevated_feet_plank",85:"weighted_single_leg_elevated_feet_plank",86:"single_leg_flex_and_extend",87:"weighted_single_leg_flex_and_extend",88:"single_leg_side_plank",89:"weighted_single_leg_side_plank",90:"spiderman_plank",91:"weighted_spiderman_plank",92:"straight_arm_plank",93:"weighted_straight_arm_plank",94:"straight_arm_plank_with_shoulder_touch",95:"weighted_straight_arm_plank_with_shoulder_touch",96:"swiss_ball_plank",97:"weighted_swiss_ball_plank",98:"swiss_ball_plank_leg_lift",99:"weighted_swiss_ball_plank_leg_lift",100:"swiss_ball_plank_leg_lift_and_hold",101:"swiss_ball_plank_with_feet_on_bench",102:"weighted_swiss_ball_plank_with_feet_on_bench",103:"swiss_ball_prone_jackknife",104:"weighted_swiss_ball_prone_jackknife",105:"swiss_ball_side_plank",106:"weighted_swiss_ball_side_plank",107:"three_way_plank",108:"weighted_three_way_plank",109:"towel_plank_and_knee_in",110:"weighted_towel_plank_and_knee_in",111:"t_stabilization",112:"weighted_t_stabilization",113:"turkish_get_up_to_side_plank",114:"weighted_turkish_get_up_to_side_plank",115:"two_point_plank",116:"weighted_two_point_plank",117:"weighted_plank",118:"wide_stance_plank_with_diagonal_arm_lift",119:"weighted_wide_stance_plank_with_diagonal_arm_lift",120:"wide_stance_plank_with_diagonal_leg_lift",121:"weighted_wide_stance_plank_with_diagonal_leg_lift",122:"wide_stance_plank_with_leg_lift",123:"weighted_wide_stance_plank_with_leg_lift",124:"wide_stance_plank_with_opposite_arm_and_leg_lift",125:"weighted_mountain_climber_with_hands_on_bench",126:"weighted_swiss_ball_plank_leg_lift_and_hold",127:"weighted_wide_stance_plank_with_opposite_arm_and_leg_lift",128:"plank_with_feet_on_swiss_ball",129:"side_plank_to_plank_with_reach_under",130:"bridge_with_glute_lower_lift",131:"bridge_one_leg_bridge",132:"plank_with_arm_variations",133:"plank_with_leg_lift",134:"reverse_plank_with_leg_pull"},plyo_exercise_name:{0:"alternating_jump_lunge",1:"weighted_alternating_jump_lunge",2:"barbell_jump_squat",3:"body_weight_jump_squat",4:"weighted_jump_squat",5:"cross_knee_strike",6:"weighted_cross_knee_strike",7:"depth_jump",8:"weighted_depth_jump",9:"dumbbell_jump_squat",10:"dumbbell_split_jump",11:"front_knee_strike",12:"weighted_front_knee_strike",13:"high_box_jump",14:"weighted_high_box_jump",15:"isometric_explosive_body_weight_jump_squat",16:"weighted_isometric_explosive_jump_squat",17:"lateral_leap_and_hop",18:"weighted_lateral_leap_and_hop",19:"lateral_plyo_squats",20:"weighted_lateral_plyo_squats",21:"lateral_slide",22:"weighted_lateral_slide",23:"medicine_ball_overhead_throws",24:"medicine_ball_side_throw",25:"medicine_ball_slam",26:"side_to_side_medicine_ball_throws",27:"side_to_side_shuffle_jump",28:"weighted_side_to_side_shuffle_jump",29:"squat_jump_onto_box",30:"weighted_squat_jump_onto_box",31:"squat_jumps_in_and_out",32:"weighted_squat_jumps_in_and_out"},pull_up_exercise_name:{0:"banded_pull_ups",1:"30_degree_lat_pulldown",2:"band_assisted_chin_up",3:"close_grip_chin_up",4:"weighted_close_grip_chin_up",5:"close_grip_lat_pulldown",6:"crossover_chin_up",7:"weighted_crossover_chin_up",8:"ez_bar_pullover",9:"hanging_hurdle",10:"weighted_hanging_hurdle",11:"kneeling_lat_pulldown",12:"kneeling_underhand_grip_lat_pulldown",13:"lat_pulldown",14:"mixed_grip_chin_up",15:"weighted_mixed_grip_chin_up",16:"mixed_grip_pull_up",17:"weighted_mixed_grip_pull_up",18:"reverse_grip_pulldown",19:"standing_cable_pullover",20:"straight_arm_pulldown",21:"swiss_ball_ez_bar_pullover",22:"towel_pull_up",23:"weighted_towel_pull_up",24:"weighted_pull_up",25:"wide_grip_lat_pulldown",26:"wide_grip_pull_up",27:"weighted_wide_grip_pull_up",28:"burpee_pull_up",29:"weighted_burpee_pull_up",30:"jumping_pull_ups",31:"weighted_jumping_pull_ups",32:"kipping_pull_up",33:"weighted_kipping_pull_up",34:"l_pull_up",35:"weighted_l_pull_up",36:"suspended_chin_up",37:"weighted_suspended_chin_up",38:"pull_up"},push_up_exercise_name:{0:"chest_press_with_band",1:"alternating_staggered_push_up",2:"weighted_alternating_staggered_push_up",3:"alternating_hands_medicine_ball_push_up",4:"weighted_alternating_hands_medicine_ball_push_up",5:"bosu_ball_push_up",6:"weighted_bosu_ball_push_up",7:"clapping_push_up",8:"weighted_clapping_push_up",9:"close_grip_medicine_ball_push_up",10:"weighted_close_grip_medicine_ball_push_up",11:"close_hands_push_up",12:"weighted_close_hands_push_up",13:"decline_push_up",14:"weighted_decline_push_up",15:"diamond_push_up",16:"weighted_diamond_push_up",17:"explosive_crossover_push_up",18:"weighted_explosive_crossover_push_up",19:"explosive_push_up",20:"weighted_explosive_push_up",21:"feet_elevated_side_to_side_push_up",22:"weighted_feet_elevated_side_to_side_push_up",23:"hand_release_push_up",24:"weighted_hand_release_push_up",25:"handstand_push_up",26:"weighted_handstand_push_up",27:"incline_push_up",28:"weighted_incline_push_up",29:"isometric_explosive_push_up",30:"weighted_isometric_explosive_push_up",31:"judo_push_up",32:"weighted_judo_push_up",33:"kneeling_push_up",34:"weighted_kneeling_push_up",35:"medicine_ball_chest_pass",36:"medicine_ball_push_up",37:"weighted_medicine_ball_push_up",38:"one_arm_push_up",39:"weighted_one_arm_push_up",40:"weighted_push_up",41:"push_up_and_row",42:"weighted_push_up_and_row",43:"push_up_plus",44:"weighted_push_up_plus",45:"push_up_with_feet_on_swiss_ball",46:"weighted_push_up_with_feet_on_swiss_ball",47:"push_up_with_one_hand_on_medicine_ball",48:"weighted_push_up_with_one_hand_on_medicine_ball",49:"shoulder_push_up",50:"weighted_shoulder_push_up",51:"single_arm_medicine_ball_push_up",52:"weighted_single_arm_medicine_ball_push_up",53:"spiderman_push_up",54:"weighted_spiderman_push_up",55:"stacked_feet_push_up",56:"weighted_stacked_feet_push_up",57:"staggered_hands_push_up",58:"weighted_staggered_hands_push_up",59:"suspended_push_up",60:"weighted_suspended_push_up",61:"swiss_ball_push_up",62:"weighted_swiss_ball_push_up",63:"swiss_ball_push_up_plus",64:"weighted_swiss_ball_push_up_plus",65:"t_push_up",66:"weighted_t_push_up",67:"triple_stop_push_up",68:"weighted_triple_stop_push_up",69:"wide_hands_push_up",70:"weighted_wide_hands_push_up",71:"parallette_handstand_push_up",72:"weighted_parallette_handstand_push_up",73:"ring_handstand_push_up",74:"weighted_ring_handstand_push_up",75:"ring_push_up",76:"weighted_ring_push_up",77:"push_up",78:"pilates_pushup"},row_exercise_name:{0:"barbell_straight_leg_deadlift_to_row",1:"cable_row_standing",2:"dumbbell_row",3:"elevated_feet_inverted_row",4:"weighted_elevated_feet_inverted_row",5:"face_pull",6:"face_pull_with_external_rotation",7:"inverted_row_with_feet_on_swiss_ball",8:"weighted_inverted_row_with_feet_on_swiss_ball",9:"kettlebell_row",10:"modified_inverted_row",11:"weighted_modified_inverted_row",12:"neutral_grip_alternating_dumbbell_row",13:"one_arm_bent_over_row",14:"one_legged_dumbbell_row",15:"renegade_row",16:"reverse_grip_barbell_row",17:"rope_handle_cable_row",18:"seated_cable_row",19:"seated_dumbbell_row",20:"single_arm_cable_row",21:"single_arm_cable_row_and_rotation",22:"single_arm_inverted_row",23:"weighted_single_arm_inverted_row",24:"single_arm_neutral_grip_dumbbell_row",25:"single_arm_neutral_grip_dumbbell_row_and_rotation",26:"suspended_inverted_row",27:"weighted_suspended_inverted_row",28:"t_bar_row",29:"towel_grip_inverted_row",30:"weighted_towel_grip_inverted_row",31:"underhand_grip_cable_row",32:"v_grip_cable_row",33:"wide_grip_seated_cable_row"},shoulder_press_exercise_name:{0:"alternating_dumbbell_shoulder_press",1:"arnold_press",2:"barbell_front_squat_to_push_press",3:"barbell_push_press",4:"barbell_shoulder_press",5:"dead_curl_press",6:"dumbbell_alternating_shoulder_press_and_twist",7:"dumbbell_hammer_curl_to_lunge_to_press",8:"dumbbell_push_press",9:"floor_inverted_shoulder_press",10:"weighted_floor_inverted_shoulder_press",11:"inverted_shoulder_press",12:"weighted_inverted_shoulder_press",13:"one_arm_push_press",14:"overhead_barbell_press",15:"overhead_dumbbell_press",16:"seated_barbell_shoulder_press",17:"seated_dumbbell_shoulder_press",18:"single_arm_dumbbell_shoulder_press",19:"single_arm_step_up_and_press",20:"smith_machine_overhead_press",21:"split_stance_hammer_curl_to_press",22:"swiss_ball_dumbbell_shoulder_press",23:"weight_plate_front_raise"},shoulder_stability_exercise_name:{0:"90_degree_cable_external_rotation",1:"band_external_rotation",2:"band_internal_rotation",3:"bent_arm_lateral_raise_and_external_rotation",4:"cable_external_rotation",5:"dumbbell_face_pull_with_external_rotation",6:"floor_i_raise",7:"weighted_floor_i_raise",8:"floor_t_raise",9:"weighted_floor_t_raise",10:"floor_y_raise",11:"weighted_floor_y_raise",12:"incline_i_raise",13:"weighted_incline_i_raise",14:"incline_l_raise",15:"weighted_incline_l_raise",16:"incline_t_raise",17:"weighted_incline_t_raise",18:"incline_w_raise",19:"weighted_incline_w_raise",20:"incline_y_raise",21:"weighted_incline_y_raise",22:"lying_external_rotation",23:"seated_dumbbell_external_rotation",24:"standing_l_raise",25:"swiss_ball_i_raise",26:"weighted_swiss_ball_i_raise",27:"swiss_ball_t_raise",28:"weighted_swiss_ball_t_raise",29:"swiss_ball_w_raise",30:"weighted_swiss_ball_w_raise",31:"swiss_ball_y_raise",32:"weighted_swiss_ball_y_raise"},shrug_exercise_name:{0:"barbell_jump_shrug",1:"barbell_shrug",2:"barbell_upright_row",3:"behind_the_back_smith_machine_shrug",4:"dumbbell_jump_shrug",5:"dumbbell_shrug",6:"dumbbell_upright_row",7:"incline_dumbbell_shrug",8:"overhead_barbell_shrug",9:"overhead_dumbbell_shrug",10:"scaption_and_shrug",11:"scapular_retraction",12:"serratus_chair_shrug",13:"weighted_serratus_chair_shrug",14:"serratus_shrug",15:"weighted_serratus_shrug",16:"wide_grip_jump_shrug"},sit_up_exercise_name:{0:"alternating_sit_up",1:"weighted_alternating_sit_up",2:"bent_knee_v_up",3:"weighted_bent_knee_v_up",4:"butterfly_sit_up",5:"weighted_butterfly_situp",6:"cross_punch_roll_up",7:"weighted_cross_punch_roll_up",8:"crossed_arms_sit_up",9:"weighted_crossed_arms_sit_up",10:"get_up_sit_up",11:"weighted_get_up_sit_up",12:"hovering_sit_up",13:"weighted_hovering_sit_up",14:"kettlebell_sit_up",15:"medicine_ball_alternating_v_up",16:"medicine_ball_sit_up",17:"medicine_ball_v_up",18:"modified_sit_up",19:"negative_sit_up",20:"one_arm_full_sit_up",21:"reclining_circle",22:"weighted_reclining_circle",23:"reverse_curl_up",24:"weighted_reverse_curl_up",25:"single_leg_swiss_ball_jackknife",26:"weighted_single_leg_swiss_ball_jackknife",27:"the_teaser",28:"the_teaser_weighted",29:"three_part_roll_down",30:"weighted_three_part_roll_down",31:"v_up",32:"weighted_v_up",33:"weighted_russian_twist_on_swiss_ball",34:"weighted_sit_up",35:"x_abs",36:"weighted_x_abs",37:"sit_up"},squat_exercise_name:{0:"leg_press",1:"back_squat_with_body_bar",2:"back_squats",3:"weighted_back_squats",4:"balancing_squat",5:"weighted_balancing_squat",6:"barbell_back_squat",7:"barbell_box_squat",8:"barbell_front_squat",9:"barbell_hack_squat",10:"barbell_hang_squat_snatch",11:"barbell_lateral_step_up",12:"barbell_quarter_squat",13:"barbell_siff_squat",14:"barbell_squat_snatch",15:"barbell_squat_with_heels_raised",16:"barbell_stepover",17:"barbell_step_up",18:"bench_squat_with_rotational_chop",19:"weighted_bench_squat_with_rotational_chop",20:"body_weight_wall_squat",21:"weighted_wall_squat",22:"box_step_squat",23:"weighted_box_step_squat",24:"braced_squat",25:"crossed_arm_barbell_front_squat",26:"crossover_dumbbell_step_up",27:"dumbbell_front_squat",28:"dumbbell_split_squat",29:"dumbbell_squat",30:"dumbbell_squat_clean",31:"dumbbell_stepover",32:"dumbbell_step_up",33:"elevated_single_leg_squat",34:"weighted_elevated_single_leg_squat",35:"figure_four_squats",36:"weighted_figure_four_squats",37:"goblet_squat",38:"kettlebell_squat",39:"kettlebell_swing_overhead",40:"kettlebell_swing_with_flip_to_squat",41:"lateral_dumbbell_step_up",42:"one_legged_squat",43:"overhead_dumbbell_squat",44:"overhead_squat",45:"partial_single_leg_squat",46:"weighted_partial_single_leg_squat",47:"pistol_squat",48:"weighted_pistol_squat",49:"plie_slides",50:"weighted_plie_slides",51:"plie_squat",52:"weighted_plie_squat",53:"prisoner_squat",54:"weighted_prisoner_squat",55:"single_leg_bench_get_up",56:"weighted_single_leg_bench_get_up",57:"single_leg_bench_squat",58:"weighted_single_leg_bench_squat",59:"single_leg_squat_on_swiss_ball",60:"weighted_single_leg_squat_on_swiss_ball",61:"squat",62:"weighted_squat",63:"squats_with_band",64:"staggered_squat",65:"weighted_staggered_squat",66:"step_up",67:"weighted_step_up",68:"suitcase_squats",69:"sumo_squat",70:"sumo_squat_slide_in",71:"weighted_sumo_squat_slide_in",72:"sumo_squat_to_high_pull",73:"sumo_squat_to_stand",74:"weighted_sumo_squat_to_stand",75:"sumo_squat_with_rotation",76:"weighted_sumo_squat_with_rotation",77:"swiss_ball_body_weight_wall_squat",78:"weighted_swiss_ball_wall_squat",79:"thrusters",80:"uneven_squat",81:"weighted_uneven_squat",82:"waist_slimming_squat",83:"wall_ball",84:"wide_stance_barbell_squat",85:"wide_stance_goblet_squat",86:"zercher_squat",87:"kbs_overhead",88:"squat_and_side_kick",89:"squat_jumps_in_n_out",90:"pilates_plie_squats_parallel_turned_out_flat_and_heels",91:"releve_straight_leg_and_knee_bent_with_one_leg_variation"},total_body_exercise_name:{0:"burpee",1:"weighted_burpee",2:"burpee_box_jump",3:"weighted_burpee_box_jump",4:"high_pull_burpee",5:"man_makers",6:"one_arm_burpee",7:"squat_thrusts",8:"weighted_squat_thrusts",9:"squat_plank_push_up",10:"weighted_squat_plank_push_up",11:"standing_t_rotation_balance",12:"weighted_standing_t_rotation_balance"},triceps_extension_exercise_name:{0:"bench_dip",1:"weighted_bench_dip",2:"body_weight_dip",3:"cable_kickback",4:"cable_lying_triceps_extension",5:"cable_overhead_triceps_extension",6:"dumbbell_kickback",7:"dumbbell_lying_triceps_extension",8:"ez_bar_overhead_triceps_extension",9:"incline_dip",10:"weighted_incline_dip",11:"incline_ez_bar_lying_triceps_extension",12:"lying_dumbbell_pullover_to_extension",13:"lying_ez_bar_triceps_extension",14:"lying_triceps_extension_to_close_grip_bench_press",15:"overhead_dumbbell_triceps_extension",16:"reclining_triceps_press",17:"reverse_grip_pressdown",18:"reverse_grip_triceps_pressdown",19:"rope_pressdown",20:"seated_barbell_overhead_triceps_extension",21:"seated_dumbbell_overhead_triceps_extension",22:"seated_ez_bar_overhead_triceps_extension",23:"seated_single_arm_overhead_dumbbell_extension",24:"single_arm_dumbbell_overhead_triceps_extension",25:"single_dumbbell_seated_overhead_triceps_extension",26:"single_leg_bench_dip_and_kick",27:"weighted_single_leg_bench_dip_and_kick",28:"single_leg_dip",29:"weighted_single_leg_dip",30:"static_lying_triceps_extension",31:"suspended_dip",32:"weighted_suspended_dip",33:"swiss_ball_dumbbell_lying_triceps_extension",34:"swiss_ball_ez_bar_lying_triceps_extension",35:"swiss_ball_ez_bar_overhead_triceps_extension",36:"tabletop_dip",37:"weighted_tabletop_dip",38:"triceps_extension_on_floor",39:"triceps_pressdown",40:"weighted_dip"},warm_up_exercise_name:{0:"quadruped_rocking",1:"neck_tilts",2:"ankle_circles",3:"ankle_dorsiflexion_with_band",4:"ankle_internal_rotation",5:"arm_circles",6:"bent_over_reach_to_sky",7:"cat_camel",8:"elbow_to_foot_lunge",9:"forward_and_backward_leg_swings",10:"groiners",11:"inverted_hamstring_stretch",12:"lateral_duck_under",13:"neck_rotations",14:"opposite_arm_and_leg_balance",15:"reach_roll_and_lift",16:"scorpion",17:"shoulder_circles",18:"side_to_side_leg_swings",19:"sleeper_stretch",20:"slide_out",21:"swiss_ball_hip_crossover",22:"swiss_ball_reach_roll_and_lift",23:"swiss_ball_windshield_wipers",24:"thoracic_rotation",25:"walking_high_kicks",26:"walking_high_knees",27:"walking_knee_hugs",28:"walking_leg_cradles",29:"walkout",30:"walkout_from_push_up_position"},run_exercise_name:{0:"run",1:"walk",2:"jog",3:"sprint"},water_type:{0:"fresh",1:"salt",2:"en13319",3:"custom"},tissue_model_type:{0:"zhl_16c"},dive_gas_status:{0:"disabled",1:"enabled",2:"backup_only"},dive_alarm_type:{0:"depth",1:"time"},dive_backlight_mode:{0:"at_depth",1:"always_on"},favero_product:{10:"assioma_uno",12:"assioma_duo"}}};function kg(s){var e=nh.messages[s];return e?e.name:""}function Eg(s,e){var t=nh.messages[e];if(!t)return"";var n=t[s];return n||{}}var wa={};Object.defineProperty(wa,"__esModule",{value:!0});wa.getFitMessage=Sg;wa.getFitMessageBaseType=Tg;var au=ji;function Sg(s){return{name:(0,au.getMessageName)(s),getAttributes:function(t){return(0,au.getFieldObject)(t,s)}}}function Tg(s){return s}var ih={};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(s){var e=Bs,t=va,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;s.Buffer=o,s.SlowBuffer=G,s.INSPECT_MAX_BYTES=50;var i=2147483647;s.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=r(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function r(){try{var S=new Uint8Array(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,Uint8Array.prototype),Object.setPrototypeOf(S,_),S.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function a(S){if(S>i)throw new RangeError('The value "'+S+'" is invalid for option "size"');var _=new Uint8Array(S);return Object.setPrototypeOf(_,o.prototype),_}function o(S,_,v){if(typeof S=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(S)}return l(S,_,v)}o.poolSize=8192;function l(S,_,v){if(typeof S=="string")return m(S,_);if(ArrayBuffer.isView(S))return E(S);if(S==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S);if(He(S,ArrayBuffer)||S&&He(S.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(He(S,SharedArrayBuffer)||S&&He(S.buffer,SharedArrayBuffer)))return C(S,_,v);if(typeof S=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var D=S.valueOf&&S.valueOf();if(D!=null&&D!==S)return o.from(D,_,v);var $=I(S);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof S[Symbol.toPrimitive]=="function")return o.from(S[Symbol.toPrimitive]("string"),_,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S)}o.from=function(S,_,v){return l(S,_,v)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function u(S){if(typeof S!="number")throw new TypeError('"size" argument must be of type number');if(S<0)throw new RangeError('The value "'+S+'" is invalid for option "size"')}function d(S,_,v){return u(S),S<=0?a(S):_!==void 0?typeof v=="string"?a(S).fill(_,v):a(S).fill(_):a(S)}o.alloc=function(S,_,v){return d(S,_,v)};function p(S){return u(S),a(S<0?0:B(S)|0)}o.allocUnsafe=function(S){return p(S)},o.allocUnsafeSlow=function(S){return p(S)};function m(S,_){if((typeof _!="string"||_==="")&&(_="utf8"),!o.isEncoding(_))throw new TypeError("Unknown encoding: "+_);var v=Y(S,_)|0,D=a(v),$=D.write(S,_);return $!==v&&(D=D.slice(0,$)),D}function w(S){for(var _=S.length<0?0:B(S.length)|0,v=a(_),D=0;D<_;D+=1)v[D]=S[D]&255;return v}function E(S){if(He(S,Uint8Array)){var _=new Uint8Array(S);return C(_.buffer,_.byteOffset,_.byteLength)}return w(S)}function C(S,_,v){if(_<0||S.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(S.byteLength<_+(v||0))throw new RangeError('"length" is outside of buffer bounds');var D;return _===void 0&&v===void 0?D=new Uint8Array(S):v===void 0?D=new Uint8Array(S,_):D=new Uint8Array(S,_,v),Object.setPrototypeOf(D,o.prototype),D}function I(S){if(o.isBuffer(S)){var _=B(S.length)|0,v=a(_);return v.length===0||S.copy(v,0,0,_),v}if(S.length!==void 0)return typeof S.length!="number"||Dt(S.length)?a(0):w(S);if(S.type==="Buffer"&&Array.isArray(S.data))return w(S.data)}function B(S){if(S>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return S|0}function G(S){return+S!=S&&(S=0),o.alloc(+S)}o.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==o.prototype},o.compare=function(_,v){if(He(_,Uint8Array)&&(_=o.from(_,_.offset,_.byteLength)),He(v,Uint8Array)&&(v=o.from(v,v.offset,v.byteLength)),!o.isBuffer(_)||!o.isBuffer(v))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===v)return 0;for(var D=_.length,$=v.length,q=0,j=Math.min(D,$);q<j;++q)if(_[q]!==v[q]){D=_[q],$=v[q];break}return D<$?-1:$<D?1:0},o.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(_,v){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return o.alloc(0);var D;if(v===void 0)for(v=0,D=0;D<_.length;++D)v+=_[D].length;var $=o.allocUnsafe(v),q=0;for(D=0;D<_.length;++D){var j=_[D];if(He(j,Uint8Array))q+j.length>$.length?o.from(j).copy($,q):Uint8Array.prototype.set.call($,j,q);else if(o.isBuffer(j))j.copy($,q);else throw new TypeError('"list" argument must be an Array of Buffers');q+=j.length}return $};function Y(S,_){if(o.isBuffer(S))return S.length;if(ArrayBuffer.isView(S)||He(S,ArrayBuffer))return S.byteLength;if(typeof S!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof S);var v=S.length,D=arguments.length>2&&arguments[2]===!0;if(!D&&v===0)return 0;for(var $=!1;;)switch(_){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return Xe(S).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return ue(S).length;default:if($)return D?-1:Xe(S).length;_=(""+_).toLowerCase(),$=!0}}o.byteLength=Y;function K(S,_,v){var D=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,_>>>=0,v<=_))return"";for(S||(S="utf8");;)switch(S){case"hex":return Se(this,_,v);case"utf8":case"utf-8":return ze(this,_,v);case"ascii":return ut(this,_,v);case"latin1":case"binary":return vt(this,_,v);case"base64":return x(this,_,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return dt(this,_,v);default:if(D)throw new TypeError("Unknown encoding: "+S);S=(S+"").toLowerCase(),D=!0}}o.prototype._isBuffer=!0;function ee(S,_,v){var D=S[_];S[_]=S[v],S[v]=D}o.prototype.swap16=function(){var _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var v=0;v<_;v+=2)ee(this,v,v+1);return this},o.prototype.swap32=function(){var _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var v=0;v<_;v+=4)ee(this,v,v+3),ee(this,v+1,v+2);return this},o.prototype.swap64=function(){var _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var v=0;v<_;v+=8)ee(this,v,v+7),ee(this,v+1,v+6),ee(this,v+2,v+5),ee(this,v+3,v+4);return this},o.prototype.toString=function(){var _=this.length;return _===0?"":arguments.length===0?ze(this,0,_):K.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(_){if(!o.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:o.compare(this,_)===0},o.prototype.inspect=function(){var _="",v=s.INSPECT_MAX_BYTES;return _=this.toString("hex",0,v).replace(/(.{2})/g,"$1 ").trim(),this.length>v&&(_+=" ... "),"<Buffer "+_+">"},n&&(o.prototype[n]=o.prototype.inspect),o.prototype.compare=function(_,v,D,$,q){if(He(_,Uint8Array)&&(_=o.from(_,_.offset,_.byteLength)),!o.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(v===void 0&&(v=0),D===void 0&&(D=_?_.length:0),$===void 0&&($=0),q===void 0&&(q=this.length),v<0||D>_.length||$<0||q>this.length)throw new RangeError("out of range index");if($>=q&&v>=D)return 0;if($>=q)return-1;if(v>=D)return 1;if(v>>>=0,D>>>=0,$>>>=0,q>>>=0,this===_)return 0;for(var j=q-$,de=D-v,be=Math.min(j,de),fe=this.slice($,q),ye=_.slice(v,D),b=0;b<be;++b)if(fe[b]!==ye[b]){j=fe[b],de=ye[b];break}return j<de?-1:de<j?1:0};function ae(S,_,v,D,$){if(S.length===0)return-1;if(typeof v=="string"?(D=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,Dt(v)&&(v=$?0:S.length-1),v<0&&(v=S.length+v),v>=S.length){if($)return-1;v=S.length-1}else if(v<0)if($)v=0;else return-1;if(typeof _=="string"&&(_=o.from(_,D)),o.isBuffer(_))return _.length===0?-1:M(S,_,v,D,$);if(typeof _=="number")return _=_&255,typeof Uint8Array.prototype.indexOf=="function"?$?Uint8Array.prototype.indexOf.call(S,_,v):Uint8Array.prototype.lastIndexOf.call(S,_,v):M(S,[_],v,D,$);throw new TypeError("val must be string, number or Buffer")}function M(S,_,v,D,$){var q=1,j=S.length,de=_.length;if(D!==void 0&&(D=String(D).toLowerCase(),D==="ucs2"||D==="ucs-2"||D==="utf16le"||D==="utf-16le")){if(S.length<2||_.length<2)return-1;q=2,j/=2,de/=2,v/=2}function be(g,T){return q===1?g[T]:g.readUInt16BE(T*q)}var fe;if($){var ye=-1;for(fe=v;fe<j;fe++)if(be(S,fe)===be(_,ye===-1?0:fe-ye)){if(ye===-1&&(ye=fe),fe-ye+1===de)return ye*q}else ye!==-1&&(fe-=fe-ye),ye=-1}else for(v+de>j&&(v=j-de),fe=v;fe>=0;fe--){for(var b=!0,f=0;f<de;f++)if(be(S,fe+f)!==be(_,f)){b=!1;break}if(b)return fe}return-1}o.prototype.includes=function(_,v,D){return this.indexOf(_,v,D)!==-1},o.prototype.indexOf=function(_,v,D){return ae(this,_,v,D,!0)},o.prototype.lastIndexOf=function(_,v,D){return ae(this,_,v,D,!1)};function A(S,_,v,D){v=Number(v)||0;var $=S.length-v;D?(D=Number(D),D>$&&(D=$)):D=$;var q=_.length;D>q/2&&(D=q/2);for(var j=0;j<D;++j){var de=parseInt(_.substr(j*2,2),16);if(Dt(de))return j;S[v+j]=de}return j}function R(S,_,v,D){return At(Xe(_,S.length-v),S,v,D)}function P(S,_,v,D){return At(Vt(_),S,v,D)}function F(S,_,v,D){return At(ue(_),S,v,D)}function N(S,_,v,D){return At(bt(_,S.length-v),S,v,D)}o.prototype.write=function(_,v,D,$){if(v===void 0)$="utf8",D=this.length,v=0;else if(D===void 0&&typeof v=="string")$=v,D=this.length,v=0;else if(isFinite(v))v=v>>>0,isFinite(D)?(D=D>>>0,$===void 0&&($="utf8")):($=D,D=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var q=this.length-v;if((D===void 0||D>q)&&(D=q),_.length>0&&(D<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");$||($="utf8");for(var j=!1;;)switch($){case"hex":return A(this,_,v,D);case"utf8":case"utf-8":return R(this,_,v,D);case"ascii":case"latin1":case"binary":return P(this,_,v,D);case"base64":return F(this,_,v,D);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,_,v,D);default:if(j)throw new TypeError("Unknown encoding: "+$);$=(""+$).toLowerCase(),j=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function x(S,_,v){return _===0&&v===S.length?e.fromByteArray(S):e.fromByteArray(S.slice(_,v))}function ze(S,_,v){v=Math.min(S.length,v);for(var D=[],$=_;$<v;){var q=S[$],j=null,de=q>239?4:q>223?3:q>191?2:1;if($+de<=v){var be,fe,ye,b;switch(de){case 1:q<128&&(j=q);break;case 2:be=S[$+1],(be&192)===128&&(b=(q&31)<<6|be&63,b>127&&(j=b));break;case 3:be=S[$+1],fe=S[$+2],(be&192)===128&&(fe&192)===128&&(b=(q&15)<<12|(be&63)<<6|fe&63,b>2047&&(b<55296||b>57343)&&(j=b));break;case 4:be=S[$+1],fe=S[$+2],ye=S[$+3],(be&192)===128&&(fe&192)===128&&(ye&192)===128&&(b=(q&15)<<18|(be&63)<<12|(fe&63)<<6|ye&63,b>65535&&b<1114112&&(j=b))}}j===null?(j=65533,de=1):j>65535&&(j-=65536,D.push(j>>>10&1023|55296),j=56320|j&1023),D.push(j),$+=de}return Pt(D)}var ct=4096;function Pt(S){var _=S.length;if(_<=ct)return String.fromCharCode.apply(String,S);for(var v="",D=0;D<_;)v+=String.fromCharCode.apply(String,S.slice(D,D+=ct));return v}function ut(S,_,v){var D="";v=Math.min(S.length,v);for(var $=_;$<v;++$)D+=String.fromCharCode(S[$]&127);return D}function vt(S,_,v){var D="";v=Math.min(S.length,v);for(var $=_;$<v;++$)D+=String.fromCharCode(S[$]);return D}function Se(S,_,v){var D=S.length;(!_||_<0)&&(_=0),(!v||v<0||v>D)&&(v=D);for(var $="",q=_;q<v;++q)$+=Zn[S[q]];return $}function dt(S,_,v){for(var D=S.slice(_,v),$="",q=0;q<D.length-1;q+=2)$+=String.fromCharCode(D[q]+D[q+1]*256);return $}o.prototype.slice=function(_,v){var D=this.length;_=~~_,v=v===void 0?D:~~v,_<0?(_+=D,_<0&&(_=0)):_>D&&(_=D),v<0?(v+=D,v<0&&(v=0)):v>D&&(v=D),v<_&&(v=_);var $=this.subarray(_,v);return Object.setPrototypeOf($,o.prototype),$};function oe(S,_,v){if(S%1!==0||S<0)throw new RangeError("offset is not uint");if(S+_>v)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(_,v,D){_=_>>>0,v=v>>>0,D||oe(_,v,this.length);for(var $=this[_],q=1,j=0;++j<v&&(q*=256);)$+=this[_+j]*q;return $},o.prototype.readUintBE=o.prototype.readUIntBE=function(_,v,D){_=_>>>0,v=v>>>0,D||oe(_,v,this.length);for(var $=this[_+--v],q=1;v>0&&(q*=256);)$+=this[_+--v]*q;return $},o.prototype.readUint8=o.prototype.readUInt8=function(_,v){return _=_>>>0,v||oe(_,1,this.length),this[_]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(_,v){return _=_>>>0,v||oe(_,2,this.length),this[_]|this[_+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(_,v){return _=_>>>0,v||oe(_,2,this.length),this[_]<<8|this[_+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(_,v){return _=_>>>0,v||oe(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(_,v){return _=_>>>0,v||oe(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},o.prototype.readIntLE=function(_,v,D){_=_>>>0,v=v>>>0,D||oe(_,v,this.length);for(var $=this[_],q=1,j=0;++j<v&&(q*=256);)$+=this[_+j]*q;return q*=128,$>=q&&($-=Math.pow(2,8*v)),$},o.prototype.readIntBE=function(_,v,D){_=_>>>0,v=v>>>0,D||oe(_,v,this.length);for(var $=v,q=1,j=this[_+--$];$>0&&(q*=256);)j+=this[_+--$]*q;return q*=128,j>=q&&(j-=Math.pow(2,8*v)),j},o.prototype.readInt8=function(_,v){return _=_>>>0,v||oe(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},o.prototype.readInt16LE=function(_,v){_=_>>>0,v||oe(_,2,this.length);var D=this[_]|this[_+1]<<8;return D&32768?D|4294901760:D},o.prototype.readInt16BE=function(_,v){_=_>>>0,v||oe(_,2,this.length);var D=this[_+1]|this[_]<<8;return D&32768?D|4294901760:D},o.prototype.readInt32LE=function(_,v){return _=_>>>0,v||oe(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},o.prototype.readInt32BE=function(_,v){return _=_>>>0,v||oe(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},o.prototype.readFloatLE=function(_,v){return _=_>>>0,v||oe(_,4,this.length),t.read(this,_,!0,23,4)},o.prototype.readFloatBE=function(_,v){return _=_>>>0,v||oe(_,4,this.length),t.read(this,_,!1,23,4)},o.prototype.readDoubleLE=function(_,v){return _=_>>>0,v||oe(_,8,this.length),t.read(this,_,!0,52,8)},o.prototype.readDoubleBE=function(_,v){return _=_>>>0,v||oe(_,8,this.length),t.read(this,_,!1,52,8)};function ie(S,_,v,D,$,q){if(!o.isBuffer(S))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>$||_<q)throw new RangeError('"value" argument is out of bounds');if(v+D>S.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(_,v,D,$){if(_=+_,v=v>>>0,D=D>>>0,!$){var q=Math.pow(2,8*D)-1;ie(this,_,v,D,q,0)}var j=1,de=0;for(this[v]=_&255;++de<D&&(j*=256);)this[v+de]=_/j&255;return v+D},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(_,v,D,$){if(_=+_,v=v>>>0,D=D>>>0,!$){var q=Math.pow(2,8*D)-1;ie(this,_,v,D,q,0)}var j=D-1,de=1;for(this[v+j]=_&255;--j>=0&&(de*=256);)this[v+j]=_/de&255;return v+D},o.prototype.writeUint8=o.prototype.writeUInt8=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,1,255,0),this[v]=_&255,v+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,2,65535,0),this[v]=_&255,this[v+1]=_>>>8,v+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,2,65535,0),this[v]=_>>>8,this[v+1]=_&255,v+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,4,4294967295,0),this[v+3]=_>>>24,this[v+2]=_>>>16,this[v+1]=_>>>8,this[v]=_&255,v+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,4,4294967295,0),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4},o.prototype.writeIntLE=function(_,v,D,$){if(_=+_,v=v>>>0,!$){var q=Math.pow(2,8*D-1);ie(this,_,v,D,q-1,-q)}var j=0,de=1,be=0;for(this[v]=_&255;++j<D&&(de*=256);)_<0&&be===0&&this[v+j-1]!==0&&(be=1),this[v+j]=(_/de>>0)-be&255;return v+D},o.prototype.writeIntBE=function(_,v,D,$){if(_=+_,v=v>>>0,!$){var q=Math.pow(2,8*D-1);ie(this,_,v,D,q-1,-q)}var j=D-1,de=1,be=0;for(this[v+j]=_&255;--j>=0&&(de*=256);)_<0&&be===0&&this[v+j+1]!==0&&(be=1),this[v+j]=(_/de>>0)-be&255;return v+D},o.prototype.writeInt8=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,1,127,-128),_<0&&(_=255+_+1),this[v]=_&255,v+1},o.prototype.writeInt16LE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,2,32767,-32768),this[v]=_&255,this[v+1]=_>>>8,v+2},o.prototype.writeInt16BE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,2,32767,-32768),this[v]=_>>>8,this[v+1]=_&255,v+2},o.prototype.writeInt32LE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,4,2147483647,-2147483648),this[v]=_&255,this[v+1]=_>>>8,this[v+2]=_>>>16,this[v+3]=_>>>24,v+4},o.prototype.writeInt32BE=function(_,v,D){return _=+_,v=v>>>0,D||ie(this,_,v,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4};function De(S,_,v,D,$,q){if(v+D>S.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function Ot(S,_,v,D,$){return _=+_,v=v>>>0,$||De(S,_,v,4),t.write(S,_,v,D,23,4),v+4}o.prototype.writeFloatLE=function(_,v,D){return Ot(this,_,v,!0,D)},o.prototype.writeFloatBE=function(_,v,D){return Ot(this,_,v,!1,D)};function tt(S,_,v,D,$){return _=+_,v=v>>>0,$||De(S,_,v,8),t.write(S,_,v,D,52,8),v+8}o.prototype.writeDoubleLE=function(_,v,D){return tt(this,_,v,!0,D)},o.prototype.writeDoubleBE=function(_,v,D){return tt(this,_,v,!1,D)},o.prototype.copy=function(_,v,D,$){if(!o.isBuffer(_))throw new TypeError("argument should be a Buffer");if(D||(D=0),!$&&$!==0&&($=this.length),v>=_.length&&(v=_.length),v||(v=0),$>0&&$<D&&($=D),$===D||_.length===0||this.length===0)return 0;if(v<0)throw new RangeError("targetStart out of bounds");if(D<0||D>=this.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("sourceEnd out of bounds");$>this.length&&($=this.length),_.length-v<$-D&&($=_.length-v+D);var q=$-D;return this===_&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(v,D,$):Uint8Array.prototype.set.call(_,this.subarray(D,$),v),q},o.prototype.fill=function(_,v,D,$){if(typeof _=="string"){if(typeof v=="string"?($=v,v=0,D=this.length):typeof D=="string"&&($=D,D=this.length),$!==void 0&&typeof $!="string")throw new TypeError("encoding must be a string");if(typeof $=="string"&&!o.isEncoding($))throw new TypeError("Unknown encoding: "+$);if(_.length===1){var q=_.charCodeAt(0);($==="utf8"&&q<128||$==="latin1")&&(_=q)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(v<0||this.length<v||this.length<D)throw new RangeError("Out of range index");if(D<=v)return this;v=v>>>0,D=D===void 0?this.length:D>>>0,_||(_=0);var j;if(typeof _=="number")for(j=v;j<D;++j)this[j]=_;else{var de=o.isBuffer(_)?_:o.from(_,$),be=de.length;if(be===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(j=0;j<D-v;++j)this[j+v]=de[j%be]}return this};var wt=/[^+/0-9A-Za-z-_]/g;function Ze(S){if(S=S.split("=")[0],S=S.trim().replace(wt,""),S.length<2)return"";for(;S.length%4!==0;)S=S+"=";return S}function Xe(S,_){_=_||1/0;for(var v,D=S.length,$=null,q=[],j=0;j<D;++j){if(v=S.charCodeAt(j),v>55295&&v<57344){if(!$){if(v>56319){(_-=3)>-1&&q.push(239,191,189);continue}else if(j+1===D){(_-=3)>-1&&q.push(239,191,189);continue}$=v;continue}if(v<56320){(_-=3)>-1&&q.push(239,191,189),$=v;continue}v=($-55296<<10|v-56320)+65536}else $&&(_-=3)>-1&&q.push(239,191,189);if($=null,v<128){if((_-=1)<0)break;q.push(v)}else if(v<2048){if((_-=2)<0)break;q.push(v>>6|192,v&63|128)}else if(v<65536){if((_-=3)<0)break;q.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((_-=4)<0)break;q.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return q}function Vt(S){for(var _=[],v=0;v<S.length;++v)_.push(S.charCodeAt(v)&255);return _}function bt(S,_){for(var v,D,$,q=[],j=0;j<S.length&&!((_-=2)<0);++j)v=S.charCodeAt(j),D=v>>8,$=v%256,q.push($),q.push(D);return q}function ue(S){return e.toByteArray(Ze(S))}function At(S,_,v,D){for(var $=0;$<D&&!($+v>=_.length||$>=S.length);++$)_[$+v]=S[$];return $}function He(S,_){return S instanceof _||S!=null&&S.constructor!=null&&S.constructor.name!=null&&S.constructor.name===_.name}function Dt(S){return S!==S}var Zn=function(){for(var S="0123456789abcdef",_=new Array(256),v=0;v<16;++v)for(var D=v*16,$=0;$<16;++$)_[D+$]=S[v]+S[$];return _}()})(ih);Object.defineProperty(qi,"__esModule",{value:!0});qi.addEndian=rl;qi.readRecord=Cg;qi.getArrayBuffer=xg;qi.calculateCRC=Pg;var Lt=ji,vr=wa,Ig=ih;function rl(s,e){var t=0;s||e.reverse();for(var n=0;n<e.length;n++)t+=e[n]<<(n<<3)>>>0;return t}var Ag=96,ou=128,Ro=6310656e5,wr=0;function Dg(s,e,t,n){if(e.endianAbility===!0){for(var i=[],r=0;r<e.size;r++)i.push(s[t+r]);var a=new Uint8Array(i).buffer,o=new DataView(a);try{switch(e.type){case"sint16":return o.getInt16(0,e.littleEndian);case"uint16":case"uint16z":return o.getUint16(0,e.littleEndian);case"sint32":return o.getInt32(0,e.littleEndian);case"uint32":case"uint32z":return o.getUint32(0,e.littleEndian);case"float32":return o.getFloat32(0,e.littleEndian);case"float64":return o.getFloat64(0,e.littleEndian);case"uint32_array":for(var l=[],u=0;u<e.size;u+=4)l.push(o.getUint32(u,e.littleEndian));return l;case"uint16_array":for(var d=[],p=0;p<e.size;p+=2)d.push(o.getUint16(p,e.littleEndian));return d}}catch(I){if(!n.force)throw I}return rl(e.littleEndian,i)}if(e.type==="string"){for(var m=[],w=0;w<e.size;w++)s[t+w]&&m.push(s[t+w]);return new Ig.Buffer.from(m).toString("utf-8")}if(e.type==="byte_array"){for(var E=[],C=0;C<e.size;C++)E.push(s[t+C]);return E}return s[t]}function lu(s,e,t,n){switch(e){case"date_time":case"local_date_time":return new Date(s*1e3+Ro);case"sint32":return s*Lt.FIT.scConst;case"uint8":case"sint16":case"uint32":case"uint16":return t?s/t+n:s;case"uint32_array":case"uint16_array":return s.map(function(o){return t?o/t+n:o});default:if(!Lt.FIT.types[e])return s;var i=[];for(var r in Lt.FIT.types[e])Lt.FIT.types[e].hasOwnProperty(r)&&i.push(Lt.FIT.types[e][r]);if(i.indexOf("mask")===-1)return Lt.FIT.types[e][s];var a={};for(var r in Lt.FIT.types[e])Lt.FIT.types[e].hasOwnProperty(r)&&(Lt.FIT.types[e][r]==="mask"?a.value=s&r:a[Lt.FIT.types[e][r]]=!!((s&r)>>7));return a}}function Rg(s,e){switch(e){case"enum":return s===255;case"sint8":return s===127;case"uint8":return s===255;case"sint16":return s===32767;case"uint16":return s===65535;case"sint32":return s===2147483647;case"uint32":return s===4294967295;case"string":return s===0;case"float32":return s===4294967295;case"float64":return s===18446744073709552e3;case"uint8z":return s===0;case"uint16z":return s===0;case"uint32z":return s===0;case"byte":return s===255;case"sint64":return s===9223372036854776e3;case"uint64":return s===18446744073709552e3;case"uint64z":return s===0;default:return!1}}function br(s,e,t){var n=Lt.FIT.options[e][t];return n?s*n.multiplier+n.offset:s}function cu(s,e,t){switch(e){case"speed":case"enhanced_speed":case"vertical_speed":case"avg_speed":case"max_speed":case"speed_1s":case"ball_speed":case"enhanced_avg_speed":case"enhanced_max_speed":case"avg_pos_vertical_speed":case"max_pos_vertical_speed":case"avg_neg_vertical_speed":case"max_neg_vertical_speed":return br(s,"speedUnits",t.speedUnit);case"distance":case"total_distance":case"enhanced_avg_altitude":case"enhanced_min_altitude":case"enhanced_max_altitude":case"enhanced_altitude":case"height":case"odometer":case"avg_stroke_distance":case"min_altitude":case"avg_altitude":case"max_altitude":case"total_ascent":case"total_descent":case"altitude":case"cycle_length":case"auto_wheelsize":case"custom_wheelsize":case"gps_accuracy":return br(s,"lengthUnits",t.lengthUnit);case"temperature":case"avg_temperature":case"max_temperature":return br(s,"temperatureUnits",t.temperatureUnit);case"pressure":case"start_pressure":case"end_pressure":return br(s,"pressureUnits",t.pressureUnit);default:return s}}function Cg(s,e,t,n,i,r,a){var o=s[n],l=o&15;if((o&ou)===ou)l=(o&Ag)>>5;else if((o&64)===64){for(var u=(o&32)===32,d=s[n+2]===0,p=s[n+5],m=u?s[n+5+p*3+1]:0,w={littleEndian:d,globalMessageNumber:rl(d,[s[n+3],s[n+4]]),numberOfFields:p+m,fieldDefs:[]},E=(0,vr.getFitMessage)(w.globalMessageNumber),C=0;C<p;C++){var I=n+6+C*3,B=s[I+2],G=E.getAttributes(s[I]),Y=G.field,K=G.type,ee={type:K,fDefNo:s[I],size:s[I+1],endianAbility:(B&128)===128,littleEndian:d,baseTypeNo:B&15,name:Y,dataType:(0,vr.getFitMessageBaseType)(B&15)};w.fieldDefs.push(ee)}for(var ae=0;ae<m;ae++)try{var M=n+6+p*3+1+ae*3,A=s[M],R=s[M+1],P=s[M+2],F=t[P][A],N=F.fit_base_type_id,x={type:Lt.FIT.types.fit_base_type[N],fDefNo:A,size:R,endianAbility:(N&128)===128,littleEndian:d,baseTypeNo:N&15,name:F.field_name,dataType:(0,vr.getFitMessageBaseType)(N&15),scale:F.scale||1,offset:F.offset||0,developerDataIndex:P,isDeveloperField:!0};w.fieldDefs.push(x)}catch(At){if(i.force)continue;throw At}e[l]=w;var ze=n+6+w.numberOfFields*3,ct=ze+1;return{messageType:"definition",nextIndex:u?ct:ze}}for(var Pt=e[l]||e[0],ut=0,vt=n+1,Se={},dt=(0,vr.getFitMessage)(Pt.globalMessageNumber),oe=0;oe<Pt.fieldDefs.length;oe++){var ie=Pt.fieldDefs[oe],De=Dg(s,ie,vt,i);if(!Rg(De,ie.type)){if(ie.isDeveloperField){var Y=ie.name,K=ie.type,Ot=ie.scale,tt=ie.offset;Se[ie.name]=cu(lu(De,K,Ot,tt),Y,i)}else{var wt=dt.getAttributes(ie.fDefNo),Ze=wt.field,Xe=wt.type,Vt=wt.scale,bt=wt.offset;Ze!=="unknown"&&Ze!==""&&Ze!==void 0&&(Se[Ze]=cu(lu(De,Xe,Vt,bt),Ze,i))}dt.name==="record"&&i.elapsedRecordField&&(Se.elapsed_time=(Se.timestamp-r)/1e3,Se.timer_time=Se.elapsed_time-a)}vt+=ie.size,ut+=ie.size}dt.name==="field_description"&&(t[Se.developer_data_index]=t[Se.developer_data_index]||[],t[Se.developer_data_index][Se.field_definition_number]=Se),dt.name==="monitoring"&&(Se.timestamp&&(wr=Se.timestamp,Se.timestamp=new Date(Se.timestamp*1e3+Ro)),Se.timestamp16&&!Se.timestamp&&(wr+=Se.timestamp16-(wr&65535)&65535,Se.timestamp=new Date(wr*1e3+Ro)));var ue={messageType:dt.name,nextIndex:n+ut+1,message:Se};return ue}function xg(s){if(s instanceof ArrayBuffer)return s;for(var e=new ArrayBuffer(s.length),t=new Uint8Array(e),n=0;n<s.length;++n)t[n]=s[n];return e}function Pg(s,e,t){for(var n=[0,52225,55297,5120,61441,15360,10240,58369,40961,27648,30720,46081,20480,39937,34817,17408],i=0,r=e;r<t;r++){var a=s[r],o=n[i&15];i=i>>4&4095,i=i^o^n[a&15],o=n[i&15],i=i>>4&4095,i=i^o^n[a>>4&15]}return i}var ba={};Object.defineProperty(ba,"__esModule",{value:!0});function sh(s){if(Array.isArray(s)){for(var e=0,t=Array(s.length);e<s.length;e++)t[e]=s[e];return t}else return Array.from(s)}ba.mapDataIntoLap=function(e,t,n){for(var i=[].concat(sh(e)),r=0,a=0;a<i.length;a++){for(var o=i[a],l=i[a+1],u=[],d=new Date(o.start_time).getTime(),p=l?new Date(l.start_time).getTime():null,m=r;m<n.length;m++){var w=n[m];if(l){var E=new Date(w.timestamp).getTime();if(d<=E&&p>E)u.push(w);else if(p<=E){r=m;break}}else u.push(w)}i[a][t]||(i[a][t]=u)}return i};ba.mapDataIntoSession=function(e,t){for(var n=[].concat(sh(e)),i=0,r=0;r<n.length;r++){for(var a=n[r],o=n[r+1],l=[],u=new Date(a.start_time).getTime(),d=o?new Date(o.start_time).getTime():null,p=i;p<t.length;p++){var m=t[p];if(o){var w=new Date(m.start_time).getTime();if(u<=w&&d>w)l.push(m);else if(d<=w){i=p;break}}else l.push(m)}n[r].laps||(n[r].laps=l)}return n};Object.defineProperty(th,"__esModule",{value:!0});var Mg=function(){function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}(),kr=qi,oo=ba;function Lg(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}var Fg=function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Lg(this,s),this.options={force:e.force!=null?e.force:!0,speedUnit:e.speedUnit||"m/s",lengthUnit:e.lengthUnit||"m",temperatureUnit:e.temperatureUnit||"celsius",elapsedRecordField:e.elapsedRecordField||!1,pressureUnit:e.pressureUnit||"bar",mode:e.mode||"list"}}return Mg(s,[{key:"parse",value:function(t,n){var i=new Uint8Array((0,kr.getArrayBuffer)(t));if(!(i.length<12&&(n("File to small to be a FIT file",{}),!this.options.force))){var r=i[0];if(!(r!==14&&r!==12&&(n("Incorrect header size",{}),!this.options.force))){for(var a="",o=8;o<12;o++)a+=String.fromCharCode(i[o]);if(!(a!==".FIT"&&(n("Missing '.FIT' in header",{}),!this.options.force))){if(r===14){var l=i[12]+(i[13]<<8),u=(0,kr.calculateCRC)(i,0,12);if(l!==u&&!this.options.force)return}var d=i[1],p=i[2]+(i[3]<<8),m=i[4]+(i[5]<<8)+(i[6]<<16)+(i[7]<<24),w=m+r,E=i[w]+(i[w+1]<<8),C=(0,kr.calculateCRC)(i,r===12?0:r,w);if(!(E!==C&&!this.options.force)){var I={};I.protocolVersion=d,I.profileVersion=p;for(var B=[],G=[],Y=[],K=[],ee=[],ae=[],M=[],A=[],R=[],P=[],F=[],N=[],x=[],ze=[],ct=[],Pt=[],ut=[],vt=[],Se=[],dt=r,oe=[],ie=[],De=this.options.mode==="cascade",Ot=De||this.options.mode==="both",tt=void 0,wt=void 0,Ze=0;dt<w;){var Xe=(0,kr.readRecord)(i,oe,ie,dt,this.options,tt,Ze),Vt=Xe.nextIndex,bt=Xe.messageType,ue=Xe.message;switch(dt=Vt,bt){case"lap":G.push(ue);break;case"session":B.push(ue);break;case"event":ue.event==="timer"&&(ue.event_type==="stop_all"?wt=ue.timestamp:ue.event_type==="start"&&wt&&(Ze+=(ue.timestamp-wt)/1e3)),K.push(ue);break;case"length":ut.push(ue);break;case"hrv":ee.push(ue);break;case"record":tt||(tt=ue.timestamp,ue.elapsed_time=0,ue.timer_time=0),Y.push(ue);break;case"field_description":A.push(ue);break;case"device_info":ae.push(ue);break;case"developer_data_id":M.push(ue);break;case"dive_gas":R.push(ue);break;case"course_point":P.push(ue);break;case"sport":F.push(ue);break;case"file_id":ue&&ct.push(ue);break;case"definition":ue&&ze.push(ue);break;case"monitoring":N.push(ue);break;case"monitoring_info":Pt.push(ue);break;case"stress_level":x.push(ue);break;case"software":I.software=ue;break;case"tank_update":vt.push(ue);break;case"tank_summary":Se.push(ue);break;default:bt!==""&&(I[bt]=ue);break}}Ot&&(I.activity=I.activity||{},G=(0,oo.mapDataIntoLap)(G,"records",Y),G=(0,oo.mapDataIntoLap)(G,"lengths",ut),B=(0,oo.mapDataIntoSession)(B,G),I.activity.sessions=B,I.activity.events=K,I.activity.hrv=ee,I.activity.device_infos=ae,I.activity.developer_data_ids=M,I.activity.field_descriptions=A,I.activity.sports=F),De||(I.sessions=B,I.laps=G,I.lengths=ut,I.records=Y,I.events=K,I.device_infos=ae,I.developer_data_ids=M,I.field_descriptions=A,I.hrv=ee,I.dive_gases=R,I.course_points=P,I.sports=F,I.devices=ae,I.monitors=N,I.stress=x,I.file_ids=ct,I.monitor_info=Pt,I.definitions=ze,I.tank_updates=vt,I.tank_summaries=Se),n(null,I)}}}}}}]),s}(),Ng=th.default=Fg;class $g{constructor(e={}){this.options={speedUnit:"km/h",lengthUnit:"km",temperatureUnit:"celsius",mode:"both",elapsedRecordField:!0,force:!0,...e},this.parser=new Ng(this.options)}parse(e){return new Promise((t,n)=>{try{const i=il.Buffer.from(e);this.parser.parse(i,(r,a)=>{if(r){n(new Error(`FIT parsing failed: ${r.message}`));return}if(!a){n(new Error("No data returned from FIT parser"));return}const o=this.transformToLegacyFormat(a);t(o)})}catch(i){n(new Error(`FIT parsing error: ${i.message}`))}})}transformToLegacyFormat(e){const t={...e,deviceInfos:e.device_infos||[],rawMessages:this.extractRawMessages(e),header:this.createLegacyHeader(e)};return t.records=this.extractRecords(e),t.sessions=this.extractSessions(e),t.laps=this.extractLaps(e),t.events=e.events||[],t}extractRecords(e){var n;const t=[];return e.records&&Array.isArray(e.records)&&t.push(...e.records),(n=e.activity)!=null&&n.sessions&&e.activity.sessions.forEach(i=>{i.laps&&i.laps.forEach(r=>{r.records&&t.push(...r.records)})}),t}extractSessions(e){var t;return e.sessions||((t=e.activity)==null?void 0:t.sessions)||[]}extractLaps(e){var n;const t=[];return e.laps&&Array.isArray(e.laps)&&t.push(...e.laps),(n=e.activity)!=null&&n.sessions&&e.activity.sessions.forEach(i=>{i.laps&&t.push(...i.laps)}),t}extractRawMessages(e){const t=[];return e.records&&t.push(...e.records.map((n,i)=>({...n,messageIndex:i,messageType:"record"}))),e.sessions&&t.push(...e.sessions.map((n,i)=>({...n,messageIndex:i,messageType:"session"}))),e.laps&&t.push(...e.laps.map((n,i)=>({...n,messageIndex:i,messageType:"lap"}))),e.events&&t.push(...e.events.map((n,i)=>({...n,messageIndex:i,messageType:"event"}))),t}createLegacyHeader(e){return{headerSize:14,protocolVersion:2,profileVersion:21,dataSize:0,dataType:".FIT"}}getParserOptions(){return{...this.options}}}const rh={restingHR:59,maxHR:190,hrZones:[{zone:1,name:"Recovery",minPercent:50,maxPercent:60,color:"#4CAF50",description:"Active recovery and warm-up"},{zone:2,name:"Aerobic Base",minPercent:60,maxPercent:70,color:"#8BC34A",description:"Aerobic base building"},{zone:3,name:"Aerobic",minPercent:70,maxPercent:80,color:"#FFC107",description:"Aerobic development"},{zone:4,name:"Threshold",minPercent:80,maxPercent:90,color:"#FF9800",description:"Lactate threshold"},{zone:5,name:"Neuromuscular",minPercent:90,maxPercent:100,color:"#F44336",description:"Neuromuscular power"}],paceSports:["running","run","trail_running","track_running"],speedSports:["cycling","bike","road_cycling","mountain_biking","swimming"]};class Og{constructor(e=rh){this.config=e}getHRZone(e){const t=e/this.config.maxHR*100;for(const n of this.config.hrZones)if(t>=n.minPercent&&t<=n.maxPercent)return n.zone;return t<this.config.hrZones[0].minPercent?1:5}getZoneThresholds(){const e={};return this.config.hrZones.forEach(t=>{e[t.zone]={min:Math.round(t.minPercent/100*this.config.maxHR),max:Math.round(t.maxPercent/100*this.config.maxHR)}}),e}calculateTRIMP(e,t){const n=(e-this.config.restingHR)/(this.config.maxHR-this.config.restingHR),r=t*n*Math.exp(1.92*n);return Math.round(r*10)/10}isPaceSport(e){return this.config.paceSports.some(t=>e.toLowerCase().includes(t.toLowerCase()))}isSpeedSport(e){return this.config.speedSports.some(t=>e.toLowerCase().includes(t.toLowerCase()))}}const Vg=864e5,ah=6e4,oh=36e5,uu=Symbol.for("constructDateFrom");function ka(s,e){return typeof s=="function"?s(e):s&&typeof s=="object"&&uu in s?s[uu](e):s instanceof Date?new s.constructor(e):new Date(e)}function Zt(s,e){return ka(e||s,s)}function Ug(s,e,t){const n=Zt(s,t==null?void 0:t.in);return isNaN(e)?ka(s,NaN):(e&&n.setDate(n.getDate()+e),n)}let Bg={};function lh(){return Bg}function lo(s,e){var o,l,u,d;const t=lh(),n=(e==null?void 0:e.weekStartsOn)??((l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)??t.weekStartsOn??((d=(u=t.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,i=Zt(s,e==null?void 0:e.in),r=i.getDay(),a=(r<n?7:0)+r-n;return i.setDate(i.getDate()-a),i.setHours(0,0,0,0),i}function du(s){const e=Zt(s),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+s-+t}function ch(s,...e){const t=ka.bind(null,e.find(n=>typeof n=="object"));return e.map(t)}function hu(s,e){const t=Zt(s,e==null?void 0:e.in);return t.setHours(0,0,0,0),t}function Wg(s,e,t){const[n,i]=ch(t==null?void 0:t.in,s,e),r=hu(n),a=hu(i),o=+r-du(r),l=+a-du(a);return Math.round((o-l)/Vg)}function fu(s,e,t){const[n,i]=ch(t==null?void 0:t.in,s,e),r=pu(n,i),a=Math.abs(Wg(n,i));n.setDate(n.getDate()-r*a);const o=+(pu(n,i)===-r),l=r*(a-o);return l===0?0:l}function pu(s,e){const t=s.getFullYear()-e.getFullYear()||s.getMonth()-e.getMonth()||s.getDate()-e.getDate()||s.getHours()-e.getHours()||s.getMinutes()-e.getMinutes()||s.getSeconds()-e.getSeconds()||s.getMilliseconds()-e.getMilliseconds();return t<0?-1:t>0?1:t}function co(s,e){var o,l,u,d;const t=lh(),n=(e==null?void 0:e.weekStartsOn)??((l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)??t.weekStartsOn??((d=(u=t.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,i=Zt(s,e==null?void 0:e.in),r=i.getDay(),a=(r<n?-7:0)+6-(r-n);return i.setDate(i.getDate()+a),i.setHours(23,59,59,999),i}function uo(s,e,t){const n=+Zt(s,t==null?void 0:t.in),[i,r]=[+Zt(e.start,t==null?void 0:t.in),+Zt(e.end,t==null?void 0:t.in)].sort((a,o)=>a-o);return n>=i&&n<=r}function pn(s,e,t){return Ug(s,-e,t)}function jt(s,e){const t=()=>ka(e==null?void 0:e.in,NaN),i=jg(s);let r;if(i.date){const u=Gg(i.date,2);r=Kg(u.restDateString,u.year)}if(!r||isNaN(+r))return t();const a=+r;let o=0,l;if(i.time&&(o=Qg(i.time),isNaN(o)))return t();if(i.timezone){if(l=Yg(i.timezone),isNaN(l))return t()}else{const u=new Date(a+o),d=Zt(0,e==null?void 0:e.in);return d.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),d.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),d}return Zt(a+o+l,e==null?void 0:e.in)}const Er={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},zg=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Hg=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,qg=/^([+-])(\d{2})(?::?(\d{2}))?$/;function jg(s){const e={},t=s.split(Er.dateTimeDelimiter);let n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],Er.timeZoneDelimiter.test(e.date)&&(e.date=s.split(Er.timeZoneDelimiter)[0],n=s.substr(e.date.length,s.length))),n){const i=Er.timezone.exec(n);i?(e.time=n.replace(i[1],""),e.timezone=i[1]):e.time=n}return e}function Gg(s,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=s.match(t);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,r=n[2]?parseInt(n[2]):null;return{year:r===null?i:r*100,restDateString:s.slice((n[1]||n[2]).length)}}function Kg(s,e){if(e===null)return new Date(NaN);const t=s.match(zg);if(!t)return new Date(NaN);const n=!!t[4],i=ds(t[1]),r=ds(t[2])-1,a=ds(t[3]),o=ds(t[4]),l=ds(t[5])-1;if(n)return tm(e,o,l)?Jg(e,o,l):new Date(NaN);{const u=new Date(0);return!Xg(e,r,a)||!em(e,i)?new Date(NaN):(u.setUTCFullYear(e,r,Math.max(i,a)),u)}}function ds(s){return s?parseInt(s):1}function Qg(s){const e=s.match(Hg);if(!e)return NaN;const t=ho(e[1]),n=ho(e[2]),i=ho(e[3]);return nm(t,n,i)?t*oh+n*ah+i*1e3:NaN}function ho(s){return s&&parseFloat(s.replace(",","."))||0}function Yg(s){if(s==="Z")return 0;const e=s.match(qg);if(!e)return 0;const t=e[1]==="+"?-1:1,n=parseInt(e[2]),i=e[3]&&parseInt(e[3])||0;return im(n,i)?t*(n*oh+i*ah):NaN}function Jg(s,e,t){const n=new Date(0);n.setUTCFullYear(s,0,4);const i=n.getUTCDay()||7,r=(e-1)*7+t+1-i;return n.setUTCDate(n.getUTCDate()+r),n}const Zg=[31,null,31,30,31,30,31,31,30,31,30,31];function uh(s){return s%400===0||s%4===0&&s%100!==0}function Xg(s,e,t){return e>=0&&e<=11&&t>=1&&t<=(Zg[e]||(uh(s)?29:28))}function em(s,e){return e>=1&&e<=(uh(s)?366:365)}function tm(s,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function nm(s,e,t){return s===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&s>=0&&s<25}function im(s,e){return e>=0&&e<=59}class Ai{static calculateDashboardMetrics(e){const t=e.filter(m=>m.date&&m.trainingLoad>0).sort((m,w)=>new Date(m.date).getTime()-new Date(w.date).getTime());if(t.length===0)return this.getEmptyMetrics();const n=new Date,i=lo(n,{weekStartsOn:1}),r=co(n,{weekStartsOn:1}),a=lo(pn(n,7),{weekStartsOn:1}),o=co(pn(n,7),{weekStartsOn:1}),l=t.filter(m=>{const w=jt(m.date);return uo(w,{start:i,end:r})}),u=t.filter(m=>{const w=jt(m.date);return uo(w,{start:a,end:o})}),d=t.filter(m=>{const w=jt(m.date);return fu(n,w)<=7}),p=this.calculateFitnessForm(t);return{currentFatigueRisk:this.calculateFatigueRisk(d),readinessScore:this.calculateReadinessScore(d,t),weeklyTrainingLoad:this.sumTrainingLoad(l),weeklyZoneDistribution:this.calculateZoneDistribution(l),trainingLoadTrend:this.calculateTrainingLoadTrend(t),currentStreak:this.calculateCurrentStreak(t),longestStreak:this.calculateLongestStreak(t),hrDriftTrend:this.calculateHRDriftTrend(d),volumeChangePercent:this.calculateVolumeChange(l,u),injuryRiskFactors:this.identifyInjuryRiskFactors(d,t),fitnessForm:p,chartData:this.generateChartData(t)}}static calculateFatigueRisk(e){if(e.length===0)return"low";const n=this.sumTrainingLoad(e)/7,i=e.reduce((r,a)=>r+a.zone4Minutes+a.zone5Minutes,0);return n>100||i>120?"high":n>60||i>60?"moderate":"low"}static calculateReadinessScore(e,t){if(e.length===0)return 85;let n=100;const i=this.sumTrainingLoad(e),r=t.length>0?this.sumTrainingLoad(t)/t.length*7:0;i>r*1.5?n-=20:i>r*1.2&&(n-=10);const a=this.daysSinceLastRest(e);return a>6?n-=15:a>4&&(n-=10),e.filter(l=>l.hrDrift!==void 0).reduce((l,u)=>l+(u.hrDrift||0),0)/e.length>10&&(n-=15),Math.max(0,Math.min(100,n))}static calculateZoneDistribution(e){return e.reduce((t,n)=>({zone1:t.zone1+n.zone1Minutes,zone2:t.zone2+n.zone2Minutes,zone3:t.zone3+n.zone3Minutes,zone4:t.zone4+n.zone4Minutes,zone5:t.zone5+n.zone5Minutes}),{zone1:0,zone2:0,zone3:0,zone4:0,zone5:0})}static calculateTrainingLoadTrend(e){if(e.length<14)return"stable";const t=new Date,n=pn(t,14),i=pn(t,7),r=e.filter(l=>{const u=jt(l.date);return u>=n&&u<i}).reduce((l,u)=>l+u.trainingLoad,0),a=e.filter(l=>jt(l.date)>=i).reduce((l,u)=>l+u.trainingLoad,0),o=r>0?(a-r)/r*100:0;return o>15?"increasing":o<-15?"decreasing":"stable"}static calculateCurrentStreak(e){if(e.length===0)return 0;const t=new Date;let n=0,i=new Date(t);for(let r=0;r<30;r++){const a=i.toISOString().split("T")[0];if(e.some(l=>l.date.startsWith(a)))n++,i=pn(i,1);else break}return n}static calculateLongestStreak(e){if(e.length===0)return 0;const t=e.map(a=>a.date.split("T")[0]),n=[...new Set(t)].sort();let i=0,r=1;for(let a=1;a<n.length;a++){const o=new Date(n[a-1]),l=new Date(n[a]);fu(l,o)===1?r++:(i=Math.max(i,r),r=1)}return Math.max(i,r)}static calculateHRDriftTrend(e){const t=e.filter(r=>r.hrDrift!==void 0);if(t.length<3)return"insufficient_data";const n=t.slice(-3),i=n.reduce((r,a)=>r+(a.hrDrift||0),0)/n.length;if(t.length>=6){const r=t.slice(-6,-3),a=r.reduce((o,l)=>o+(l.hrDrift||0),0)/r.length;if(i<a-2)return"improving";if(i>a+2)return"declining"}return"stable"}static calculateVolumeChange(e,t){const n=e.reduce((r,a)=>r+a.duration,0),i=t.reduce((r,a)=>r+a.duration,0);return i===0?n>0?100:0:(n-i)/i*100}static identifyInjuryRiskFactors(e,t){const n=[];this.calculateVolumeChange(e,t.slice(-14,-7))>25&&n.push("High volume increase (>25%)"),this.sumTrainingLoad(e)>500&&n.push("High weekly training load"),this.daysSinceLastRest(e)>6&&n.push("No rest days in over 6 days");const o=e.reduce((u,d)=>u+d.duration,0),l=e.reduce((u,d)=>u+d.zone4Minutes+d.zone5Minutes,0);return o>0&&l/o>.3&&n.push("High intensity ratio (>30%)"),n}static calculateFitnessForm(e){if(e.length===0)return{ctl:0,atl:0,tsb:0,ctlChange:0,status:"maintaining"};const t=42,n=7,i=this.generateDailyTrainingLoads(e);let r=0,a=0,o=0;i.forEach((p,m)=>{m===i.length-8&&(o=r),r=r+(p.load-r)*(1/t),a=a+(p.load-a)*(1/n)});const l=r-a,u=r-o;let d;return l>25?d="fresh":l>=5&&l<=25?d="optimal":l>=-10&&l<5?d="productive":l>=-30&&l<-10?d="overreaching":l<-30?d="high_risk":d="maintaining",{ctl:Math.round(r*10)/10,atl:Math.round(a*10)/10,tsb:Math.round(l*10)/10,ctlChange:Math.round(u*10)/10,status:d}}static generateDailyTrainingLoads(e){if(e.length===0)return[];const t=new Map;e.forEach(o=>{const l=o.date.split("T")[0];t.set(l,(t.get(l)||0)+o.trainingLoad)});const n=jt(e[0].date),i=new Date,r=[];let a=new Date(n);for(;a<=i;){const o=a.toISOString().split("T")[0];r.push({date:o,load:t.get(o)||0}),a=new Date(a),a.setDate(a.getDate()+1)}return r}static generateChartData(e){const t=pn(new Date,30),n=e.filter(i=>jt(i.date)>=t);return{trainingLoadHistory:this.generateTrainingLoadHistory(n),weeklyLoadComparison:this.generateWeeklyComparison(e),hrTrendData:this.generateHRTrendData(n),zoneProgressData:this.generateZoneProgressData(n),fitnessFormHistory:this.generateFitnessFormHistory(e),intensityHeatMap:this.generateIntensityHeatMap(e)}}static generateFitnessFormHistory(e){if(e.length===0)return[];const t=this.generateDailyTrainingLoads(e),n=42,i=7;let r=0,a=0;const o=[];return t.forEach(l=>{r=r+(l.load-r)*(1/n),a=a+(l.load-a)*(1/i);const u=r-a;o.push({date:l.date,ctl:Math.round(r*10)/10,atl:Math.round(a*10)/10,tsb:Math.round(u*10)/10})}),o.slice(-90)}static generateIntensityHeatMap(e){const t=pn(new Date,90),n=e.filter(r=>jt(r.date)>=t),i=new Map;return n.forEach(r=>{const a=r.date.split("T")[0],o=i.get(a)||{intensity:0,load:0,duration:0},l=r.duration>0?r.trainingLoad/r.duration:0;i.set(a,{intensity:Math.max(o.intensity,l),load:o.load+r.trainingLoad,duration:o.duration+r.duration})}),Array.from(i.entries()).map(([r,a])=>({date:r,...a})).sort((r,a)=>r.date.localeCompare(a.date))}static generateTrainingLoadHistory(e){const t=new Map;return e.forEach(n=>{const i=n.date.split("T")[0];t.set(i,(t.get(i)||0)+n.trainingLoad)}),Array.from(t.entries()).map(([n,i])=>({date:n,load:i})).sort((n,i)=>n.date.localeCompare(i.date))}static generateWeeklyComparison(e){const t=new Map,n=new Date;for(let i=7;i>=0;i--){const r=lo(pn(n,i*7),{weekStartsOn:1}),a=co(r,{weekStartsOn:1}),o=`${r.getMonth()+1}/${r.getDate()}`,l=e.filter(p=>{const m=jt(p.date);return uo(m,{start:r,end:a})}),u=this.sumTrainingLoad(l),d=this.calculateWeekRecoveryScore(l);t.set(o,{load:u,recovery:d})}return Array.from(t.entries()).map(([i,r])=>({week:i,...r}))}static generateHRTrendData(e){return e.filter(t=>t.avgHR&&t.maxHR).map(t=>({date:t.date.split("T")[0],avgHR:t.avgHR,maxHR:t.maxHR})).sort((t,n)=>t.date.localeCompare(n.date))}static generateZoneProgressData(e){const t=new Map;return e.forEach(n=>{const i=n.date.split("T")[0],r=t.get(i)||[0,0,0,0,0];r[0]+=n.zone1Minutes,r[1]+=n.zone2Minutes,r[2]+=n.zone3Minutes,r[3]+=n.zone4Minutes,r[4]+=n.zone5Minutes,t.set(i,r)}),Array.from(t.entries()).map(([n,i])=>({date:n,zones:i})).sort((n,i)=>n.date.localeCompare(i.date))}static sumTrainingLoad(e){return e.reduce((t,n)=>t+n.trainingLoad,0)}static daysSinceLastRest(e){const t=new Date,n=e.map(i=>jt(i.date));for(let i=0;i<14;i++){const r=pn(t,i);if(!n.some(o=>o.toDateString()===r.toDateString()))return i}return 14}static calculateWeekRecoveryScore(e){if(e.length===0)return 100;const t=this.sumTrainingLoad(e)/7,n=7-new Set(e.map(i=>i.date.split("T")[0])).size;return Math.min(100,n*20+Math.max(0,40-t))}static getEmptyMetrics(){return{currentFatigueRisk:"low",readinessScore:85,weeklyTrainingLoad:0,weeklyZoneDistribution:{zone1:0,zone2:0,zone3:0,zone4:0,zone5:0},trainingLoadTrend:"stable",currentStreak:0,longestStreak:0,hrDriftTrend:"insufficient_data",volumeChangePercent:0,injuryRiskFactors:[],fitnessForm:{ctl:0,atl:0,tsb:0,ctlChange:0,status:"maintaining"},chartData:{trainingLoadHistory:[],weeklyLoadComparison:[],hrTrendData:[],zoneProgressData:[],fitnessFormHistory:[],intensityHeatMap:[]}}}}const sm=()=>{};var gu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let i=s.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},rm=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const i=s[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const r=s[t++];e[n++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=s[t++],a=s[t++],o=s[t++],l=((i&7)<<18|(r&63)<<12|(a&63)<<6|o&63)-65536;e[n++]=String.fromCharCode(55296+(l>>10)),e[n++]=String.fromCharCode(56320+(l&1023))}else{const r=s[t++],a=s[t++];e[n++]=String.fromCharCode((i&15)<<12|(r&63)<<6|a&63)}}return e.join("")},hh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<s.length;i+=3){const r=s[i],a=i+1<s.length,o=a?s[i+1]:0,l=i+2<s.length,u=l?s[i+2]:0,d=r>>2,p=(r&3)<<4|o>>4;let m=(o&15)<<2|u>>6,w=u&63;l||(w=64,a||(m=64)),n.push(t[d],t[p],t[m],t[w])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(dh(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):rm(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<s.length;){const r=t[s.charAt(i++)],o=i<s.length?t[s.charAt(i)]:0;++i;const u=i<s.length?t[s.charAt(i)]:64;++i;const p=i<s.length?t[s.charAt(i)]:64;if(++i,r==null||o==null||u==null||p==null)throw new am;const m=r<<2|o>>4;if(n.push(m),u!==64){const w=o<<4&240|u>>2;if(n.push(w),p!==64){const E=u<<6&192|p;n.push(E)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class am extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const om=function(s){const e=dh(s);return hh.encodeByteArray(e,!0)},zr=function(s){return om(s).replace(/\./g,"")},fh=function(s){try{return hh.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lm(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cm=()=>lm().__FIREBASE_DEFAULTS__,um=()=>{if(typeof process>"u"||typeof gu>"u")return;const s=gu.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},dm=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&fh(s[1]);return e&&JSON.parse(e)},Ea=()=>{try{return sm()||cm()||um()||dm()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},ph=s=>{var e,t;return(t=(e=Ea())==null?void 0:e.emulatorHosts)==null?void 0:t[s]},gh=s=>{const e=ph(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},mh=()=>{var s;return(s=Ea())==null?void 0:s.config},_h=s=>{var e;return(e=Ea())==null?void 0:e[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yi(s){try{return(s.startsWith("http://")||s.startsWith("https://")?new URL(s).hostname:s).endsWith(".cloudworkstations.dev")}catch{return!1}}async function al(s){return(await fetch(s,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yh(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",i=s.iat||0,r=s.sub||s.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...s};return[zr(JSON.stringify(t)),zr(JSON.stringify(a)),""].join(".")}const ws={};function fm(){const s={prod:[],emulator:[]};for(const e of Object.keys(ws))ws[e]?s.emulator.push(e):s.prod.push(e);return s}function pm(s){let e=document.getElementById(s),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",s),t=!0),{created:t,element:e}}let mu=!1;function ol(s,e){if(typeof window>"u"||typeof document>"u"||!yi(window.location.host)||ws[s]===e||ws[s]||mu)return;ws[s]=e;function t(m){return`__firebase__banner__${m}`}const n="__firebase__banner",r=fm().prod.length>0;function a(){const m=document.getElementById(n);m&&m.remove()}function o(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,w){m.setAttribute("width","24"),m.setAttribute("id",w),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{mu=!0,a()},m}function d(m,w){m.setAttribute("id",w),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=pm(n),w=t("text"),E=document.getElementById(w)||document.createElement("span"),C=t("learnmore"),I=document.getElementById(C)||document.createElement("a"),B=t("preprendIcon"),G=document.getElementById(B)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const Y=m.element;o(Y),d(I,C);const K=u();l(G,B),Y.append(G,E,I,K),document.body.appendChild(Y)}r?(E.innerText="Preview backend disconnected.",G.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(G.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",w)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function gm(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(yt())}function mm(){var e;const s=(e=Ea())==null?void 0:e.forceEnvironment;if(s==="node")return!0;if(s==="browser")return!1;try{return Object.prototype.toString.call(globalThis.process)==="[object process]"}catch{return!1}}function _m(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ym(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function vm(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function wm(){const s=yt();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function bm(){return!mm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function km(){try{return typeof indexedDB=="object"}catch{return!1}}function Em(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var r;e(((r=i.error)==null?void 0:r.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sm="FirebaseError";class un extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Sm,Object.setPrototypeOf(this,un.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ws.prototype.create)}}class Ws{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],a=r?Tm(r,n):"Error",o=`${this.serviceName}: ${a} (${i}).`;return new un(i,o,n)}}function Tm(s,e){return s.replace(Im,(t,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const Im=/\{\$([^}]+)}/g;function Am(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function ui(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const i of t){if(!n.includes(i))return!1;const r=s[i],a=e[i];if(_u(r)&&_u(a)){if(!ui(r,a))return!1}else if(r!==a)return!1}for(const i of n)if(!t.includes(i))return!1;return!0}function _u(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zs(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function ps(s){const e={};return s.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,r]=n.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function gs(s){const e=s.indexOf("?");if(!e)return"";const t=s.indexOf("#",e);return s.substring(e,t>0?t:void 0)}function Dm(s,e){const t=new Rm(s,e);return t.subscribe.bind(t)}class Rm{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Cm(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=fo),i.error===void 0&&(i.error=fo),i.complete===void 0&&(i.complete=fo);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Cm(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function fo(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(s){return s&&s._delegate?s._delegate:s}class Bn{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xm{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new hm;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Mm(e))try{this.getOrInitializeService({instanceIdentifier:ii})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});n.resolve(r)}catch{}}}}clearInstance(e=ii){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ii){return this.instances.has(e)}getOptions(e=ii){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(r);n===o&&a.resolve(i)}return i}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);const r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Pm(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ii){return this.component?this.component.multipleInstances?e:ii:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Pm(s){return s===ii?void 0:s}function Mm(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new xm(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(ge||(ge={}));const Fm={debug:ge.DEBUG,verbose:ge.VERBOSE,info:ge.INFO,warn:ge.WARN,error:ge.ERROR,silent:ge.SILENT},Nm=ge.INFO,$m={[ge.DEBUG]:"log",[ge.VERBOSE]:"log",[ge.INFO]:"info",[ge.WARN]:"warn",[ge.ERROR]:"error"},Om=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),i=$m[e];if(i)console[i](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ll{constructor(e){this.name=e,this._logLevel=Nm,this._logHandler=Om,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ge))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Fm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ge.DEBUG,...e),this._logHandler(this,ge.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ge.VERBOSE,...e),this._logHandler(this,ge.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ge.INFO,...e),this._logHandler(this,ge.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ge.WARN,...e),this._logHandler(this,ge.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ge.ERROR,...e),this._logHandler(this,ge.ERROR,...e)}}const Vm=(s,e)=>e.some(t=>s instanceof t);let yu,vu;function Um(){return yu||(yu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Bm(){return vu||(vu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const vh=new WeakMap,Co=new WeakMap,wh=new WeakMap,po=new WeakMap,cl=new WeakMap;function Wm(s){const e=new Promise((t,n)=>{const i=()=>{s.removeEventListener("success",r),s.removeEventListener("error",a)},r=()=>{t($n(s.result)),i()},a=()=>{n(s.error),i()};s.addEventListener("success",r),s.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&vh.set(t,s)}).catch(()=>{}),cl.set(e,s),e}function zm(s){if(Co.has(s))return;const e=new Promise((t,n)=>{const i=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",a),s.removeEventListener("abort",a)},r=()=>{t(),i()},a=()=>{n(s.error||new DOMException("AbortError","AbortError")),i()};s.addEventListener("complete",r),s.addEventListener("error",a),s.addEventListener("abort",a)});Co.set(s,e)}let xo={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return Co.get(s);if(e==="objectStoreNames")return s.objectStoreNames||wh.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return $n(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function Hm(s){xo=s(xo)}function qm(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(go(this),e,...t);return wh.set(n,e.sort?e.sort():[e]),$n(n)}:Bm().includes(s)?function(...e){return s.apply(go(this),e),$n(vh.get(this))}:function(...e){return $n(s.apply(go(this),e))}}function jm(s){return typeof s=="function"?qm(s):(s instanceof IDBTransaction&&zm(s),Vm(s,Um())?new Proxy(s,xo):s)}function $n(s){if(s instanceof IDBRequest)return Wm(s);if(po.has(s))return po.get(s);const e=jm(s);return e!==s&&(po.set(s,e),cl.set(e,s)),e}const go=s=>cl.get(s);function Gm(s,e,{blocked:t,upgrade:n,blocking:i,terminated:r}={}){const a=indexedDB.open(s,e),o=$n(a);return n&&a.addEventListener("upgradeneeded",l=>{n($n(a.result),l.oldVersion,l.newVersion,$n(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const Km=["get","getKey","getAll","getAllKeys","count"],Qm=["put","add","delete","clear"],mo=new Map;function wu(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(mo.get(e))return mo.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,i=Qm.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Km.includes(t)))return;const r=async function(a,...o){const l=this.transaction(a,i?"readwrite":"readonly");let u=l.store;return n&&(u=u.index(o.shift())),(await Promise.all([u[t](...o),i&&l.done]))[0]};return mo.set(e,r),r}Hm(s=>({...s,get:(e,t,n)=>wu(e,t)||s.get(e,t,n),has:(e,t)=>!!wu(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Jm(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Jm(s){const e=s.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Po="@firebase/app",bu="0.14.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wn=new ll("@firebase/app"),Zm="@firebase/app-compat",Xm="@firebase/analytics-compat",e_="@firebase/analytics",t_="@firebase/app-check-compat",n_="@firebase/app-check",i_="@firebase/auth",s_="@firebase/auth-compat",r_="@firebase/database",a_="@firebase/data-connect",o_="@firebase/database-compat",l_="@firebase/functions",c_="@firebase/functions-compat",u_="@firebase/installations",d_="@firebase/installations-compat",h_="@firebase/messaging",f_="@firebase/messaging-compat",p_="@firebase/performance",g_="@firebase/performance-compat",m_="@firebase/remote-config",__="@firebase/remote-config-compat",y_="@firebase/storage",v_="@firebase/storage-compat",w_="@firebase/firestore",b_="@firebase/ai",k_="@firebase/firestore-compat",E_="firebase",S_="12.0.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo="[DEFAULT]",T_={[Po]:"fire-core",[Zm]:"fire-core-compat",[e_]:"fire-analytics",[Xm]:"fire-analytics-compat",[n_]:"fire-app-check",[t_]:"fire-app-check-compat",[i_]:"fire-auth",[s_]:"fire-auth-compat",[r_]:"fire-rtdb",[a_]:"fire-data-connect",[o_]:"fire-rtdb-compat",[l_]:"fire-fn",[c_]:"fire-fn-compat",[u_]:"fire-iid",[d_]:"fire-iid-compat",[h_]:"fire-fcm",[f_]:"fire-fcm-compat",[p_]:"fire-perf",[g_]:"fire-perf-compat",[m_]:"fire-rc",[__]:"fire-rc-compat",[y_]:"fire-gcs",[v_]:"fire-gcs-compat",[w_]:"fire-fst",[k_]:"fire-fst-compat",[b_]:"fire-vertex","fire-js":"fire-js",[E_]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hr=new Map,I_=new Map,Lo=new Map;function ku(s,e){try{s.container.addComponent(e)}catch(t){wn.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function di(s){const e=s.name;if(Lo.has(e))return wn.debug(`There were multiple attempts to register component ${e}.`),!1;Lo.set(e,s);for(const t of Hr.values())ku(t,s);for(const t of I_.values())ku(t,s);return!0}function Sa(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function Ct(s){return s==null?!1:s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},On=new Ws("app","Firebase",A_);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Bn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw On.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi=S_;function bh(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n={name:Mo,automaticDataCollectionEnabled:!0,...e},i=n.name;if(typeof i!="string"||!i)throw On.create("bad-app-name",{appName:String(i)});if(t||(t=mh()),!t)throw On.create("no-options");const r=Hr.get(i);if(r){if(ui(t,r.options)&&ui(n,r.config))return r;throw On.create("duplicate-app",{appName:i})}const a=new Lm(i);for(const l of Lo.values())a.addComponent(l);const o=new D_(t,n,a);return Hr.set(i,o),o}function ul(s=Mo){const e=Hr.get(s);if(!e&&s===Mo&&mh())return bh();if(!e)throw On.create("no-app",{appName:s});return e}function Xt(s,e,t){let n=T_[s]??s;t&&(n+=`-${t}`);const i=n.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const a=[`Unable to register library "${n}" with version "${e}":`];i&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&r&&a.push("and"),r&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),wn.warn(a.join(" "));return}di(new Bn(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R_="firebase-heartbeat-database",C_=1,Ps="firebase-heartbeat-store";let _o=null;function kh(){return _o||(_o=Gm(R_,C_,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(Ps)}catch(t){console.warn(t)}}}}).catch(s=>{throw On.create("idb-open",{originalErrorMessage:s.message})})),_o}async function x_(s){try{const t=(await kh()).transaction(Ps),n=await t.objectStore(Ps).get(Eh(s));return await t.done,n}catch(e){if(e instanceof un)wn.warn(e.message);else{const t=On.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});wn.warn(t.message)}}}async function Eu(s,e){try{const n=(await kh()).transaction(Ps,"readwrite");await n.objectStore(Ps).put(e,Eh(s)),await n.done}catch(t){if(t instanceof un)wn.warn(t.message);else{const n=On.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});wn.warn(n.message)}}}function Eh(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P_=1024,M_=30;class L_{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new N_(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Su();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>M_){const a=$_(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){wn.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Su(),{heartbeatsToSend:n,unsentEntries:i}=F_(this._heartbeatsCache.heartbeats),r=zr(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return wn.warn(t),""}}}function Su(){return new Date().toISOString().substring(0,10)}function F_(s,e=P_){const t=[];let n=s.slice();for(const i of s){const r=t.find(a=>a.agent===i.agent);if(r){if(r.dates.push(i.date),Tu(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Tu(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class N_{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return km()?Em().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await x_(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Eu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Eu(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Tu(s){return zr(JSON.stringify({version:2,heartbeats:s})).length}function $_(s){if(s.length===0)return-1;let e=0,t=s[0].date;for(let n=1;n<s.length;n++)s[n].date<t&&(t=s[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O_(s){di(new Bn("platform-logger",e=>new Ym(e),"PRIVATE")),di(new Bn("heartbeat",e=>new L_(e),"PRIVATE")),Xt(Po,bu,s),Xt(Po,bu,"esm2020"),Xt("fire-js","")}O_("");var Iu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Vn,Sh;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(M,A){function R(){}R.prototype=A.prototype,M.D=A.prototype,M.prototype=new R,M.prototype.constructor=M,M.C=function(P,F,N){for(var x=Array(arguments.length-2),ze=2;ze<arguments.length;ze++)x[ze-2]=arguments[ze];return A.prototype[F].apply(P,x)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(M,A,R){R||(R=0);var P=Array(16);if(typeof A=="string")for(var F=0;16>F;++F)P[F]=A.charCodeAt(R++)|A.charCodeAt(R++)<<8|A.charCodeAt(R++)<<16|A.charCodeAt(R++)<<24;else for(F=0;16>F;++F)P[F]=A[R++]|A[R++]<<8|A[R++]<<16|A[R++]<<24;A=M.g[0],R=M.g[1],F=M.g[2];var N=M.g[3],x=A+(N^R&(F^N))+P[0]+3614090360&4294967295;A=R+(x<<7&4294967295|x>>>25),x=N+(F^A&(R^F))+P[1]+3905402710&4294967295,N=A+(x<<12&4294967295|x>>>20),x=F+(R^N&(A^R))+P[2]+606105819&4294967295,F=N+(x<<17&4294967295|x>>>15),x=R+(A^F&(N^A))+P[3]+3250441966&4294967295,R=F+(x<<22&4294967295|x>>>10),x=A+(N^R&(F^N))+P[4]+4118548399&4294967295,A=R+(x<<7&4294967295|x>>>25),x=N+(F^A&(R^F))+P[5]+1200080426&4294967295,N=A+(x<<12&4294967295|x>>>20),x=F+(R^N&(A^R))+P[6]+2821735955&4294967295,F=N+(x<<17&4294967295|x>>>15),x=R+(A^F&(N^A))+P[7]+4249261313&4294967295,R=F+(x<<22&4294967295|x>>>10),x=A+(N^R&(F^N))+P[8]+1770035416&4294967295,A=R+(x<<7&4294967295|x>>>25),x=N+(F^A&(R^F))+P[9]+2336552879&4294967295,N=A+(x<<12&4294967295|x>>>20),x=F+(R^N&(A^R))+P[10]+4294925233&4294967295,F=N+(x<<17&4294967295|x>>>15),x=R+(A^F&(N^A))+P[11]+2304563134&4294967295,R=F+(x<<22&4294967295|x>>>10),x=A+(N^R&(F^N))+P[12]+1804603682&4294967295,A=R+(x<<7&4294967295|x>>>25),x=N+(F^A&(R^F))+P[13]+4254626195&4294967295,N=A+(x<<12&4294967295|x>>>20),x=F+(R^N&(A^R))+P[14]+2792965006&4294967295,F=N+(x<<17&4294967295|x>>>15),x=R+(A^F&(N^A))+P[15]+1236535329&4294967295,R=F+(x<<22&4294967295|x>>>10),x=A+(F^N&(R^F))+P[1]+4129170786&4294967295,A=R+(x<<5&4294967295|x>>>27),x=N+(R^F&(A^R))+P[6]+3225465664&4294967295,N=A+(x<<9&4294967295|x>>>23),x=F+(A^R&(N^A))+P[11]+643717713&4294967295,F=N+(x<<14&4294967295|x>>>18),x=R+(N^A&(F^N))+P[0]+3921069994&4294967295,R=F+(x<<20&4294967295|x>>>12),x=A+(F^N&(R^F))+P[5]+3593408605&4294967295,A=R+(x<<5&4294967295|x>>>27),x=N+(R^F&(A^R))+P[10]+38016083&4294967295,N=A+(x<<9&4294967295|x>>>23),x=F+(A^R&(N^A))+P[15]+3634488961&4294967295,F=N+(x<<14&4294967295|x>>>18),x=R+(N^A&(F^N))+P[4]+3889429448&4294967295,R=F+(x<<20&4294967295|x>>>12),x=A+(F^N&(R^F))+P[9]+568446438&4294967295,A=R+(x<<5&4294967295|x>>>27),x=N+(R^F&(A^R))+P[14]+3275163606&4294967295,N=A+(x<<9&4294967295|x>>>23),x=F+(A^R&(N^A))+P[3]+4107603335&4294967295,F=N+(x<<14&4294967295|x>>>18),x=R+(N^A&(F^N))+P[8]+1163531501&4294967295,R=F+(x<<20&4294967295|x>>>12),x=A+(F^N&(R^F))+P[13]+2850285829&4294967295,A=R+(x<<5&4294967295|x>>>27),x=N+(R^F&(A^R))+P[2]+4243563512&4294967295,N=A+(x<<9&4294967295|x>>>23),x=F+(A^R&(N^A))+P[7]+1735328473&4294967295,F=N+(x<<14&4294967295|x>>>18),x=R+(N^A&(F^N))+P[12]+2368359562&4294967295,R=F+(x<<20&4294967295|x>>>12),x=A+(R^F^N)+P[5]+4294588738&4294967295,A=R+(x<<4&4294967295|x>>>28),x=N+(A^R^F)+P[8]+2272392833&4294967295,N=A+(x<<11&4294967295|x>>>21),x=F+(N^A^R)+P[11]+1839030562&4294967295,F=N+(x<<16&4294967295|x>>>16),x=R+(F^N^A)+P[14]+4259657740&4294967295,R=F+(x<<23&4294967295|x>>>9),x=A+(R^F^N)+P[1]+2763975236&4294967295,A=R+(x<<4&4294967295|x>>>28),x=N+(A^R^F)+P[4]+1272893353&4294967295,N=A+(x<<11&4294967295|x>>>21),x=F+(N^A^R)+P[7]+4139469664&4294967295,F=N+(x<<16&4294967295|x>>>16),x=R+(F^N^A)+P[10]+3200236656&4294967295,R=F+(x<<23&4294967295|x>>>9),x=A+(R^F^N)+P[13]+681279174&4294967295,A=R+(x<<4&4294967295|x>>>28),x=N+(A^R^F)+P[0]+3936430074&4294967295,N=A+(x<<11&4294967295|x>>>21),x=F+(N^A^R)+P[3]+3572445317&4294967295,F=N+(x<<16&4294967295|x>>>16),x=R+(F^N^A)+P[6]+76029189&4294967295,R=F+(x<<23&4294967295|x>>>9),x=A+(R^F^N)+P[9]+3654602809&4294967295,A=R+(x<<4&4294967295|x>>>28),x=N+(A^R^F)+P[12]+3873151461&4294967295,N=A+(x<<11&4294967295|x>>>21),x=F+(N^A^R)+P[15]+530742520&4294967295,F=N+(x<<16&4294967295|x>>>16),x=R+(F^N^A)+P[2]+3299628645&4294967295,R=F+(x<<23&4294967295|x>>>9),x=A+(F^(R|~N))+P[0]+4096336452&4294967295,A=R+(x<<6&4294967295|x>>>26),x=N+(R^(A|~F))+P[7]+1126891415&4294967295,N=A+(x<<10&4294967295|x>>>22),x=F+(A^(N|~R))+P[14]+2878612391&4294967295,F=N+(x<<15&4294967295|x>>>17),x=R+(N^(F|~A))+P[5]+4237533241&4294967295,R=F+(x<<21&4294967295|x>>>11),x=A+(F^(R|~N))+P[12]+1700485571&4294967295,A=R+(x<<6&4294967295|x>>>26),x=N+(R^(A|~F))+P[3]+2399980690&4294967295,N=A+(x<<10&4294967295|x>>>22),x=F+(A^(N|~R))+P[10]+4293915773&4294967295,F=N+(x<<15&4294967295|x>>>17),x=R+(N^(F|~A))+P[1]+2240044497&4294967295,R=F+(x<<21&4294967295|x>>>11),x=A+(F^(R|~N))+P[8]+1873313359&4294967295,A=R+(x<<6&4294967295|x>>>26),x=N+(R^(A|~F))+P[15]+4264355552&4294967295,N=A+(x<<10&4294967295|x>>>22),x=F+(A^(N|~R))+P[6]+2734768916&4294967295,F=N+(x<<15&4294967295|x>>>17),x=R+(N^(F|~A))+P[13]+1309151649&4294967295,R=F+(x<<21&4294967295|x>>>11),x=A+(F^(R|~N))+P[4]+4149444226&4294967295,A=R+(x<<6&4294967295|x>>>26),x=N+(R^(A|~F))+P[11]+3174756917&4294967295,N=A+(x<<10&4294967295|x>>>22),x=F+(A^(N|~R))+P[2]+718787259&4294967295,F=N+(x<<15&4294967295|x>>>17),x=R+(N^(F|~A))+P[9]+3951481745&4294967295,M.g[0]=M.g[0]+A&4294967295,M.g[1]=M.g[1]+(F+(x<<21&4294967295|x>>>11))&4294967295,M.g[2]=M.g[2]+F&4294967295,M.g[3]=M.g[3]+N&4294967295}n.prototype.u=function(M,A){A===void 0&&(A=M.length);for(var R=A-this.blockSize,P=this.B,F=this.h,N=0;N<A;){if(F==0)for(;N<=R;)i(this,M,N),N+=this.blockSize;if(typeof M=="string"){for(;N<A;)if(P[F++]=M.charCodeAt(N++),F==this.blockSize){i(this,P),F=0;break}}else for(;N<A;)if(P[F++]=M[N++],F==this.blockSize){i(this,P),F=0;break}}this.h=F,this.o+=A},n.prototype.v=function(){var M=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);M[0]=128;for(var A=1;A<M.length-8;++A)M[A]=0;var R=8*this.o;for(A=M.length-8;A<M.length;++A)M[A]=R&255,R/=256;for(this.u(M),M=Array(16),A=R=0;4>A;++A)for(var P=0;32>P;P+=8)M[R++]=this.g[A]>>>P&255;return M};function r(M,A){var R=o;return Object.prototype.hasOwnProperty.call(R,M)?R[M]:R[M]=A(M)}function a(M,A){this.h=A;for(var R=[],P=!0,F=M.length-1;0<=F;F--){var N=M[F]|0;P&&N==A||(R[F]=N,P=!1)}this.g=R}var o={};function l(M){return-128<=M&&128>M?r(M,function(A){return new a([A|0],0>A?-1:0)}):new a([M|0],0>M?-1:0)}function u(M){if(isNaN(M)||!isFinite(M))return p;if(0>M)return I(u(-M));for(var A=[],R=1,P=0;M>=R;P++)A[P]=M/R|0,R*=4294967296;return new a(A,0)}function d(M,A){if(M.length==0)throw Error("number format error: empty string");if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(M.charAt(0)=="-")return I(d(M.substring(1),A));if(0<=M.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=u(Math.pow(A,8)),P=p,F=0;F<M.length;F+=8){var N=Math.min(8,M.length-F),x=parseInt(M.substring(F,F+N),A);8>N?(N=u(Math.pow(A,N)),P=P.j(N).add(u(x))):(P=P.j(R),P=P.add(u(x)))}return P}var p=l(0),m=l(1),w=l(16777216);s=a.prototype,s.m=function(){if(C(this))return-I(this).m();for(var M=0,A=1,R=0;R<this.g.length;R++){var P=this.i(R);M+=(0<=P?P:4294967296+P)*A,A*=4294967296}return M},s.toString=function(M){if(M=M||10,2>M||36<M)throw Error("radix out of range: "+M);if(E(this))return"0";if(C(this))return"-"+I(this).toString(M);for(var A=u(Math.pow(M,6)),R=this,P="";;){var F=K(R,A).g;R=B(R,F.j(A));var N=((0<R.g.length?R.g[0]:R.h)>>>0).toString(M);if(R=F,E(R))return N+P;for(;6>N.length;)N="0"+N;P=N+P}},s.i=function(M){return 0>M?0:M<this.g.length?this.g[M]:this.h};function E(M){if(M.h!=0)return!1;for(var A=0;A<M.g.length;A++)if(M.g[A]!=0)return!1;return!0}function C(M){return M.h==-1}s.l=function(M){return M=B(this,M),C(M)?-1:E(M)?0:1};function I(M){for(var A=M.g.length,R=[],P=0;P<A;P++)R[P]=~M.g[P];return new a(R,~M.h).add(m)}s.abs=function(){return C(this)?I(this):this},s.add=function(M){for(var A=Math.max(this.g.length,M.g.length),R=[],P=0,F=0;F<=A;F++){var N=P+(this.i(F)&65535)+(M.i(F)&65535),x=(N>>>16)+(this.i(F)>>>16)+(M.i(F)>>>16);P=x>>>16,N&=65535,x&=65535,R[F]=x<<16|N}return new a(R,R[R.length-1]&-2147483648?-1:0)};function B(M,A){return M.add(I(A))}s.j=function(M){if(E(this)||E(M))return p;if(C(this))return C(M)?I(this).j(I(M)):I(I(this).j(M));if(C(M))return I(this.j(I(M)));if(0>this.l(w)&&0>M.l(w))return u(this.m()*M.m());for(var A=this.g.length+M.g.length,R=[],P=0;P<2*A;P++)R[P]=0;for(P=0;P<this.g.length;P++)for(var F=0;F<M.g.length;F++){var N=this.i(P)>>>16,x=this.i(P)&65535,ze=M.i(F)>>>16,ct=M.i(F)&65535;R[2*P+2*F]+=x*ct,G(R,2*P+2*F),R[2*P+2*F+1]+=N*ct,G(R,2*P+2*F+1),R[2*P+2*F+1]+=x*ze,G(R,2*P+2*F+1),R[2*P+2*F+2]+=N*ze,G(R,2*P+2*F+2)}for(P=0;P<A;P++)R[P]=R[2*P+1]<<16|R[2*P];for(P=A;P<2*A;P++)R[P]=0;return new a(R,0)};function G(M,A){for(;(M[A]&65535)!=M[A];)M[A+1]+=M[A]>>>16,M[A]&=65535,A++}function Y(M,A){this.g=M,this.h=A}function K(M,A){if(E(A))throw Error("division by zero");if(E(M))return new Y(p,p);if(C(M))return A=K(I(M),A),new Y(I(A.g),I(A.h));if(C(A))return A=K(M,I(A)),new Y(I(A.g),A.h);if(30<M.g.length){if(C(M)||C(A))throw Error("slowDivide_ only works with positive integers.");for(var R=m,P=A;0>=P.l(M);)R=ee(R),P=ee(P);var F=ae(R,1),N=ae(P,1);for(P=ae(P,2),R=ae(R,2);!E(P);){var x=N.add(P);0>=x.l(M)&&(F=F.add(R),N=x),P=ae(P,1),R=ae(R,1)}return A=B(M,F.j(A)),new Y(F,A)}for(F=p;0<=M.l(A);){for(R=Math.max(1,Math.floor(M.m()/A.m())),P=Math.ceil(Math.log(R)/Math.LN2),P=48>=P?1:Math.pow(2,P-48),N=u(R),x=N.j(A);C(x)||0<x.l(M);)R-=P,N=u(R),x=N.j(A);E(N)&&(N=m),F=F.add(N),M=B(M,x)}return new Y(F,M)}s.A=function(M){return K(this,M).h},s.and=function(M){for(var A=Math.max(this.g.length,M.g.length),R=[],P=0;P<A;P++)R[P]=this.i(P)&M.i(P);return new a(R,this.h&M.h)},s.or=function(M){for(var A=Math.max(this.g.length,M.g.length),R=[],P=0;P<A;P++)R[P]=this.i(P)|M.i(P);return new a(R,this.h|M.h)},s.xor=function(M){for(var A=Math.max(this.g.length,M.g.length),R=[],P=0;P<A;P++)R[P]=this.i(P)^M.i(P);return new a(R,this.h^M.h)};function ee(M){for(var A=M.g.length+1,R=[],P=0;P<A;P++)R[P]=M.i(P)<<1|M.i(P-1)>>>31;return new a(R,M.h)}function ae(M,A){var R=A>>5;A%=32;for(var P=M.g.length-R,F=[],N=0;N<P;N++)F[N]=0<A?M.i(N+R)>>>A|M.i(N+R+1)<<32-A:M.i(N+R);return new a(F,M.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Sh=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=d,Vn=a}).apply(typeof Iu<"u"?Iu:typeof self<"u"?self:typeof window<"u"?window:{});var Sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Th,ms,Ih,Pr,Fo,Ah,Dh,Rh;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,h,y){return c==Array.prototype||c==Object.prototype||(c[h]=y.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Sr=="object"&&Sr];for(var h=0;h<c.length;++h){var y=c[h];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var n=t(this);function i(c,h){if(h)e:{var y=n;c=c.split(".");for(var k=0;k<c.length-1;k++){var O=c[k];if(!(O in y))break e;y=y[O]}c=c[c.length-1],k=y[c],h=h(k),h!=k&&h!=null&&e(y,c,{configurable:!0,writable:!0,value:h})}}function r(c,h){c instanceof String&&(c+="");var y=0,k=!1,O={next:function(){if(!k&&y<c.length){var U=y++;return{value:h(U,c[U]),done:!1}}return k=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}i("Array.prototype.values",function(c){return c||function(){return r(this,function(h,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function l(c){var h=typeof c;return h=h!="object"?h:c?Array.isArray(c)?"array":h:"null",h=="array"||h=="object"&&typeof c.length=="number"}function u(c){var h=typeof c;return h=="object"&&c!=null||h=="function"}function d(c,h,y){return c.call.apply(c.bind,arguments)}function p(c,h,y){if(!c)throw Error();if(2<arguments.length){var k=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,k),c.apply(h,O)}}return function(){return c.apply(h,arguments)}}function m(c,h,y){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function w(c,h){var y=Array.prototype.slice.call(arguments,1);return function(){var k=y.slice();return k.push.apply(k,arguments),c.apply(this,k)}}function E(c,h){function y(){}y.prototype=h.prototype,c.aa=h.prototype,c.prototype=new y,c.prototype.constructor=c,c.Qb=function(k,O,U){for(var J=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)J[Ce-2]=arguments[Ce];return h.prototype[O].apply(k,J)}}function C(c){const h=c.length;if(0<h){const y=Array(h);for(let k=0;k<h;k++)y[k]=c[k];return y}return[]}function I(c,h){for(let y=1;y<arguments.length;y++){const k=arguments[y];if(l(k)){const O=c.length||0,U=k.length||0;c.length=O+U;for(let J=0;J<U;J++)c[O+J]=k[J]}else c.push(k)}}class B{constructor(h,y){this.i=h,this.j=y,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function G(c){return/^[\s\xa0]*$/.test(c)}function Y(){var c=o.navigator;return c&&(c=c.userAgent)?c:""}function K(c){return K[" "](c),c}K[" "]=function(){};var ee=Y().indexOf("Gecko")!=-1&&!(Y().toLowerCase().indexOf("webkit")!=-1&&Y().indexOf("Edge")==-1)&&!(Y().indexOf("Trident")!=-1||Y().indexOf("MSIE")!=-1)&&Y().indexOf("Edge")==-1;function ae(c,h,y){for(const k in c)h.call(y,c[k],k,c)}function M(c,h){for(const y in c)h.call(void 0,c[y],y,c)}function A(c){const h={};for(const y in c)h[y]=c[y];return h}const R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(c,h){let y,k;for(let O=1;O<arguments.length;O++){k=arguments[O];for(y in k)c[y]=k[y];for(let U=0;U<R.length;U++)y=R[U],Object.prototype.hasOwnProperty.call(k,y)&&(c[y]=k[y])}}function F(c){var h=1;c=c.split(":");const y=[];for(;0<h&&c.length;)y.push(c.shift()),h--;return c.length&&y.push(c.join(":")),y}function N(c){o.setTimeout(()=>{throw c},0)}function x(){var c=Se;let h=null;return c.g&&(h=c.g,c.g=c.g.next,c.g||(c.h=null),h.next=null),h}class ze{constructor(){this.h=this.g=null}add(h,y){const k=ct.get();k.set(h,y),this.h?this.h.next=k:this.g=k,this.h=k}}var ct=new B(()=>new Pt,c=>c.reset());class Pt{constructor(){this.next=this.g=this.h=null}set(h,y){this.h=h,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let ut,vt=!1,Se=new ze,dt=()=>{const c=o.Promise.resolve(void 0);ut=()=>{c.then(oe)}};var oe=()=>{for(var c;c=x();){try{c.h.call(c.g)}catch(y){N(y)}var h=ct;h.j(c),100>h.h&&(h.h++,c.next=h.g,h.g=c)}vt=!1};function ie(){this.s=this.s,this.C=this.C}ie.prototype.s=!1,ie.prototype.ma=function(){this.s||(this.s=!0,this.N())},ie.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function De(c,h){this.type=c,this.g=this.target=h,this.defaultPrevented=!1}De.prototype.h=function(){this.defaultPrevented=!0};var Ot=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,h=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const y=()=>{};o.addEventListener("test",y,h),o.removeEventListener("test",y,h)}catch{}return c}();function tt(c,h){if(De.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var y=this.type=c.type,k=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=h,h=c.relatedTarget){if(ee){e:{try{K(h.nodeName);var O=!0;break e}catch{}O=!1}O||(h=null)}}else y=="mouseover"?h=c.fromElement:y=="mouseout"&&(h=c.toElement);this.relatedTarget=h,k?(this.clientX=k.clientX!==void 0?k.clientX:k.pageX,this.clientY=k.clientY!==void 0?k.clientY:k.pageY,this.screenX=k.screenX||0,this.screenY=k.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:wt[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&tt.aa.h.call(this)}}E(tt,De);var wt={2:"touch",3:"pen",4:"mouse"};tt.prototype.h=function(){tt.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ze="closure_listenable_"+(1e6*Math.random()|0),Xe=0;function Vt(c,h,y,k,O){this.listener=c,this.proxy=null,this.src=h,this.type=y,this.capture=!!k,this.ha=O,this.key=++Xe,this.da=this.fa=!1}function bt(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function ue(c){this.src=c,this.g={},this.h=0}ue.prototype.add=function(c,h,y,k,O){var U=c.toString();c=this.g[U],c||(c=this.g[U]=[],this.h++);var J=He(c,h,k,O);return-1<J?(h=c[J],y||(h.fa=!1)):(h=new Vt(h,this.src,U,!!k,O),h.fa=y,c.push(h)),h};function At(c,h){var y=h.type;if(y in c.g){var k=c.g[y],O=Array.prototype.indexOf.call(k,h,void 0),U;(U=0<=O)&&Array.prototype.splice.call(k,O,1),U&&(bt(h),c.g[y].length==0&&(delete c.g[y],c.h--))}}function He(c,h,y,k){for(var O=0;O<c.length;++O){var U=c[O];if(!U.da&&U.listener==h&&U.capture==!!y&&U.ha==k)return O}return-1}var Dt="closure_lm_"+(1e6*Math.random()|0),Zn={};function S(c,h,y,k,O){if(Array.isArray(h)){for(var U=0;U<h.length;U++)S(c,h[U],y,k,O);return null}return y=fe(y),c&&c[Ze]?c.K(h,y,u(k)?!!k.capture:!1,O):_(c,h,y,!1,k,O)}function _(c,h,y,k,O,U){if(!h)throw Error("Invalid event type");var J=u(O)?!!O.capture:!!O,Ce=de(c);if(Ce||(c[Dt]=Ce=new ue(c)),y=Ce.add(h,y,k,J,U),y.proxy)return y;if(k=v(),y.proxy=k,k.src=c,k.listener=y,c.addEventListener)Ot||(O=J),O===void 0&&(O=!1),c.addEventListener(h.toString(),k,O);else if(c.attachEvent)c.attachEvent(q(h.toString()),k);else if(c.addListener&&c.removeListener)c.addListener(k);else throw Error("addEventListener and attachEvent are unavailable.");return y}function v(){function c(y){return h.call(c.src,c.listener,y)}const h=j;return c}function D(c,h,y,k,O){if(Array.isArray(h))for(var U=0;U<h.length;U++)D(c,h[U],y,k,O);else k=u(k)?!!k.capture:!!k,y=fe(y),c&&c[Ze]?(c=c.i,h=String(h).toString(),h in c.g&&(U=c.g[h],y=He(U,y,k,O),-1<y&&(bt(U[y]),Array.prototype.splice.call(U,y,1),U.length==0&&(delete c.g[h],c.h--)))):c&&(c=de(c))&&(h=c.g[h.toString()],c=-1,h&&(c=He(h,y,k,O)),(y=-1<c?h[c]:null)&&$(y))}function $(c){if(typeof c!="number"&&c&&!c.da){var h=c.src;if(h&&h[Ze])At(h.i,c);else{var y=c.type,k=c.proxy;h.removeEventListener?h.removeEventListener(y,k,c.capture):h.detachEvent?h.detachEvent(q(y),k):h.addListener&&h.removeListener&&h.removeListener(k),(y=de(h))?(At(y,c),y.h==0&&(y.src=null,h[Dt]=null)):bt(c)}}}function q(c){return c in Zn?Zn[c]:Zn[c]="on"+c}function j(c,h){if(c.da)c=!0;else{h=new tt(h,this);var y=c.listener,k=c.ha||c.src;c.fa&&$(c),c=y.call(k,h)}return c}function de(c){return c=c[Dt],c instanceof ue?c:null}var be="__closure_events_fn_"+(1e9*Math.random()>>>0);function fe(c){return typeof c=="function"?c:(c[be]||(c[be]=function(h){return c.handleEvent(h)}),c[be])}function ye(){ie.call(this),this.i=new ue(this),this.M=this,this.F=null}E(ye,ie),ye.prototype[Ze]=!0,ye.prototype.removeEventListener=function(c,h,y,k){D(this,c,h,y,k)};function b(c,h){var y,k=c.F;if(k)for(y=[];k;k=k.F)y.push(k);if(c=c.M,k=h.type||h,typeof h=="string")h=new De(h,c);else if(h instanceof De)h.target=h.target||c;else{var O=h;h=new De(k,c),P(h,O)}if(O=!0,y)for(var U=y.length-1;0<=U;U--){var J=h.g=y[U];O=f(J,k,!0,h)&&O}if(J=h.g=c,O=f(J,k,!0,h)&&O,O=f(J,k,!1,h)&&O,y)for(U=0;U<y.length;U++)J=h.g=y[U],O=f(J,k,!1,h)&&O}ye.prototype.N=function(){if(ye.aa.N.call(this),this.i){var c=this.i,h;for(h in c.g){for(var y=c.g[h],k=0;k<y.length;k++)bt(y[k]);delete c.g[h],c.h--}}this.F=null},ye.prototype.K=function(c,h,y,k){return this.i.add(String(c),h,!1,y,k)},ye.prototype.L=function(c,h,y,k){return this.i.add(String(c),h,!0,y,k)};function f(c,h,y,k){if(h=c.i.g[String(h)],!h)return!0;h=h.concat();for(var O=!0,U=0;U<h.length;++U){var J=h[U];if(J&&!J.da&&J.capture==y){var Ce=J.listener,nt=J.ha||J.src;J.fa&&At(c.i,J),O=Ce.call(nt,k)!==!1&&O}}return O&&!k.defaultPrevented}function g(c,h,y){if(typeof c=="function")y&&(c=m(c,y));else if(c&&typeof c.handleEvent=="function")c=m(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:o.setTimeout(c,h||0)}function T(c){c.g=g(()=>{c.g=null,c.i&&(c.i=!1,T(c))},c.l);const h=c.h;c.h=null,c.m.apply(null,h)}class L extends ie{constructor(h,y){super(),this.m=h,this.l=y,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:T(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function V(c){ie.call(this),this.h=c,this.g={}}E(V,ie);var z=[];function he(c){ae(c.g,function(h,y){this.g.hasOwnProperty(y)&&$(h)},c),c.g={}}V.prototype.N=function(){V.aa.N.call(this),he(this)},V.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Pe=o.JSON.stringify,Me=o.JSON.parse,$e=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function Te(){}Te.prototype.h=null;function uc(c){return c.h||(c.h=c.i())}function dc(){}var Xi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ja(){De.call(this,"d")}E(ja,De);function Ga(){De.call(this,"c")}E(Ga,De);var Xn={},hc=null;function sr(){return hc=hc||new ye}Xn.La="serverreachability";function fc(c){De.call(this,Xn.La,c)}E(fc,De);function es(c){const h=sr();b(h,new fc(h))}Xn.STAT_EVENT="statevent";function pc(c,h){De.call(this,Xn.STAT_EVENT,c),this.stat=h}E(pc,De);function kt(c){const h=sr();b(h,new pc(h,c))}Xn.Ma="timingevent";function gc(c,h){De.call(this,Xn.Ma,c),this.size=h}E(gc,De);function ts(c,h){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},h)}function ns(){this.g=!0}ns.prototype.xa=function(){this.g=!1};function Bp(c,h,y,k,O,U){c.info(function(){if(c.g)if(U)for(var J="",Ce=U.split("&"),nt=0;nt<Ce.length;nt++){var Ee=Ce[nt].split("=");if(1<Ee.length){var ht=Ee[0];Ee=Ee[1];var ft=ht.split("_");J=2<=ft.length&&ft[1]=="type"?J+(ht+"="+Ee+"&"):J+(ht+"=redacted&")}}else J=null;else J=U;return"XMLHTTP REQ ("+k+") [attempt "+O+"]: "+h+`
`+y+`
`+J})}function Wp(c,h,y,k,O,U,J){c.info(function(){return"XMLHTTP RESP ("+k+") [ attempt "+O+"]: "+h+`
`+y+`
`+U+" "+J})}function ki(c,h,y,k){c.info(function(){return"XMLHTTP TEXT ("+h+"): "+Hp(c,y)+(k?" "+k:"")})}function zp(c,h){c.info(function(){return"TIMEOUT: "+h})}ns.prototype.info=function(){};function Hp(c,h){if(!c.g)return h;if(!h)return null;try{var y=JSON.parse(h);if(y){for(c=0;c<y.length;c++)if(Array.isArray(y[c])){var k=y[c];if(!(2>k.length)){var O=k[1];if(Array.isArray(O)&&!(1>O.length)){var U=O[0];if(U!="noop"&&U!="stop"&&U!="close")for(var J=1;J<O.length;J++)O[J]=""}}}}return Pe(y)}catch{return h}}var rr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},mc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ka;function ar(){}E(ar,Te),ar.prototype.g=function(){return new XMLHttpRequest},ar.prototype.i=function(){return{}},Ka=new ar;function Tn(c,h,y,k){this.j=c,this.i=h,this.l=y,this.R=k||1,this.U=new V(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new _c}function _c(){this.i=null,this.g="",this.h=!1}var yc={},Qa={};function Ya(c,h,y){c.L=1,c.v=ur(hn(h)),c.m=y,c.P=!0,vc(c,null)}function vc(c,h){c.F=Date.now(),or(c),c.A=hn(c.v);var y=c.A,k=c.R;Array.isArray(k)||(k=[String(k)]),Mc(y.i,"t",k),c.C=0,y=c.j.J,c.h=new _c,c.g=Jc(c.j,y?h:null,!c.m),0<c.O&&(c.M=new L(m(c.Y,c,c.g),c.O)),h=c.U,y=c.g,k=c.ca;var O="readystatechange";Array.isArray(O)||(O&&(z[0]=O.toString()),O=z);for(var U=0;U<O.length;U++){var J=S(y,O[U],k||h.handleEvent,!1,h.h||h);if(!J)break;h.g[J.key]=J}h=c.H?A(c.H):{},c.m?(c.u||(c.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,h)):(c.u="GET",c.g.ea(c.A,c.u,null,h)),es(),Bp(c.i,c.u,c.A,c.l,c.R,c.m)}Tn.prototype.ca=function(c){c=c.target;const h=this.M;h&&fn(c)==3?h.j():this.Y(c)},Tn.prototype.Y=function(c){try{if(c==this.g)e:{const ft=fn(this.g);var h=this.g.Ba();const Ti=this.g.Z();if(!(3>ft)&&(ft!=3||this.g&&(this.h.h||this.g.oa()||Uc(this.g)))){this.J||ft!=4||h==7||(h==8||0>=Ti?es(3):es(2)),Ja(this);var y=this.g.Z();this.X=y;t:if(wc(this)){var k=Uc(this.g);c="";var O=k.length,U=fn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ei(this),is(this);var J="";break t}this.h.i=new o.TextDecoder}for(h=0;h<O;h++)this.h.h=!0,c+=this.h.i.decode(k[h],{stream:!(U&&h==O-1)});k.length=0,this.h.g+=c,this.C=0,J=this.h.g}else J=this.g.oa();if(this.o=y==200,Wp(this.i,this.u,this.A,this.l,this.R,ft,y),this.o){if(this.T&&!this.K){t:{if(this.g){var Ce,nt=this.g;if((Ce=nt.g?nt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(Ce)){var Ee=Ce;break t}}Ee=null}if(y=Ee)ki(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Za(this,y);else{this.o=!1,this.s=3,kt(12),ei(this),is(this);break e}}if(this.P){y=!0;let Ut;for(;!this.J&&this.C<J.length;)if(Ut=qp(this,J),Ut==Qa){ft==4&&(this.s=4,kt(14),y=!1),ki(this.i,this.l,null,"[Incomplete Response]");break}else if(Ut==yc){this.s=4,kt(15),ki(this.i,this.l,J,"[Invalid Chunk]"),y=!1;break}else ki(this.i,this.l,Ut,null),Za(this,Ut);if(wc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ft!=4||J.length!=0||this.h.h||(this.s=1,kt(16),y=!1),this.o=this.o&&y,!y)ki(this.i,this.l,J,"[Invalid Chunked Response]"),ei(this),is(this);else if(0<J.length&&!this.W){this.W=!0;var ht=this.j;ht.g==this&&ht.ba&&!ht.M&&(ht.j.info("Great, no buffering proxy detected. Bytes received: "+J.length),so(ht),ht.M=!0,kt(11))}}else ki(this.i,this.l,J,null),Za(this,J);ft==4&&ei(this),this.o&&!this.J&&(ft==4?Gc(this.j,this):(this.o=!1,or(this)))}else lg(this.g),y==400&&0<J.indexOf("Unknown SID")?(this.s=3,kt(12)):(this.s=0,kt(13)),ei(this),is(this)}}}catch{}finally{}};function wc(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function qp(c,h){var y=c.C,k=h.indexOf(`
`,y);return k==-1?Qa:(y=Number(h.substring(y,k)),isNaN(y)?yc:(k+=1,k+y>h.length?Qa:(h=h.slice(k,k+y),c.C=k+y,h)))}Tn.prototype.cancel=function(){this.J=!0,ei(this)};function or(c){c.S=Date.now()+c.I,bc(c,c.I)}function bc(c,h){if(c.B!=null)throw Error("WatchDog timer not null");c.B=ts(m(c.ba,c),h)}function Ja(c){c.B&&(o.clearTimeout(c.B),c.B=null)}Tn.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(zp(this.i,this.A),this.L!=2&&(es(),kt(17)),ei(this),this.s=2,is(this)):bc(this,this.S-c)};function is(c){c.j.G==0||c.J||Gc(c.j,c)}function ei(c){Ja(c);var h=c.M;h&&typeof h.ma=="function"&&h.ma(),c.M=null,he(c.U),c.g&&(h=c.g,c.g=null,h.abort(),h.ma())}function Za(c,h){try{var y=c.j;if(y.G!=0&&(y.g==c||Xa(y.h,c))){if(!c.K&&Xa(y.h,c)&&y.G==3){try{var k=y.Da.g.parse(h)}catch{k=null}if(Array.isArray(k)&&k.length==3){var O=k;if(O[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<c.F)mr(y),pr(y);else break e;io(y),kt(18)}}else y.za=O[1],0<y.za-y.T&&37500>O[2]&&y.F&&y.v==0&&!y.C&&(y.C=ts(m(y.Za,y),6e3));if(1>=Sc(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else ni(y,11)}else if((c.K||y.g==c)&&mr(y),!G(h))for(O=y.Da.g.parse(h),h=0;h<O.length;h++){let Ee=O[h];if(y.T=Ee[0],Ee=Ee[1],y.G==2)if(Ee[0]=="c"){y.K=Ee[1],y.ia=Ee[2];const ht=Ee[3];ht!=null&&(y.la=ht,y.j.info("VER="+y.la));const ft=Ee[4];ft!=null&&(y.Aa=ft,y.j.info("SVER="+y.Aa));const Ti=Ee[5];Ti!=null&&typeof Ti=="number"&&0<Ti&&(k=1.5*Ti,y.L=k,y.j.info("backChannelRequestTimeoutMs_="+k)),k=y;const Ut=c.g;if(Ut){const yr=Ut.g?Ut.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yr){var U=k.h;U.g||yr.indexOf("spdy")==-1&&yr.indexOf("quic")==-1&&yr.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(eo(U,U.h),U.h=null))}if(k.D){const ro=Ut.g?Ut.g.getResponseHeader("X-HTTP-Session-Id"):null;ro&&(k.ya=ro,Ne(k.I,k.D,ro))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-c.F,y.j.info("Handshake RTT: "+y.R+"ms")),k=y;var J=c;if(k.qa=Yc(k,k.J?k.ia:null,k.W),J.K){Tc(k.h,J);var Ce=J,nt=k.L;nt&&(Ce.I=nt),Ce.B&&(Ja(Ce),or(Ce)),k.g=J}else qc(k);0<y.i.length&&gr(y)}else Ee[0]!="stop"&&Ee[0]!="close"||ni(y,7);else y.G==3&&(Ee[0]=="stop"||Ee[0]=="close"?Ee[0]=="stop"?ni(y,7):no(y):Ee[0]!="noop"&&y.l&&y.l.ta(Ee),y.v=0)}}es(4)}catch{}}var jp=class{constructor(c,h){this.g=c,this.map=h}};function kc(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ec(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Sc(c){return c.h?1:c.g?c.g.size:0}function Xa(c,h){return c.h?c.h==h:c.g?c.g.has(h):!1}function eo(c,h){c.g?c.g.add(h):c.h=h}function Tc(c,h){c.h&&c.h==h?c.h=null:c.g&&c.g.has(h)&&c.g.delete(h)}kc.prototype.cancel=function(){if(this.i=Ic(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Ic(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let h=c.i;for(const y of c.g.values())h=h.concat(y.D);return h}return C(c.i)}function Gp(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var h=[],y=c.length,k=0;k<y;k++)h.push(c[k]);return h}h=[],y=0;for(k in c)h[y++]=c[k];return h}function Kp(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var h=[];c=c.length;for(var y=0;y<c;y++)h.push(y);return h}h=[],y=0;for(const k in c)h[y++]=k;return h}}}function Ac(c,h){if(c.forEach&&typeof c.forEach=="function")c.forEach(h,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,h,void 0);else for(var y=Kp(c),k=Gp(c),O=k.length,U=0;U<O;U++)h.call(void 0,k[U],y&&y[U],c)}var Dc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qp(c,h){if(c){c=c.split("&");for(var y=0;y<c.length;y++){var k=c[y].indexOf("="),O=null;if(0<=k){var U=c[y].substring(0,k);O=c[y].substring(k+1)}else U=c[y];h(U,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function ti(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof ti){this.h=c.h,lr(this,c.j),this.o=c.o,this.g=c.g,cr(this,c.s),this.l=c.l;var h=c.i,y=new as;y.i=h.i,h.g&&(y.g=new Map(h.g),y.h=h.h),Rc(this,y),this.m=c.m}else c&&(h=String(c).match(Dc))?(this.h=!1,lr(this,h[1]||"",!0),this.o=ss(h[2]||""),this.g=ss(h[3]||"",!0),cr(this,h[4]),this.l=ss(h[5]||"",!0),Rc(this,h[6]||"",!0),this.m=ss(h[7]||"")):(this.h=!1,this.i=new as(null,this.h))}ti.prototype.toString=function(){var c=[],h=this.j;h&&c.push(rs(h,Cc,!0),":");var y=this.g;return(y||h=="file")&&(c.push("//"),(h=this.o)&&c.push(rs(h,Cc,!0),"@"),c.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&c.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&c.push("/"),c.push(rs(y,y.charAt(0)=="/"?Zp:Jp,!0))),(y=this.i.toString())&&c.push("?",y),(y=this.m)&&c.push("#",rs(y,eg)),c.join("")};function hn(c){return new ti(c)}function lr(c,h,y){c.j=y?ss(h,!0):h,c.j&&(c.j=c.j.replace(/:$/,""))}function cr(c,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);c.s=h}else c.s=null}function Rc(c,h,y){h instanceof as?(c.i=h,tg(c.i,c.h)):(y||(h=rs(h,Xp)),c.i=new as(h,c.h))}function Ne(c,h,y){c.i.set(h,y)}function ur(c){return Ne(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function ss(c,h){return c?h?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function rs(c,h,y){return typeof c=="string"?(c=encodeURI(c).replace(h,Yp),y&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function Yp(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Cc=/[#\/\?@]/g,Jp=/[#\?:]/g,Zp=/[#\?]/g,Xp=/[#\?@]/g,eg=/#/g;function as(c,h){this.h=this.g=null,this.i=c||null,this.j=!!h}function In(c){c.g||(c.g=new Map,c.h=0,c.i&&Qp(c.i,function(h,y){c.add(decodeURIComponent(h.replace(/\+/g," ")),y)}))}s=as.prototype,s.add=function(c,h){In(this),this.i=null,c=Ei(this,c);var y=this.g.get(c);return y||this.g.set(c,y=[]),y.push(h),this.h+=1,this};function xc(c,h){In(c),h=Ei(c,h),c.g.has(h)&&(c.i=null,c.h-=c.g.get(h).length,c.g.delete(h))}function Pc(c,h){return In(c),h=Ei(c,h),c.g.has(h)}s.forEach=function(c,h){In(this),this.g.forEach(function(y,k){y.forEach(function(O){c.call(h,O,k,this)},this)},this)},s.na=function(){In(this);const c=Array.from(this.g.values()),h=Array.from(this.g.keys()),y=[];for(let k=0;k<h.length;k++){const O=c[k];for(let U=0;U<O.length;U++)y.push(h[k])}return y},s.V=function(c){In(this);let h=[];if(typeof c=="string")Pc(this,c)&&(h=h.concat(this.g.get(Ei(this,c))));else{c=Array.from(this.g.values());for(let y=0;y<c.length;y++)h=h.concat(c[y])}return h},s.set=function(c,h){return In(this),this.i=null,c=Ei(this,c),Pc(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[h]),this.h+=1,this},s.get=function(c,h){return c?(c=this.V(c),0<c.length?String(c[0]):h):h};function Mc(c,h,y){xc(c,h),0<y.length&&(c.i=null,c.g.set(Ei(c,h),C(y)),c.h+=y.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],h=Array.from(this.g.keys());for(var y=0;y<h.length;y++){var k=h[y];const U=encodeURIComponent(String(k)),J=this.V(k);for(k=0;k<J.length;k++){var O=U;J[k]!==""&&(O+="="+encodeURIComponent(String(J[k]))),c.push(O)}}return this.i=c.join("&")};function Ei(c,h){return h=String(h),c.j&&(h=h.toLowerCase()),h}function tg(c,h){h&&!c.j&&(In(c),c.i=null,c.g.forEach(function(y,k){var O=k.toLowerCase();k!=O&&(xc(this,k),Mc(this,O,y))},c)),c.j=h}function ng(c,h){const y=new ns;if(o.Image){const k=new Image;k.onload=w(An,y,"TestLoadImage: loaded",!0,h,k),k.onerror=w(An,y,"TestLoadImage: error",!1,h,k),k.onabort=w(An,y,"TestLoadImage: abort",!1,h,k),k.ontimeout=w(An,y,"TestLoadImage: timeout",!1,h,k),o.setTimeout(function(){k.ontimeout&&k.ontimeout()},1e4),k.src=c}else h(!1)}function ig(c,h){const y=new ns,k=new AbortController,O=setTimeout(()=>{k.abort(),An(y,"TestPingServer: timeout",!1,h)},1e4);fetch(c,{signal:k.signal}).then(U=>{clearTimeout(O),U.ok?An(y,"TestPingServer: ok",!0,h):An(y,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(O),An(y,"TestPingServer: error",!1,h)})}function An(c,h,y,k,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),k(y)}catch{}}function sg(){this.g=new $e}function rg(c,h,y){const k=y||"";try{Ac(c,function(O,U){let J=O;u(O)&&(J=Pe(O)),h.push(k+U+"="+encodeURIComponent(J))})}catch(O){throw h.push(k+"type="+encodeURIComponent("_badmap")),O}}function dr(c){this.l=c.Ub||null,this.j=c.eb||!1}E(dr,Te),dr.prototype.g=function(){return new hr(this.l,this.j)},dr.prototype.i=function(c){return function(){return c}}({});function hr(c,h){ye.call(this),this.D=c,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}E(hr,ye),s=hr.prototype,s.open=function(c,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=h,this.readyState=1,ls(this)},s.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(h.body=c),(this.D||o).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,os(this)),this.readyState=0},s.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,ls(this)),this.g&&(this.readyState=3,ls(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lc(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function Lc(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}s.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var h=c.value?c.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!c.done}))&&(this.response=this.responseText+=h)}c.done?os(this):ls(this),this.readyState==3&&Lc(this)}},s.Ra=function(c){this.g&&(this.response=this.responseText=c,os(this))},s.Qa=function(c){this.g&&(this.response=c,os(this))},s.ga=function(){this.g&&os(this)};function os(c){c.readyState=4,c.l=null,c.j=null,c.v=null,ls(c)}s.setRequestHeader=function(c,h){this.u.append(c,h)},s.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],h=this.h.entries();for(var y=h.next();!y.done;)y=y.value,c.push(y[0]+": "+y[1]),y=h.next();return c.join(`\r
`)};function ls(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(hr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Fc(c){let h="";return ae(c,function(y,k){h+=k,h+=":",h+=y,h+=`\r
`}),h}function to(c,h,y){e:{for(k in y){var k=!1;break e}k=!0}k||(y=Fc(y),typeof c=="string"?y!=null&&encodeURIComponent(String(y)):Ne(c,h,y))}function Ue(c){ye.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}E(Ue,ye);var ag=/^https?$/i,og=["POST","PUT"];s=Ue.prototype,s.Ha=function(c){this.J=c},s.ea=function(c,h,y,k){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);h=h?h.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ka.g(),this.v=this.o?uc(this.o):uc(Ka),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(c),!0),this.B=!1}catch(U){Nc(this,U);return}if(c=y||"",y=new Map(this.headers),k)if(Object.getPrototypeOf(k)===Object.prototype)for(var O in k)y.set(O,k[O]);else if(typeof k.keys=="function"&&typeof k.get=="function")for(const U of k.keys())y.set(U,k.get(U));else throw Error("Unknown input type for opt_headers: "+String(k));k=Array.from(y.keys()).find(U=>U.toLowerCase()=="content-type"),O=o.FormData&&c instanceof o.FormData,!(0<=Array.prototype.indexOf.call(og,h,void 0))||k||O||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,J]of y)this.g.setRequestHeader(U,J);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Vc(this),this.u=!0,this.g.send(c),this.u=!1}catch(U){Nc(this,U)}};function Nc(c,h){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=h,c.m=5,$c(c),fr(c)}function $c(c){c.A||(c.A=!0,b(c,"complete"),b(c,"error"))}s.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,b(this,"complete"),b(this,"abort"),fr(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fr(this,!0)),Ue.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Oc(this):this.bb())},s.bb=function(){Oc(this)};function Oc(c){if(c.h&&typeof a<"u"&&(!c.v[1]||fn(c)!=4||c.Z()!=2)){if(c.u&&fn(c)==4)g(c.Ea,0,c);else if(b(c,"readystatechange"),fn(c)==4){c.h=!1;try{const J=c.Z();e:switch(J){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var y;if(!(y=h)){var k;if(k=J===0){var O=String(c.D).match(Dc)[1]||null;!O&&o.self&&o.self.location&&(O=o.self.location.protocol.slice(0,-1)),k=!ag.test(O?O.toLowerCase():"")}y=k}if(y)b(c,"complete"),b(c,"success");else{c.m=6;try{var U=2<fn(c)?c.g.statusText:""}catch{U=""}c.l=U+" ["+c.Z()+"]",$c(c)}}finally{fr(c)}}}}function fr(c,h){if(c.g){Vc(c);const y=c.g,k=c.v[0]?()=>{}:null;c.g=null,c.v=null,h||b(c,"ready");try{y.onreadystatechange=k}catch{}}}function Vc(c){c.I&&(o.clearTimeout(c.I),c.I=null)}s.isActive=function(){return!!this.g};function fn(c){return c.g?c.g.readyState:0}s.Z=function(){try{return 2<fn(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(c){if(this.g){var h=this.g.responseText;return c&&h.indexOf(c)==0&&(h=h.substring(c.length)),Me(h)}};function Uc(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function lg(c){const h={};c=(c.g&&2<=fn(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let k=0;k<c.length;k++){if(G(c[k]))continue;var y=F(c[k]);const O=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const U=h[O]||[];h[O]=U,U.push(y)}M(h,function(k){return k.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function cs(c,h,y){return y&&y.internalChannelParams&&y.internalChannelParams[c]||h}function Bc(c){this.Aa=0,this.i=[],this.j=new ns,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=cs("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=cs("baseRetryDelayMs",5e3,c),this.cb=cs("retryDelaySeedMs",1e4,c),this.Wa=cs("forwardChannelMaxRetries",2,c),this.wa=cs("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new kc(c&&c.concurrentRequestLimit),this.Da=new sg,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=Bc.prototype,s.la=8,s.G=1,s.connect=function(c,h,y,k){kt(0),this.W=c,this.H=h||{},y&&k!==void 0&&(this.H.OSID=y,this.H.OAID=k),this.F=this.X,this.I=Yc(this,null,this.W),gr(this)};function no(c){if(Wc(c),c.G==3){var h=c.U++,y=hn(c.I);if(Ne(y,"SID",c.K),Ne(y,"RID",h),Ne(y,"TYPE","terminate"),us(c,y),h=new Tn(c,c.j,h),h.L=2,h.v=ur(hn(y)),y=!1,o.navigator&&o.navigator.sendBeacon)try{y=o.navigator.sendBeacon(h.v.toString(),"")}catch{}!y&&o.Image&&(new Image().src=h.v,y=!0),y||(h.g=Jc(h.j,null),h.g.ea(h.v)),h.F=Date.now(),or(h)}Qc(c)}function pr(c){c.g&&(so(c),c.g.cancel(),c.g=null)}function Wc(c){pr(c),c.u&&(o.clearTimeout(c.u),c.u=null),mr(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&o.clearTimeout(c.s),c.s=null)}function gr(c){if(!Ec(c.h)&&!c.s){c.s=!0;var h=c.Ga;ut||dt(),vt||(ut(),vt=!0),Se.add(h,c),c.B=0}}function cg(c,h){return Sc(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=h.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=ts(m(c.Ga,c,h),Kc(c,c.B)),c.B++,!0)}s.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const O=new Tn(this,this.j,c);let U=this.o;if(this.S&&(U?(U=A(U),P(U,this.S)):U=this.S),this.m!==null||this.O||(O.H=U,U=null),this.P)e:{for(var h=0,y=0;y<this.i.length;y++){t:{var k=this.i[y];if("__data__"in k.map&&(k=k.map.__data__,typeof k=="string")){k=k.length;break t}k=void 0}if(k===void 0)break;if(h+=k,4096<h){h=y;break e}if(h===4096||y===this.i.length-1){h=y+1;break e}}h=1e3}else h=1e3;h=Hc(this,O,h),y=hn(this.I),Ne(y,"RID",c),Ne(y,"CVER",22),this.D&&Ne(y,"X-HTTP-Session-Id",this.D),us(this,y),U&&(this.O?h="headers="+encodeURIComponent(String(Fc(U)))+"&"+h:this.m&&to(y,this.m,U)),eo(this.h,O),this.Ua&&Ne(y,"TYPE","init"),this.P?(Ne(y,"$req",h),Ne(y,"SID","null"),O.T=!0,Ya(O,y,null)):Ya(O,y,h),this.G=2}}else this.G==3&&(c?zc(this,c):this.i.length==0||Ec(this.h)||zc(this))};function zc(c,h){var y;h?y=h.l:y=c.U++;const k=hn(c.I);Ne(k,"SID",c.K),Ne(k,"RID",y),Ne(k,"AID",c.T),us(c,k),c.m&&c.o&&to(k,c.m,c.o),y=new Tn(c,c.j,y,c.B+1),c.m===null&&(y.H=c.o),h&&(c.i=h.D.concat(c.i)),h=Hc(c,y,1e3),y.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),eo(c.h,y),Ya(y,k,h)}function us(c,h){c.H&&ae(c.H,function(y,k){Ne(h,k,y)}),c.l&&Ac({},function(y,k){Ne(h,k,y)})}function Hc(c,h,y){y=Math.min(c.i.length,y);var k=c.l?m(c.l.Na,c.l,c):null;e:{var O=c.i;let U=-1;for(;;){const J=["count="+y];U==-1?0<y?(U=O[0].g,J.push("ofs="+U)):U=0:J.push("ofs="+U);let Ce=!0;for(let nt=0;nt<y;nt++){let Ee=O[nt].g;const ht=O[nt].map;if(Ee-=U,0>Ee)U=Math.max(0,O[nt].g-100),Ce=!1;else try{rg(ht,J,"req"+Ee+"_")}catch{k&&k(ht)}}if(Ce){k=J.join("&");break e}}}return c=c.i.splice(0,y),h.D=c,k}function qc(c){if(!c.g&&!c.u){c.Y=1;var h=c.Fa;ut||dt(),vt||(ut(),vt=!0),Se.add(h,c),c.v=0}}function io(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=ts(m(c.Fa,c),Kc(c,c.v)),c.v++,!0)}s.Fa=function(){if(this.u=null,jc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=ts(m(this.ab,this),c)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,kt(10),pr(this),jc(this))};function so(c){c.A!=null&&(o.clearTimeout(c.A),c.A=null)}function jc(c){c.g=new Tn(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var h=hn(c.qa);Ne(h,"RID","rpc"),Ne(h,"SID",c.K),Ne(h,"AID",c.T),Ne(h,"CI",c.F?"0":"1"),!c.F&&c.ja&&Ne(h,"TO",c.ja),Ne(h,"TYPE","xmlhttp"),us(c,h),c.m&&c.o&&to(h,c.m,c.o),c.L&&(c.g.I=c.L);var y=c.g;c=c.ia,y.L=1,y.v=ur(hn(h)),y.m=null,y.P=!0,vc(y,c)}s.Za=function(){this.C!=null&&(this.C=null,pr(this),io(this),kt(19))};function mr(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function Gc(c,h){var y=null;if(c.g==h){mr(c),so(c),c.g=null;var k=2}else if(Xa(c.h,h))y=h.D,Tc(c.h,h),k=1;else return;if(c.G!=0){if(h.o)if(k==1){y=h.m?h.m.length:0,h=Date.now()-h.F;var O=c.B;k=sr(),b(k,new gc(k,y)),gr(c)}else qc(c);else if(O=h.s,O==3||O==0&&0<h.X||!(k==1&&cg(c,h)||k==2&&io(c)))switch(y&&0<y.length&&(h=c.h,h.i=h.i.concat(y)),O){case 1:ni(c,5);break;case 4:ni(c,10);break;case 3:ni(c,6);break;default:ni(c,2)}}}function Kc(c,h){let y=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(y*=2),y*h}function ni(c,h){if(c.j.info("Error code "+h),h==2){var y=m(c.fb,c),k=c.Xa;const O=!k;k=new ti(k||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||lr(k,"https"),ur(k),O?ng(k.toString(),y):ig(k.toString(),y)}else kt(2);c.G=0,c.l&&c.l.sa(h),Qc(c),Wc(c)}s.fb=function(c){c?(this.j.info("Successfully pinged google.com"),kt(2)):(this.j.info("Failed to ping google.com"),kt(1))};function Qc(c){if(c.G=0,c.ka=[],c.l){const h=Ic(c.h);(h.length!=0||c.i.length!=0)&&(I(c.ka,h),I(c.ka,c.i),c.h.i.length=0,C(c.i),c.i.length=0),c.l.ra()}}function Yc(c,h,y){var k=y instanceof ti?hn(y):new ti(y);if(k.g!="")h&&(k.g=h+"."+k.g),cr(k,k.s);else{var O=o.location;k=O.protocol,h=h?h+"."+O.hostname:O.hostname,O=+O.port;var U=new ti(null);k&&lr(U,k),h&&(U.g=h),O&&cr(U,O),y&&(U.l=y),k=U}return y=c.D,h=c.ya,y&&h&&Ne(k,y,h),Ne(k,"VER",c.la),us(c,k),k}function Jc(c,h,y){if(h&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=c.Ca&&!c.pa?new Ue(new dr({eb:y})):new Ue(c.pa),h.Ha(c.J),h}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function Zc(){}s=Zc.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function _r(){}_r.prototype.g=function(c,h){return new Rt(c,h)};function Rt(c,h){ye.call(this),this.g=new Bc(h),this.l=c,this.h=h&&h.messageUrlParams||null,c=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(c?c["X-WebChannel-Content-Type"]=h.messageContentType:c={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(c?c["X-WebChannel-Client-Profile"]=h.va:c={"X-WebChannel-Client-Profile":h.va}),this.g.S=c,(c=h&&h.Sb)&&!G(c)&&(this.g.m=c),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!G(h)&&(this.g.D=h,c=this.h,c!==null&&h in c&&(c=this.h,h in c&&delete c[h])),this.j=new Si(this)}E(Rt,ye),Rt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Rt.prototype.close=function(){no(this.g)},Rt.prototype.o=function(c){var h=this.g;if(typeof c=="string"){var y={};y.__data__=c,c=y}else this.u&&(y={},y.__data__=Pe(c),c=y);h.i.push(new jp(h.Ya++,c)),h.G==3&&gr(h)},Rt.prototype.N=function(){this.g.l=null,delete this.j,no(this.g),delete this.g,Rt.aa.N.call(this)};function Xc(c){ja.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var h=c.__sm__;if(h){e:{for(const y in h){c=y;break e}c=void 0}(this.i=c)&&(c=this.i,h=h!==null&&c in h?h[c]:void 0),this.data=h}else this.data=c}E(Xc,ja);function eu(){Ga.call(this),this.status=1}E(eu,Ga);function Si(c){this.g=c}E(Si,Zc),Si.prototype.ua=function(){b(this.g,"a")},Si.prototype.ta=function(c){b(this.g,new Xc(c))},Si.prototype.sa=function(c){b(this.g,new eu)},Si.prototype.ra=function(){b(this.g,"b")},_r.prototype.createWebChannel=_r.prototype.g,Rt.prototype.send=Rt.prototype.o,Rt.prototype.open=Rt.prototype.m,Rt.prototype.close=Rt.prototype.close,Rh=function(){return new _r},Dh=function(){return sr()},Ah=Xn,Fo={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},rr.NO_ERROR=0,rr.TIMEOUT=8,rr.HTTP_ERROR=6,Pr=rr,mc.COMPLETE="complete",Ih=mc,dc.EventType=Xi,Xi.OPEN="a",Xi.CLOSE="b",Xi.ERROR="c",Xi.MESSAGE="d",ye.prototype.listen=ye.prototype.K,ms=dc,Ue.prototype.listenOnce=Ue.prototype.L,Ue.prototype.getLastError=Ue.prototype.Ka,Ue.prototype.getLastErrorCode=Ue.prototype.Ba,Ue.prototype.getStatus=Ue.prototype.Z,Ue.prototype.getResponseJson=Ue.prototype.Oa,Ue.prototype.getResponseText=Ue.prototype.oa,Ue.prototype.send=Ue.prototype.ea,Ue.prototype.setWithCredentials=Ue.prototype.Ha,Th=Ue}).apply(typeof Sr<"u"?Sr:typeof self<"u"?self:typeof window<"u"?window:{});const Au="@firebase/firestore",Du="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gt.UNAUTHENTICATED=new gt(null),gt.GOOGLE_CREDENTIALS=new gt("google-credentials-uid"),gt.FIRST_PARTY=new gt("first-party-uid"),gt.MOCK_USER=new gt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gi="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hi=new ll("@firebase/firestore");function Di(){return hi.logLevel}function X(s,...e){if(hi.logLevel<=ge.DEBUG){const t=e.map(dl);hi.debug(`Firestore (${Gi}): ${s}`,...t)}}function bn(s,...e){if(hi.logLevel<=ge.ERROR){const t=e.map(dl);hi.error(`Firestore (${Gi}): ${s}`,...t)}}function Vi(s,...e){if(hi.logLevel<=ge.WARN){const t=e.map(dl);hi.warn(`Firestore (${Gi}): ${s}`,...t)}}function dl(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function re(s,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,Ch(s,n,t)}function Ch(s,e,t){let n=`FIRESTORE (${Gi}) INTERNAL ASSERTION FAILED: ${e} (ID: ${s.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw bn(n),new Error(n)}function Ae(s,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,s||Ch(e,i,n)}function ce(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends un{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class V_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(gt.UNAUTHENTICATED))}shutdown(){}}class U_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class B_{constructor(e){this.t=e,this.currentUser=gt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ae(this.o===void 0,42304);let n=this.i;const i=l=>this.i!==n?(n=this.i,t(l)):Promise.resolve();let r=new yn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new yn,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const l=r;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},o=l=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new yn)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Ae(typeof n.accessToken=="string",31837,{l:n}),new xh(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ae(e===null||typeof e=="string",2055,{h:e}),new gt(e)}}class W_{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=gt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class z_{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new W_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(gt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ru{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class H_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ct(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Ae(this.o===void 0,3512);const n=r=>{r.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const a=r.token!==this.m;return this.m=r.token,X("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>n(r))};const i=r=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(r=>i(r)),setTimeout(()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?i(r):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ru(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ae(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ru(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q_(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=q_(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%62))}return n}}function me(s,e){return s<e?-1:s>e?1:0}function No(s,e){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++){const i=s.charAt(n),r=e.charAt(n);if(i!==r)return yo(i)===yo(r)?me(i,r):yo(i)?1:-1}return me(s.length,e.length)}const j_=55296,G_=57343;function yo(s){const e=s.charCodeAt(0);return e>=j_&&e<=G_}function Ui(s,e,t){return s.length===e.length&&s.every((n,i)=>t(n,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cu="__name__";class Kt{constructor(e,t,n){t===void 0?t=0:t>e.length&&re(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&re(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Kt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Kt?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const r=Kt.compareSegments(e.get(i),t.get(i));if(r!==0)return r}return me(e.length,t.length)}static compareSegments(e,t){const n=Kt.isNumericId(e),i=Kt.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?Kt.extractNumericId(e).compare(Kt.extractNumericId(t)):No(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vn.fromString(e.substring(4,e.length-2))}}class Fe extends Kt{construct(e,t,n){return new Fe(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Z(W.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new Fe(t)}static emptyPath(){return new Fe([])}}const K_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class at extends Kt{construct(e,t,n){return new at(e,t,n)}static isValidIdentifier(e){return K_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),at.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Cu}static keyField(){return new at([Cu])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(n.length===0)throw new Z(W.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const o=e[i];if(o==="\\"){if(i+1===e.length)throw new Z(W.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Z(W.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=l,i+=2}else o==="`"?(a=!a,i++):o!=="."||a?(n+=o,i++):(r(),i++)}if(r(),a)throw new Z(W.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new at(t)}static emptyPath(){return new at([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.path=e}static fromPath(e){return new te(Fe.fromString(e))}static fromName(e){return new te(Fe.fromString(e).popFirst(5))}static empty(){return new te(Fe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Fe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Fe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new te(new Fe(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(s,e,t){if(!t)throw new Z(W.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function Q_(s,e,t,n){if(e===!0&&n===!0)throw new Z(W.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function xu(s){if(!te.isDocumentKey(s))throw new Z(W.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function Pu(s){if(te.isDocumentKey(s))throw new Z(W.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function Mh(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}function Ta(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":re(12329,{type:typeof s})}function Et(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new Z(W.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ta(s);throw new Z(W.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qe(s,e){const t={typeString:s};return e&&(t.value=e),t}function Hs(s,e){if(!Mh(s))throw new Z(W.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const i=e[n].typeString,r="value"in e[n]?{value:e[n].value}:void 0;if(!(n in s)){t=`JSON missing required field: '${n}'`;break}const a=s[n];if(i&&typeof a!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(r!==void 0&&a!==r.value){t=`Expected '${n}' field to equal '${r.value}'`;break}}if(t)throw new Z(W.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mu=-62135596800,Lu=1e6;class ke{static now(){return ke.fromMillis(Date.now())}static fromDate(e){return ke.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Lu);return new ke(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Z(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Z(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Mu)throw new Z(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Lu}_compareTo(e){return this.seconds===e.seconds?me(this.nanoseconds,e.nanoseconds):me(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ke._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Hs(e,ke._jsonSchema))return new ke(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Mu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ke._jsonSchemaVersion="firestore/timestamp/1.0",ke._jsonSchema={type:Qe("string",ke._jsonSchemaVersion),seconds:Qe("number"),nanoseconds:Qe("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{static fromTimestamp(e){return new le(e)}static min(){return new le(new ke(0,0))}static max(){return new le(new ke(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ms=-1;function Y_(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,i=le.fromTimestamp(n===1e9?new ke(t+1,0):new ke(t,n));return new Wn(i,te.empty(),e)}function J_(s){return new Wn(s.readTime,s.key,Ms)}class Wn{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Wn(le.min(),te.empty(),Ms)}static max(){return new Wn(le.max(),te.empty(),Ms)}}function Z_(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=te.comparator(s.documentKey,e.documentKey),t!==0?t:me(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ey{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ki(s){if(s.code!==W.FAILED_PRECONDITION||s.message!==X_)throw s;X("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&re(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new H((n,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(n,i)},this.catchCallback=r=>{this.wrapFailure(t,r).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof H?t:H.resolve(t)}catch(t){return H.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):H.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):H.reject(t)}static resolve(e){return new H((t,n)=>{t(e)})}static reject(e){return new H((t,n)=>{n(e)})}static waitFor(e){return new H((t,n)=>{let i=0,r=0,a=!1;e.forEach(o=>{++i,o.next(()=>{++r,a&&r===i&&t()},l=>n(l))}),a=!0,r===i&&t()})}static or(e){let t=H.resolve(!1);for(const n of e)t=t.next(i=>i?H.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,r)=>{n.push(t.call(this,i,r))}),this.waitFor(n)}static mapArray(e,t){return new H((n,i)=>{const r=e.length,a=new Array(r);let o=0;for(let l=0;l<r;l++){const u=l;t(e[u]).next(d=>{a[u]=d,++o,o===r&&n(a)},d=>i(d))}})}static doWhile(e,t){return new H((n,i)=>{const r=()=>{e()===!0?t().next(()=>{r()},i):n()};r()})}}function ty(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Qi(s){return s.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ia.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fl=-1;function Aa(s){return s==null}function qr(s){return s===0&&1/s==-1/0}function ny(s){return typeof s=="number"&&Number.isInteger(s)&&!qr(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lh="";function iy(s){let e="";for(let t=0;t<s.length;t++)e.length>0&&(e=Fu(e)),e=sy(s.get(t),e);return Fu(e)}function sy(s,e){let t=e;const n=s.length;for(let i=0;i<n;i++){const r=s.charAt(i);switch(r){case"\0":t+="";break;case Lh:t+="";break;default:t+=r}}return t}function Fu(s){return s+Lh+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function Kn(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function Fh(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e,t){this.comparator=e,this.root=t||rt.EMPTY}insert(e,t){return new Ve(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rt.BLACK,null,null))}remove(e){return new Ve(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Tr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Tr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Tr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Tr(this.root,e,this.comparator,!0)}}class Tr{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rt{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=n??rt.RED,this.left=i??rt.EMPTY,this.right=r??rt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new rt(e??this.key,t??this.value,n??this.color,i??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):r===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return rt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return rt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,rt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,rt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw re(43730,{key:this.key,value:this.value});if(this.right.isRed())throw re(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw re(27949);return e+(this.isRed()?0:1)}}rt.EMPTY=null,rt.RED=!0,rt.BLACK=!1;rt.EMPTY=new class{constructor(){this.size=0}get key(){throw re(57766)}get value(){throw re(16141)}get color(){throw re(16727)}get left(){throw re(29726)}get right(){throw re(36894)}copy(e,t,n,i,r){return this}insert(e,t,n){return new rt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Je{constructor(e){this.comparator=e,this.data=new Ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $u(this.data.getIterator())}getIteratorFrom(e){return new $u(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Je)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=n.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Je(this.comparator);return t.data=e,t}}class $u{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e){this.fields=e,e.sort(at.comparator)}static empty(){return new xt([])}unionWith(e){let t=new Je(at.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new xt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ui(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new Nh("Invalid base64 string: "+r):r}}(e);return new lt(t)}static fromUint8Array(e){const t=function(i){let r="";for(let a=0;a<i.length;++a)r+=String.fromCharCode(i[a]);return r}(e);return new lt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return me(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}lt.EMPTY_BYTE_STRING=new lt("");const ry=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zn(s){if(Ae(!!s,39018),typeof s=="string"){let e=0;const t=ry.exec(s);if(Ae(!!t,46558,{timestamp:s}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:je(s.seconds),nanos:je(s.nanos)}}function je(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function Hn(s){return typeof s=="string"?lt.fromBase64String(s):lt.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $h="server_timestamp",Oh="__type__",Vh="__previous_value__",Uh="__local_write_time__";function pl(s){var t,n;return((n=(((t=s==null?void 0:s.mapValue)==null?void 0:t.fields)||{})[Oh])==null?void 0:n.stringValue)===$h}function Da(s){const e=s.mapValue.fields[Vh];return pl(e)?Da(e):e}function Ls(s){const e=zn(s.mapValue.fields[Uh].timestampValue);return new ke(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e,t,n,i,r,a,o,l,u,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=d}}const jr="(default)";class Fs{constructor(e,t){this.projectId=e,this.database=t||jr}static empty(){return new Fs("","")}get isDefaultDatabase(){return this.database===jr}isEqual(e){return e instanceof Fs&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bh="__type__",oy="__max__",Ir={mapValue:{}},Wh="__vector__",Gr="value";function qn(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?pl(s)?4:cy(s)?9007199254740991:ly(s)?10:11:re(28295,{value:s})}function on(s,e){if(s===e)return!0;const t=qn(s);if(t!==qn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return Ls(s).isEqual(Ls(e));case 3:return function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const a=zn(i.timestampValue),o=zn(r.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(i,r){return Hn(i.bytesValue).isEqual(Hn(r.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(i,r){return je(i.geoPointValue.latitude)===je(r.geoPointValue.latitude)&&je(i.geoPointValue.longitude)===je(r.geoPointValue.longitude)}(s,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return je(i.integerValue)===je(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const a=je(i.doubleValue),o=je(r.doubleValue);return a===o?qr(a)===qr(o):isNaN(a)&&isNaN(o)}return!1}(s,e);case 9:return Ui(s.arrayValue.values||[],e.arrayValue.values||[],on);case 10:case 11:return function(i,r){const a=i.mapValue.fields||{},o=r.mapValue.fields||{};if(Nu(a)!==Nu(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!on(a[l],o[l])))return!1;return!0}(s,e);default:return re(52216,{left:s})}}function Ns(s,e){return(s.values||[]).find(t=>on(t,e))!==void 0}function Bi(s,e){if(s===e)return 0;const t=qn(s),n=qn(e);if(t!==n)return me(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return me(s.booleanValue,e.booleanValue);case 2:return function(r,a){const o=je(r.integerValue||r.doubleValue),l=je(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(s,e);case 3:return Ou(s.timestampValue,e.timestampValue);case 4:return Ou(Ls(s),Ls(e));case 5:return No(s.stringValue,e.stringValue);case 6:return function(r,a){const o=Hn(r),l=Hn(a);return o.compareTo(l)}(s.bytesValue,e.bytesValue);case 7:return function(r,a){const o=r.split("/"),l=a.split("/");for(let u=0;u<o.length&&u<l.length;u++){const d=me(o[u],l[u]);if(d!==0)return d}return me(o.length,l.length)}(s.referenceValue,e.referenceValue);case 8:return function(r,a){const o=me(je(r.latitude),je(a.latitude));return o!==0?o:me(je(r.longitude),je(a.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return Vu(s.arrayValue,e.arrayValue);case 10:return function(r,a){var m,w,E,C;const o=r.fields||{},l=a.fields||{},u=(m=o[Gr])==null?void 0:m.arrayValue,d=(w=l[Gr])==null?void 0:w.arrayValue,p=me(((E=u==null?void 0:u.values)==null?void 0:E.length)||0,((C=d==null?void 0:d.values)==null?void 0:C.length)||0);return p!==0?p:Vu(u,d)}(s.mapValue,e.mapValue);case 11:return function(r,a){if(r===Ir.mapValue&&a===Ir.mapValue)return 0;if(r===Ir.mapValue)return 1;if(a===Ir.mapValue)return-1;const o=r.fields||{},l=Object.keys(o),u=a.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let p=0;p<l.length&&p<d.length;++p){const m=No(l[p],d[p]);if(m!==0)return m;const w=Bi(o[l[p]],u[d[p]]);if(w!==0)return w}return me(l.length,d.length)}(s.mapValue,e.mapValue);default:throw re(23264,{he:t})}}function Ou(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return me(s,e);const t=zn(s),n=zn(e),i=me(t.seconds,n.seconds);return i!==0?i:me(t.nanos,n.nanos)}function Vu(s,e){const t=s.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const r=Bi(t[i],n[i]);if(r)return r}return me(t.length,n.length)}function Wi(s){return $o(s)}function $o(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(t){const n=zn(t);return`time(${n.seconds},${n.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(t){return Hn(t).toBase64()}(s.bytesValue):"referenceValue"in s?function(t){return te.fromName(t).toString()}(s.referenceValue):"geoPointValue"in s?function(t){return`geo(${t.latitude},${t.longitude})`}(s.geoPointValue):"arrayValue"in s?function(t){let n="[",i=!0;for(const r of t.values||[])i?i=!1:n+=",",n+=$o(r);return n+"]"}(s.arrayValue):"mapValue"in s?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",r=!0;for(const a of n)r?r=!1:i+=",",i+=`${a}:${$o(t.fields[a])}`;return i+"}"}(s.mapValue):re(61005,{value:s})}function Mr(s){switch(qn(s)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Da(s);return e?16+Mr(e):16;case 5:return 2*s.stringValue.length;case 6:return Hn(s.bytesValue).approximateByteSize();case 7:return s.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,r)=>i+Mr(r),0)}(s.arrayValue);case 10:case 11:return function(n){let i=0;return Kn(n.fields,(r,a)=>{i+=r.length+Mr(a)}),i}(s.mapValue);default:throw re(13486,{value:s})}}function Uu(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function Oo(s){return!!s&&"integerValue"in s}function gl(s){return!!s&&"arrayValue"in s}function Bu(s){return!!s&&"nullValue"in s}function Wu(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function Lr(s){return!!s&&"mapValue"in s}function ly(s){var t,n;return((n=(((t=s==null?void 0:s.mapValue)==null?void 0:t.fields)||{})[Bh])==null?void 0:n.stringValue)===Wh}function bs(s){if(s.geoPointValue)return{geoPointValue:{...s.geoPointValue}};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:{...s.timestampValue}};if(s.mapValue){const e={mapValue:{fields:{}}};return Kn(s.mapValue.fields,(t,n)=>e.mapValue.fields[t]=bs(n)),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=bs(s.arrayValue.values[t]);return e}return{...s}}function cy(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue===oy}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this.value=e}static empty(){return new It({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Lr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=bs(t)}setAll(e){let t=at.emptyPath(),n={},i=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const l=this.getFieldsMap(t);this.applyChanges(l,n,i),n={},i=[],t=o.popLast()}a?n[o.lastSegment()]=bs(a):i.push(o.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());Lr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return on(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Lr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Kn(t,(i,r)=>e[i]=r);for(const i of n)delete e[i]}clone(){return new It(bs(this.value))}}function zh(s){const e=[];return Kn(s.fields,(t,n)=>{const i=new at([t]);if(Lr(n)){const r=zh(n.mapValue).fields;if(r.length===0)e.push(i);else for(const a of r)e.push(i.child(a))}else e.push(i)}),new xt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,t,n,i,r,a,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=a,this.documentState=o}static newInvalidDocument(e){return new _t(e,0,le.min(),le.min(),le.min(),It.empty(),0)}static newFoundDocument(e,t,n,i){return new _t(e,1,t,le.min(),n,i,0)}static newNoDocument(e,t){return new _t(e,2,t,le.min(),le.min(),It.empty(),0)}static newUnknownDocument(e,t){return new _t(e,3,t,le.min(),le.min(),It.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(le.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=It.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=It.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=le.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof _t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,t){this.position=e,this.inclusive=t}}function zu(s,e,t){let n=0;for(let i=0;i<s.position.length;i++){const r=e[i],a=s.position[i];if(r.field.isKeyField()?n=te.comparator(te.fromName(a.referenceValue),t.key):n=Bi(a,t.data.field(r.field)),r.dir==="desc"&&(n*=-1),n!==0)break}return n}function Hu(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!on(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e,t="asc"){this.field=e,this.dir=t}}function uy(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hh{}class Ke extends Hh{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new hy(e,t,n):t==="array-contains"?new gy(e,n):t==="in"?new my(e,n):t==="not-in"?new _y(e,n):t==="array-contains-any"?new yy(e,n):new Ke(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new fy(e,n):new py(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Bi(t,this.value)):t!==null&&qn(this.value)===qn(t)&&this.matchesComparison(Bi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return re(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zt extends Hh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new zt(e,t)}matches(e){return qh(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function qh(s){return s.op==="and"}function jh(s){return dy(s)&&qh(s)}function dy(s){for(const e of s.filters)if(e instanceof zt)return!1;return!0}function Vo(s){if(s instanceof Ke)return s.field.canonicalString()+s.op.toString()+Wi(s.value);if(jh(s))return s.filters.map(e=>Vo(e)).join(",");{const e=s.filters.map(t=>Vo(t)).join(",");return`${s.op}(${e})`}}function Gh(s,e){return s instanceof Ke?function(n,i){return i instanceof Ke&&n.op===i.op&&n.field.isEqual(i.field)&&on(n.value,i.value)}(s,e):s instanceof zt?function(n,i){return i instanceof zt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((r,a,o)=>r&&Gh(a,i.filters[o]),!0):!1}(s,e):void re(19439)}function Kh(s){return s instanceof Ke?function(t){return`${t.field.canonicalString()} ${t.op} ${Wi(t.value)}`}(s):s instanceof zt?function(t){return t.op.toString()+" {"+t.getFilters().map(Kh).join(" ,")+"}"}(s):"Filter"}class hy extends Ke{constructor(e,t,n){super(e,t,n),this.key=te.fromName(n.referenceValue)}matches(e){const t=te.comparator(e.key,this.key);return this.matchesComparison(t)}}class fy extends Ke{constructor(e,t){super(e,"in",t),this.keys=Qh("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class py extends Ke{constructor(e,t){super(e,"not-in",t),this.keys=Qh("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Qh(s,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(n=>te.fromName(n.referenceValue))}class gy extends Ke{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return gl(t)&&Ns(t.arrayValue,this.value)}}class my extends Ke{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ns(this.value.arrayValue,t)}}class _y extends Ke{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ns(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ns(this.value.arrayValue,t)}}class yy extends Ke{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!gl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Ns(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vy{constructor(e,t=null,n=[],i=[],r=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=a,this.endAt=o,this.Te=null}}function qu(s,e=null,t=[],n=[],i=null,r=null,a=null){return new vy(s,e,t,n,i,r,a)}function ml(s){const e=ce(s);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Vo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(r){return r.field.canonicalString()+r.dir}(n)).join(","),Aa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Wi(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Wi(n)).join(",")),e.Te=t}return e.Te}function _l(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!uy(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!Gh(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!Hu(s.startAt,e.startAt)&&Hu(s.endAt,e.endAt)}function Uo(s){return te.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,t=null,n=[],i=[],r=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function wy(s,e,t,n,i,r,a,o){return new Yi(s,e,t,n,i,r,a,o)}function Ra(s){return new Yi(s)}function ju(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Yh(s){return s.collectionGroup!==null}function ks(s){const e=ce(s);if(e.Ie===null){e.Ie=[];const t=new Set;for(const r of e.explicitOrderBy)e.Ie.push(r),t.add(r.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new Je(at.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(o=o.add(u.field))})}),o})(e).forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new $s(r,n))}),t.has(at.keyField().canonicalString())||e.Ie.push(new $s(at.keyField(),n))}return e.Ie}function en(s){const e=ce(s);return e.Ee||(e.Ee=by(e,ks(s))),e.Ee}function by(s,e){if(s.limitType==="F")return qu(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(i=>{const r=i.dir==="desc"?"asc":"desc";return new $s(i.field,r)});const t=s.endAt?new Kr(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new Kr(s.startAt.position,s.startAt.inclusive):null;return qu(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function Bo(s,e){const t=s.filters.concat([e]);return new Yi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function Wo(s,e,t){return new Yi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function Ca(s,e){return _l(en(s),en(e))&&s.limitType===e.limitType}function Jh(s){return`${ml(en(s))}|lt:${s.limitType}`}function Ri(s){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Kh(i)).join(", ")}]`),Aa(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Wi(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Wi(i)).join(",")),`Target(${n})`}(en(s))}; limitType=${s.limitType})`}function xa(s,e){return e.isFoundDocument()&&function(n,i){const r=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):te.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r)}(s,e)&&function(n,i){for(const r of ks(n))if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0}(s,e)&&function(n,i){for(const r of n.filters)if(!r.matches(i))return!1;return!0}(s,e)&&function(n,i){return!(n.startAt&&!function(a,o,l){const u=zu(a,o,l);return a.inclusive?u<=0:u<0}(n.startAt,ks(n),i)||n.endAt&&!function(a,o,l){const u=zu(a,o,l);return a.inclusive?u>=0:u>0}(n.endAt,ks(n),i))}(s,e)}function ky(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function Zh(s){return(e,t)=>{let n=!1;for(const i of ks(s)){const r=Ey(i,e,t);if(r!==0)return r;n=n||i.field.isKeyField()}return 0}}function Ey(s,e,t){const n=s.field.isKeyField()?te.comparator(e.key,t.key):function(r,a,o){const l=a.data.field(r),u=o.data.field(r);return l!==null&&u!==null?Bi(l,u):re(42886)}(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return re(19790,{direction:s.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[i,r]of n)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Kn(this.inner,(t,n)=>{for(const[i,r]of n)e(i,r)})}isEmpty(){return Fh(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sy=new Ve(te.comparator);function kn(){return Sy}const Xh=new Ve(te.comparator);function _s(...s){let e=Xh;for(const t of s)e=e.insert(t.key,t);return e}function ef(s){let e=Xh;return s.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function ai(){return Es()}function tf(){return Es()}function Es(){return new wi(s=>s.toString(),(s,e)=>s.isEqual(e))}const Ty=new Ve(te.comparator),Iy=new Je(te.comparator);function _e(...s){let e=Iy;for(const t of s)e=e.add(t);return e}const Ay=new Je(me);function Dy(){return Ay}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yl(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qr(e)?"-0":e}}function nf(s){return{integerValue:""+s}}function Ry(s,e){return ny(e)?nf(e):yl(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(){this._=void 0}}function Cy(s,e,t){return s instanceof Qr?function(i,r){const a={fields:{[Oh]:{stringValue:$h},[Uh]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&pl(r)&&(r=Da(r)),r&&(a.fields[Vh]=r),{mapValue:a}}(t,e):s instanceof Os?rf(s,e):s instanceof Vs?af(s,e):function(i,r){const a=sf(i,r),o=Gu(a)+Gu(i.Ae);return Oo(a)&&Oo(i.Ae)?nf(o):yl(i.serializer,o)}(s,e)}function xy(s,e,t){return s instanceof Os?rf(s,e):s instanceof Vs?af(s,e):t}function sf(s,e){return s instanceof Yr?function(n){return Oo(n)||function(r){return!!r&&"doubleValue"in r}(n)}(e)?e:{integerValue:0}:null}class Qr extends Pa{}class Os extends Pa{constructor(e){super(),this.elements=e}}function rf(s,e){const t=of(e);for(const n of s.elements)t.some(i=>on(i,n))||t.push(n);return{arrayValue:{values:t}}}class Vs extends Pa{constructor(e){super(),this.elements=e}}function af(s,e){let t=of(e);for(const n of s.elements)t=t.filter(i=>!on(i,n));return{arrayValue:{values:t}}}class Yr extends Pa{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Gu(s){return je(s.integerValue||s.doubleValue)}function of(s){return gl(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function Py(s,e){return s.field.isEqual(e.field)&&function(n,i){return n instanceof Os&&i instanceof Os||n instanceof Vs&&i instanceof Vs?Ui(n.elements,i.elements,on):n instanceof Yr&&i instanceof Yr?on(n.Ae,i.Ae):n instanceof Qr&&i instanceof Qr}(s.transform,e.transform)}class My{constructor(e,t){this.version=e,this.transformResults=t}}class St{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new St}static exists(e){return new St(void 0,e)}static updateTime(e){return new St(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Fr(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class Ma{}function lf(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new La(s.key,St.none()):new qs(s.key,s.data,St.none());{const t=s.data,n=It.empty();let i=new Je(at.comparator);for(let r of e.fields)if(!i.has(r)){let a=t.field(r);a===null&&r.length>1&&(r=r.popLast(),a=t.field(r)),a===null?n.delete(r):n.set(r,a),i=i.add(r)}return new Qn(s.key,n,new xt(i.toArray()),St.none())}}function Ly(s,e,t){s instanceof qs?function(i,r,a){const o=i.value.clone(),l=Qu(i.fieldTransforms,r,a.transformResults);o.setAll(l),r.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(s,e,t):s instanceof Qn?function(i,r,a){if(!Fr(i.precondition,r))return void r.convertToUnknownDocument(a.version);const o=Qu(i.fieldTransforms,r,a.transformResults),l=r.data;l.setAll(cf(i)),l.setAll(o),r.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(s,e,t):function(i,r,a){r.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Ss(s,e,t,n){return s instanceof qs?function(r,a,o,l){if(!Fr(r.precondition,a))return o;const u=r.value.clone(),d=Yu(r.fieldTransforms,l,a);return u.setAll(d),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(s,e,t,n):s instanceof Qn?function(r,a,o,l){if(!Fr(r.precondition,a))return o;const u=Yu(r.fieldTransforms,l,a),d=a.data;return d.setAll(cf(r)),d.setAll(u),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),o===null?null:o.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(p=>p.field))}(s,e,t,n):function(r,a,o){return Fr(r.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(s,e,t)}function Fy(s,e){let t=null;for(const n of s.fieldTransforms){const i=e.data.field(n.field),r=sf(n.transform,i||null);r!=null&&(t===null&&(t=It.empty()),t.set(n.field,r))}return t||null}function Ku(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Ui(n,i,(r,a)=>Py(r,a))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class qs extends Ma{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Qn extends Ma{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function cf(s){const e=new Map;return s.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}}),e}function Qu(s,e,t){const n=new Map;Ae(s.length===t.length,32656,{Re:t.length,Ve:s.length});for(let i=0;i<t.length;i++){const r=s[i],a=r.transform,o=e.data.field(r.field);n.set(r.field,xy(a,o,t[i]))}return n}function Yu(s,e,t){const n=new Map;for(const i of s){const r=i.transform,a=t.data.field(i.field);n.set(i.field,Cy(r,a,e))}return n}class La extends Ma{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ny extends Ma{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&Ly(r,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ss(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ss(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=tf();return this.mutations.forEach(i=>{const r=e.get(i.key),a=r.overlayedDocument;let o=this.applyToLocalView(a,r.mutatedFields);o=t.has(i.key)?null:o;const l=lf(a,o);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(le.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_e())}isEqual(e){return this.batchId===e.batchId&&Ui(this.mutations,e.mutations,(t,n)=>Ku(t,n))&&Ui(this.baseMutations,e.baseMutations,(t,n)=>Ku(t,n))}}class vl{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Ae(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=function(){return Ty}();const r=e.mutations;for(let a=0;a<r.length;a++)i=i.insert(r[a].key,n[a].version);return new vl(e,t,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ge,we;function Uy(s){switch(s){case W.OK:return re(64938);case W.CANCELLED:case W.UNKNOWN:case W.DEADLINE_EXCEEDED:case W.RESOURCE_EXHAUSTED:case W.INTERNAL:case W.UNAVAILABLE:case W.UNAUTHENTICATED:return!1;case W.INVALID_ARGUMENT:case W.NOT_FOUND:case W.ALREADY_EXISTS:case W.PERMISSION_DENIED:case W.FAILED_PRECONDITION:case W.ABORTED:case W.OUT_OF_RANGE:case W.UNIMPLEMENTED:case W.DATA_LOSS:return!0;default:return re(15467,{code:s})}}function uf(s){if(s===void 0)return bn("GRPC error has no .code"),W.UNKNOWN;switch(s){case Ge.OK:return W.OK;case Ge.CANCELLED:return W.CANCELLED;case Ge.UNKNOWN:return W.UNKNOWN;case Ge.DEADLINE_EXCEEDED:return W.DEADLINE_EXCEEDED;case Ge.RESOURCE_EXHAUSTED:return W.RESOURCE_EXHAUSTED;case Ge.INTERNAL:return W.INTERNAL;case Ge.UNAVAILABLE:return W.UNAVAILABLE;case Ge.UNAUTHENTICATED:return W.UNAUTHENTICATED;case Ge.INVALID_ARGUMENT:return W.INVALID_ARGUMENT;case Ge.NOT_FOUND:return W.NOT_FOUND;case Ge.ALREADY_EXISTS:return W.ALREADY_EXISTS;case Ge.PERMISSION_DENIED:return W.PERMISSION_DENIED;case Ge.FAILED_PRECONDITION:return W.FAILED_PRECONDITION;case Ge.ABORTED:return W.ABORTED;case Ge.OUT_OF_RANGE:return W.OUT_OF_RANGE;case Ge.UNIMPLEMENTED:return W.UNIMPLEMENTED;case Ge.DATA_LOSS:return W.DATA_LOSS;default:return re(39323,{code:s})}}(we=Ge||(Ge={}))[we.OK=0]="OK",we[we.CANCELLED=1]="CANCELLED",we[we.UNKNOWN=2]="UNKNOWN",we[we.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",we[we.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",we[we.NOT_FOUND=5]="NOT_FOUND",we[we.ALREADY_EXISTS=6]="ALREADY_EXISTS",we[we.PERMISSION_DENIED=7]="PERMISSION_DENIED",we[we.UNAUTHENTICATED=16]="UNAUTHENTICATED",we[we.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",we[we.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",we[we.ABORTED=10]="ABORTED",we[we.OUT_OF_RANGE=11]="OUT_OF_RANGE",we[we.UNIMPLEMENTED=12]="UNIMPLEMENTED",we[we.INTERNAL=13]="INTERNAL",we[we.UNAVAILABLE=14]="UNAVAILABLE",we[we.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function By(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=new Vn([4294967295,4294967295],0);function Ju(s){const e=By().encode(s),t=new Sh;return t.update(e),new Uint8Array(t.digest())}function Zu(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new Vn([t,n],0),new Vn([i,r],0)]}class wl{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ys(`Invalid padding: ${t}`);if(n<0)throw new ys(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new ys(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new ys(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vn.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(Vn.fromNumber(n)));return i.compare(Wy)===1&&(i=new Vn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Ju(e),[n,i]=Zu(t);for(let r=0;r<this.hashCount;r++){const a=this.ye(n,i,r);if(!this.we(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),a=new wl(r,i,t);return n.forEach(o=>a.insert(o)),a}insert(e){if(this.ge===0)return;const t=Ju(e),[n,i]=Zu(t);for(let r=0;r<this.hashCount;r++){const a=this.ye(n,i,r);this.Se(a)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ys extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,js.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Fa(le.min(),i,new Ve(me),kn(),_e())}}class js{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new js(n,t,_e(),_e(),_e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}}class df{constructor(e,t){this.targetId=e,this.Ce=t}}class hf{constructor(e,t,n=lt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Xu{constructor(){this.ve=0,this.Fe=ed(),this.Me=lt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=_e(),t=_e(),n=_e();return this.Fe.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:re(38017,{changeType:r})}}),new js(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=ed()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ae(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class zy{constructor(e){this.Ge=e,this.ze=new Map,this.je=kn(),this.Je=Ar(),this.He=Ar(),this.Ye=new Ve(me)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:re(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((n,i)=>{this.rt(i)&&t(i)})}st(e){const t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){const r=i.target;if(Uo(r))if(n===0){const a=new te(r.path);this.et(t,a,_t.newNoDocument(a,le.min()))}else Ae(n===1,20013,{expectedCount:n});else{const a=this._t(t);if(a!==n){const o=this.ut(e),l=o?this.ct(o,e,a):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:r=0}=t;let a,o;try{a=Hn(n).toUint8Array()}catch(l){if(l instanceof Nh)return Vi("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new wl(a,i,r)}catch(l){return Vi(l instanceof ys?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let i=0;return n.forEach(r=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${r.path.canonicalString()}`;e.mightContain(o)||(this.et(t,r,null),i++)}),i}Tt(e){const t=new Map;this.ze.forEach((r,a)=>{const o=this.ot(a);if(o){if(r.current&&Uo(o.target)){const l=new te(o.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,_t.newNoDocument(l,e))}r.Be&&(t.set(a,r.ke()),r.qe())}});let n=_e();this.He.forEach((r,a)=>{let o=!0;a.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(n=n.add(r))}),this.je.forEach((r,a)=>a.setReadTime(e));const i=new Fa(e,t,this.Ye,this.je,n);return this.je=kn(),this.Je=Ar(),this.He=Ar(),this.Ye=new Ve(me),i}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Xu,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Je(me),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Je(me),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||X("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Xu),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ar(){return new Ve(te.comparator)}function ed(){return new Ve(te.comparator)}const Hy={asc:"ASCENDING",desc:"DESCENDING"},qy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jy={and:"AND",or:"OR"};class Gy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function zo(s,e){return s.useProto3Json||Aa(e)?e:{value:e}}function Jr(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ff(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function Ky(s,e){return Jr(s,e.toTimestamp())}function tn(s){return Ae(!!s,49232),le.fromTimestamp(function(t){const n=zn(t);return new ke(n.seconds,n.nanos)}(s))}function bl(s,e){return Ho(s,e).canonicalString()}function Ho(s,e){const t=function(i){return new Fe(["projects",i.projectId,"databases",i.database])}(s).child("documents");return e===void 0?t:t.child(e)}function pf(s){const e=Fe.fromString(s);return Ae(vf(e),10190,{key:e.toString()}),e}function qo(s,e){return bl(s.databaseId,e.path)}function vo(s,e){const t=pf(e);if(t.get(1)!==s.databaseId.projectId)throw new Z(W.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new Z(W.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new te(mf(t))}function gf(s,e){return bl(s.databaseId,e)}function Qy(s){const e=pf(s);return e.length===4?Fe.emptyPath():mf(e)}function jo(s){return new Fe(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function mf(s){return Ae(s.length>4&&s.get(4)==="documents",29091,{key:s.toString()}),s.popFirst(5)}function td(s,e,t){return{name:qo(s,e),fields:t.value.mapValue.fields}}function Yy(s,e){let t;if("targetChange"in e){e.targetChange;const n=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:re(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(u,d){return u.useProto3Json?(Ae(d===void 0||typeof d=="string",58123),lt.fromBase64String(d||"")):(Ae(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),lt.fromUint8Array(d||new Uint8Array))}(s,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(u){const d=u.code===void 0?W.UNKNOWN:uf(u.code);return new Z(d,u.message||"")}(a);t=new hf(n,i,r,o||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=vo(s,n.document.name),r=tn(n.document.updateTime),a=n.document.createTime?tn(n.document.createTime):le.min(),o=new It({mapValue:{fields:n.document.fields}}),l=_t.newFoundDocument(i,r,a,o),u=n.targetIds||[],d=n.removedTargetIds||[];t=new Nr(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=vo(s,n.document),r=n.readTime?tn(n.readTime):le.min(),a=_t.newNoDocument(i,r),o=n.removedTargetIds||[];t=new Nr([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=vo(s,n.document),r=n.removedTargetIds||[];t=new Nr([],r,i,null)}else{if(!("filter"in e))return re(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:r}=n,a=new Vy(i,r),o=n.targetId;t=new df(o,a)}}return t}function Jy(s,e){let t;if(e instanceof qs)t={update:td(s,e.key,e.value)};else if(e instanceof La)t={delete:qo(s,e.key)};else if(e instanceof Qn)t={update:td(s,e.key,e.data),updateMask:av(e.fieldMask)};else{if(!(e instanceof Ny))return re(16599,{Vt:e.type});t={verify:qo(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(r,a){const o=a.transform;if(o instanceof Qr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Os)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Vs)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Yr)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw re(20930,{transform:a.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,r){return r.updateTime!==void 0?{updateTime:Ky(i,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:re(27497)}(s,e.precondition)),t}function Zy(s,e){return s&&s.length>0?(Ae(e!==void 0,14353),s.map(t=>function(i,r){let a=i.updateTime?tn(i.updateTime):tn(r);return a.isEqual(le.min())&&(a=tn(r)),new My(a,i.transformResults||[])}(t,e))):[]}function Xy(s,e){return{documents:[gf(s,e.path)]}}function ev(s,e){const t={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=gf(s,i);const r=function(u){if(u.length!==0)return yf(zt.create(u,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const a=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:Ci(m.field),direction:iv(m.dir)}}(d))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=zo(s,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:i}}function tv(s){let e=Qy(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){Ae(n===1,65062);const d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let r=[];t.where&&(r=function(p){const m=_f(p);return m instanceof zt&&jh(m)?m.getFilters():[m]}(t.where));let a=[];t.orderBy&&(a=function(p){return p.map(m=>function(E){return new $s(xi(E.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(m))}(t.orderBy));let o=null;t.limit&&(o=function(p){let m;return m=typeof p=="object"?p.value:p,Aa(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(p){const m=!!p.before,w=p.values||[];return new Kr(w,m)}(t.startAt));let u=null;return t.endAt&&(u=function(p){const m=!p.before,w=p.values||[];return new Kr(w,m)}(t.endAt)),wy(e,i,a,r,o,"F",l,u)}function nv(s,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return re(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function _f(s){return s.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=xi(t.unaryFilter.field);return Ke.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=xi(t.unaryFilter.field);return Ke.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=xi(t.unaryFilter.field);return Ke.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=xi(t.unaryFilter.field);return Ke.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return re(61313);default:return re(60726)}}(s):s.fieldFilter!==void 0?function(t){return Ke.create(xi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return re(58110);default:return re(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(t){return zt.create(t.compositeFilter.filters.map(n=>_f(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return re(1026)}}(t.compositeFilter.op))}(s):re(30097,{filter:s})}function iv(s){return Hy[s]}function sv(s){return qy[s]}function rv(s){return jy[s]}function Ci(s){return{fieldPath:s.canonicalString()}}function xi(s){return at.fromServerFormat(s.fieldPath)}function yf(s){return s instanceof Ke?function(t){if(t.op==="=="){if(Wu(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NAN"}};if(Bu(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Wu(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NAN"}};if(Bu(t.value))return{unaryFilter:{field:Ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ci(t.field),op:sv(t.op),value:t.value}}}(s):s instanceof zt?function(t){const n=t.getFilters().map(i=>yf(i));return n.length===1?n[0]:{compositeFilter:{op:rv(t.op),filters:n}}}(s):re(54877,{filter:s})}function av(s){const e=[];return s.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vf(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t,n,i,r=le.min(),a=le.min(),o=lt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new Fn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Fn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Fn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Fn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov{constructor(e){this.yt=e}}function lv(s){const e=tv({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Wo(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(){this.Cn=new uv}addToCollectionParentIndex(e,t){return this.Cn.add(t),H.resolve()}getCollectionParents(e,t){return H.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return H.resolve()}deleteFieldIndex(e,t){return H.resolve()}deleteAllFieldIndexes(e){return H.resolve()}createTargetIndexes(e,t){return H.resolve()}getDocumentsMatchingTarget(e,t){return H.resolve(null)}getIndexType(e,t){return H.resolve(0)}getFieldIndexes(e,t){return H.resolve([])}getNextCollectionGroupToUpdate(e){return H.resolve(null)}getMinOffset(e,t){return H.resolve(Wn.min())}getMinOffsetFromCollectionGroup(e,t){return H.resolve(Wn.min())}updateCollectionGroup(e,t,n){return H.resolve()}updateIndexEntries(e,t){return H.resolve()}}class uv{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Je(Fe.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Je(Fe.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wf=41943040;class Tt{static withCacheSize(e){return new Tt(e,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Tt.DEFAULT_COLLECTION_PERCENTILE=10,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tt.DEFAULT=new Tt(wf,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tt.DISABLED=new Tt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new zi(0)}static cr(){return new zi(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const id="LruGarbageCollector",dv=1048576;function sd([s,e],[t,n]){const i=me(s,t);return i===0?me(e,n):i}class hv{constructor(e){this.Ir=e,this.buffer=new Je(sd),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();sd(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class fv{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){X(id,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Qi(t)?X(id,"Ignoring IndexedDB error during garbage collection: ",t):await Ki(t)}await this.Vr(3e5)})}}class pv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return H.resolve(Ia.ce);const n=new hv(t);return this.mr.forEachTarget(e,i=>n.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>n.Ar(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),H.resolve(nd)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nd):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,r,a,o,l,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(n=p,o=Date.now(),this.removeTargets(e,n,t))).next(p=>(r=p,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(u=Date.now(),Di()<=ge.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-d}ms
	Determined least recently used ${i} in `+(o-a)+`ms
	Removed ${r} targets in `+(l-o)+`ms
	Removed ${p} documents in `+(u-l)+`ms
Total Duration: ${u-d}ms`),H.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:p})))}}function gv(s,e){return new pv(s,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(){this.changes=new wi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?H.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&Ss(n.mutation,i,xt.empty(),ke.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,_e()).next(()=>n))}getLocalViewOfDocuments(e,t,n=_e()){const i=ai();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(r=>{let a=_s();return r.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=ai();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,_e()))}populateOverlays(e,t,n){const i=[];return n.forEach(r=>{t.has(r)||i.push(r)}),this.documentOverlayCache.getOverlays(e,i).next(r=>{r.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,n,i){let r=kn();const a=Es(),o=function(){return Es()}();return t.forEach((l,u)=>{const d=n.get(u.key);i.has(u.key)&&(d===void 0||d.mutation instanceof Qn)?r=r.insert(u.key,u):d!==void 0?(a.set(u.key,d.mutation.getFieldMask()),Ss(d.mutation,u,d.mutation.getFieldMask(),ke.now())):a.set(u.key,xt.empty())}),this.recalculateAndSaveOverlays(e,r).next(l=>(l.forEach((u,d)=>a.set(u,d)),t.forEach((u,d)=>o.set(u,new _v(d,a.get(u)??null))),o))}recalculateAndSaveOverlays(e,t){const n=Es();let i=new Ve((a,o)=>a-o),r=_e();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let d=n.get(l)||xt.empty();d=o.applyToLocalView(u,d),n.set(l,d);const p=(i.get(o.batchId)||_e()).add(l);i=i.insert(o.batchId,p)})}).next(()=>{const a=[],o=i.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),u=l.key,d=l.value,p=tf();d.forEach(m=>{if(!r.has(m)){const w=lf(t.get(m),n.get(m));w!==null&&p.set(m,w),r=r.add(m)}}),a.push(this.documentOverlayCache.saveOverlays(e,u,p))}return H.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(a){return te.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Yh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{const a=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):H.resolve(ai());let o=Ms,l=r;return a.next(u=>H.forEach(u,(d,p)=>(o<p.largestBatchId&&(o=p.largestBatchId),r.get(d)?H.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{l=l.insert(d,m)}))).next(()=>this.populateOverlays(e,u,r)).next(()=>this.computeViews(e,l,u,_e())).next(d=>({batchId:o,changes:ef(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new te(t)).next(n=>{let i=_s();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const r=t.collectionGroup;let a=_s();return this.indexManager.getCollectionParents(e,r).next(o=>H.forEach(o,l=>{const u=function(p,m){return new Yi(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,l.child(r));return this.getDocumentsMatchingCollectionQuery(e,u,n,i).next(d=>{d.forEach((p,m)=>{a=a.insert(p,m)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(r=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,i))).next(a=>{r.forEach((l,u)=>{const d=u.getKey();a.get(d)===null&&(a=a.insert(d,_t.newInvalidDocument(d)))});let o=_s();return a.forEach((l,u)=>{const d=r.get(l);d!==void 0&&Ss(d.mutation,u,xt.empty(),ke.now()),xa(t,u)&&(o=o.insert(l,u))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return H.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:tn(i.createTime)}}(t)),H.resolve()}getNamedQuery(e,t){return H.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(i){return{name:i.name,query:lv(i.bundledQuery),readTime:tn(i.readTime)}}(t)),H.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(){this.overlays=new Ve(te.comparator),this.qr=new Map}getOverlay(e,t){return H.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ai();return H.forEach(t,i=>this.getOverlay(e,i).next(r=>{r!==null&&n.set(i,r)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,r)=>{this.St(e,t,r)}),H.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return i!==void 0&&(i.forEach(r=>this.overlays=this.overlays.remove(r)),this.qr.delete(n)),H.resolve()}getOverlaysForCollection(e,t,n){const i=ai(),r=t.length+1,a=new te(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===r&&l.largestBatchId>n&&i.set(l.getKey(),l)}return H.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new Ve((u,d)=>u-d);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){let d=r.get(u.largestBatchId);d===null&&(d=ai(),r=r.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const o=ai(),l=r.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,d)=>o.set(u,d)),!(o.size()>=i)););return H.resolve(o)}St(e,t,n){const i=this.overlays.get(n.key);if(i!==null){const a=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Oy(t,n));let r=this.qr.get(t);r===void 0&&(r=_e(),this.qr.set(t,r)),this.qr.set(t,r.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv{constructor(){this.sessionToken=lt.EMPTY_BYTE_STRING}getSessionToken(e){return H.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,H.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(){this.Qr=new Je(et.$r),this.Ur=new Je(et.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new et(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Gr(new et(e,t))}zr(e,t){e.forEach(n=>this.removeReference(n,t))}jr(e){const t=new te(new Fe([])),n=new et(t,e),i=new et(t,e+1),r=[];return this.Ur.forEachInRange([n,i],a=>{this.Gr(a),r.push(a.key)}),r}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new te(new Fe([])),n=new et(t,e),i=new et(t,e+1);let r=_e();return this.Ur.forEachInRange([n,i],a=>{r=r.add(a.key)}),r}containsKey(e){const t=new et(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class et{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return te.comparator(e.key,t.key)||me(e.Yr,t.Yr)}static Kr(e,t){return me(e.Yr,t.Yr)||te.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Je(et.$r)}checkEmpty(e){return H.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new $y(r,t,n,i);this.mutationQueue.push(a);for(const o of i)this.Zr=this.Zr.add(new et(o.key,r)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return H.resolve(a)}lookupMutationBatch(e,t){return H.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ei(n),r=i<0?0:i;return H.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return H.resolve(this.mutationQueue.length===0?fl:this.tr-1)}getAllMutationBatches(e){return H.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new et(t,0),i=new et(t,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([n,i],a=>{const o=this.Xr(a.Yr);r.push(o)}),H.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Je(me);return t.forEach(i=>{const r=new et(i,0),a=new et(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([r,a],o=>{n=n.add(o.Yr)})}),H.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;te.isDocumentKey(r)||(r=r.child(""));const a=new et(new te(r),0);let o=new Je(me);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!n.isPrefixOf(u)&&(u.length===i&&(o=o.add(l.Yr)),!0)},a),H.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(n=>{const i=this.Xr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Ae(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return H.forEach(t.mutations,i=>{const r=new et(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new et(t,0),i=this.Zr.firstAfterOrEqual(n);return H.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,H.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(e){this.ri=e,this.docs=function(){return new Ve(te.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),r=i?i.size:0,a=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return H.resolve(n?n.document.mutableCopy():_t.newInvalidDocument(t))}getEntries(e,t){let n=kn();return t.forEach(i=>{const r=this.docs.get(i);n=n.insert(i,r?r.document.mutableCopy():_t.newInvalidDocument(i))}),H.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=kn();const a=t.path,o=new te(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:u,value:{document:d}}=l.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||Z_(J_(d),n)<=0||(i.has(d.key)||xa(t,d))&&(r=r.insert(d.key,d.mutableCopy()))}return H.resolve(r)}getAllFromCollectionGroup(e,t,n,i){re(9500)}ii(e,t){return H.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Sv(this)}getSize(e){return H.resolve(this.size)}}class Sv extends mv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)}),H.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(e){this.persistence=e,this.si=new wi(t=>ml(t),_l),this.lastRemoteSnapshotVersion=le.min(),this.highestTargetId=0,this.oi=0,this._i=new kl,this.targetCount=0,this.ai=zi.ur()}forEachTarget(e,t){return this.si.forEach((n,i)=>t(i)),H.resolve()}getLastRemoteSnapshotVersion(e){return H.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return H.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),H.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),H.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new zi(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,H.resolve()}updateTargetData(e,t){return this.Pr(t),H.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,H.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.si.forEach((a,o)=>{o.sequenceNumber<=t&&n.get(o.targetId)===null&&(this.si.delete(a),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),H.waitFor(r).next(()=>i)}getTargetCount(e){return H.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return H.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),H.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(a=>{r.push(i.markPotentiallyOrphaned(e,a))}),H.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),H.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return H.resolve(n)}containsKey(e,t){return H.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ia(0),this.li=!1,this.li=!0,this.hi=new bv,this.referenceDelegate=e(this),this.Pi=new Tv(this),this.indexManager=new cv,this.remoteDocumentCache=function(i){return new Ev(i)}(n=>this.referenceDelegate.Ti(n)),this.serializer=new ov(t),this.Ii=new vv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new wv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new kv(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){X("MemoryPersistence","Starting transaction:",e);const i=new Iv(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(r=>this.referenceDelegate.di(i).next(()=>r)).toPromise().then(r=>(i.raiseOnCommittedEvent(),r))}Ai(e,t){return H.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class Iv extends ey{constructor(e){super(),this.currentSequenceNumber=e}}class El{constructor(e){this.persistence=e,this.Ri=new kl,this.Vi=null}static mi(e){return new El(e)}get fi(){if(this.Vi)return this.Vi;throw re(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),H.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),H.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),H.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(r=>this.fi.add(r.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return H.forEach(this.fi,n=>{const i=te.fromPath(n);return this.gi(e,i).next(r=>{r||t.removeEntry(i,le.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return H.or([()=>H.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Zr{constructor(e,t){this.persistence=e,this.pi=new wi(n=>iy(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=gv(this,t)}static mi(e,t){return new Zr(e,t)}Ei(){}di(e){return H.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}wr(e){let t=0;return this.pr(e,n=>{t++}).next(()=>t)}pr(e,t){return H.forEach(this.pi,(n,i)=>this.br(e,n,i).next(r=>r?H.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ii(e,a=>this.br(e,a,t).next(o=>{o||(n++,r.removeEntry(a,le.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),H.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),H.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),H.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),H.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Mr(e.data.value)),t}br(e,t,n){return H.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return H.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=_e(),i=_e();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new Sl(e,t.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return bm()?8:ty(yt())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const r={result:null};return this.ys(e,t).next(a=>{r.result=a}).next(()=>{if(!r.result)return this.ws(e,t,i,n).next(a=>{r.result=a})}).next(()=>{if(r.result)return;const a=new Av;return this.Ss(e,t,a).next(o=>{if(r.result=o,this.Vs)return this.bs(e,t,a,o.size)})}).next(()=>r.result)}bs(e,t,n,i){return n.documentReadCount<this.fs?(Di()<=ge.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",Ri(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),H.resolve()):(Di()<=ge.DEBUG&&X("QueryEngine","Query:",Ri(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(Di()<=ge.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",Ri(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,en(t))):H.resolve())}ys(e,t){if(ju(t))return H.resolve(null);let n=en(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Wo(t,null,"F"),n=en(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const a=_e(...r);return this.ps.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,n).next(l=>{const u=this.Ds(t,o);return this.Cs(t,u,a,l.readTime)?this.ys(e,Wo(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,n,i){return ju(t)||i.isEqual(le.min())?H.resolve(null):this.ps.getDocuments(e,n).next(r=>{const a=this.Ds(t,r);return this.Cs(t,a,n,i)?H.resolve(null):(Di()<=ge.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ri(t)),this.vs(e,a,t,Y_(i,Ms)).next(o=>o))})}Ds(e,t){let n=new Je(Zh(e));return t.forEach((i,r)=>{xa(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Ss(e,t,n){return Di()<=ge.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",Ri(t)),this.ps.getDocumentsMatchingQuery(e,t,Wn.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next(r=>(t.forEach(a=>{r=r.insert(a.key,a)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tl="LocalStore",Rv=3e8;class Cv{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Ve(me),this.xs=new wi(r=>ml(r),_l),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function xv(s,e,t,n){return new Cv(s,e,t,n)}async function kf(s,e){const t=ce(s);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,t.Bs(e),t.mutationQueue.getAllMutationBatches(n))).next(r=>{const a=[],o=[];let l=_e();for(const u of i){a.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}for(const u of r){o.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(n,l).next(u=>({Ls:u,removedBatchIds:a,addedBatchIds:o}))})})}function Pv(s,e){const t=ce(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),r=t.Ns.newChangeBuffer({trackRemovals:!0});return function(o,l,u,d){const p=u.batch,m=p.keys();let w=H.resolve();return m.forEach(E=>{w=w.next(()=>d.getEntry(l,E)).next(C=>{const I=u.docVersions.get(E);Ae(I!==null,48541),C.version.compareTo(I)<0&&(p.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),d.addEntry(C)))})}),w.next(()=>o.mutationQueue.removeMutationBatch(l,p))}(t,n,e,r).next(()=>r.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(o){let l=_e();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(l=l.add(o.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function Ef(s){const e=ce(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function Mv(s,e){const t=ce(s),n=e.snapshotVersion;let i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;const o=[];e.targetChanges.forEach((d,p)=>{const m=i.get(p);if(!m)return;o.push(t.Pi.removeMatchingKeys(r,d.removedDocuments,p).next(()=>t.Pi.addMatchingKeys(r,d.addedDocuments,p)));let w=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(p)!==null?w=w.withResumeToken(lt.EMPTY_BYTE_STRING,le.min()).withLastLimboFreeSnapshotVersion(le.min()):d.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(d.resumeToken,n)),i=i.insert(p,w),function(C,I,B){return C.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=Rv?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0}(m,w,d)&&o.push(t.Pi.updateTargetData(r,w))});let l=kn(),u=_e();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(r,d))}),o.push(Lv(r,a,e.documentUpdates).next(d=>{l=d.ks,u=d.qs})),!n.isEqual(le.min())){const d=t.Pi.getLastRemoteSnapshotVersion(r).next(p=>t.Pi.setTargetsMetadata(r,r.currentSequenceNumber,n));o.push(d)}return H.waitFor(o).next(()=>a.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,l,u)).next(()=>l)}).then(r=>(t.Ms=i,r))}function Lv(s,e,t){let n=_e(),i=_e();return t.forEach(r=>n=n.add(r)),e.getEntries(s,n).next(r=>{let a=kn();return t.forEach((o,l)=>{const u=r.get(o);l.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(o)),l.isNoDocument()&&l.version.isEqual(le.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):X(Tl,"Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",l.version)}),{ks:a,qs:i}})}function Fv(s,e){const t=ce(s);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=fl),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Nv(s,e){const t=ce(s);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Pi.getTargetData(n,e).next(r=>r?(i=r,H.resolve(i)):t.Pi.allocateTargetId(n).next(a=>(i=new Fn(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.Ms.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n})}async function Go(s,e,t){const n=ce(s),i=n.Ms.get(e),r=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",r,a=>n.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Qi(a))throw a;X(Tl,`Failed to update sequence numbers for target ${e}: ${a}`)}n.Ms=n.Ms.remove(e),n.xs.delete(i.target)}function rd(s,e,t){const n=ce(s);let i=le.min(),r=_e();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,u,d){const p=ce(l),m=p.xs.get(d);return m!==void 0?H.resolve(p.Ms.get(m)):p.Pi.getTargetData(u,d)}(n,a,en(e)).next(o=>{if(o)return i=o.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,o.targetId).next(l=>{r=l})}).next(()=>n.Fs.getDocumentsMatchingQuery(a,e,t?i:le.min(),t?r:_e())).next(o=>($v(n,ky(e),o),{documents:o,Qs:r})))}function $v(s,e,t){let n=s.Os.get(e)||le.min();t.forEach((i,r)=>{r.readTime.compareTo(n)>0&&(n=r.readTime)}),s.Os.set(e,n)}class ad{constructor(){this.activeTargetIds=Dy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ov{constructor(){this.Mo=new ad,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new ad,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vv{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const od="ConnectivityMonitor";class ld{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){X(od,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){X(od,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dr=null;function Ko(){return Dr===null?Dr=function(){return 268435456+Math.round(2147483648*Math.random())}():Dr++,"0x"+Dr.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo="RestConnection",Uv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Bv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===jr?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,r){const a=Ko(),o=this.zo(e,t.toUriEncodedString());X(wo,`Sending RPC '${e}' ${a}:`,o,n);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,i,r);const{host:u}=new URL(o),d=yi(u);return this.Jo(e,o,l,n,d).then(p=>(X(wo,`Received RPC '${e}' ${a}: `,p),p),p=>{throw Vi(wo,`RPC '${e}' ${a} failed with error: `,p,"url: ",o,"request:",n),p})}Ho(e,t,n,i,r,a){return this.Go(e,t,n,i,r)}jo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gi}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,r)=>e[r]=i),n&&n.headers.forEach((i,r)=>e[r]=i)}zo(e,t){const n=Uv[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pt="WebChannelConnection";class zv extends Bv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,r){const a=Ko();return new Promise((o,l)=>{const u=new Th;u.setWithCredentials(!0),u.listenOnce(Ih.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Pr.NO_ERROR:const p=u.getResponseJson();X(pt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(p)),o(p);break;case Pr.TIMEOUT:X(pt,`RPC '${e}' ${a} timed out`),l(new Z(W.DEADLINE_EXCEEDED,"Request time out"));break;case Pr.HTTP_ERROR:const m=u.getStatus();if(X(pt,`RPC '${e}' ${a} failed with status:`,m,"response text:",u.getResponseText()),m>0){let w=u.getResponseJson();Array.isArray(w)&&(w=w[0]);const E=w==null?void 0:w.error;if(E&&E.status&&E.message){const C=function(B){const G=B.toLowerCase().replace(/_/g,"-");return Object.values(W).indexOf(G)>=0?G:W.UNKNOWN}(E.status);l(new Z(C,E.message))}else l(new Z(W.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new Z(W.UNAVAILABLE,"Connection failed."));break;default:re(9055,{l_:e,streamId:a,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{X(pt,`RPC '${e}' ${a} completed.`)}});const d=JSON.stringify(i);X(pt,`RPC '${e}' ${a} sending request:`,i),u.send(t,"POST",d,n,15)})}T_(e,t,n){const i=Ko(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Rh(),o=Dh(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;const d=r.join("");X(pt,`Creating RPC '${e}' stream ${i}: ${d}`,l);const p=a.createWebChannel(d,l);this.I_(p);let m=!1,w=!1;const E=new Wv({Yo:I=>{w?X(pt,`Not sending because RPC '${e}' stream ${i} is closed:`,I):(m||(X(pt,`Opening RPC '${e}' stream ${i} transport.`),p.open(),m=!0),X(pt,`RPC '${e}' stream ${i} sending:`,I),p.send(I))},Zo:()=>p.close()}),C=(I,B,G)=>{I.listen(B,Y=>{try{G(Y)}catch(K){setTimeout(()=>{throw K},0)}})};return C(p,ms.EventType.OPEN,()=>{w||(X(pt,`RPC '${e}' stream ${i} transport opened.`),E.o_())}),C(p,ms.EventType.CLOSE,()=>{w||(w=!0,X(pt,`RPC '${e}' stream ${i} transport closed`),E.a_(),this.E_(p))}),C(p,ms.EventType.ERROR,I=>{w||(w=!0,Vi(pt,`RPC '${e}' stream ${i} transport errored. Name:`,I.name,"Message:",I.message),E.a_(new Z(W.UNAVAILABLE,"The operation could not be completed")))}),C(p,ms.EventType.MESSAGE,I=>{var B;if(!w){const G=I.data[0];Ae(!!G,16349);const Y=G,K=(Y==null?void 0:Y.error)||((B=Y[0])==null?void 0:B.error);if(K){X(pt,`RPC '${e}' stream ${i} received error:`,K);const ee=K.status;let ae=function(R){const P=Ge[R];if(P!==void 0)return uf(P)}(ee),M=K.message;ae===void 0&&(ae=W.INTERNAL,M="Unknown error status: "+ee+" with message "+K.message),w=!0,E.a_(new Z(ae,M)),p.close()}else X(pt,`RPC '${e}' stream ${i} received:`,G),E.u_(G)}}),C(o,Ah.STAT_EVENT,I=>{I.stat===Fo.PROXY?X(pt,`RPC '${e}' stream ${i} detected buffering proxy`):I.stat===Fo.NOPROXY&&X(pt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.__()},0),E}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function bo(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(s){return new Gy(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e,t,n=1e3,i=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&X("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cd="PersistentStream";class Tf{constructor(e,t,n,i,r,a,o,l){this.Mi=e,this.S_=n,this.b_=i,this.connection=r,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Sf(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===W.RESOURCE_EXHAUSTED?(bn(t.toString()),bn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===W.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.D_===t&&this.G_(n,i)},n=>{e(()=>{const i=new Z(W.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(i)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{n(()=>this.z_(i))}),this.stream.onMessage(i=>{n(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return X(cd,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(X(cd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Hv extends Tf{constructor(e,t,n,i,r,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Yy(this.serializer,e),n=function(r){if(!("targetChange"in r))return le.min();const a=r.targetChange;return a.targetIds&&a.targetIds.length?le.min():a.readTime?tn(a.readTime):le.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=jo(this.serializer),t.addTarget=function(r,a){let o;const l=a.target;if(o=Uo(l)?{documents:Xy(r,l)}:{query:ev(r,l).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=ff(r,a.resumeToken);const u=zo(r,a.expectedCount);u!==null&&(o.expectedCount=u)}else if(a.snapshotVersion.compareTo(le.min())>0){o.readTime=Jr(r,a.snapshotVersion.toTimestamp());const u=zo(r,a.expectedCount);u!==null&&(o.expectedCount=u)}return o}(this.serializer,e);const n=nv(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=jo(this.serializer),t.removeTarget=e,this.q_(t)}}class qv extends Tf{constructor(e,t,n,i,r,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Ae(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ae(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ae(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Zy(e.writeResults,e.commitTime),n=tn(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=jo(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Jy(this.serializer,n))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{}class Gv extends jv{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new Z(W.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,a])=>this.connection.Go(e,Ho(t,n),i,r,a)).catch(r=>{throw r.name==="FirebaseError"?(r.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new Z(W.UNKNOWN,r.toString())})}Ho(e,t,n,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Ho(e,Ho(t,n),i,a,o,r)).catch(a=>{throw a.name==="FirebaseError"?(a.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Z(W.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Kv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(bn(t),this.aa=!1):X("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi="RemoteStore";class Qv{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(a=>{n.enqueueAndForget(async()=>{bi(this)&&(X(fi,"Restarting streams for network reachability change."),await async function(l){const u=ce(l);u.Ea.add(4),await Gs(u),u.Ra.set("Unknown"),u.Ea.delete(4),await $a(u)}(this))})}),this.Ra=new Kv(n,i)}}async function $a(s){if(bi(s))for(const e of s.da)await e(!0)}async function Gs(s){for(const e of s.da)await e(!1)}function If(s,e){const t=ce(s);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Rl(t)?Dl(t):Ji(t).O_()&&Al(t,e))}function Il(s,e){const t=ce(s),n=Ji(t);t.Ia.delete(e),n.O_()&&Af(t,e),t.Ia.size===0&&(n.O_()?n.L_():bi(t)&&t.Ra.set("Unknown"))}function Al(s,e){if(s.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(le.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ji(s).Y_(e)}function Af(s,e){s.Va.Ue(e),Ji(s).Z_(e)}function Dl(s){s.Va=new zy({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),At:e=>s.Ia.get(e)||null,ht:()=>s.datastore.serializer.databaseId}),Ji(s).start(),s.Ra.ua()}function Rl(s){return bi(s)&&!Ji(s).x_()&&s.Ia.size>0}function bi(s){return ce(s).Ea.size===0}function Df(s){s.Va=void 0}async function Yv(s){s.Ra.set("Online")}async function Jv(s){s.Ia.forEach((e,t)=>{Al(s,e)})}async function Zv(s,e){Df(s),Rl(s)?(s.Ra.ha(e),Dl(s)):s.Ra.set("Unknown")}async function Xv(s,e,t){if(s.Ra.set("Online"),e instanceof hf&&e.state===2&&e.cause)try{await async function(i,r){const a=r.cause;for(const o of r.targetIds)i.Ia.has(o)&&(await i.remoteSyncer.rejectListen(o,a),i.Ia.delete(o),i.Va.removeTarget(o))}(s,e)}catch(n){X(fi,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Xr(s,n)}else if(e instanceof Nr?s.Va.Ze(e):e instanceof df?s.Va.st(e):s.Va.tt(e),!t.isEqual(le.min()))try{const n=await Ef(s.localStore);t.compareTo(n)>=0&&await function(r,a){const o=r.Va.Tt(a);return o.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const d=r.Ia.get(u);d&&r.Ia.set(u,d.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,u)=>{const d=r.Ia.get(l);if(!d)return;r.Ia.set(l,d.withResumeToken(lt.EMPTY_BYTE_STRING,d.snapshotVersion)),Af(r,l);const p=new Fn(d.target,l,u,d.sequenceNumber);Al(r,p)}),r.remoteSyncer.applyRemoteEvent(o)}(s,t)}catch(n){X(fi,"Failed to raise snapshot:",n),await Xr(s,n)}}async function Xr(s,e,t){if(!Qi(e))throw e;s.Ea.add(1),await Gs(s),s.Ra.set("Offline"),t||(t=()=>Ef(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{X(fi,"Retrying IndexedDB access"),await t(),s.Ea.delete(1),await $a(s)})}function Rf(s,e){return e().catch(t=>Xr(s,t,e))}async function Oa(s){const e=ce(s),t=jn(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:fl;for(;e0(e);)try{const i=await Fv(e.localStore,n);if(i===null){e.Ta.length===0&&t.L_();break}n=i.batchId,t0(e,i)}catch(i){await Xr(e,i)}Cf(e)&&xf(e)}function e0(s){return bi(s)&&s.Ta.length<10}function t0(s,e){s.Ta.push(e);const t=jn(s);t.O_()&&t.X_&&t.ea(e.mutations)}function Cf(s){return bi(s)&&!jn(s).x_()&&s.Ta.length>0}function xf(s){jn(s).start()}async function n0(s){jn(s).ra()}async function i0(s){const e=jn(s);for(const t of s.Ta)e.ea(t.mutations)}async function s0(s,e,t){const n=s.Ta.shift(),i=vl.from(n,e,t);await Rf(s,()=>s.remoteSyncer.applySuccessfulWrite(i)),await Oa(s)}async function r0(s,e){e&&jn(s).X_&&await async function(n,i){if(function(a){return Uy(a)&&a!==W.ABORTED}(i.code)){const r=n.Ta.shift();jn(n).B_(),await Rf(n,()=>n.remoteSyncer.rejectFailedWrite(r.batchId,i)),await Oa(n)}}(s,e),Cf(s)&&xf(s)}async function ud(s,e){const t=ce(s);t.asyncQueue.verifyOperationInProgress(),X(fi,"RemoteStore received new credentials");const n=bi(t);t.Ea.add(3),await Gs(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await $a(t)}async function a0(s,e){const t=ce(s);e?(t.Ea.delete(2),await $a(t)):e||(t.Ea.add(2),await Gs(t),t.Ra.set("Unknown"))}function Ji(s){return s.ma||(s.ma=function(t,n,i){const r=ce(t);return r.sa(),new Hv(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)}(s.datastore,s.asyncQueue,{Xo:Yv.bind(null,s),t_:Jv.bind(null,s),r_:Zv.bind(null,s),H_:Xv.bind(null,s)}),s.da.push(async e=>{e?(s.ma.B_(),Rl(s)?Dl(s):s.Ra.set("Unknown")):(await s.ma.stop(),Df(s))})),s.ma}function jn(s){return s.fa||(s.fa=function(t,n,i){const r=ce(t);return r.sa(),new qv(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,i)}(s.datastore,s.asyncQueue,{Xo:()=>Promise.resolve(),t_:n0.bind(null,s),r_:r0.bind(null,s),ta:i0.bind(null,s),na:s0.bind(null,s)}),s.da.push(async e=>{e?(s.fa.B_(),await Oa(s)):(await s.fa.stop(),s.Ta.length>0&&(X(fi,`Stopping write stream with ${s.Ta.length} pending writes`),s.Ta=[]))})),s.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new yn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){const a=Date.now()+n,o=new Cl(e,t,a,i,r);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(W.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xl(s,e){if(bn("AsyncQueue",`${e}: ${s}`),Qi(s))return new Z(W.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{static emptySet(e){return new Fi(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||te.comparator(t.key,n.key):(t,n)=>te.comparator(t.key,n.key),this.keyedMap=_s(),this.sortedSet=new Ve(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Fi)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,r=n.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Fi;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(){this.ga=new Ve(te.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):re(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Hi{constructor(e,t,n,i,r,a,o,l,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,i,r){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new Hi(e,t,Fi.emptySet(t),a,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ca(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class l0{constructor(){this.queries=hd(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const i=ce(t),r=i.queries;i.queries=hd(),r.forEach((a,o)=>{for(const l of o.Sa)l.onError(n)})})(this,new Z(W.ABORTED,"Firestore shutting down"))}}function hd(){return new wi(s=>Jh(s),Ca)}async function Pl(s,e){const t=ce(s);let n=3;const i=e.query;let r=t.queries.get(i);r?!r.ba()&&e.Da()&&(n=2):(r=new o0,n=e.Da()?0:1);try{switch(n){case 0:r.wa=await t.onListen(i,!0);break;case 1:r.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const o=xl(a,`Initialization of query '${Ri(e.query)}' failed`);return void e.onError(o)}t.queries.set(i,r),r.Sa.push(e),e.va(t.onlineState),r.wa&&e.Fa(r.wa)&&Ll(t)}async function Ml(s,e){const t=ce(s),n=e.query;let i=3;const r=t.queries.get(n);if(r){const a=r.Sa.indexOf(e);a>=0&&(r.Sa.splice(a,1),r.Sa.length===0?i=e.Da()?0:1:!r.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function c0(s,e){const t=ce(s);let n=!1;for(const i of e){const r=i.query,a=t.queries.get(r);if(a){for(const o of a.Sa)o.Fa(i)&&(n=!0);a.wa=i}}n&&Ll(t)}function u0(s,e,t){const n=ce(s),i=n.queries.get(e);if(i)for(const r of i.Sa)r.onError(t);n.queries.delete(e)}function Ll(s){s.Ca.forEach(e=>{e.next()})}var Qo,fd;(fd=Qo||(Qo={})).Ma="default",fd.Cache="cache";class Fl{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new Hi(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Hi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Qo.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e){this.key=e}}class Mf{constructor(e){this.key=e}}class d0{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=_e(),this.mutatedKeys=_e(),this.eu=Zh(e),this.tu=new Fi(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new dd,i=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,a=i,o=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,p)=>{const m=i.get(d),w=xa(this.query,p)?p:null,E=!!m&&this.mutatedKeys.has(m.key),C=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let I=!1;m&&w?m.data.isEqual(w.data)?E!==C&&(n.track({type:3,doc:w}),I=!0):this.su(m,w)||(n.track({type:2,doc:w}),I=!0,(l&&this.eu(w,l)>0||u&&this.eu(w,u)<0)&&(o=!0)):!m&&w?(n.track({type:0,doc:w}),I=!0):m&&!w&&(n.track({type:1,doc:m}),I=!0,(l||u)&&(o=!0)),I&&(w?(a=a.add(w),r=C?r.add(d):r.delete(d)):(a=a.delete(d),r=r.delete(d)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const d=this.query.limitType==="F"?a.last():a.first();a=a.delete(d.key),r=r.delete(d.key),n.track({type:1,doc:d})}return{tu:a,iu:n,Cs:o,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((d,p)=>function(w,E){const C=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return re(20277,{Rt:I})}};return C(w)-C(E)}(d.type,p.type)||this.eu(d.doc,p.doc)),this.ou(n),i=i??!1;const o=t&&!i?this._u():[],l=this.Xa.size===0&&this.current&&!i?1:0,u=l!==this.Za;return this.Za=l,a.length!==0||u?{snapshot:new Hi(this.query,e.tu,r,a,e.mutatedKeys,l===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new dd,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=_e(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});const t=[];return e.forEach(n=>{this.Xa.has(n)||t.push(new Mf(n))}),this.Xa.forEach(n=>{e.has(n)||t.push(new Pf(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=_e();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Hi.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Nl="SyncEngine";class h0{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class f0{constructor(e){this.key=e,this.hu=!1}}class p0{constructor(e,t,n,i,r,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new wi(o=>Jh(o),Ca),this.Iu=new Map,this.Eu=new Set,this.du=new Ve(te.comparator),this.Au=new Map,this.Ru=new kl,this.Vu={},this.mu=new Map,this.fu=zi.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function g0(s,e,t=!0){const n=Vf(s);let i;const r=n.Tu.get(e);return r?(n.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.lu()):i=await Lf(n,e,t,!0),i}async function m0(s,e){const t=Vf(s);await Lf(t,e,!0,!1)}async function Lf(s,e,t,n){const i=await Nv(s.localStore,en(e)),r=i.targetId,a=s.sharedClientState.addLocalQueryTarget(r,t);let o;return n&&(o=await _0(s,e,r,a==="current",i.resumeToken)),s.isPrimaryClient&&t&&If(s.remoteStore,i),o}async function _0(s,e,t,n,i){s.pu=(p,m,w)=>async function(C,I,B,G){let Y=I.view.ru(B);Y.Cs&&(Y=await rd(C.localStore,I.query,!1).then(({documents:M})=>I.view.ru(M,Y)));const K=G&&G.targetChanges.get(I.targetId),ee=G&&G.targetMismatches.get(I.targetId)!=null,ae=I.view.applyChanges(Y,C.isPrimaryClient,K,ee);return gd(C,I.targetId,ae.au),ae.snapshot}(s,p,m,w);const r=await rd(s.localStore,e,!0),a=new d0(e,r.Qs),o=a.ru(r.documents),l=js.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",i),u=a.applyChanges(o,s.isPrimaryClient,l);gd(s,t,u.au);const d=new h0(e,t,a);return s.Tu.set(e,d),s.Iu.has(t)?s.Iu.get(t).push(e):s.Iu.set(t,[e]),u.snapshot}async function y0(s,e,t){const n=ce(s),i=n.Tu.get(e),r=n.Iu.get(i.targetId);if(r.length>1)return n.Iu.set(i.targetId,r.filter(a=>!Ca(a,e))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Go(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Il(n.remoteStore,i.targetId),Yo(n,i.targetId)}).catch(Ki)):(Yo(n,i.targetId),await Go(n.localStore,i.targetId,!0))}async function v0(s,e){const t=ce(s),n=t.Tu.get(e),i=t.Iu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Il(t.remoteStore,n.targetId))}async function w0(s,e,t){const n=A0(s);try{const i=await function(a,o){const l=ce(a),u=ke.now(),d=o.reduce((w,E)=>w.add(E.key),_e());let p,m;return l.persistence.runTransaction("Locally write mutations","readwrite",w=>{let E=kn(),C=_e();return l.Ns.getEntries(w,d).next(I=>{E=I,E.forEach((B,G)=>{G.isValidDocument()||(C=C.add(B))})}).next(()=>l.localDocuments.getOverlayedDocuments(w,E)).next(I=>{p=I;const B=[];for(const G of o){const Y=Fy(G,p.get(G.key).overlayedDocument);Y!=null&&B.push(new Qn(G.key,Y,zh(Y.value.mapValue),St.exists(!0)))}return l.mutationQueue.addMutationBatch(w,u,B,o)}).next(I=>{m=I;const B=I.applyToLocalDocumentSet(p,C);return l.documentOverlayCache.saveOverlays(w,I.batchId,B)})}).then(()=>({batchId:m.batchId,changes:ef(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,o,l){let u=a.Vu[a.currentUser.toKey()];u||(u=new Ve(me)),u=u.insert(o,l),a.Vu[a.currentUser.toKey()]=u}(n,i.batchId,t),await Ks(n,i.changes),await Oa(n.remoteStore)}catch(i){const r=xl(i,"Failed to persist write");t.reject(r)}}async function Ff(s,e){const t=ce(s);try{const n=await Mv(t.localStore,e);e.targetChanges.forEach((i,r)=>{const a=t.Au.get(r);a&&(Ae(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Ae(a.hu,14607):i.removedDocuments.size>0&&(Ae(a.hu,42227),a.hu=!1))}),await Ks(t,n,e)}catch(n){await Ki(n)}}function pd(s,e,t){const n=ce(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const i=[];n.Tu.forEach((r,a)=>{const o=a.view.va(e);o.snapshot&&i.push(o.snapshot)}),function(a,o){const l=ce(a);l.onlineState=o;let u=!1;l.queries.forEach((d,p)=>{for(const m of p.Sa)m.va(o)&&(u=!0)}),u&&Ll(l)}(n.eventManager,e),i.length&&n.Pu.H_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function b0(s,e,t){const n=ce(s);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Au.get(e),r=i&&i.key;if(r){let a=new Ve(te.comparator);a=a.insert(r,_t.newNoDocument(r,le.min()));const o=_e().add(r),l=new Fa(le.min(),new Map,new Ve(me),a,o);await Ff(n,l),n.du=n.du.remove(r),n.Au.delete(e),$l(n)}else await Go(n.localStore,e,!1).then(()=>Yo(n,e,t)).catch(Ki)}async function k0(s,e){const t=ce(s),n=e.batch.batchId;try{const i=await Pv(t.localStore,e);$f(t,n,null),Nf(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Ks(t,i)}catch(i){await Ki(i)}}async function E0(s,e,t){const n=ce(s);try{const i=await function(a,o){const l=ce(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return l.mutationQueue.lookupMutationBatch(u,o).next(p=>(Ae(p!==null,37113),d=p.keys(),l.mutationQueue.removeMutationBatch(u,p))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>l.localDocuments.getDocuments(u,d))})}(n.localStore,e);$f(n,e,t),Nf(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Ks(n,i)}catch(i){await Ki(i)}}function Nf(s,e){(s.mu.get(e)||[]).forEach(t=>{t.resolve()}),s.mu.delete(e)}function $f(s,e,t){const n=ce(s);let i=n.Vu[n.currentUser.toKey()];if(i){const r=i.get(e);r&&(t?r.reject(t):r.resolve(),i=i.remove(e)),n.Vu[n.currentUser.toKey()]=i}}function Yo(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Iu.get(e))s.Tu.delete(n),t&&s.Pu.yu(n,t);s.Iu.delete(e),s.isPrimaryClient&&s.Ru.jr(e).forEach(n=>{s.Ru.containsKey(n)||Of(s,n)})}function Of(s,e){s.Eu.delete(e.path.canonicalString());const t=s.du.get(e);t!==null&&(Il(s.remoteStore,t),s.du=s.du.remove(e),s.Au.delete(t),$l(s))}function gd(s,e,t){for(const n of t)n instanceof Pf?(s.Ru.addReference(n.key,e),S0(s,n)):n instanceof Mf?(X(Nl,"Document no longer in limbo: "+n.key),s.Ru.removeReference(n.key,e),s.Ru.containsKey(n.key)||Of(s,n.key)):re(19791,{wu:n})}function S0(s,e){const t=e.key,n=t.path.canonicalString();s.du.get(t)||s.Eu.has(n)||(X(Nl,"New document in limbo: "+t),s.Eu.add(n),$l(s))}function $l(s){for(;s.Eu.size>0&&s.du.size<s.maxConcurrentLimboResolutions;){const e=s.Eu.values().next().value;s.Eu.delete(e);const t=new te(Fe.fromString(e)),n=s.fu.next();s.Au.set(n,new f0(t)),s.du=s.du.insert(t,n),If(s.remoteStore,new Fn(en(Ra(t.path)),n,"TargetPurposeLimboResolution",Ia.ce))}}async function Ks(s,e,t){const n=ce(s),i=[],r=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((o,l)=>{a.push(n.pu(l,e,t).then(u=>{var d;if((u||t)&&n.isPrimaryClient){const p=u?!u.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:d.current;n.sharedClientState.updateQueryState(l.targetId,p?"current":"not-current")}if(u){i.push(u);const p=Sl.As(l.targetId,u);r.push(p)}}))}),await Promise.all(a),n.Pu.H_(i),await async function(l,u){const d=ce(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>H.forEach(u,m=>H.forEach(m.Es,w=>d.persistence.referenceDelegate.addReference(p,m.targetId,w)).next(()=>H.forEach(m.ds,w=>d.persistence.referenceDelegate.removeReference(p,m.targetId,w)))))}catch(p){if(!Qi(p))throw p;X(Tl,"Failed to update sequence numbers: "+p)}for(const p of u){const m=p.targetId;if(!p.fromCache){const w=d.Ms.get(m),E=w.snapshotVersion,C=w.withLastLimboFreeSnapshotVersion(E);d.Ms=d.Ms.insert(m,C)}}}(n.localStore,r))}async function T0(s,e){const t=ce(s);if(!t.currentUser.isEqual(e)){X(Nl,"User change. New user:",e.toKey());const n=await kf(t.localStore,e);t.currentUser=e,function(r,a){r.mu.forEach(o=>{o.forEach(l=>{l.reject(new Z(W.CANCELLED,a))})}),r.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Ks(t,n.Ls)}}function I0(s,e){const t=ce(s),n=t.Au.get(e);if(n&&n.hu)return _e().add(n.key);{let i=_e();const r=t.Iu.get(e);if(!r)return i;for(const a of r){const o=t.Tu.get(a);i=i.unionWith(o.view.nu)}return i}}function Vf(s){const e=ce(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ff.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=I0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=b0.bind(null,e),e.Pu.H_=c0.bind(null,e.eventManager),e.Pu.yu=u0.bind(null,e.eventManager),e}function A0(s){const e=ce(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=k0.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=E0.bind(null,e),e}class ea{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Na(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return xv(this.persistence,new Dv,e.initialUser,this.serializer)}Cu(e){return new bf(El.mi,this.serializer)}Du(e){return new Ov}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ea.provider={build:()=>new ea};class D0 extends ea{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Ae(this.persistence.referenceDelegate instanceof Zr,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new fv(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Tt.withCacheSize(this.cacheSizeBytes):Tt.DEFAULT;return new bf(n=>Zr.mi(n,t),this.serializer)}}class Jo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>pd(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=T0.bind(null,this.syncEngine),await a0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new l0}()}createDatastore(e){const t=Na(e.databaseInfo.databaseId),n=function(r){return new zv(r)}(e.databaseInfo);return function(r,a,o,l){return new Gv(r,a,o,l)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,i,r,a,o){return new Qv(n,i,r,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>pd(this.syncEngine,t,0),function(){return ld.v()?new ld:new Vv}())}createSyncEngine(e,t){return function(i,r,a,o,l,u,d){const p=new p0(i,r,a,o,l,u);return d&&(p.gu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const r=ce(i);X(fi,"RemoteStore shutting down."),r.Ea.add(5),await Gs(r),r.Aa.shutdown(),r.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Jo.provider={build:()=>new Jo};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):bn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gn="FirestoreClient";class R0{constructor(e,t,n,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=gt.UNAUTHENTICATED,this.clientId=hl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async a=>{X(Gn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(X(Gn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new yn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=xl(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function ko(s,e){s.asyncQueue.verifyOperationInProgress(),X(Gn,"Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener(async i=>{n.isEqual(i)||(await kf(e.localStore,i),n=i)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function md(s,e){s.asyncQueue.verifyOperationInProgress();const t=await C0(s);X(Gn,"Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener(n=>ud(e.remoteStore,n)),s.setAppCheckTokenChangeListener((n,i)=>ud(e.remoteStore,i)),s._onlineComponents=e}async function C0(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){X(Gn,"Using user provided OfflineComponentProvider");try{await ko(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===W.FAILED_PRECONDITION||i.code===W.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Vi("Error using user provided cache. Falling back to memory cache: "+t),await ko(s,new ea)}}else X(Gn,"Using default OfflineComponentProvider"),await ko(s,new D0(void 0));return s._offlineComponents}async function Uf(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(X(Gn,"Using user provided OnlineComponentProvider"),await md(s,s._uninitializedComponentsProvider._online)):(X(Gn,"Using default OnlineComponentProvider"),await md(s,new Jo))),s._onlineComponents}function x0(s){return Uf(s).then(e=>e.syncEngine)}async function ta(s){const e=await Uf(s),t=e.eventManager;return t.onListen=g0.bind(null,e.syncEngine),t.onUnlisten=y0.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=m0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=v0.bind(null,e.syncEngine),t}function P0(s,e,t={}){const n=new yn;return s.asyncQueue.enqueueAndForget(async()=>function(r,a,o,l,u){const d=new Ol({next:m=>{d.Nu(),a.enqueueAndForget(()=>Ml(r,p));const w=m.docs.has(o);!w&&m.fromCache?u.reject(new Z(W.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&m.fromCache&&l&&l.source==="server"?u.reject(new Z(W.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new Fl(Ra(o.path),d,{includeMetadataChanges:!0,qa:!0});return Pl(r,p)}(await ta(s),s.asyncQueue,e,t,n)),n.promise}function M0(s,e,t={}){const n=new yn;return s.asyncQueue.enqueueAndForget(async()=>function(r,a,o,l,u){const d=new Ol({next:m=>{d.Nu(),a.enqueueAndForget(()=>Ml(r,p)),m.fromCache&&l.source==="server"?u.reject(new Z(W.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),p=new Fl(o,d,{includeMetadataChanges:!0,qa:!0});return Pl(r,p)}(await ta(s),s.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bf(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _d=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wf="firestore.googleapis.com",yd=!0;class vd{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Z(W.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Wf,this.ssl=yd}else this.host=e.host,this.ssl=e.ssl??yd;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=wf;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<dv)throw new Z(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Q_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Bf(e.experimentalLongPollingOptions??{}),function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new Z(W.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new Z(W.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new Z(W.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Va{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vd({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(W.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(W.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vd(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new V_;switch(n.type){case"firstParty":return new z_(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new Z(W.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=_d.get(t);n&&(X("ComponentProvider","Removing Datastore"),_d.delete(t),n.terminate())}(this),Promise.resolve()}}function L0(s,e,t,n={}){var u;s=Et(s,Va);const i=yi(e),r=s._getSettings(),a={...r,emulatorOptions:s._getEmulatorOptions()},o=`${e}:${t}`;i&&(al(`https://${o}`),ol("Firestore",!0)),r.host!==Wf&&r.host!==o&&Vi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...r,host:o,ssl:i,emulatorOptions:n};if(!ui(l,a)&&(s._setSettings(l),n.mockUserToken)){let d,p;if(typeof n.mockUserToken=="string")d=n.mockUserToken,p=gt.MOCK_USER;else{d=yh(n.mockUserToken,(u=s._app)==null?void 0:u.options.projectId);const m=n.mockUserToken.sub||n.mockUserToken.user_id;if(!m)throw new Z(W.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new gt(m)}s._authCredentials=new U_(new xh(d,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Yn(this.firestore,e,this._query)}}class We{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Un(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new We(this.firestore,e,this._key)}toJSON(){return{type:We._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Hs(t,We._jsonSchema))return new We(e,n||null,new te(Fe.fromString(t.referencePath)))}}We._jsonSchemaVersion="firestore/documentReference/1.0",We._jsonSchema={type:Qe("string",We._jsonSchemaVersion),referencePath:Qe("string")};class Un extends Yn{constructor(e,t,n){super(e,t,Ra(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new We(this.firestore,null,new te(e))}withConverter(e){return new Un(this.firestore,e,this._path)}}function Ie(s,e,...t){if(s=Oe(s),Ph("collection","path",e),s instanceof Va){const n=Fe.fromString(e,...t);return Pu(n),new Un(s,null,n)}{if(!(s instanceof We||s instanceof Un))throw new Z(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(Fe.fromString(e,...t));return Pu(n),new Un(s.firestore,null,n)}}function Be(s,e,...t){if(s=Oe(s),arguments.length===1&&(e=hl.newId()),Ph("doc","path",e),s instanceof Va){const n=Fe.fromString(e,...t);return xu(n),new We(s,null,new te(n))}{if(!(s instanceof We||s instanceof Un))throw new Z(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(Fe.fromString(e,...t));return xu(n),new We(s.firestore,s instanceof Un?s.converter:null,new te(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd="AsyncQueue";class bd{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Sf(this,"async_queue_retry"),this._c=()=>{const n=bo();n&&X(wd,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=bo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=bo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new yn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Qi(e))throw e;X(wd,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(n=>{throw this.nc=n,this.rc=!1,bn("INTERNAL UNHANDLED ERROR: ",kd(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Cl.createAndSchedule(this,e,t,n,r=>this.hc(r));return this.tc.push(i),i}uc(){this.nc&&re(47125,{Pc:kd(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function kd(s){let e=s.message||"";return s.stack&&(e=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ed(s){return function(t,n){if(typeof t!="object"||t===null)return!1;const i=t;for(const r of n)if(r in i&&typeof i[r]=="function")return!0;return!1}(s,["next","error","complete"])}class ln extends Va{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new bd,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new bd(e),this._firestoreClient=void 0,await e}}}function F0(s,e){const t=typeof s=="object"?s:ul(),n=typeof s=="string"?s:jr,i=Sa(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const r=gh("firestore");r&&L0(i,...r)}return i}function Qs(s){if(s._terminated)throw new Z(W.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||N0(s),s._firestoreClient}function N0(s){var n,i,r;const e=s._freezeSettings(),t=function(o,l,u,d){return new ay(o,l,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Bf(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(s._databaseId,((n=s._app)==null?void 0:n.options.appId)||"",s._persistenceKey,e);s._componentsProvider||(i=e.localCache)!=null&&i._offlineComponentProvider&&((r=e.localCache)!=null&&r._onlineComponentProvider)&&(s._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),s._firestoreClient=new R0(s._authCredentials,s._appCheckCredentials,s._queue,t,s._componentsProvider&&function(o){const l=o==null?void 0:o._online.build();return{_offline:o==null?void 0:o._offline.build(l),_online:l}}(s._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $t(lt.fromBase64String(e))}catch(t){throw new Z(W.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $t(lt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$t._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Hs(e,$t._jsonSchema))return $t.fromBase64String(e.bytes)}}$t._jsonSchemaVersion="firestore/bytes/1.0",$t._jsonSchema={type:Qe("string",$t._jsonSchemaVersion),bytes:Qe("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Z(W.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new at(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Z(W.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Z(W.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return me(this._lat,e._lat)||me(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:nn._jsonSchemaVersion}}static fromJSON(e){if(Hs(e,nn._jsonSchema))return new nn(e.latitude,e.longitude)}}nn._jsonSchemaVersion="firestore/geoPoint/1.0",nn._jsonSchema={type:Qe("string",nn._jsonSchemaVersion),latitude:Qe("number"),longitude:Qe("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let r=0;r<n.length;++r)if(n[r]!==i[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:sn._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Hs(e,sn._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new sn(e.vectorValues);throw new Z(W.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}sn._jsonSchemaVersion="firestore/vectorValue/1.0",sn._jsonSchema={type:Qe("string",sn._jsonSchemaVersion),vectorValues:Qe("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $0=/^__.*__$/;class O0{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Qn(e,this.data,this.fieldMask,t,this.fieldTransforms):new qs(e,this.data,t,this.fieldTransforms)}}class zf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Qn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Hf(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw re(40011,{Ac:s})}}class Ul{constructor(e,t,n,i,r,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,r===void 0&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Ul({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){var i;const t=(i=this.path)==null?void 0:i.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return na(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Hf(this.Ac)&&$0.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class V0{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Na(e)}Cc(e,t,n,i=!1){return new Ul({Ac:e,methodName:t,Dc:n,path:at.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Js(s){const e=s._freezeSettings(),t=Na(s._databaseId);return new V0(s._databaseId,!!e.ignoreUndefinedProperties,t)}function Bl(s,e,t,n,i,r={}){const a=s.Cc(r.merge||r.mergeFields?2:0,e,t,i);Wl("Data must be an object, but it was:",a,n);const o=Gf(n,a);let l,u;if(r.merge)l=new xt(a.fieldMask),u=a.fieldTransforms;else if(r.mergeFields){const d=[];for(const p of r.mergeFields){const m=Zo(e,p,t);if(!a.contains(m))throw new Z(W.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Qf(d,m)||d.push(m)}l=new xt(d),u=a.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,u=a.fieldTransforms;return new O0(new It(o),l,u)}class Ua extends Vl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ua}}function qf(s,e,t,n){const i=s.Cc(1,e,t);Wl("Data must be an object, but it was:",i,n);const r=[],a=It.empty();Kn(n,(l,u)=>{const d=zl(e,l,t);u=Oe(u);const p=i.yc(d);if(u instanceof Ua)r.push(d);else{const m=Zs(u,p);m!=null&&(r.push(d),a.set(d,m))}});const o=new xt(r);return new zf(a,o,i.fieldTransforms)}function jf(s,e,t,n,i,r){const a=s.Cc(1,e,t),o=[Zo(e,n,t)],l=[i];if(r.length%2!=0)throw new Z(W.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<r.length;m+=2)o.push(Zo(e,r[m])),l.push(r[m+1]);const u=[],d=It.empty();for(let m=o.length-1;m>=0;--m)if(!Qf(u,o[m])){const w=o[m];let E=l[m];E=Oe(E);const C=a.yc(w);if(E instanceof Ua)u.push(w);else{const I=Zs(E,C);I!=null&&(u.push(w),d.set(w,I))}}const p=new xt(u);return new zf(d,p,a.fieldTransforms)}function U0(s,e,t,n=!1){return Zs(t,s.Cc(n?4:3,e))}function Zs(s,e){if(Kf(s=Oe(s)))return Wl("Unsupported field value:",e,s),Gf(s,e);if(s instanceof Vl)return function(n,i){if(!Hf(i.Ac))throw i.Sc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${n._methodName}() is not currently supported inside arrays`);const r=n._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(n,i){const r=[];let a=0;for(const o of n){let l=Zs(o,i.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),r.push(l),a++}return{arrayValue:{values:r}}}(s,e)}return function(n,i){if((n=Oe(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Ry(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const r=ke.fromDate(n);return{timestampValue:Jr(i.serializer,r)}}if(n instanceof ke){const r=new ke(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Jr(i.serializer,r)}}if(n instanceof nn)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof $t)return{bytesValue:ff(i.serializer,n._byteString)};if(n instanceof We){const r=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(r))throw i.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:bl(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof sn)return function(a,o){return{mapValue:{fields:{[Bh]:{stringValue:Wh},[Gr]:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw o.Sc("VectorValues must only contain numeric values.");return yl(o.serializer,u)})}}}}}}(n,i);throw i.Sc(`Unsupported field value: ${Ta(n)}`)}(s,e)}function Gf(s,e){const t={};return Fh(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Kn(s,(n,i)=>{const r=Zs(i,e.mc(n));r!=null&&(t[n]=r)}),{mapValue:{fields:t}}}function Kf(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof ke||s instanceof nn||s instanceof $t||s instanceof We||s instanceof Vl||s instanceof sn)}function Wl(s,e,t){if(!Kf(t)||!Mh(t)){const n=Ta(t);throw n==="an object"?e.Sc(s+" a custom object"):e.Sc(s+" "+n)}}function Zo(s,e,t){if((e=Oe(e))instanceof Ys)return e._internalPath;if(typeof e=="string")return zl(s,e);throw na("Field path arguments must be of type string or ",s,!1,void 0,t)}const B0=new RegExp("[~\\*/\\[\\]]");function zl(s,e,t){if(e.search(B0)>=0)throw na(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new Ys(...e.split("."))._internalPath}catch{throw na(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function na(s,e,t,n,i){const r=n&&!n.isEmpty(),a=i!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(r||a)&&(l+=" (found",r&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new Z(W.INVALID_ARGUMENT,o+s+l)}function Qf(s,e){return s.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new We(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new W0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ba("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class W0 extends Yf{data(){return super.data()}}function Ba(s,e){return typeof e=="string"?zl(s,e):e instanceof Ys?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jf(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new Z(W.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hl{}class Zf extends Hl{}function ve(s,e,...t){let n=[];e instanceof Hl&&n.push(e),n=n.concat(t),function(r){const a=r.filter(l=>l instanceof ql).length,o=r.filter(l=>l instanceof Wa).length;if(a>1||a>0&&o>0)throw new Z(W.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)s=i._apply(s);return s}class Wa extends Zf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Wa(e,t,n)}_apply(e){const t=this._parse(e);return Xf(e._query,t),new Yn(e.firestore,e.converter,Bo(e._query,t))}_parse(e){const t=Js(e.firestore);return function(r,a,o,l,u,d,p){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Z(W.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Td(p,d);const E=[];for(const C of p)E.push(Sd(l,r,C));m={arrayValue:{values:E}}}else m=Sd(l,r,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Td(p,d),m=U0(o,a,p,d==="in"||d==="not-in");return Ke.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Re(s,e,t){const n=e,i=Ba("where",s);return Wa._create(i,n,t)}class ql extends Hl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ql(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:zt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,r){let a=i;const o=r.getFlattenedFilters();for(const l of o)Xf(a,l),a=Bo(a,l)}(e._query,t),new Yn(e.firestore,e.converter,Bo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class jl extends Zf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new jl(e,t)}_apply(e){const t=function(i,r,a){if(i.startAt!==null)throw new Z(W.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new Z(W.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new $s(r,a)}(e._query,this._field,this._direction);return new Yn(e.firestore,e.converter,function(i,r){const a=i.explicitOrderBy.concat([r]);return new Yi(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function Ft(s,e="asc"){const t=e,n=Ba("orderBy",s);return jl._create(n,t)}function Sd(s,e,t){if(typeof(t=Oe(t))=="string"){if(t==="")throw new Z(W.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yh(e)&&t.indexOf("/")!==-1)throw new Z(W.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Fe.fromString(t));if(!te.isDocumentKey(n))throw new Z(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Uu(s,new te(n))}if(t instanceof We)return Uu(s,t._key);throw new Z(W.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ta(t)}.`)}function Td(s,e){if(!Array.isArray(s)||s.length===0)throw new Z(W.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Xf(s,e){const t=function(i,r){for(const a of i)for(const o of a.getFlattenedFilters())if(r.indexOf(o.op)>=0)return o.op;return null}(s.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Z(W.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Z(W.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class z0{convertValue(e,t="none"){switch(qn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return je(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Hn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw re(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Kn(e,(i,r)=>{n[i]=this.convertValue(r,t)}),n}convertVectorValue(e){var n,i,r;const t=(r=(i=(n=e.fields)==null?void 0:n[Gr].arrayValue)==null?void 0:i.values)==null?void 0:r.map(a=>je(a.doubleValue));return new sn(t)}convertGeoPoint(e){return new nn(je(e.latitude),je(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Da(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ls(e));default:return null}}convertTimestamp(e){const t=zn(e);return new ke(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Fe.fromString(e);Ae(vf(n),9688,{name:e});const i=new Fs(n.get(1),n.get(3)),r=new te(n.popFirst(5));return i.isEqual(t)||bn(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gl(s,e,t){let n;return n=s?t&&(t.merge||t.mergeFields)?s.toFirestore(e,t):s.toFirestore(e):e,n}class vs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class li extends Yf{constructor(e,t,n,i,r,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $r(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ba("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Z(W.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=li._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}li._jsonSchemaVersion="firestore/documentSnapshot/1.0",li._jsonSchema={type:Qe("string",li._jsonSchemaVersion),bundleSource:Qe("string","DocumentSnapshot"),bundleName:Qe("string"),bundle:Qe("string")};class $r extends li{data(e={}){return super.data(e)}}class ci{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new vs(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new $r(this._firestore,this._userDataWriter,n.key,n,new vs(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Z(W.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(o=>{const l=new $r(i._firestore,i._userDataWriter,o.doc.key,o.doc,new vs(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>r||o.type!==3).map(o=>{const l=new $r(i._firestore,i._userDataWriter,o.doc.key,o.doc,new vs(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,d=-1;return o.type!==0&&(u=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),d=a.indexOf(o.doc.key)),{type:H0(o.type),doc:l,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Z(W.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ci._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=hl.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach(r=>{r._document!==null&&(t.push(r._document),n.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),i.push(r.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function H0(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return re(61501,{type:s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ep(s){s=Et(s,We);const e=Et(s.firestore,ln);return P0(Qs(e),s._key).then(t=>tp(e,s,t))}ci._jsonSchemaVersion="firestore/querySnapshot/1.0",ci._jsonSchema={type:Qe("string",ci._jsonSchemaVersion),bundleSource:Qe("string","QuerySnapshot"),bundleName:Qe("string"),bundle:Qe("string")};class Kl extends z0{constructor(e){super(),this.firestore=e}convertBytes(e){return new $t(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new We(this.firestore,null,t)}}function st(s){s=Et(s,Yn);const e=Et(s.firestore,ln),t=Qs(e),n=new Kl(e);return Jf(s._query),M0(t,s._query).then(i=>new ci(e,n,s,i))}function ia(s,e,t){s=Et(s,We);const n=Et(s.firestore,ln),i=Gl(s.converter,e,t);return Xs(n,[Bl(Js(n),"setDoc",s._key,i,s.converter!==null,t).toMutation(s._key,St.none())])}function Cn(s,e,t,...n){s=Et(s,We);const i=Et(s.firestore,ln),r=Js(i);let a;return a=typeof(e=Oe(e))=="string"||e instanceof Ys?jf(r,"updateDoc",s._key,e,t,n):qf(r,"updateDoc",s._key,e),Xs(i,[a.toMutation(s._key,St.exists(!0))])}function Or(s){return Xs(Et(s.firestore,ln),[new La(s._key,St.none())])}function si(s,e){const t=Et(s.firestore,ln),n=Be(s),i=Gl(s.converter,e);return Xs(t,[Bl(Js(s.firestore),"addDoc",n._key,i,s.converter!==null,{}).toMutation(n._key,St.exists(!1))]).then(()=>n)}function Rr(s,...e){var l,u,d;s=Oe(s);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||Ed(e[n])||(t=e[n++]);const i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Ed(e[n])){const p=e[n];e[n]=(l=p.next)==null?void 0:l.bind(p),e[n+1]=(u=p.error)==null?void 0:u.bind(p),e[n+2]=(d=p.complete)==null?void 0:d.bind(p)}let r,a,o;if(s instanceof We)a=Et(s.firestore,ln),o=Ra(s._key.path),r={next:p=>{e[n]&&e[n](tp(a,s,p))},error:e[n+1],complete:e[n+2]};else{const p=Et(s,Yn);a=Et(p.firestore,ln),o=p._query;const m=new Kl(a);r={next:w=>{e[n]&&e[n](new ci(a,m,p,w))},error:e[n+1],complete:e[n+2]},Jf(s._query)}return function(m,w,E,C){const I=new Ol(C),B=new Fl(w,I,E);return m.asyncQueue.enqueueAndForget(async()=>Pl(await ta(m),B)),()=>{I.Nu(),m.asyncQueue.enqueueAndForget(async()=>Ml(await ta(m),B))}}(Qs(a),o,i,r)}function Xs(s,e){return function(n,i){const r=new yn;return n.asyncQueue.enqueueAndForget(async()=>w0(await x0(n),i,r)),r.promise}(Qs(s),e)}function tp(s,e,t){const n=t.docs.get(e._key),i=new Kl(s);return new li(s,i,e._key,n,new vs(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Js(e)}set(e,t,n){this._verifyNotCommitted();const i=Eo(e,this._firestore),r=Gl(i.converter,t,n),a=Bl(this._dataReader,"WriteBatch.set",i._key,r,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,St.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const r=Eo(e,this._firestore);let a;return a=typeof(t=Oe(t))=="string"||t instanceof Ys?jf(this._dataReader,"WriteBatch.update",r._key,t,n,i):qf(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(a.toMutation(r._key,St.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Eo(e,this._firestore);return this._mutations=this._mutations.concat(new La(t._key,St.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Z(W.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Eo(s,e){if((s=Oe(s)).firestore!==e)throw new Z(W.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(s){return Qs(s=Et(s,ln)),new q0(s,e=>Xs(s,e))}(function(e,t=!0){(function(i){Gi=i})(vi),di(new Bn("firestore",(n,{instanceIdentifier:i,options:r})=>{const a=n.getProvider("app").getImmediate(),o=new ln(new B_(n.getProvider("auth-internal")),new H_(a,n.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Z(W.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fs(u.options.projectId,d)}(a,i),a);return r={useFetchStreams:t,...r},o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),Xt(Au,Du,e),Xt(Au,Du,"esm2020")})();var j0="firebase",G0="12.0.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xt(j0,G0,"app");function np(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const K0=np,ip=new Ws("auth","Firebase",np());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sa=new ll("@firebase/auth");function Q0(s,...e){sa.logLevel<=ge.WARN&&sa.warn(`Auth (${vi}): ${s}`,...e)}function Vr(s,...e){sa.logLevel<=ge.ERROR&&sa.error(`Auth (${vi}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(s,...e){throw Ql(s,...e)}function rn(s,...e){return Ql(s,...e)}function sp(s,e,t){const n={...K0(),[e]:t};return new Ws("auth","Firebase",n).create(e,{appName:s.name})}function vn(s){return sp(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ql(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return ip.create(s,...e)}function se(s,e,...t){if(!s)throw Ql(e,...t)}function gn(s){const e="INTERNAL ASSERTION FAILED: "+s;throw Vr(e),new Error(e)}function En(s,e){s||gn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xo(){var s;return typeof self<"u"&&((s=self.location)==null?void 0:s.href)||""}function Y0(){return Id()==="http:"||Id()==="https:"}function Id(){var s;return typeof self<"u"&&((s=self.location)==null?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J0(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Y0()||ym()||"connection"in navigator)?navigator.onLine:!0}function Z0(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e,t){this.shortDelay=e,this.longDelay=t,En(t>e,"Short delay should be less than long delay!"),this.isMobile=gm()||vm()}get(){return J0()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yl(s,e){En(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;gn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;gn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;gn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X0={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tw=new er(3e4,6e4);function Sn(s,e){return s.tenantId&&!e.tenantId?{...e,tenantId:s.tenantId}:e}async function qt(s,e,t,n,i={}){return ap(s,i,async()=>{let r={},a={};n&&(e==="GET"?a=n:r={body:JSON.stringify(n)});const o=zs({key:s.config.apiKey,...a}).slice(1),l=await s._getAdditionalHeaders();l["Content-Type"]="application/json",s.languageCode&&(l["X-Firebase-Locale"]=s.languageCode);const u={method:e,headers:l,...r};return _m()||(u.referrerPolicy="no-referrer"),s.emulatorConfig&&yi(s.emulatorConfig.host)&&(u.credentials="include"),rp.fetch()(await op(s,s.config.apiHost,t,o),u)})}async function ap(s,e,t){s._canInitEmulator=!1;const n={...X0,...e};try{const i=new iw(s),r=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await r.json();if("needConfirmation"in a)throw Cr(s,"account-exists-with-different-credential",a);if(r.ok&&!("errorMessage"in a))return a;{const o=r.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Cr(s,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Cr(s,"email-already-in-use",a);if(l==="USER_DISABLED")throw Cr(s,"user-disabled",a);const d=n[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw sp(s,d,u);Ht(s,d)}}catch(i){if(i instanceof un)throw i;Ht(s,"network-request-failed",{message:String(i)})}}async function tr(s,e,t,n,i={}){const r=await qt(s,e,t,n,i);return"mfaPendingCredential"in r&&Ht(s,"multi-factor-auth-required",{_serverResponse:r}),r}async function op(s,e,t,n){const i=`${e}${t}?${n}`,r=s,a=r.config.emulator?Yl(s.config,i):`${s.config.apiScheme}://${i}`;return ew.includes(t)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(a).toString():a}function nw(s){switch(s){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class iw{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(rn(this.auth,"network-request-failed")),tw.get())})}}function Cr(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=rn(s,e,n);return i.customData._tokenResponse=t,i}function Ad(s){return s!==void 0&&s.enterprise!==void 0}class sw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return nw(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function rw(s,e){return qt(s,"GET","/v2/recaptchaConfig",Sn(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aw(s,e){return qt(s,"POST","/v1/accounts:delete",e)}async function ra(s,e){return qt(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ts(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ow(s,e=!1){const t=Oe(s),n=await t.getIdToken(e),i=Jl(n);se(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,a=r==null?void 0:r.sign_in_provider;return{claims:i,token:n,authTime:Ts(So(i.auth_time)),issuedAtTime:Ts(So(i.iat)),expirationTime:Ts(So(i.exp)),signInProvider:a||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function So(s){return Number(s)*1e3}function Jl(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return Vr("JWT malformed, contained fewer than 3 sections"),null;try{const i=fh(t);return i?JSON.parse(i):(Vr("Failed to decode base64 JWT payload"),null)}catch(i){return Vr("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function Dd(s){const e=Jl(s);return se(e,"internal-error"),se(typeof e.exp<"u","internal-error"),se(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pi(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof un&&lw(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function lw({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ts(this.lastLoginAt),this.creationTime=Ts(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aa(s){var p;const e=s.auth,t=await s.getIdToken(),n=await pi(s,ra(e,{idToken:t}));se(n==null?void 0:n.users.length,e,"internal-error");const i=n.users[0];s._notifyReloadListener(i);const r=(p=i.providerUserInfo)!=null&&p.length?lp(i.providerUserInfo):[],a=dw(s.providerData,r),o=s.isAnonymous,l=!(s.email&&i.passwordHash)&&!(a!=null&&a.length),u=o?l:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new el(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(s,d)}async function uw(s){const e=Oe(s);await aa(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function dw(s,e){return[...s.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function lp(s){return s.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hw(s,e){const t=await ap(s,{},async()=>{const n=zs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=s.config,a=await op(s,i,"/v1/token",`key=${r}`),o=await s._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:n};return s.emulatorConfig&&yi(s.emulatorConfig.host)&&(l.credentials="include"),rp.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function fw(s,e){return qt(s,"POST","/v2/accounts:revokeToken",Sn(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){se(e.idToken,"internal-error"),se(typeof e.idToken<"u","internal-error"),se(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Dd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){se(e.length!==0,"internal-error");const t=Dd(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(se(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await hw(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,a=new Ni;return n&&(se(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),i&&(se(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),r&&(se(typeof r=="number","internal-error",{appName:e}),a.expirationTime=r),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ni,this.toJSON())}_performRefresh(){return gn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(s,e){se(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class Bt{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new cw(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new el(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await pi(this,this.stsTokenManager.getToken(this.auth,e));return se(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ow(this,e)}reload(){return uw(this)}_assign(e){this!==e&&(se(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Bt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){se(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await aa(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ct(this.auth.app))return Promise.reject(vn(this.auth));const e=await this.getIdToken();return await pi(this,aw(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:p,emailVerified:m,isAnonymous:w,providerData:E,stsTokenManager:C}=t;se(p&&C,e,"internal-error");const I=Ni.fromJSON(this.name,C);se(typeof p=="string",e,"internal-error"),Dn(n,e.name),Dn(i,e.name),se(typeof m=="boolean",e,"internal-error"),se(typeof w=="boolean",e,"internal-error"),Dn(r,e.name),Dn(a,e.name),Dn(o,e.name),Dn(l,e.name),Dn(u,e.name),Dn(d,e.name);const B=new Bt({uid:p,auth:e,email:i,emailVerified:m,displayName:n,isAnonymous:w,photoURL:a,phoneNumber:r,tenantId:o,stsTokenManager:I,createdAt:u,lastLoginAt:d});return E&&Array.isArray(E)&&(B.providerData=E.map(G=>({...G}))),l&&(B._redirectEventId=l),B}static async _fromIdTokenResponse(e,t,n=!1){const i=new Ni;i.updateFromServerResponse(t);const r=new Bt({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await aa(r),r}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];se(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?lp(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),o=new Ni;o.updateFromIdToken(n);const l=new Bt({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:a}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new el(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rd=new Map;function mn(s){En(s instanceof Function,"Expected a class definition");let e=Rd.get(s);return e?(En(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,Rd.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}cp.type="NONE";const Cd=cp;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ur(s,e,t){return`firebase:${s}:${e}:${t}`}class $i{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=Ur(this.userKey,i.apiKey,r),this.fullPersistenceKey=Ur("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ra(this.auth,{idToken:e}).catch(()=>{});return t?Bt._fromGetAccountInfoResponse(this.auth,t,e):null}return Bt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new $i(mn(Cd),e,n);const i=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let r=i[0]||mn(Cd);const a=Ur(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{const d=await u._get(a);if(d){let p;if(typeof d=="string"){const m=await ra(e,{idToken:d}).catch(()=>{});if(!m)break;p=await Bt._fromGetAccountInfoResponse(e,m,d)}else p=Bt._fromJSON(e,d);u!==r&&(o=p),r=u;break}}catch{}const l=i.filter(u=>u._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new $i(r,e,n):(r=l[0],o&&await r._set(a,o.toJSON()),await Promise.all(t.map(async u=>{if(u!==r)try{await u._remove(a)}catch{}})),new $i(r,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xd(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(up(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(gp(e))return"Blackberry";if(mp(e))return"Webos";if(dp(e))return"Safari";if((e.includes("chrome/")||hp(e))&&!e.includes("edge/"))return"Chrome";if(pp(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function up(s=yt()){return/firefox\//i.test(s)}function dp(s=yt()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function hp(s=yt()){return/crios\//i.test(s)}function fp(s=yt()){return/iemobile/i.test(s)}function pp(s=yt()){return/android/i.test(s)}function gp(s=yt()){return/blackberry/i.test(s)}function mp(s=yt()){return/webos/i.test(s)}function Zl(s=yt()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function pw(s=yt()){var e;return Zl(s)&&!!((e=window.navigator)!=null&&e.standalone)}function gw(){return wm()&&document.documentMode===10}function _p(s=yt()){return Zl(s)||pp(s)||mp(s)||gp(s)||/windows phone/i.test(s)||fp(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yp(s,e=[]){let t;switch(s){case"Browser":t=xd(yt());break;case"Worker":t=`${xd(yt())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${vi}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=r=>new Promise((a,o)=>{try{const l=e(r);a(l)}catch(l){o(l)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _w(s,e={}){return qt(s,"GET","/v2/passwordPolicy",Sn(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yw=6;class vw{constructor(e){var n;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??yw,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((n=e.allowedNonAlphanumericCharacters)==null?void 0:n.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Pd(this),this.idTokenSubscription=new Pd(this),this.beforeStateQueue=new mw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ip,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=mn(t)),this._initializationPromise=this.queue(async()=>{var n,i,r;if(!this._deleted&&(this.persistenceManager=await $i.create(this,e),(n=this._resolvePersistenceManagerAvailable)==null||n.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)==null?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ra(this,{idToken:e}),n=await Bt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Ct(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(r=this.redirectUser)==null?void 0:r._redirectEventId,o=n==null?void 0:n._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(n=l.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(a){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return se(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await aa(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Z0()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ct(this.app))return Promise.reject(vn(this));const t=e?Oe(e):null;return t&&se(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&se(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ct(this.app)?Promise.reject(vn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ct(this.app)?Promise.reject(vn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await _w(this),t=new vw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ws("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await fw(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&mn(e)||this._popupRedirectResolver;se(t,this,"argument-error"),this.redirectPersistenceManager=await $i.create(this,[mn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)==null?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(se(o,this,"internal-error"),o.then(()=>{a||r(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,n,i);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return se(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){var t;if(Ct(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&Q0(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Jn(s){return Oe(s)}class Pd{constructor(e){this.auth=e,this.observer=null,this.addObserver=Dm(t=>this.observer=t)}get next(){return se(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let za={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function bw(s){za=s}function vp(s){return za.loadJS(s)}function kw(){return za.recaptchaEnterpriseScript}function Ew(){return za.gapiScript}function Sw(s){return`__${s}${Math.floor(Math.random()*1e6)}`}class Tw{constructor(){this.enterprise=new Iw}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Iw{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Aw="recaptcha-enterprise",wp="NO_RECAPTCHA";class Dw{constructor(e){this.type=Aw,this.auth=Jn(e)}async verify(e="verify",t=!1){async function n(r){if(!t){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(a,o)=>{rw(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new sw(l);return r.tenantId==null?r._agentRecaptchaConfig=u:r._tenantRecaptchaConfigs[r.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function i(r,a,o){const l=window.grecaptcha;Ad(l)?l.enterprise.ready(()=>{l.enterprise.execute(r,{action:e}).then(u=>{a(u)}).catch(()=>{a(wp)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Tw().execute("siteKey",{action:"verify"}):new Promise((r,a)=>{n(this.auth).then(o=>{if(!t&&Ad(window.grecaptcha))i(o,r,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=kw();l.length!==0&&(l+=o),vp(l).then(()=>{i(o,r,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function Md(s,e,t,n=!1,i=!1){const r=new Dw(s);let a;if(i)a=wp;else try{a=await r.verify(t)}catch{a=await r.verify(t,!0)}const o={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,u=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function oa(s,e,t,n,i){var r;if((r=s._getRecaptchaConfig())!=null&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Md(s,e,t,t==="getOobCode");return n(s,a)}else return n(s,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Md(s,e,t,t==="getOobCode");return n(s,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rw(s,e){const t=Sa(s,"auth");if(t.isInitialized()){const i=t.getImmediate(),r=t.getOptions();if(ui(r,e??{}))return i;Ht(i,"already-initialized")}return t.initialize({options:e})}function Cw(s,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(mn);e!=null&&e.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function xw(s,e,t){const n=Jn(s);se(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,r=bp(e),{host:a,port:o}=Pw(e),l=o===null?"":`:${o}`,u={url:`${r}//${a}${l}/`},d=Object.freeze({host:a,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){se(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),se(ui(u,n.config.emulator)&&ui(d,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=u,n.emulatorConfig=d,n.settings.appVerificationDisabledForTesting=!0,yi(a)?(al(`${r}//${a}${l}`),ol("Auth",!0)):Mw()}function bp(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function Pw(s){const e=bp(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const r=i[1];return{host:r,port:Ld(n.substr(r.length+1))}}else{const[r,a]=n.split(":");return{host:r,port:Ld(a)}}}function Ld(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function Mw(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return gn("not implemented")}_getIdTokenResponse(e){return gn("not implemented")}_linkToIdToken(e,t){return gn("not implemented")}_getReauthenticationResolver(e){return gn("not implemented")}}async function Lw(s,e){return qt(s,"POST","/v1/accounts:update",e)}async function Fw(s,e){return qt(s,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nw(s,e){return tr(s,"POST","/v1/accounts:signInWithPassword",Sn(s,e))}async function $w(s,e){return qt(s,"POST","/v1/accounts:sendOobCode",Sn(s,e))}async function Ow(s,e){return $w(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vw(s,e){return tr(s,"POST","/v1/accounts:signInWithEmailLink",Sn(s,e))}async function Uw(s,e){return tr(s,"POST","/v1/accounts:signInWithEmailLink",Sn(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us extends Xl{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Us(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Us(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oa(e,t,"signInWithPassword",Nw);case"emailLink":return Vw(e,{email:this._email,oobCode:this._password});default:Ht(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oa(e,n,"signUpPassword",Fw);case"emailLink":return Uw(e,{idToken:t,email:this._email,oobCode:this._password});default:Ht(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oi(s,e){return tr(s,"POST","/v1/accounts:signInWithIdp",Sn(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw="http://localhost";class gi extends Xl{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new gi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ht("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i,...r}=t;if(!n||!i)return null;const a=new gi(n,i);return a.idToken=r.idToken||void 0,a.accessToken=r.accessToken||void 0,a.secret=r.secret,a.nonce=r.nonce,a.pendingToken=r.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Oi(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Oi(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Oi(e,t)}buildRequest(){const e={requestUri:Bw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=zs(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ww(s){switch(s){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function zw(s){const e=ps(gs(s)).link,t=e?ps(gs(e)).deep_link_id:null,n=ps(gs(s)).deep_link_id;return(n?ps(gs(n)).link:null)||n||t||e||s}class ec{constructor(e){const t=ps(gs(e)),n=t.apiKey??null,i=t.oobCode??null,r=Ww(t.mode??null);se(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=zw(e);try{return new ec(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(){this.providerId=Zi.PROVIDER_ID}static credential(e,t){return Us._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ec.parseLink(t);return se(n,"argument-error"),Us._fromEmailAndCode(e,n.code,n.tenantId)}}Zi.PROVIDER_ID="password";Zi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Zi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr extends kp{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn extends nr{constructor(){super("facebook.com")}static credential(e){return gi._fromParams({providerId:xn.PROVIDER_ID,signInMethod:xn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xn.credentialFromTaggedObject(e)}static credentialFromError(e){return xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xn.credential(e.oauthAccessToken)}catch{return null}}}xn.FACEBOOK_SIGN_IN_METHOD="facebook.com";xn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn extends nr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return gi._fromParams({providerId:Pn.PROVIDER_ID,signInMethod:Pn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Pn.credentialFromTaggedObject(e)}static credentialFromError(e){return Pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Pn.credential(t,n)}catch{return null}}}Pn.GOOGLE_SIGN_IN_METHOD="google.com";Pn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn extends nr{constructor(){super("github.com")}static credential(e){return gi._fromParams({providerId:Mn.PROVIDER_ID,signInMethod:Mn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Mn.credentialFromTaggedObject(e)}static credentialFromError(e){return Mn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Mn.credential(e.oauthAccessToken)}catch{return null}}}Mn.GITHUB_SIGN_IN_METHOD="github.com";Mn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln extends nr{constructor(){super("twitter.com")}static credential(e,t){return gi._fromParams({providerId:Ln.PROVIDER_ID,signInMethod:Ln.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ln.credentialFromTaggedObject(e)}static credentialFromError(e){return Ln.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ln.credential(t,n)}catch{return null}}}Ln.TWITTER_SIGN_IN_METHOD="twitter.com";Ln.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hw(s,e){return tr(s,"POST","/v1/accounts:signUp",Sn(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await Bt._fromIdTokenResponse(e,n,i),a=Fd(n);return new mi({user:r,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=Fd(n);return new mi({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function Fd(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la extends un{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,la.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new la(e,t,n,i)}}function Ep(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?la._fromErrorAndOperation(s,r,e,n):r})}async function qw(s,e,t=!1){const n=await pi(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return mi._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jw(s,e,t=!1){const{auth:n}=s;if(Ct(n.app))return Promise.reject(vn(n));const i="reauthenticate";try{const r=await pi(s,Ep(n,i,e,s),t);se(r.idToken,n,"internal-error");const a=Jl(r.idToken);se(a,n,"internal-error");const{sub:o}=a;return se(s.uid===o,n,"user-mismatch"),mi._forOperation(s,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Ht(n,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sp(s,e,t=!1){if(Ct(s.app))return Promise.reject(vn(s));const n="signIn",i=await Ep(s,n,e),r=await mi._fromIdTokenResponse(s,n,i);return t||await s._updateCurrentUser(r.user),r}async function Gw(s,e){return Sp(Jn(s),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tp(s){const e=Jn(s);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Kw(s,e,t){const n=Jn(s);await oa(n,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Ow)}async function Qw(s,e,t){if(Ct(s.app))return Promise.reject(vn(s));const n=Jn(s),a=await oa(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hw).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Tp(s),l}),o=await mi._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(o.user),o}function Yw(s,e,t){return Ct(s.app)?Promise.reject(vn(s)):Gw(Oe(s),Zi.credential(e,t)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&Tp(s),n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jw(s,e){return qt(s,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zw(s,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const n=Oe(s),r={idToken:await n.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await pi(n,Jw(n.auth,r));n.displayName=a.displayName||null,n.photoURL=a.photoUrl||null;const o=n.providerData.find(({providerId:l})=>l==="password");o&&(o.displayName=n.displayName,o.photoURL=n.photoURL),await n._updateTokensIfNecessary(a)}function Xw(s,e){return eb(Oe(s),null,e)}async function eb(s,e,t){const{auth:n}=s,r={idToken:await s.getIdToken(),returnSecureToken:!0};t&&(r.password=t);const a=await pi(s,Lw(n,r));await s._updateTokensIfNecessary(a,!0)}function tb(s,e,t,n){return Oe(s).onIdTokenChanged(e,t,n)}function nb(s,e,t){return Oe(s).beforeAuthStateChanged(e,t)}function ib(s,e,t,n){return Oe(s).onAuthStateChanged(e,t,n)}function sb(s){return Oe(s).signOut()}const ca="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ca,"1"),this.storage.removeItem(ca),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rb=1e3,ab=10;class Ap extends Ip{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_p(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(n);!t&&this.localCache[n]===a||this.notifyListeners(n,a)},r=this.storage.getItem(n);gw()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,ab):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},rb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ap.type="LOCAL";const ob=Ap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp extends Ip{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Dp.type="SESSION";const Rp=Dp;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lb(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const n=new Ha(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(a).map(async u=>u(t.origin,r)),l=await lb(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ha.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,a;return new Promise((o,l)=>{const u=tc("",20);i.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},n);a={messageChannel:i,onMessage(p){const m=p;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(d),r=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(m.data.response);break;default:clearTimeout(d),clearTimeout(r),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function an(){return window}function ub(s){an().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cp(){return typeof an().WorkerGlobalScope<"u"&&typeof an().importScripts=="function"}async function db(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hb(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)==null?void 0:s.controller)||null}function fb(){return Cp()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp="firebaseLocalStorageDb",pb=1,ua="firebaseLocalStorage",Pp="fbase_key";class ir{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function qa(s,e){return s.transaction([ua],e?"readwrite":"readonly").objectStore(ua)}function gb(){const s=indexedDB.deleteDatabase(xp);return new ir(s).toPromise()}function tl(){const s=indexedDB.open(xp,pb);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(ua,{keyPath:Pp})}catch(i){t(i)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(ua)?e(n):(n.close(),await gb(),e(await tl()))})})}async function Nd(s,e,t){const n=qa(s,!0).put({[Pp]:e,value:t});return new ir(n).toPromise()}async function mb(s,e){const t=qa(s,!1).get(e),n=await new ir(t).toPromise();return n===void 0?null:n.value}function $d(s,e){const t=qa(s,!0).delete(e);return new ir(t).toPromise()}const _b=800,yb=3;class Mp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await tl(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>yb)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Cp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ha._getInstance(fb()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,n;if(this.activeServiceWorker=await db(),!this.activeServiceWorker)return;this.sender=new cb(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(n=e[0])!=null&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||hb()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await tl();return await Nd(e,ca,"1"),await $d(e,ca),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Nd(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>mb(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>$d(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=qa(i,!1).getAll();return new ir(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_b)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Mp.type="LOCAL";const vb=Mp;new er(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wb(s,e){return e?mn(e):(se(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc extends Xl{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Oi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Oi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Oi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function bb(s){return Sp(s.auth,new nc(s),s.bypassAuthState)}function kb(s){const{auth:e,user:t}=s;return se(t,e,"internal-error"),jw(t,new nc(s),s.bypassAuthState)}async function Eb(s){const{auth:e,user:t}=s;return se(t,e,"internal-error"),qw(t,new nc(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return bb;case"linkViaPopup":case"linkViaRedirect":return Eb;case"reauthViaPopup":case"reauthViaRedirect":return kb;default:Ht(this.auth,"internal-error")}}resolve(e){En(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){En(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sb=new er(2e3,1e4);class Mi extends Lp{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,Mi.currentPopupAction&&Mi.currentPopupAction.cancel(),Mi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return se(e,this.auth,"internal-error"),e}async onExecution(){En(this.filter.length===1,"Popup operations only handle one event");const e=tc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(rn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(rn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Mi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if((n=(t=this.authWindow)==null?void 0:t.window)!=null&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(rn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Sb.get())};e()}}Mi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tb="pendingRedirect",Br=new Map;class Ib extends Lp{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Br.get(this.auth._key());if(!e){try{const n=await Ab(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Br.set(this.auth._key(),e)}return this.bypassAuthState||Br.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Ab(s,e){const t=Cb(e),n=Rb(s);if(!await n._isAvailable())return!1;const i=await n._get(t)==="true";return await n._remove(t),i}function Db(s,e){Br.set(s._key(),e)}function Rb(s){return mn(s._redirectPersistence)}function Cb(s){return Ur(Tb,s.config.apiKey,s.name)}async function xb(s,e,t=!1){if(Ct(s.app))return Promise.reject(vn(s));const n=Jn(s),i=wb(n,e),a=await new Ib(n,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pb=10*60*1e3;class Mb{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Lb(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Fp(e)){const i=((n=e.error.code)==null?void 0:n.split("auth/")[1])||"internal-error";t.onError(rn(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Pb&&this.cachedEventUids.clear(),this.cachedEventUids.has(Od(e))}saveEventToCache(e){this.cachedEventUids.add(Od(e)),this.lastProcessedEventTime=Date.now()}}function Od(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function Fp({type:s,error:e}){return s==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Lb(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Fp(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fb(s,e={}){return qt(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nb=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$b=/^https?/;async function Ob(s){if(s.config.emulator)return;const{authorizedDomains:e}=await Fb(s);for(const t of e)try{if(Vb(t))return}catch{}Ht(s,"unauthorized-domain")}function Vb(s){const e=Xo(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const a=new URL(s);return a.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===n}if(!$b.test(t))return!1;if(Nb.test(s))return n===s;const i=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ub=new er(3e4,6e4);function Vd(){const s=an().___jsl;if(s!=null&&s.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function Bb(s){return new Promise((e,t)=>{var i,r,a;function n(){Vd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Vd(),t(rn(s,"network-request-failed"))},timeout:Ub.get()})}if((r=(i=an().gapi)==null?void 0:i.iframes)!=null&&r.Iframe)e(gapi.iframes.getContext());else if((a=an().gapi)!=null&&a.load)n();else{const o=Sw("iframefcb");return an()[o]=()=>{gapi.load?n():t(rn(s,"network-request-failed"))},vp(`${Ew()}?onload=${o}`).catch(l=>t(l))}}).catch(e=>{throw Wr=null,e})}let Wr=null;function Wb(s){return Wr=Wr||Bb(s),Wr}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zb=new er(5e3,15e3),Hb="__/auth/iframe",qb="emulator/auth/iframe",jb={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Gb=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Kb(s){const e=s.config;se(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?Yl(e,qb):`https://${s.config.authDomain}/${Hb}`,n={apiKey:e.apiKey,appName:s.name,v:vi},i=Gb.get(s.config.apiHost);i&&(n.eid=i);const r=s._getFrameworks();return r.length&&(n.fw=r.join(",")),`${t}?${zs(n).slice(1)}`}async function Qb(s){const e=await Wb(s),t=an().gapi;return se(t,s,"internal-error"),e.open({where:document.body,url:Kb(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jb,dontclear:!0},n=>new Promise(async(i,r)=>{await n.restyle({setHideOnLeave:!1});const a=rn(s,"network-request-failed"),o=an().setTimeout(()=>{r(a)},zb.get());function l(){an().clearTimeout(o),i(n)}n.ping(l).then(l,()=>{r(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Jb=500,Zb=600,Xb="_blank",e1="http://localhost";class Ud{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function t1(s,e,t,n=Jb,i=Zb){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let o="";const l={...Yb,width:n.toString(),height:i.toString(),top:r,left:a},u=yt().toLowerCase();t&&(o=hp(u)?Xb:t),up(u)&&(e=e||e1,l.scrollbars="yes");const d=Object.entries(l).reduce((m,[w,E])=>`${m}${w}=${E},`,"");if(pw(u)&&o!=="_self")return n1(e||"",o),new Ud(null);const p=window.open(e||"",o,d);se(p,s,"popup-blocked");try{p.focus()}catch{}return new Ud(p)}function n1(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1="__/auth/handler",s1="emulator/auth/handler",r1=encodeURIComponent("fac");async function Bd(s,e,t,n,i,r){se(s.config.authDomain,s,"auth-domain-config-required"),se(s.config.apiKey,s,"invalid-api-key");const a={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:vi,eventId:i};if(e instanceof kp){e.setDefaultLanguage(s.languageCode),a.providerId=e.providerId||"",Am(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,p]of Object.entries({}))a[d]=p}if(e instanceof nr){const d=e.getScopes().filter(p=>p!=="");d.length>0&&(a.scopes=d.join(","))}s.tenantId&&(a.tid=s.tenantId);const o=a;for(const d of Object.keys(o))o[d]===void 0&&delete o[d];const l=await s._getAppCheckToken(),u=l?`#${r1}=${encodeURIComponent(l)}`:"";return`${a1(s)}?${zs(o).slice(1)}${u}`}function a1({config:s}){return s.emulator?Yl(s,s1):`https://${s.authDomain}/${i1}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To="webStorageSupport";class o1{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Rp,this._completeRedirectFn=xb,this._overrideRedirectResult=Db}async _openPopup(e,t,n,i){var a;En((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const r=await Bd(e,t,n,Xo(),i);return t1(e,r,tc())}async _openRedirect(e,t,n,i){await this._originValidation(e);const r=await Bd(e,t,n,Xo(),i);return ub(r),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:r}=this.eventManagers[t];return i?Promise.resolve(i):(En(r,"If manager is not set, promise should be"),r)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Qb(e),n=new Mb(e);return t.register("authEvent",i=>(se(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(To,{type:To},i=>{var a;const r=(a=i==null?void 0:i[0])==null?void 0:a[To];r!==void 0&&t(!!r),Ht(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ob(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return _p()||dp()||Zl()}}const l1=o1;var Wd="@firebase/auth",zd="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){se(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u1(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function d1(s){di(new Bn("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;se(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const l={apiKey:a,authDomain:o,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yp(s)},u=new ww(n,i,r,l);return Cw(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),di(new Bn("auth-internal",e=>{const t=Jn(e.getProvider("auth").getImmediate());return(n=>new c1(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Xt(Wd,zd,u1(s)),Xt(Wd,zd,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h1=5*60,f1=_h("authIdTokenMaxAge")||h1;let Hd=null;const p1=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>f1)return;const i=t==null?void 0:t.token;Hd!==i&&(Hd=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function g1(s=ul()){const e=Sa(s,"auth");if(e.isInitialized())return e.getImmediate();const t=Rw(s,{popupRedirectResolver:l1,persistence:[vb,ob,Rp]}),n=_h("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(n,location.origin);if(location.origin===r.origin){const a=p1(r.toString());nb(t,a,()=>a(t.currentUser)),tb(t,o=>a(o))}}const i=ph("auth");return i&&xw(t,`http://${i}`),t}function m1(){var s;return((s=document.getElementsByTagName("head"))==null?void 0:s[0])??document}bw({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=i=>{const r=rn("internal-error");r.customData=i,t(r)},n.type="text/javascript",n.charset="UTF-8",m1().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});d1("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Np="firebasestorage.googleapis.com",_1="storageBucket",y1=2*60*1e3,v1=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn extends un{constructor(e,t,n=0){super(Io(e),`Firebase Storage: ${t} (${Io(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,dn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Io(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var cn;(function(s){s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(cn||(cn={}));function Io(s){return"storage/"+s}function w1(){const s="An unknown error occurred, please check the error payload for server response.";return new dn(cn.UNKNOWN,s)}function b1(){return new dn(cn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function k1(){return new dn(cn.CANCELED,"User canceled the upload/download.")}function E1(s){return new dn(cn.INVALID_URL,"Invalid URL '"+s+"'.")}function S1(s){return new dn(cn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function qd(s){return new dn(cn.INVALID_ARGUMENT,s)}function $p(){return new dn(cn.APP_DELETED,"The Firebase app was deleted.")}function T1(s){return new dn(cn.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Wt.makeFromUrl(e,t)}catch{return new Wt(e,"")}if(n.path==="")return n;throw S1(e)}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";function r(K){K.path.charAt(K.path.length-1)==="/"&&(K.path_=K.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+i+a,"i"),l={bucket:1,path:3};function u(K){K.path_=decodeURIComponent(K.path)}const d="v[A-Za-z0-9_]+",p=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",w=new RegExp(`^https?://${p}/${d}/b/${i}/o${m}`,"i"),E={bucket:1,path:3},C=t===Np?"(?:storage.googleapis.com|storage.cloud.google.com)":t,I="([^?#]*)",B=new RegExp(`^https?://${C}/${i}/${I}`,"i"),Y=[{regex:o,indices:l,postModify:r},{regex:w,indices:E,postModify:u},{regex:B,indices:{bucket:1,path:2},postModify:u}];for(let K=0;K<Y.length;K++){const ee=Y[K],ae=ee.regex.exec(e);if(ae){const M=ae[ee.indices.bucket];let A=ae[ee.indices.path];A||(A=""),n=new Wt(M,A),ee.postModify(n);break}}if(n==null)throw E1(e);return n}}class I1{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A1(s,e,t){let n=1,i=null,r=null,a=!1,o=0;function l(){return o===2}let u=!1;function d(...I){u||(u=!0,e.apply(null,I))}function p(I){i=setTimeout(()=>{i=null,s(w,l())},I)}function m(){r&&clearTimeout(r)}function w(I,...B){if(u){m();return}if(I){m(),d.call(null,I,...B);return}if(l()||a){m(),d.call(null,I,...B);return}n<64&&(n*=2);let Y;o===1?(o=2,Y=0):Y=(n+Math.random())*1e3,p(Y)}let E=!1;function C(I){E||(E=!0,m(),!u&&(i!==null?(I||(o=2),clearTimeout(i),p(0)):I||(o=1)))}return p(0),r=setTimeout(()=>{a=!0,C(!0)},t),C}function D1(s){s(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R1(s){return s!==void 0}function jd(s,e,t,n){if(n<e)throw qd(`Invalid value for '${s}'. Expected ${e} or greater.`);if(n>t)throw qd(`Invalid value for '${s}'. Expected ${t} or less.`)}function C1(s){const e=encodeURIComponent;let t="?";for(const n in s)if(s.hasOwnProperty(n)){const i=e(n)+"="+e(s[n]);t=t+i+"&"}return t=t.slice(0,-1),t}var da;(function(s){s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT"})(da||(da={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x1(s,e){const t=s>=500&&s<600,i=[408,429].indexOf(s)!==-1,r=e.indexOf(s)!==-1;return t||i||r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e,t,n,i,r,a,o,l,u,d,p,m=!0,w=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=d,this.connectionFactory_=p,this.retry=m,this.isUsingEmulator=w,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((E,C)=>{this.resolve_=E,this.reject_=C,this.start_()})}start_(){const e=(n,i)=>{if(i){n(!1,new xr(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const a=o=>{const l=o.loaded,u=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&r.addUploadProgressListener(a),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(a),this.pendingConnection_=null;const o=r.getErrorCode()===da.NO_ERROR,l=r.getStatus();if(!o||x1(l,this.additionalRetryCodes_)&&this.retry){const d=r.getErrorCode()===da.ABORT;n(!1,new xr(!1,null,d));return}const u=this.successCodes_.indexOf(l)!==-1;n(!0,new xr(u,r))})},t=(n,i)=>{const r=this.resolve_,a=this.reject_,o=i.connection;if(i.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());R1(l)?r(l):r()}catch(l){a(l)}else if(o!==null){const l=w1();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(i.canceled){const l=this.appDelete_?$p():k1();a(l)}else{const l=b1();a(l)}};this.canceled_?t(!1,new xr(!1,null,!0)):this.backoffId_=A1(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&D1(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class xr{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function M1(s,e){e!==null&&e.length>0&&(s.Authorization="Firebase "+e)}function L1(s,e){s["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function F1(s,e){e&&(s["X-Firebase-GMPID"]=e)}function N1(s,e){e!==null&&(s["X-Firebase-AppCheck"]=e)}function $1(s,e,t,n,i,r,a=!0,o=!1){const l=C1(s.urlParams),u=s.url+l,d=Object.assign({},s.headers);return F1(d,e),M1(d,t),L1(d,r),N1(d,n),new P1(u,s.method,d,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,i,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O1(s){if(s.length===0)return null;const e=s.lastIndexOf("/");return e===-1?"":s.slice(0,e)}function V1(s){const e=s.lastIndexOf("/",s.length-2);return e===-1?s:s.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,t){this._service=e,t instanceof Wt?this._location=t:this._location=Wt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ha(e,t)}get root(){const e=new Wt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return V1(this._location.path)}get storage(){return this._service}get parent(){const e=O1(this._location.path);if(e===null)return null;const t=new Wt(this._location.bucket,e);return new ha(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw T1(e)}}function Gd(s,e){const t=e==null?void 0:e[_1];return t==null?null:Wt.makeFromBucketSpec(t,s)}function U1(s,e,t,n={}){s.host=`${e}:${t}`;const i=yi(e);i&&(al(`https://${s.host}/b`),ol("Storage",!0)),s._isUsingEmulator=!0,s._protocol=i?"https":"http";const{mockUserToken:r}=n;r&&(s._overrideAuthToken=typeof r=="string"?r:yh(r,s.app.options.projectId))}class B1{constructor(e,t,n,i,r,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._isUsingEmulator=a,this._bucket=null,this._host=Np,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=y1,this._maxUploadRetryTime=v1,this._requests=new Set,i!=null?this._bucket=Wt.makeFromBucketSpec(i,this._host):this._bucket=Gd(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Wt.makeFromBucketSpec(this._url,e):this._bucket=Gd(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){jd("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){jd("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Ct(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ha(this,e)}_makeRequest(e,t,n,i,r=!0){if(this._deleted)return new I1($p());{const a=$1(e,this._appId,n,i,t,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const Kd="@firebase/storage",Qd="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op="storage";function W1(s=ul(),e){s=Oe(s);const n=Sa(s,Op).getImmediate({identifier:e}),i=gh("storage");return i&&z1(n,...i),n}function z1(s,e,t,n={}){U1(s,e,t,n)}function H1(s,{instanceIdentifier:e}){const t=s.getProvider("app").getImmediate(),n=s.getProvider("auth-internal"),i=s.getProvider("app-check-internal");return new B1(t,n,i,e,vi)}function q1(){di(new Bn(Op,H1,"PUBLIC").setMultipleInstances(!0)),Xt(Kd,Qd,""),Xt(Kd,Qd,"esm2020")}q1();const qe={},j1={apiKey:(qe==null?void 0:qe.VITE_FIREBASE_API_KEY)||"placeholder-api-key",authDomain:(qe==null?void 0:qe.VITE_FIREBASE_AUTH_DOMAIN)||"placeholder-project.firebaseapp.com",projectId:(qe==null?void 0:qe.VITE_FIREBASE_PROJECT_ID)||"placeholder-project",storageBucket:(qe==null?void 0:qe.VITE_FIREBASE_STORAGE_BUCKET)||"placeholder-project.appspot.com",messagingSenderId:(qe==null?void 0:qe.VITE_FIREBASE_MESSAGING_SENDER_ID)||"placeholder-sender-id",appId:(qe==null?void 0:qe.VITE_FIREBASE_APP_ID)||"placeholder-app-id",measurementId:(qe==null?void 0:qe.VITE_FIREBASE_MEASUREMENT_ID)||"placeholder-measurement-id"},ic=bh(j1),fs=g1(ic),ne=F0(ic);W1(ic);const ga=class ga{static initialize(){return new Promise(e=>{let t=!1;const n=ib(fs,i=>{console.log("ðŸ” Auth state changed during initialization:",{hasUser:!!i,userId:i==null?void 0:i.uid,initialCheck:!t}),this.currentUser=i,this.authStateListeners.forEach(r=>r(i)),t||(t=!0,e(i))});this.authUnsubscribe=n})}static async register(e,t,n){try{const r=(await Qw(fs,e,t)).user;n&&await Zw(r,{displayName:n});const a={uid:r.uid,email:r.email,displayName:n||null,createdAt:new Date,preferences:this.getDefaultPreferences(),stats:{totalActivities:0,totalTrainingTime:0,lastActivityDate:null}};return await ia(Be(ne,"users",r.uid,"profile","data"),a),this.currentUser=r,this.notifyAuthStateListeners(r),{user:r,profile:a}}catch(i){throw console.error("Registration error:",i),i}}static async login(e,t){try{const i=(await Yw(fs,e,t)).user;return this.currentUser=i,this.notifyAuthStateListeners(i),i}catch(n){throw console.error("Login error:",n),n}}static async logout(){try{await sb(fs),this.currentUser=null,this.notifyAuthStateListeners(null)}catch(e){throw console.error("Logout error:",e),e}}static getCurrentUser(){return this.currentUser}static getCurrentUserId(){var e;return((e=this.currentUser)==null?void 0:e.uid)||null}static isAuthenticated(){return this.currentUser!==null}static async getUserProfile(e){var t;try{const n=e||((t=this.currentUser)==null?void 0:t.uid);if(!n)return null;const i=Be(ne,"users",n,"profile","data"),r=await ep(i);if(r.exists()){const a=r.data();return{...a,createdAt:a.createdAt.toDate()}}return null}catch(n){throw console.error("Error getting user profile:",n),n}}static async resetPassword(e){try{await Kw(fs,e)}catch(t){throw console.error("Password reset error:",t),t}}static async changePassword(e){try{if(!this.currentUser)throw new Error("No authenticated user");await Xw(this.currentUser,e)}catch(t){throw console.error("Password change error:",t),t}}static addAuthStateListener(e){return this.authStateListeners.push(e),()=>{const t=this.authStateListeners.indexOf(e);t>-1&&this.authStateListeners.splice(t,1)}}static getDefaultPreferences(){return{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,units:"metric",hrZones:{zone1:{min:0,max:142},zone2:{min:142,max:152},zone3:{min:152,max:161},zone4:{min:161,max:171},zone5:{min:171,max:190}},fitnessLevel:"intermediate",restingHR:60,maxHR:190,age:35,sports:["running","cycling"],goals:["fitness","endurance"]}}static notifyAuthStateListeners(e){this.authStateListeners.forEach(t=>t(e))}static async updateUserProfile(e){try{if(!this.currentUser)throw new Error("No authenticated user");const t=Be(ne,"users",this.currentUser.uid),n=await this.getUserProfile();if(!n)throw new Error("No existing profile found");const i={...n,...e};return await ia(t,i,{merge:!0}),i}catch(t){throw console.error("Error updating user profile:",t),t}}static async getIdToken(){try{return this.currentUser?await this.currentUser.getIdToken():null}catch(e){return console.error("Error getting ID token:",e),null}}};ga.currentUser=null,ga.authStateListeners=[];let xe=ga;const Vp=Object.freeze(Object.defineProperty({__proto__:null,AuthService:xe},Symbol.toStringTag,{value:"Module"}));class pe{static getUserId(){const e=xe.getCurrentUser();if(!e)throw new Error("User not authenticated");return e.uid}static async addActivity(e){try{const t=this.getUserId(),n={...e,userId:t,uploadedAt:new Date,processed:!0};return(await si(Ie(ne,"users",t,"activities"),n)).id}catch(t){throw console.error("Error adding activity:",t),t}}static async getActivities(e,t){try{const n=this.getUserId();let i=ve(Ie(ne,"users",n,"activities"),Ft("date","desc"));return e&&(i=ve(i,Re("date",">=",e.toISOString().split("T")[0]))),t&&(i=ve(i,Re("date","<=",t.toISOString().split("T")[0]))),(await st(i)).docs.map(a=>{var o;return{id:a.id,...a.data(),uploadedAt:(o=a.data().uploadedAt)==null?void 0:o.toDate()}})}catch(n){throw console.error("Error getting activities:",n),n}}static async updateActivity(e,t){try{const n=this.getUserId(),i=Be(ne,"users",n,"activities",e);await Cn(i,t)}catch(n){throw console.error("Error updating activity:",n),n}}static async deleteActivity(e){try{const t=this.getUserId();await Or(Be(ne,"users",t,"activities",e))}catch(t){throw console.error("Error deleting activity:",t),t}}static async addLapData(e){try{const t=this.getUserId(),n=hs(ne),i=[];return e.forEach(r=>{const a=Be(Ie(ne,"users",t,"lapData"));n.set(a,{...r,userId:t}),i.push(a.id)}),await n.commit(),i}catch(t){throw console.error("Error adding lap data:",t),t}}static async getLapDataForActivity(e){try{const t=this.getUserId(),n=ve(Ie(ne,"users",t,"lapData"),Re("activityId","==",e),Ft("lapNumber","asc"));return(await st(n)).docs.map(r=>({id:r.id,...r.data()}))}catch(t){throw console.error("Error getting lap data:",t),t}}static async addTrainingPlan(e){try{const t=this.getUserId(),n={...e,userId:t,generatedAt:new Date};return(await si(Ie(ne,"users",t,"trainingPlans"),n)).id}catch(t){throw console.error("Error adding training plan:",t),t}}static async getTrainingPlans(e,t){try{const n=this.getUserId();let i=ve(Ie(ne,"users",n,"trainingPlans"),Ft("date","asc"));return e&&(i=ve(i,Re("date",">=",e.toISOString().split("T")[0]))),t&&(i=ve(i,Re("date","<=",t.toISOString().split("T")[0]))),(await st(i)).docs.map(a=>{var o;return{id:a.id,...a.data(),generatedAt:(o=a.data().generatedAt)==null?void 0:o.toDate()}})}catch(n){throw console.error("Error getting training plans:",n),n}}static async updateTrainingPlan(e,t){try{const n=this.getUserId(),i=Be(ne,"users",n,"trainingPlans",e);await Cn(i,t)}catch(n){throw console.error("Error updating training plan:",n),n}}static async addTrackedWorkout(e){try{const t=this.getUserId(),n={...e,userId:t,lastUpdated:new Date};return(await si(Ie(ne,"users",t,"trackedWorkouts"),n)).id}catch(t){throw console.error("Error adding tracked workout:",t),t}}static async getTrackedWorkouts(e,t){try{const n=this.getUserId();let i=ve(Ie(ne,"users",n,"trackedWorkouts"),Ft("date","asc"));return e&&(i=ve(i,Re("date",">=",e.toISOString().split("T")[0]))),t&&(i=ve(i,Re("date","<=",t.toISOString().split("T")[0]))),(await st(i)).docs.map(a=>{var o;return{id:a.id,...a.data(),lastUpdated:(o=a.data().lastUpdated)==null?void 0:o.toDate()}})}catch(n){throw console.error("Error getting tracked workouts:",n),n}}static async updateTrackedWorkout(e,t){try{const n=this.getUserId(),i=Be(ne,"users",n,"trackedWorkouts",e);await Cn(i,{...t,lastUpdated:new Date})}catch(n){throw console.error("Error updating tracked workout:",n),n}}static async addRecoveryMetrics(e){try{const t=this.getUserId(),i={...Object.fromEntries(Object.entries(e).filter(([r,a])=>a!==void 0)),userId:t,recordedAt:new Date};await ia(Be(ne,"users",t,"recoveryMetrics",e.date),i)}catch(t){throw console.error("Error adding recovery metrics:",t),t}}static async getRecoveryMetrics(e,t){try{const n=this.getUserId();let i=ve(Ie(ne,"users",n,"recoveryMetrics"),Ft("date","desc"));return e&&(i=ve(i,Re("date",">=",e.toISOString().split("T")[0]))),t&&(i=ve(i,Re("date","<=",t.toISOString().split("T")[0]))),(await st(i)).docs.map(a=>{var o;return{...a.data(),recordedAt:(o=a.data().recordedAt)==null?void 0:o.toDate()}})}catch(n){throw console.error("Error getting recovery metrics:",n),n}}static async saveAnalytics(e){try{const t=this.getUserId(),n={...e,userId:t,generatedAt:new Date};await ia(Be(ne,"users",t,"analytics",e.period),n)}catch(t){throw console.error("Error saving analytics:",t),t}}static async batchUpdateActivities(e){try{const t=this.getUserId(),n=hs(ne);e.forEach(({id:i,data:r})=>{const a=Be(ne,"users",t,"activities",i);n.update(a,r)}),await n.commit()}catch(t){throw console.error("Error batch updating activities:",t),t}}static async updateUserStats(e){try{const t=this.getUserId(),n=Be(ne,"users",t,"profile","data");await Cn(n,{stats:e})}catch(t){throw console.error("Error updating user stats:",t),t}}static subscribeToActivities(e,t,n){try{const i=this.getUserId(),r=Ie(ne,"users",i,"activities");let a=ve(r,Ft("date","desc"));return n!=null&&n.startDate&&(a=ve(a,Re("date",">=",n.startDate.toISOString().split("T")[0]))),n!=null&&n.endDate&&(a=ve(a,Re("date","<=",n.endDate.toISOString().split("T")[0]))),Rr(a,l=>{const u=[];l.forEach(d=>{const p=d.data();u.push({id:d.id,...p,uploadedAt:p.uploadedAt.toDate()})}),e(u)},l=>{console.error("Error in activities subscription:",l),t==null||t(l)})}catch(i){return console.error("Error setting up activities subscription:",i),t==null||t(i),()=>{}}}static subscribeToTrainingPlans(e,t,n){try{const i=this.getUserId(),r=Ie(ne,"users",i,"trainingPlans");let a=ve(r,Ft("date","asc"));return n!=null&&n.startDate&&(a=ve(a,Re("date",">=",n.startDate.toISOString().split("T")[0]))),n!=null&&n.endDate&&(a=ve(a,Re("date","<=",n.endDate.toISOString().split("T")[0]))),Rr(a,l=>{const u=[];l.forEach(d=>{const p=d.data();u.push({id:d.id,...p,generatedAt:p.generatedAt.toDate()})}),e(u)},l=>{console.error("Error in training plans subscription:",l),t==null||t(l)})}catch(i){return console.error("Error setting up training plans subscription:",i),t==null||t(i),()=>{}}}static subscribeToTrackedWorkouts(e,t,n){try{const i=this.getUserId(),r=Ie(ne,"users",i,"trackedWorkouts");let a=ve(r,Ft("date","asc"));return n!=null&&n.startDate&&(a=ve(a,Re("date",">=",n.startDate.toISOString().split("T")[0]))),n!=null&&n.endDate&&(a=ve(a,Re("date","<=",n.endDate.toISOString().split("T")[0]))),Rr(a,l=>{const u=[];l.forEach(d=>{const p=d.data();u.push({id:d.id,...p,lastUpdated:p.lastUpdated.toDate()})}),e(u)},l=>{console.error("Error in tracked workouts subscription:",l),t==null||t(l)})}catch(i){return console.error("Error setting up tracked workouts subscription:",i),t==null||t(i),()=>{}}}static subscribeToUserProfile(e,t){try{const n=this.getUserId(),i=Be(ne,"users",n,"profile","data");return Rr(i,a=>{if(a.exists()){const o=a.data(),l={...o,createdAt:o.createdAt.toDate()};e(l)}else e(null)},a=>{console.error("Error in user profile subscription:",a),t==null||t(a)})}catch(n){return console.error("Error setting up user profile subscription:",n),t==null||t(n),()=>{}}}static subscribeToAllUserData(e,t,n){const i=[];try{if(e.onActivitiesChange){const r=this.subscribeToActivities(e.onActivitiesChange,t,n);i.push(r)}if(e.onTrainingPlansChange){const r=this.subscribeToTrainingPlans(e.onTrainingPlansChange,t,n);i.push(r)}if(e.onTrackedWorkoutsChange){const r=this.subscribeToTrackedWorkouts(e.onTrackedWorkoutsChange,t,n);i.push(r)}if(e.onProfileChange){const r=this.subscribeToUserProfile(e.onProfileChange,t);i.push(r)}return()=>{i.forEach(r=>r())}}catch(r){return console.error("Error setting up comprehensive data subscription:",r),t==null||t(r),()=>{}}}static async saveGeneratedPlan(e){try{const t=this.getUserId(),n={...e,userId:t,generatedAt:new Date,lastModified:new Date};return(await si(Ie(ne,"users",t,"generatedPlans"),n)).id}catch(t){throw console.error("Error saving generated plan:",t),t}}static async getGeneratedPlans(){try{const e=this.getUserId(),t=Ie(ne,"users",e,"generatedPlans"),n=ve(t,Ft("generatedAt","desc"));return(await st(n)).docs.map(r=>({id:r.id,...r.data(),generatedAt:r.data().generatedAt.toDate(),lastModified:r.data().lastModified.toDate()}))}catch(e){throw console.error("Error getting generated plans:",e),e}}static async getActivePlan(){try{const e=this.getUserId(),t=Ie(ne,"users",e,"generatedPlans"),n=ve(t,Re("isActive","==",!0)),i=await st(n);if(i.empty)return null;const r=i.docs[0];return{id:r.id,...r.data(),generatedAt:r.data().generatedAt.toDate(),lastModified:r.data().lastModified.toDate()}}catch(e){throw console.error("Error getting active plan:",e),e}}static async updateGeneratedPlan(e,t){try{const n=this.getUserId(),i=Be(ne,"users",n,"generatedPlans",e);await Cn(i,{...t,lastModified:new Date})}catch(n){throw console.error("Error updating generated plan:",n),n}}static async setActivePlan(e){try{const t=this.getUserId(),n=hs(ne),i=Ie(ne,"users",t,"generatedPlans"),r=ve(i,Re("isActive","==",!0));(await st(r)).docs.forEach(l=>{n.update(l.ref,{isActive:!1,lastModified:new Date})});const o=Be(ne,"users",t,"generatedPlans",e);n.update(o,{isActive:!0,lastModified:new Date}),await n.commit()}catch(t){throw console.error("Error setting active plan:",t),t}}static async deleteGeneratedPlan(e){try{const t=this.getUserId(),n=Be(ne,"users",t,"generatedPlans",e);await Or(n)}catch(t){throw console.error("Error deleting generated plan:",t),t}}static async saveTrainingCalendar(e){try{const t=this.getUserId(),n={...e,userId:t,createdAt:new Date,lastViewed:new Date};return(await si(Ie(ne,"users",t,"trainingCalendars"),n)).id}catch(t){throw console.error("Error saving training calendar:",t),t}}static async getTrainingCalendars(){try{const e=this.getUserId(),t=Ie(ne,"users",e,"trainingCalendars"),n=ve(t,Ft("createdAt","desc"));return(await st(n)).docs.map(r=>({id:r.id,...r.data(),createdAt:r.data().createdAt.toDate(),lastViewed:r.data().lastViewed.toDate()}))}catch(e){throw console.error("Error getting training calendars:",e),e}}static async getDefaultCalendar(){try{const e=this.getUserId(),t=Ie(ne,"users",e,"trainingCalendars"),n=ve(t,Re("isDefault","==",!0)),i=await st(n);if(i.empty)return null;const r=i.docs[0];return{id:r.id,...r.data(),createdAt:r.data().createdAt.toDate(),lastViewed:r.data().lastViewed.toDate()}}catch(e){throw console.error("Error getting default calendar:",e),e}}static async updateTrainingCalendar(e,t){try{const n=this.getUserId(),i=Be(ne,"users",n,"trainingCalendars",e);await Cn(i,{...t,lastViewed:new Date})}catch(n){throw console.error("Error updating training calendar:",n),n}}static async setDefaultCalendar(e){try{const t=this.getUserId(),n=hs(ne),i=Ie(ne,"users",t,"trainingCalendars"),r=ve(i,Re("isDefault","==",!0));(await st(r)).docs.forEach(l=>{n.update(l.ref,{isDefault:!1})});const o=Be(ne,"users",t,"trainingCalendars",e);n.update(o,{isDefault:!0,lastViewed:new Date}),await n.commit()}catch(t){throw console.error("Error setting default calendar:",t),t}}static async deleteTrainingCalendar(e){try{const t=this.getUserId(),n=Be(ne,"users",t,"trainingCalendars",e);await Or(n)}catch(t){throw console.error("Error deleting training calendar:",t),t}}static async saveGeneratedPlanWithWorkouts(e,t){try{const n=this.getUserId(),i=hs(ne),r=Be(Ie(ne,"users",n,"generatedPlans")),a=r.id,o={...e,userId:n,generatedAt:new Date,lastModified:new Date,workouts:[]};i.set(r,o);const l=[];for(const u of t){const d=Be(Ie(ne,"users",n,"trainingPlans")),p={...u,userId:n,planRef:a,createdAt:new Date};i.set(d,p),l.push({id:d.id,...p})}return i.update(r,{workouts:l}),await i.commit(),a}catch(n){throw console.error("Error saving generated plan with workouts:",n),n}}}class Ye{constructor(){this.currentUser=null,this.userProfile=null,this.listeners=[],this.isInitialized=!1,this.initialize()}static getInstance(){return Ye.instance||(Ye.instance=new Ye),Ye.instance}async initialize(){if(!this.isInitialized)try{if(this.currentUser=await xe.initialize(),this.currentUser)try{this.userProfile=await xe.getUserProfile()}catch(e){console.warn("Failed to get user profile in UserProfileService, continuing without it:",e),this.userProfile=null}xe.addAuthStateListener(async e=>{if(this.currentUser=e,e)try{this.userProfile=await xe.getUserProfile()}catch(t){console.warn("Failed to get user profile in auth state listener, continuing without it:",t),this.userProfile=null}else this.userProfile=null;this.notifyListeners()}),this.isInitialized=!0,this.notifyListeners()}catch(e){console.error("Failed to initialize UserProfileService:",e)}}getCurrentUser(){return this.currentUser}getUserProfile(){return this.userProfile}isAuthenticated(){return this.currentUser!==null}getDisplayName(){var e,t;return((e=this.userProfile)==null?void 0:e.displayName)||((t=this.currentUser)==null?void 0:t.email)||"User"}getEmail(){var e;return((e=this.currentUser)==null?void 0:e.email)||""}getUserId(){var e;return((e=this.currentUser)==null?void 0:e.uid)||""}getJoinDate(){var e,t;return(t=(e=this.currentUser)==null?void 0:e.metadata)!=null&&t.creationTime?new Date(this.currentUser.metadata.creationTime).toLocaleDateString():"Unknown"}getTrainingProfile(){var i,r,a,o,l,u,d,p,m;const e=this.userProfile,t=this.calculateAgeFromEmail()||30,n=((i=e==null?void 0:e.preferences)==null?void 0:i.maxHR)||this.calculateMaxHR(((r=e==null?void 0:e.preferences)==null?void 0:r.age)||t);return{age:((a=e==null?void 0:e.preferences)==null?void 0:a.age)||t,fitnessLevel:((o=e==null?void 0:e.preferences)==null?void 0:o.fitnessLevel)||"intermediate",restingHR:((l=e==null?void 0:e.preferences)==null?void 0:l.restingHR)||60,maxHR:n,preferredSports:((u=e==null?void 0:e.preferences)==null?void 0:u.sports)||["running"],goals:((d=e==null?void 0:e.preferences)==null?void 0:d.goals)||["general_fitness"],excludedExercises:((p=e==null?void 0:e.preferences)==null?void 0:p.excludedExercises)||[],hrZones:((m=e==null?void 0:e.preferences)==null?void 0:m.hrZones)||this.calculateDefaultHRZones(n)}}getActivityStats(){var e,t,n,i,r,a;return{totalActivities:((t=(e=this.userProfile)==null?void 0:e.stats)==null?void 0:t.totalActivities)||0,totalTrainingTime:((i=(n=this.userProfile)==null?void 0:n.stats)==null?void 0:i.totalTrainingTime)||0,lastActivityDate:((a=(r=this.userProfile)==null?void 0:r.stats)==null?void 0:a.lastActivityDate)||null}}addListener(e){return this.listeners.push(e),this.isInitialized&&e(this.currentUser,this.userProfile),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}async updateProfile(e){if(!this.currentUser)throw new Error("No authenticated user to update profile for");try{await xe.updateUserProfile(e),this.userProfile?this.userProfile={...this.userProfile,...e}:this.userProfile=await xe.getUserProfile(),this.notifyListeners()}catch(t){throw console.error("Failed to update user profile:",t),t}}async updateActivityStats(e){if(!this.userProfile)return;const t={...this.userProfile.stats,...e};await this.updateProfile({stats:t})}async logout(){try{await xe.logout(),this.currentUser=null,this.userProfile=null,this.notifyListeners()}catch(e){throw console.error("Logout failed:",e),e}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.currentUser,this.userProfile)}catch(t){console.error("Error in profile listener:",t)}})}calculateAgeFromEmail(){var n;const t=(((n=this.currentUser)==null?void 0:n.email)||"").match(/(\d{4})/);if(t){const i=parseInt(t[1],10);if(i>=1950&&i<=new Date().getFullYear()-13)return new Date().getFullYear()-i}return null}calculateMaxHR(e){return Math.round(208-.7*e)}calculateDefaultHRZones(e){return{zone1:{min:Math.round(e*.5),max:Math.round(e*.6)},zone2:{min:Math.round(e*.6),max:Math.round(e*.7)},zone3:{min:Math.round(e*.7),max:Math.round(e*.8)},zone4:{min:Math.round(e*.8),max:Math.round(e*.9)},zone5:{min:Math.round(e*.9),max:Math.round(e*1)}}}getStravaConnection(){var e;return((e=this.userProfile)==null?void 0:e.stravaConnection)||null}async updateStravaConnection(e){await this.updateProfile({stravaConnection:e})}isStravaConnected(){var e,t;return((t=(e=this.userProfile)==null?void 0:e.stravaConnection)==null?void 0:t.isConnected)||!1}getStravaAthleteInfo(){var t;const e=(t=this.userProfile)==null?void 0:t.stravaConnection;return e!=null&&e.isConnected?{athleteId:e.athleteId,username:e.username,fullName:e.firstname&&e.lastname?`${e.firstname} ${e.lastname}`:void 0,lastSyncAt:e.lastSyncAt}:{}}static getCurrentUser(){return Ye.getInstance().getCurrentUser()}static getUserProfile(){return Ye.getInstance().getUserProfile()}static isAuthenticated(){return Ye.getInstance().isAuthenticated()}static getTrainingProfile(){return Ye.getInstance().getTrainingProfile()}static getStravaConnection(){return Ye.getInstance().getStravaConnection()}static isStravaConnected(){return Ye.getInstance().isStravaConnected()}}class ot{static calculateTSB(e,t=new Date){const n=[...e].sort((K,ee)=>new Date(K.date).getTime()-new Date(ee.date).getTime()),i=t.getTime(),r=i-7*24*60*60*1e3,a=i-28*24*60*60*1e3,o=n.filter(K=>{const ee=new Date(K.date).getTime();return ee>=r&&ee<=i}),l=n.filter(K=>{const ee=new Date(K.date).getTime();return ee>=a&&ee<=i}),u=this.calculateExponentialAverage(o,7),d=this.calculateExponentialAverage(l,28),p=d-u,m=Math.min(100,d/5),w=Math.min(100,u/3),E=Math.max(0,Math.min(100,50+p/2)),C=this.interpretTSB(p,u,d),I=this.analyzeTSBTrends(n,t),B=[`${o.length} activities in last 7 days`,`${l.length} activities in last 28 days`,`ATL: ${u.toFixed(1)}, CTL: ${d.toFixed(1)}`];let G="poor";l.length>=20?G="excellent":l.length>=12?G="good":l.length>=6&&(G="fair");const Y=Math.min(100,l.length/20*100);return{value:{acuteLoad:u,chronicLoad:d,tsb:p,fitness:m,fatigue:w,form:E,interpretation:C,trend:I},confidence:Y,factors:B,timestamp:new Date().toISOString(),dataQuality:G}}static calculateExponentialAverage(e,t){if(e.length===0)return 0;const n=t/Math.log(2),i=new Date().getTime();let r=0,a=0;return e.forEach(o=>{const l=new Date(o.date).getTime(),u=(i-l)/(24*60*60*1e3),d=Math.exp(-u/n);r+=o.trainingLoad*d,a+=d}),a>0?r/a:0}static interpretTSB(e,t,n){let i,r,a,o;return e>25?(i="peak-form",r="Excellent form - low fatigue, high fitness",a="Great time for key workouts or competition",o=!0):e>5?(i="good-form",r="Good form - ready for quality training",a="Ideal for moderate to high intensity sessions",o=!0):e>-10?(i="neutral",r="Balanced training stress",a="Continue current training approach",o=!1):e>-30?(i="building",r="Building fitness - some accumulated fatigue",a="Focus on aerobic base, limit high intensity",o=!1):e>-50?(i="overreaching",r="High training stress - approaching overtraining",a="Prioritize recovery, reduce training load",o=!1):(i="overtrained",r="Critical fatigue levels detected",a="Immediate rest and recovery required",o=!1),{status:i,description:r,recommendation:a,optimalTrainingWindow:o}}static analyzeTSBTrends(e,t){const n=[];for(let p=3;p>=0;p--){const m=new Date(t);m.setDate(m.getDate()-p*7);const w=this.calculateTSB(e,m);n.push(w.value.tsb)}const i=this.analyzeTrend(n.slice(-3)),r=i>.1?"increasing":i<-.1?"decreasing":"stable",a=this.analyzeTrend(n),o=a>.05?"increasing":a<-.05?"decreasing":"stable",l=i>0?"improving":i<0?"worsening":"stable",u=n[n.length-1];let d;if(u<-5){const p=Math.abs(i)||2;d=Math.ceil((Math.abs(u)-5)/p)}else if(u>15){const p=Math.abs(i)||3;d=Math.ceil((u-15)/p)}return{acuteDirection:r,chronicDirection:o,balanceDirection:l,weeksToOptimal:d}}static analyzeTrend(e){if(e.length<2)return 0;const t=e.length,n=t*(t-1)/2,i=e.reduce((l,u)=>l+u,0),r=e.reduce((l,u,d)=>l+u*d,0),a=t*(t-1)*(2*t-1)/6;return(t*r-n*i)/(t*a-n*n)}static analyzeRecoveryMetrics(e,t=28){const n=[];if(e.length===0)return n;const r=[...e].sort((m,w)=>new Date(m.date).getTime()-new Date(w.date).getTime()).slice(-t),a=r[r.length-1];if(a.hrv&&r.filter(m=>m.hrv).length>=7){const m=r.filter(B=>B.hrv).map(B=>B.hrv),w=this.calculateBaseline(m),E=a.hrv,C=(E-w)/w*100;let I="normal";C<-15?I="critical":C<-10?I="concerning":C<-5&&(I="elevated"),n.push({metric:"hrv",currentValue:E,baselineValue:w,percentChange:C,status:I,description:this.getHRVDescription(I,C)})}if(a.restingHR&&r.filter(m=>m.restingHR).length>=7){const m=r.filter(B=>B.restingHR).map(B=>B.restingHR),w=this.calculateBaseline(m),E=a.restingHR,C=(E-w)/w*100;let I="normal";C>8?I="critical":C>5?I="concerning":C>3&&(I="elevated"),n.push({metric:"restingHR",currentValue:E,baselineValue:w,percentChange:C,status:I,description:this.getRHRDescription(I,C)})}if(a.bodyBattery&&r.filter(m=>m.bodyBattery).length>=5){const m=r.filter(B=>B.bodyBattery).map(B=>B.bodyBattery),w=this.calculateBaseline(m),E=a.bodyBattery,C=(E-w)/w*100;let I="normal";E<20?I="critical":E<30?I="concerning":(E<50||C<-20)&&(I="elevated"),n.push({metric:"bodyBattery",currentValue:E,baselineValue:w,percentChange:C,status:I,description:this.getBodyBatteryDescription(I,E)})}if(a.sleepScore&&r.filter(m=>m.sleepScore).length>=5){const m=r.filter(B=>B.sleepScore).map(B=>B.sleepScore),w=this.calculateBaseline(m),E=a.sleepScore,C=(E-w)/w*100;let I="normal";E<60?I="critical":E<70?I="concerning":(E<80||C<-15)&&(I="elevated"),n.push({metric:"sleepScore",currentValue:E,baselineValue:w,percentChange:C,status:I,description:this.getSleepDescription(I,E)})}const o=r.map(m=>m.subjectiveFatigue),l=o.reduce((m,w)=>m+w,0)/o.length,u=a.subjectiveFatigue,d=(u-l)/l*100;let p="normal";return u>=8?p="critical":u>=7?p="concerning":u>=6&&(p="elevated"),n.push({metric:"subjective",currentValue:u,baselineValue:l,percentChange:d,status:p,description:this.getSubjectiveFatigueDescription(p,u)}),n}static calculateBaseline(e){if(e.length===0)return 0;const t=[...e].sort((r,a)=>r-a),i=Math.floor(t.length*.2);if(i>0){const r=t.slice(i,-i);return r.reduce((a,o)=>a+o,0)/r.length}return e.reduce((r,a)=>r+a,0)/e.length}static createDecisionContext(e,t,n,i=[],r={}){return{userId:e,timestamp:new Date().toISOString(),inputData:n,algorithms:i,parameters:r,version:"1.0.0"}}static getHRVDescription(e,t){switch(e){case"critical":return`HRV significantly below baseline (${t.toFixed(1)}%) - high stress/fatigue`;case"concerning":return`HRV moderately below baseline (${t.toFixed(1)}%) - increased fatigue`;case"elevated":return`HRV slightly below baseline (${t.toFixed(1)}%) - monitor closely`;default:return`HRV within normal range (${t.toFixed(1)}% from baseline)`}}static getRHRDescription(e,t){switch(e){case"critical":return`Resting HR significantly elevated (${t.toFixed(1)}%) - possible overtraining`;case"concerning":return`Resting HR moderately elevated (${t.toFixed(1)}%) - increased fatigue`;case"elevated":return`Resting HR slightly elevated (${t.toFixed(1)}%) - monitor closely`;default:return`Resting HR within normal range (${t.toFixed(1)}% from baseline)`}}static getBodyBatteryDescription(e,t){switch(e){case"critical":return`Body battery critically low (${t}) - immediate rest required`;case"concerning":return`Body battery low (${t}) - prioritize recovery`;case"elevated":return`Body battery below optimal (${t}) - light training only`;default:return`Body battery adequate (${t}) - normal training possible`}}static getSleepDescription(e,t){switch(e){case"critical":return`Sleep quality poor (${t}) - recovery severely impacted`;case"concerning":return`Sleep quality below average (${t}) - recovery compromised`;case"elevated":return`Sleep quality suboptimal (${t}) - monitor sleep hygiene`;default:return`Sleep quality good (${t}) - adequate recovery support`}}static getSubjectiveFatigueDescription(e,t){switch(e){case"critical":return`Very high subjective fatigue (${t}/10) - rest day recommended`;case"concerning":return`High subjective fatigue (${t}/10) - easy training only`;case"elevated":return`Moderate subjective fatigue (${t}/10) - reduce intensity`;default:return`Low subjective fatigue (${t}/10) - normal training capacity`}}static calculateStatistics(e){if(e.length===0)return{mean:0,median:0,std:0,min:0,max:0};const t=[...e].sort((o,l)=>o-l),n=e.reduce((o,l)=>o+l,0)/e.length,i=t.length%2===0?(t[t.length/2-1]+t[t.length/2])/2:t[Math.floor(t.length/2)],r=e.reduce((o,l)=>o+Math.pow(l-n,2),0)/e.length,a=Math.sqrt(r);return{mean:n,median:i,std:a,min:t[0],max:t[t.length-1]}}}const ma=class ma{static async recommendTomorrowWorkout(e){const t=Date.now(),n=[];try{const i=this.validateInput(e);if(!i.valid)return{success:!1,error:i.error,warnings:n,context:ot.createDecisionContext(e.userId,"workout-recommendation",e),processingTime:Date.now()-t};const r=ot.calculateTSB(e.recentActivities);r.dataQuality==="poor"&&n.push("Limited training history - recommendations based on available data");const a=this.analyzeRecoveryStatus(e.recoveryMetrics),o=this.selectBaseWorkout(e,r.value,a),l=this.applyContextualModifications(o,e,r.value,a),u=this.generateAlternatives(l.recommendedWorkout,e,r.value),d=this.calculateConfidence(e,r,a),p=Date.now()-t;return{success:!0,data:{...l,alternatives:u,confidence:d},warnings:n,context:ot.createDecisionContext(e.userId,"workout-recommendation",e,["TSB-analysis","recovery-assessment","workout-selection"],{tsb:r.value.tsb,recoveryStatus:a.overallStatus,confidence:d}),processingTime:p}}catch(i){return{success:!1,error:`AI recommendation failed: ${i instanceof Error?i.message:"Unknown error"}`,warnings:n,context:ot.createDecisionContext(e.userId,"workout-recommendation",e),processingTime:Date.now()-t}}}static validateInput(e){if(!e.userId)return{valid:!1,error:"User ID required"};if(!e.currentDate)return{valid:!1,error:"Current date required"};if(!e.userProfile)return{valid:!1,error:"User profile required"};if(e.recentActivities.length===0)return{valid:!0};const t=new Date(e.currentDate),n=new Date(Math.min(...e.recentActivities.map(r=>new Date(r.date).getTime())));return(t.getTime()-n.getTime())/(1e3*60*60*24)>60?{valid:!1,error:"Activity data too old for reliable recommendations"}:{valid:!0}}static analyzeRecoveryStatus(e){if(e.length===0)return{overallStatus:"fair",keyFactors:["No recovery data available"],recommendation:"moderate-training"};const t=e.slice(-3),n=t[t.length-1],i=[];let r=70;if(n.bodyBattery!==void 0&&(n.bodyBattery<20?(r-=30,i.push("Very low body battery")):n.bodyBattery<40?(r-=15,i.push("Low body battery")):n.bodyBattery>80&&(r+=10,i.push("High body battery"))),n.sleepScore!==void 0&&(n.sleepScore<60?(r-=20,i.push("Poor sleep quality")):n.sleepScore<75?(r-=10,i.push("Below average sleep")):n.sleepScore>85&&(r+=10,i.push("Excellent sleep quality"))),n.hrv!==void 0&&t.length>1){const u=t.slice(0,-1).filter(d=>d.hrv!==void 0).reduce((d,p)=>d+p.hrv,0)/(t.length-1);if(u>0){const d=(n.hrv-u)/u;d<-.15?(r-=20,i.push("HRV significantly below baseline")):d<-.05?(r-=10,i.push("HRV below baseline")):d>.05&&(r+=5,i.push("HRV above baseline"))}}const a=t.reduce((u,d)=>u+d.subjectiveFatigue,0)/t.length;a>=7?(r-=25,i.push("High subjective fatigue")):a>=5?(r-=10,i.push("Moderate subjective fatigue")):a<=3&&(r+=10,i.push("Low subjective fatigue"));let o,l;return r>=85?(o="excellent",l="full-training"):r>=70?(o="good",l="full-training"):r>=50?(o="fair",l="moderate-training"):r>=30?(o="poor",l="easy-training"):(o="poor",l="rest"),{overallStatus:o,keyFactors:i,recommendation:l}}static selectBaseWorkout(e,t,n){const i=[],r=[];let a=[...mt];if(n.recommendation==="rest"?(a=Le.getRecoveryWorkouts(),i.push("Recovery metrics indicate need for rest")):n.recommendation==="easy-training"?(a=Le.getEasyWorkouts(),i.push("Recovery metrics suggest easy training only")):n.recommendation==="moderate-training"&&(a=mt.filter(l=>l.fatigueScore<=70),i.push("Recovery allows moderate intensity training")),t.tsb<-30?(a=Le.getRecoveryWorkouts(),i.push(`TSB of ${t.tsb.toFixed(1)} indicates high fatigue - recovery required`)):t.tsb<-10?(a=a.filter(l=>l.fatigueScore<=70),i.push(`TSB of ${t.tsb.toFixed(1)} suggests limiting high intensity`)):t.tsb>5&&i.push(`TSB of ${t.tsb.toFixed(1)} indicates good form for quality training`),e.userProfile.preferredSports.length>0){const l=a.filter(u=>e.userProfile.preferredSports.some(d=>u.type.toLowerCase().includes(d.toLowerCase())||u.description.toLowerCase().includes(d.toLowerCase())));l.length>0&&(a=l,i.push(`Filtered to preferred sports: ${e.userProfile.preferredSports.join(", ")}`))}let o;if(a.length===0)o={type:"rest",tag:"zone1",description:"Complete rest day",durationMin:0,fatigueScore:0,recoveryImpact:"restorative"},i.push("No suitable workouts found - defaulting to rest");else{o=a[Math.floor(Math.random()*a.length)];const l=Le.adjustWorkoutForFitnessLevel(o,e.userProfile.fitnessLevel);l.durationMin!==o.durationMin&&r.push({type:"duration",originalValue:o.durationMin,modifiedValue:l.durationMin,reason:`Adjusted for ${e.userProfile.fitnessLevel} fitness level`}),o=l,i.push(`Selected ${o.type} workout based on current training status`)}return{recommendedWorkout:o,confidence:0,reasoning:i,alternatives:[],modifications:r}}static applyContextualModifications(e,t,n,i){var d;const r={...e};let a={...e.recommendedWorkout};if(t.weatherData&&!t.weatherData.isOutdoorFriendly&&(a.type==="run"||a.type==="bike")){if(r.weatherConsideration=`Weather conditions (${t.weatherData.conditions}) suggest indoor training`,a.durationMin>45){const p=a.durationMin;a.durationMin=Math.max(30,a.durationMin*.8),r.modifications.push({type:"duration",originalValue:p,modifiedValue:a.durationMin,reason:"Reduced duration for indoor training"})}a.description=a.description.replace(/outdoor|outside/gi,"indoor"),a.description.includes("indoor")||(a.description=`Indoor ${a.description.toLowerCase()}`)}const o=new Date(t.currentDate);o.setDate(o.getDate()+1);const l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][o.getDay()],u=(d=t.userProfile.preferredWorkoutTimes)==null?void 0:d.find(p=>p.dayOfWeek===l);if(u&&u.duration!==a.durationMin&&Math.abs(u.duration-a.durationMin)>15){const m=a.durationMin;a.durationMin=Math.min(u.duration,m*1.2),r.modifications.push({type:"duration",originalValue:m,modifiedValue:a.durationMin,reason:`Adjusted to fit ${l} time preference (${u.duration} min)`})}if(i.overallStatus==="poor"&&a.fatigueScore>30){const p=a.fatigueScore;a.fatigueScore=Math.max(10,a.fatigueScore*.6),(a.description.includes("hard")||a.description.includes("intense"))&&(a.description=a.description.replace(/hard|intense/gi,"easy").replace(/threshold|intervals/gi,"conversational pace")),r.modifications.push({type:"intensity",originalValue:p,modifiedValue:a.fatigueScore,reason:"Reduced intensity due to poor recovery status"}),r.recoveryAdjustment="Intensity reduced to support recovery"}return r.recommendedWorkout=a,r}static generateAlternatives(e,t,n){const i=[],r=mt.filter(l=>l.type!==e.type&&Math.abs(l.fatigueScore-e.fatigueScore)<=10);if(r.length>0){const l=Le.adjustWorkoutForFitnessLevel(r[Math.floor(Math.random()*r.length)],t.userProfile.fitnessLevel);i.push(l)}const a=mt.filter(l=>l.type===e.type&&l.tag!==e.tag);if(a.length>0){const l=Le.adjustWorkoutForFitnessLevel(a[Math.floor(Math.random()*a.length)],t.userProfile.fitnessLevel);i.push(l)}const o=Le.getRecoveryWorkouts();return o.length>0&&!i.some(l=>l.recoveryImpact==="restorative")&&i.push(o[0]),i.slice(0,this.MAX_ALTERNATIVES)}static calculateConfidence(e,t,n){let i=100;return t.dataQuality==="poor"?i-=30:t.dataQuality==="fair"&&(i-=15),e.recoveryMetrics.length===0?i-=20:e.recoveryMetrics.length<3&&(i-=10),t.value.tsb>0&&n.recommendation==="rest"&&(i-=15),e.recentActivities.length<5?i-=20:e.recentActivities.length<10&&(i-=10),t.value.interpretation.optimalTrainingWindow&&n.recommendation==="full-training"&&(i+=10),Math.max(30,Math.min(100,i))}static async getWorkoutForDate(e,t){const n={...e,currentDate:t};return this.recommendTomorrowWorkout(n)}static async getWorkoutPlan(e,t,n){const i=[];for(let r=0;r<n;r++){const a=new Date(t);a.setDate(a.getDate()+r);const o=a.toISOString().split("T")[0],l=await this.getWorkoutForDate(e,o);if(i.push({date:o,recommendation:l}),l.success&&l.data){const u={date:o,sport:l.data.recommendedWorkout.type,duration:l.data.recommendedWorkout.durationMin,distance:0,trainingLoad:l.data.recommendedWorkout.fatigueScore*2,zone1Minutes:0,zone2Minutes:0,zone3Minutes:0,zone4Minutes:0,zone5Minutes:0};e.recentActivities.push(u)}}return i}};ma.CONFIDENCE_THRESHOLD=60,ma.MAX_ALTERNATIVES=3;let fa=ma;const Ds=class Ds{static async assessFatigue(e,t,n,i){const r=Date.now(),a=[];try{const o=ot.calculateTSB(t),l=ot.analyzeRecoveryMetrics(n),u=this.analyzeTrainingLoadTrends(t),d=[...l,...u],p=this.calculateOverallAssessment(o.value,d,i),m=this.analyzeFatigueTrends(t,n,p),w=this.calculateNextReassessment(p,m);o.dataQuality==="poor"&&a.push("Limited training history - fatigue assessment may be less accurate"),n.length<7&&a.push("Insufficient recovery data - consider tracking more metrics");const E=d.filter(B=>B.status==="critical");E.length>0&&a.push(`Critical indicators detected: ${E.map(B=>B.metric).join(", ")}`);const C={overallStatus:p.status,riskLevel:p.riskLevel,recommendation:p.recommendation,indicators:d,trendAnalysis:m,nextReassessment:w},I=Date.now()-r;return{success:!0,data:C,warnings:a,context:ot.createDecisionContext(e,"fatigue-assessment",{activitiesCount:t.length,recoveryMetricsCount:n.length,tsbValue:o.value.tsb},["TSB-analysis","recovery-analysis","trend-analysis"],{overallStatus:p.status,riskLevel:p.riskLevel}),processingTime:I}}catch(o){return{success:!1,error:`Fatigue assessment failed: ${o instanceof Error?o.message:"Unknown error"}`,warnings:a,context:ot.createDecisionContext(e,"fatigue-assessment",{}),processingTime:Date.now()-r}}}static analyzeTrainingLoadTrends(e){const t=[];if(e.length<this.MIN_DATA_POINTS)return t;const n=[...e].sort((w,E)=>new Date(w.date).getTime()-new Date(E.date).getTime()),i=new Date,r=new Date(i.getTime()-7*24*60*60*1e3),a=new Date(i.getTime()-28*24*60*60*1e3),o=n.filter(w=>new Date(w.date)>=r),l=n.filter(w=>new Date(w.date)>=a),u=o.reduce((w,E)=>w+E.trainingLoad,0)/7,d=l.reduce((w,E)=>w+E.trainingLoad,0)/28,p=d>0?(u-d)/d*100:0;let m="normal";return u>d*1.5?m="critical":u>d*1.3?m="concerning":u>d*1.1&&(m="elevated"),t.push({metric:"trainingLoad",currentValue:u,baselineValue:d,percentChange:p,status:m,description:this.getTrainingLoadDescription(m,p,u)}),t}static calculateOverallAssessment(e,t,n){let i=50;e.tsb<this.OVERTRAINING_THRESHOLD?i+=25:e.tsb<-25?i+=15:e.tsb<-10?i+=10:e.tsb>10&&(i-=10);const r=t.filter(p=>p.status==="critical").length,a=t.filter(p=>p.status==="concerning").length,o=t.filter(p=>p.status==="elevated").length;i+=r*15,i+=a*10,i+=o*5,n.age>50?i+=5:n.age>40&&(i+=3);let l,u,d;return i>=this.CRITICAL_FATIGUE_THRESHOLD?(l="overtrained",u="critical",d="medical-attention"):i>=70?(l="fatigued",u="high",d="rest"):i>=55?(l="fatigued",u="moderate",d="active-recovery"):i>=40?(l="normal",u="low",d="full-training"):(l="fresh",u="low",d="full-training"),{status:l,riskLevel:u,recommendation:d}}static analyzeFatigueTrends(e,t,n){const i=t.filter(u=>{const d=new Date(u.date),p=new Date(Date.now()-14*24*60*60*1e3);return d>=p}).sort((u,d)=>new Date(u.date).getTime()-new Date(d.date).getTime());let r="stable",a=0,o=0,l=50;if(i.length>=7){const u=i.map(C=>C.subjectiveFatigue),d=u.slice(0,Math.floor(u.length/2)),p=u.slice(Math.floor(u.length/2)),m=d.reduce((C,I)=>C+I,0)/d.length,E=p.reduce((C,I)=>C+I,0)/p.length-m;E<-1?(r="improving",a=Math.ceil(Math.abs(E)*3)):E>1.5&&(r=E>2.5?"rapidly-declining":"declining",a=Math.ceil(E*2)),l=Math.min(90,i.length*6),n.status==="overtrained"?o=r==="improving"?7:14:n.status==="fatigued"?o=r==="improving"?3:7:o=0}return{direction:r,durationDays:a,projectedRecovery:o,confidenceLevel:l}}static calculateNextReassessment(e,t){let n=7;switch(e.status){case"overtrained":n=2;break;case"fatigued":n=t.direction==="improving"?4:3;break;case"normal":n=7;break;case"fresh":n=10;break}const i=new Date;return i.setDate(i.getDate()+n),i.toISOString().split("T")[0]}static async quickFatigueCheck(e,t,n){const i=[];let r=!0,a="full";if(t.length>=7){const o=ot.calculateTSB(t);o.value.tsb<-30?(r=!1,a="rest",i.push(`Critical training stress balance (${o.value.tsb.toFixed(1)})`)):o.value.tsb<-15&&(a="easy",i.push("High training load - easy training only"))}return n.bodyBattery&&n.bodyBattery<20?(r=!1,a="rest",i.push("Body battery critically low")):n.bodyBattery&&n.bodyBattery<40&&(a="easy",i.push("Low body battery")),n.sleepScore&&n.sleepScore<60&&(a=a==="full"?"easy":a,i.push("Poor sleep quality")),n.subjectiveFatigue>=8?(r=!1,a="rest",i.push("Very high subjective fatigue")):n.subjectiveFatigue>=7&&(a="easy",i.push("High subjective fatigue")),{canTrain:r,recommendation:a,reasons:i}}static async checkOvertrainingMarkers(e,t){const n=[];if(e.length<14||t.length<7)return{hasMarkers:!1,markers:["Insufficient data for overtraining analysis"],severity:"mild"};const i=e.slice(-7),r=e.slice(-21,-14);if(i.length>=3&&r.length>=3){const p=i.reduce((w,E)=>w+E.trainingLoad,0)/i.length,m=r.reduce((w,E)=>w+E.trainingLoad,0)/r.length;p<m*.8&&n.push("Significant performance decline detected")}const a=t.slice(-7);a.reduce((p,m)=>p+m.subjectiveFatigue,0)/a.length>=7&&n.push("Persistently high subjective fatigue");const l=a.filter(p=>p.sleepScore!==void 0).map(p=>p.sleepScore);l.length>=5&&l.reduce((m,w)=>m+w,0)/l.length<65&&n.push("Persistent sleep quality issues");const u=a.filter(p=>p.hrv!==void 0).map(p=>p.hrv);if(u.length>=5){const p=u.slice(-3),m=u.slice(0,-3);if(p.length>=2&&m.length>=2){const w=p.reduce((C,I)=>C+I,0)/p.length,E=m.reduce((C,I)=>C+I,0)/m.length;w<E*.85&&n.push("HRV significantly suppressed")}}let d="mild";return n.length>=3?d="severe":n.length>=2&&(d="moderate"),{hasMarkers:n.length>0,markers:n,severity:d}}static getTrainingLoadDescription(e,t,n){switch(e){case"critical":return`Training load extremely high (${t.toFixed(1)}% above baseline) - overreaching risk`;case"concerning":return`Training load significantly elevated (${t.toFixed(1)}% above baseline)`;case"elevated":return`Training load moderately high (${t.toFixed(1)}% above baseline)`;default:return`Training load within normal range (${n.toFixed(1)} TRIMP/day average)`}}};Ds.OVERTRAINING_THRESHOLD=-40,Ds.CRITICAL_FATIGUE_THRESHOLD=85,Ds.MIN_DATA_POINTS=7;let Is=Ds;const Rs=class Rs{static async analyzePerformance(e,t,n,i){const r=Date.now(),a=[];try{if(t.length<this.MIN_ACTIVITIES_FOR_TRENDS)return{success:!1,error:`Insufficient data for performance analysis. Need at least ${this.MIN_ACTIVITIES_FOR_TRENDS} activities`,warnings:a,context:ot.createDecisionContext(e,"performance-analysis",{activitiesCount:t.length}),processingTime:Date.now()-r};const o=new Date;o.setDate(o.getDate()-this.ANALYSIS_WINDOW_DAYS);const l=t.filter(I=>new Date(I.date)>=o).sort((I,B)=>new Date(I.date).getTime()-new Date(B.date).getTime()),u=this.calculateKeyMetrics(l,i),d=this.generateInsights(u,l,n),p=this.generatePredictions(u,l),m=this.recommendTrainingFocus(u,d,i),w=this.determineOverallTrend(u);l.length<t.length*.7&&a.push("Limited recent activity data - analysis may not reflect current form");const E={overallTrend:w,keyMetrics:u,insights:d,predictions:p,recommendedFocus:m},C=Date.now()-r;return{success:!0,data:E,warnings:a,context:ot.createDecisionContext(e,"performance-analysis",{activitiesAnalyzed:l.length,analysisWindowDays:this.ANALYSIS_WINDOW_DAYS,overallTrend:w},["trend-analysis","regression-analysis","insight-generation"],{metricsCount:u.length}),processingTime:C}}catch(o){return{success:!1,error:`Performance analysis failed: ${o instanceof Error?o.message:"Unknown error"}`,warnings:a,context:ot.createDecisionContext(e,"performance-analysis",{}),processingTime:Date.now()-r}}}static calculateKeyMetrics(e,t){const n=[];if(e.length===0)return n;const i=Math.floor(e.length/2),r=e.slice(0,i),a=e.slice(i),o=e.filter(I=>I.hrDrift!==void 0);if(o.length>=5){const I=this.calculateAverage(a.filter(K=>K.hrDrift!==void 0).map(K=>K.hrDrift)),B=this.calculateAverage(r.filter(K=>K.hrDrift!==void 0).map(K=>K.hrDrift)),G=B!==0?(I-B)/Math.abs(B)*100:0,Y=G<-5?"improving":G>5?"declining":"stable";n.push({name:"Aerobic Efficiency",category:"aerobic",currentValue:I,baselineValue:B,percentChange:-G,trend:Y,confidenceLevel:Math.min(90,o.length*5),lastImprovement:this.findLastImprovement(o,"hrDrift"),timeframe:e.length})}e.map(I=>I.trainingLoad);const l=this.calculateAverage(a.map(I=>I.trainingLoad)),u=this.calculateAverage(r.map(I=>I.trainingLoad)),d=u!==0?(l-u)/u*100:0,p=d>10?"improving":d<-10?"declining":"stable";n.push({name:"Training Load Progression",category:"aerobic",currentValue:l,baselineValue:u,percentChange:d,trend:p,confidenceLevel:Math.min(95,e.length*3),lastImprovement:this.findLastImprovement(e,"trainingLoad"),timeframe:e.length});const m=e.filter(I=>I.sport.toLowerCase().includes("run")&&I.avgPace!==void 0);if(m.length>=5){const I=this.calculateAverage(a.filter(K=>K.sport.toLowerCase().includes("run")&&K.avgPace!==void 0).map(K=>K.avgPace)),B=this.calculateAverage(r.filter(K=>K.sport.toLowerCase().includes("run")&&K.avgPace!==void 0).map(K=>K.avgPace)),G=B!==0?(I-B)/B*100:0,Y=G<-3?"improving":G>3?"declining":"stable";n.push({name:"Running Pace",category:"aerobic",currentValue:I,baselineValue:B,percentChange:-G,trend:Y,confidenceLevel:Math.min(90,m.length*4),lastImprovement:this.findLastImprovement(m,"avgPace"),timeframe:m.length})}const w=e.filter(I=>I.sport.toLowerCase().includes("bike")&&I.avgSpeed!==void 0);if(w.length>=5){const I=this.calculateAverage(a.filter(K=>K.sport.toLowerCase().includes("bike")&&K.avgSpeed!==void 0).map(K=>K.avgSpeed)),B=this.calculateAverage(r.filter(K=>K.sport.toLowerCase().includes("bike")&&K.avgSpeed!==void 0).map(K=>K.avgSpeed)),G=B!==0?(I-B)/B*100:0,Y=G>3?"improving":G<-3?"declining":"stable";n.push({name:"Cycling Speed",category:"aerobic",currentValue:I,baselineValue:B,percentChange:G,trend:Y,confidenceLevel:Math.min(90,w.length*4),lastImprovement:this.findLastImprovement(w,"avgSpeed"),timeframe:w.length})}const E=this.analyzeRecoveryEfficiency(e);E&&n.push(E);const C=this.analyzeZoneDistribution(e);return C&&n.push(C),n}static generateInsights(e,t,n){const i=[],r=e.filter(w=>w.trend==="improving"&&w.percentChange>5);r.forEach(w=>{i.push({type:"achievement",title:`${w.name} Improvement`,description:`Your ${w.name.toLowerCase()} has improved by ${Math.abs(w.percentChange).toFixed(1)}% over the analysis period`,metrics:[w.name],actionable:!1,priority:"medium"})});const a=e.filter(w=>w.trend==="stable");a.length>=e.length*.6&&i.push({type:"plateau",title:"Performance Plateau Detected",description:"Multiple metrics show stable trends. Consider varying training intensity or adding new challenges",metrics:a.map(w=>w.name),actionable:!0,priority:"medium"});const o=e.filter(w=>w.trend==="declining"&&w.percentChange<-5);o.length>0&&i.push({type:"regression",title:"Performance Decline",description:`${o.length} metric(s) showing decline. Review training load and recovery`,metrics:o.map(w=>w.name),actionable:!0,priority:"high"});const l=t.slice(-14).reduce((w,E)=>w+E.duration,0),u=t.slice(-28,-14).reduce((w,E)=>w+E.duration,0);if(l>u*1.3&&i.push({type:"opportunity",title:"Training Volume Increase",description:"Recent training volume has increased significantly. Monitor recovery closely",metrics:["Training Load Progression"],actionable:!0,priority:"medium"}),n.length>=7){const w=n.slice(-7);w.filter(C=>C.bodyBattery!==void 0).reduce((C,I)=>C+I.bodyBattery,0)/w.length<60&&r.length===0&&i.push({type:"opportunity",title:"Recovery Optimization Needed",description:"Poor recovery metrics may be limiting performance gains",metrics:["Recovery Efficiency"],actionable:!0,priority:"high"})}const d=new Set(t.map(w=>w.date)).size,p=Math.ceil((new Date(t[t.length-1].date).getTime()-new Date(t[0].date).getTime())/(1e3*60*60*24)),m=d/p;return m>.6?i.push({type:"achievement",title:"Excellent Training Consistency",description:`Training ${(m*100).toFixed(0)}% of days shows great commitment`,metrics:[],actionable:!1,priority:"low"}):m<.3&&i.push({type:"opportunity",title:"Consistency Opportunity",description:"More consistent training could accelerate progress",metrics:[],actionable:!0,priority:"medium"}),i}static generatePredictions(e,t){const n=[];return e.forEach(i=>{if(i.trend==="stable"||i.confidenceLevel<50)return;const a=i.percentChange/this.ANALYSIS_WINDOW_DAYS*this.PREDICTION_WINDOW_DAYS,o=i.currentValue*(1+a/100),l=Math.abs(o-i.currentValue)*.2,u=[o-l,o+l],d=[];t.slice(-7).length>=5&&d.push("Recent training consistency"),i.trend==="improving"&&d.push("Positive trend momentum"),i.confidenceLevel>80&&d.push("High data confidence"),n.push({metric:i.name,timeframe:this.PREDICTION_WINDOW_DAYS,predictedValue:o,confidenceInterval:u,factors:d})}),n}static recommendTrainingFocus(e,t,n){const i=[],r=e.filter(l=>l.category==="aerobic"),a=r.length>0?r.reduce((l,u)=>l+(u.trend==="improving"?1:u.trend==="declining"?-1:0),0):0;if(a<=0&&i.push({area:"base-aerobic",priority:4,currentLevel:a<-1?"weak":"developing",recommendedSessions:3,duration:4}),t.filter(l=>l.description.toLowerCase().includes("recovery")).length>0&&i.push({area:"recovery",priority:5,currentLevel:"weak",recommendedSessions:2,duration:2}),n.fitnessLevel!=="beginner"){const l=e.some(u=>u.name.includes("Load")&&u.trend==="declining");i.push({area:"threshold",priority:l?4:3,currentLevel:l?"weak":"developing",recommendedSessions:1,duration:3})}return n.fitnessLevel==="advanced"&&i.push({area:"vo2max",priority:3,currentLevel:"developing",recommendedSessions:1,duration:2}),i.sort((l,u)=>u.priority-l.priority)}static determineOverallTrend(e){if(e.length===0)return"stable";const t=e.map(i=>{switch(i.trend){case"improving":return 1;case"declining":return-1;default:return 0}}),n=t.reduce((i,r)=>i+r,0)/t.length;return n>.2?"improving":n<-.2?"declining":"stable"}static calculateAverage(e){return e.length===0?0:e.reduce((t,n)=>t+n,0)/e.length}static findLastImprovement(e,t){const n=e[e.length-1];return n?n.date:new Date().toISOString().split("T")[0]}static analyzeRecoveryEfficiency(e){var u;if(e.length<14)return null;const t=ot.calculateTSB(e),n=t.value.tsb,i=e.slice(0,-7),a=ot.calculateTSB(i).value.tsb,o=a!==0?(n-a)/Math.abs(a)*100:0,l=o>10?"improving":o<-10?"declining":"stable";return{name:"Recovery Efficiency",category:"recovery",currentValue:n,baselineValue:a,percentChange:o,trend:l,confidenceLevel:t.confidence,lastImprovement:((u=e[e.length-1])==null?void 0:u.date)||new Date().toISOString().split("T")[0],timeframe:e.length}}static analyzeZoneDistribution(e){var l;if(e.length<10)return null;const t=e.slice(-Math.floor(e.length/2)),n=e.slice(0,Math.floor(e.length/2)),i=this.calculateEasyPercentage(t),r=this.calculateEasyPercentage(n),a=r!==0?(i-r)/r*100:0,o=Math.abs(a)<5?"stable":i>.7&&a>0?"improving":"declining";return{name:"Training Intensity Distribution",category:"efficiency",currentValue:i*100,baselineValue:r*100,percentChange:a,trend:o,confidenceLevel:Math.min(90,e.length*3),lastImprovement:((l=e[e.length-1])==null?void 0:l.date)||new Date().toISOString().split("T")[0],timeframe:e.length}}static calculateEasyPercentage(e){if(e.length===0)return 0;const t=e.reduce((i,r)=>i+r.zone1Minutes+r.zone2Minutes,0),n=e.reduce((i,r)=>i+r.duration,0);return n>0?t/n:0}};Rs.MIN_ACTIVITIES_FOR_TRENDS=10,Rs.ANALYSIS_WINDOW_DAYS=90,Rs.PREDICTION_WINDOW_DAYS=30;let pa=Rs;const _a=class _a{static async adjustPlan(e,t,n){const i=Date.now(),r=[];try{const a=this.validateAdjustmentRequest(t);if(!a.valid)return{success:!1,error:a.error,warnings:r,context:ot.createDecisionContext(e,"plan-adjustment",t),processingTime:Date.now()-i};const o=this.analyzeImpact(t),l=this.generatePrimaryAdjustment(t,n),u=this.generateAlternativePlans(t,n,l),d=this.calculateAdjustmentConfidence(t,l);this.addAdjustmentWarnings(t,l,o,r);const p={success:!0,adjustedPlan:l.plan,modifications:l.modifications,impactAssessment:o,alternatives:u,warnings:l.warnings,confidence:d},m=Date.now()-i;return{success:!0,data:p,warnings:r,context:ot.createDecisionContext(e,"plan-adjustment",t,["impact-analysis","plan-generation","alternative-generation"],{adjustmentReason:t.adjustmentReason,affectedDatesCount:t.affectedDates.length,confidence:d}),processingTime:m}}catch(a){return{success:!1,error:`Plan adjustment failed: ${a instanceof Error?a.message:"Unknown error"}`,warnings:r,context:ot.createDecisionContext(e,"plan-adjustment",t),processingTime:Date.now()-i}}}static validateAdjustmentRequest(e){if(!e.originalPlan||e.originalPlan.length===0)return{valid:!1,error:"Original plan is required and cannot be empty"};if(!e.affectedDates||e.affectedDates.length===0)return{valid:!1,error:"Affected dates must be specified"};if(!e.adjustmentReason)return{valid:!1,error:"Adjustment reason is required"};const t=new Set(e.originalPlan.map(i=>i.date)),n=e.affectedDates.filter(i=>!t.has(i));return n.length>0?{valid:!1,error:`Affected dates not found in plan: ${n.join(", ")}`}:{valid:!0}}static analyzeImpact(e){const t=e.originalPlan,n=t.filter(w=>e.affectedDates.includes(w.date)),i=n.reduce((w,E)=>w+E.durationMin,0),r=t.reduce((w,E)=>w+E.durationMin,0),a=r>0?-(i/r)*100:0,o=n.reduce((w,E)=>w+E.expectedFatigue,0)/n.length,l=t.reduce((w,E)=>w+E.expectedFatigue,0)/t.length,u=l>0?(o-l)/l*100:0,d=n.filter(w=>w.expectedFatigue<=10).length,p={};n.forEach(w=>{const E=w.workoutType;p[E]=(p[E]||0)+1});let m="maintained";return n.length>t.length*.3?m="significantly-altered":n.some(w=>w.expectedFatigue>70)&&(m="slightly-altered"),{volumeChange:a,intensityChange:-Math.abs(u),restDaysChange:-d,sportBalanceChange:Object.fromEntries(Object.entries(p).map(([w,E])=>[w,-E])),periodizationImpact:m}}static generatePrimaryAdjustment(e,t){let n=[...e.originalPlan];const i=n.filter(r=>e.affectedDates.includes(r.date));switch(e.adjustmentReason){case"missed-workout":return this.handleMissedWorkouts(n,i,e,t);case"illness":case"injury":return this.handleIllnessInjury(n,i,e,t);case"schedule-change":return this.handleScheduleChange(n,i,e,t);case"performance-plateau":return this.handlePerformancePlateau(n,i,e,t);case"overreaching":return this.handleOverreaching(n,i,e,t);default:return this.handleGenericAdjustment(n,i,e,t)}}static handleMissedWorkouts(e,t,n,i){const r=[],a=[],o=[...e];t.forEach(u=>{r.push({date:u.date,action:"cancelled",originalWorkout:u,reason:"Workout was missed"})});const l=t.filter(u=>u.expectedFatigue>70);if(l.length>0){const u=this.rescheduleWorkouts(o,l,n.constraints);r.push(...u.modifications),a.push(...u.warnings),u.modifiedPlan.forEach((d,p)=>{o[p]=d})}if(t.length>2){a.push("Multiple workouts missed - consider extending plan duration or reducing weekly volume");const u=this.compressPlan(o,n.constraints);r.push(...u.modifications),a.push(...u.warnings)}return{plan:o,modifications:r,warnings:a}}static handleIllnessInjury(e,t,n,i){const r=[],a=[],o=[...e];t.forEach(u=>{const d={date:u.date,workoutType:"rest",description:n.adjustmentReason==="illness"?"Rest day due to illness":"Rest day due to injury",expectedFatigue:0,durationMin:0,completed:!1},p=o.findIndex(m=>m.date===u.date);p>=0&&(o[p]=d,r.push({date:u.date,action:"modified",originalWorkout:u,newWorkout:d,reason:`Changed to rest due to ${n.adjustmentReason}`}))});const l=this.planGradualReturn(o,n.affectedDates,n.constraints);return r.push(...l.modifications),a.push(...l.warnings),a.push("Gradual return to training planned - listen to your body and progress conservatively"),{plan:o,modifications:r,warnings:a}}static handleScheduleChange(e,t,n,i){const r=[],a=[],o=[...e],l=this.rescheduleWorkouts(o,t,n.constraints);return r.push(...l.modifications),a.push(...l.warnings),{plan:o,modifications:r,warnings:a}}static handlePerformancePlateau(e,t,n,i){const r=[],a=[],o=[...e];return t.forEach(l=>{const u=mt.filter(d=>d.type!==l.workoutType&&Math.abs(d.fatigueScore-l.expectedFatigue)<=15);if(u.length>0){const d=u[Math.floor(Math.random()*u.length)],p=Le.adjustWorkoutForFitnessLevel(d,i.fitnessLevel),m={date:l.date,workoutType:p.type,description:`${p.description} (varied for progression)`,expectedFatigue:p.fatigueScore,durationMin:p.durationMin,completed:!1},w=o.findIndex(E=>E.date===l.date);w>=0&&(o[w]=m,r.push({date:l.date,action:"modified",originalWorkout:l,newWorkout:m,reason:"Varied workout type to overcome plateau"}))}}),a.push("Training variety increased to stimulate adaptation and overcome plateau"),{plan:o,modifications:r,warnings:a}}static handleOverreaching(e,t,n,i){const r=[],a=[],o=[...e];return t.forEach(l=>{if(l.expectedFatigue>30){const d=Le.getRecoveryWorkouts()[0]||{type:"rest",description:"Recovery day",durationMin:0,fatigueScore:0},p={date:l.date,workoutType:d.type,description:`${d.description} (overreaching recovery)`,expectedFatigue:d.fatigueScore,durationMin:d.durationMin,completed:!1},m=o.findIndex(w=>w.date===l.date);m>=0&&(o[m]=p,r.push({date:l.date,action:"modified",originalWorkout:l,newWorkout:p,reason:"Reduced to recovery due to overreaching"}))}}),a.push("Training load significantly reduced to address overreaching - prioritize recovery"),a.push("Monitor recovery metrics closely and gradually return to normal training"),{plan:o,modifications:r,warnings:a}}static handleGenericAdjustment(e,t,n,i){const r=[],a=[],o=[...e];return t.forEach(l=>{r.push({date:l.date,action:"cancelled",originalWorkout:l,reason:"Generic adjustment request"})}),a.push("Workouts removed as requested - consider redistributing training load"),{plan:o,modifications:r,warnings:a}}static rescheduleWorkouts(e,t,n){const i=[],r=[],a=[...e],o=new Set(e.map(u=>u.date)),l=n.availableDays||[];return t.forEach(u=>{const d=l.filter(p=>o.has(p)&&!e.some(m=>m.date===p&&m.expectedFatigue>10));if(d.length>0){const p=d[0],m={...u,date:p,description:`${u.description} (rescheduled)`},w=a.findIndex(E=>E.date===p);w>=0?a[w]=m:a.push(m),i.push({date:u.date,action:"moved",originalWorkout:u,newWorkout:m,reason:`Rescheduled from ${u.date} to ${p}`})}else r.push(`Could not reschedule ${u.workoutType} workout from ${u.date}`)}),{modifiedPlan:a,modifications:i,warnings:r}}static compressPlan(e,t){const n=[],i=[];return i.push("Plan compression not fully implemented - manual review recommended"),{modifications:n,warnings:i}}static planGradualReturn(e,t,n){const i=[],r=[],a=new Date(Math.max(...t.map(l=>new Date(l).getTime()))),o=e.filter(l=>new Date(l.date)>a).slice(0,3).sort((l,u)=>new Date(l.date).getTime()-new Date(u.date).getTime());return o.forEach((l,u)=>{const d=.5+u*.2,p=l.expectedFatigue,m=Math.max(10,p*d),w=Math.max(15,l.durationMin*d),E={...l,description:`${l.description} (gradual return - ${Math.round(d*100)}%)`,expectedFatigue:m,durationMin:w};i.push({date:l.date,action:"modified",originalWorkout:l,newWorkout:E,reason:`Reduced intensity for gradual return (${Math.round(d*100)}%)`})}),o.length>0&&r.push("First 3 workouts after return have reduced intensity for gradual progression"),{modifications:i,warnings:r}}static generateAlternativePlans(e,t,n){const i=[];return i.push({name:"Conservative Adjustment",description:"Minimal changes with focus on maintaining consistency",plan:this.generateConservativeAlternative(e,t),tradeoffs:["Lower training stress","May slow progress slightly"],score:75}),i.push({name:"Aggressive Compensation",description:"Redistribute training load to maintain weekly volume",plan:this.generateAggressiveAlternative(e,t),tradeoffs:["Higher training stress on remaining days","Risk of overreaching"],score:60}),i.slice(0,this.MAX_ALTERNATIVES)}static generateConservativeAlternative(e,t){return[...e.originalPlan].filter(i=>!e.affectedDates.includes(i.date))}static generateAggressiveAlternative(e,t){const n=[...e.originalPlan],r=n.filter(l=>e.affectedDates.includes(l.date)).reduce((l,u)=>l+u.expectedFatigue,0),a=n.filter(l=>!e.affectedDates.includes(l.date)),o=r/a.length;return a.map(l=>({...l,expectedFatigue:Math.min(100,l.expectedFatigue+o),description:`${l.description} (compensated load)`}))}static calculateAdjustmentConfidence(e,t){let n=80;return e.affectedDates.length>3&&(n-=15),e.adjustmentReason==="performance-plateau"&&(n-=10),e.constraints.maxDailyDuration&&e.constraints.maxDailyDuration<60&&(n-=10),e.adjustmentReason==="schedule-change"&&(n+=5),e.affectedDates.length===1&&(n+=5),Math.max(30,Math.min(95,n))}static addAdjustmentWarnings(e,t,n,i){Math.abs(n.volumeChange)>20&&i.push(`Significant volume change (${n.volumeChange.toFixed(1)}%) - monitor training response`),n.periodizationImpact==="significantly-altered"&&i.push("Periodization structure significantly altered - consider plan revision"),e.affectedDates.length>e.originalPlan.length*.4&&i.push("Large portion of plan affected - consider regenerating entire plan")}static async quickAdjustWorkout(e,t,n){try{switch(t){case"missed":return{success:!0,action:"cancelled",reason:"Workout was missed and marked as cancelled"};case"illness":return{success:!0,adjustedWorkout:{...e,workoutType:"rest",description:"Rest day due to illness",expectedFatigue:0,durationMin:0},action:"modified",reason:"Replaced with rest day due to illness"};case"schedule":return n?{success:!0,adjustedWorkout:{...e,date:n,description:`${e.description} (rescheduled)`},action:"moved",reason:`Rescheduled from ${e.date} to ${n}`}:{success:!1,action:"cancelled",reason:"New date required for schedule change"};default:return{success:!1,action:"cancelled",reason:"Unknown adjustment reason"}}}catch(i){return{success:!1,action:"cancelled",reason:`Adjustment failed: ${i instanceof Error?i.message:"Unknown error"}`}}}};_a.MAX_ALTERNATIVES=3,_a.MIN_CONFIDENCE_THRESHOLD=60;let nl=_a;class Rn{static firebaseActivityToActivityMetrics(e){return{date:e.date,activityId:e.id,sport:e.sport,subSport:e.subSport,duration:e.duration,distance:e.distance,avgHR:e.avgHR,maxHR:e.maxHR,hrDrift:e.hrDrift,zone1Minutes:e.zone1Minutes,zone2Minutes:e.zone2Minutes,zone3Minutes:e.zone3Minutes,zone4Minutes:e.zone4Minutes,zone5Minutes:e.zone5Minutes,trainingLoad:e.trainingLoad,calories:e.calories,totalAscent:e.totalAscent,totalDescent:e.totalDescent,avgSpeed:e.avgSpeed,maxSpeed:e.maxSpeed,avgPace:e.avgPace,notes:e.notes}}static firebaseActivitiesToActivityMetrics(e){return e.map(this.firebaseActivityToActivityMetrics)}static createUserTrainingProfile(e){if(e!=null&&e.preferences){const t=e.preferences;return{age:t.age||35,sex:this.normalizeSex(t.sex),restingHR:t.restingHR||60,maxHR:t.maxHR||185,fitnessLevel:t.fitnessLevel||"intermediate",preferredSports:t.sports||["running"],trainingGoals:t.goals||["fitness"],availableDays:t.availableDays||this.getDefaultAvailableDays(),preferredWorkoutTimes:this.getDefaultWorkoutTimes()}}return{age:35,sex:"other",restingHR:60,maxHR:185,fitnessLevel:"intermediate",preferredSports:["running"],trainingGoals:["fitness"],availableDays:this.getDefaultAvailableDays(),preferredWorkoutTimes:this.getDefaultWorkoutTimes()}}static createUserTrainingProfileFromService(e){const t=e.getUserProfile(),n=e.getTrainingProfile();if(t!=null&&t.preferences){const i=t.preferences;return{age:n.age,sex:this.normalizeSex(i.sex),restingHR:n.restingHR,maxHR:n.maxHR,fitnessLevel:n.fitnessLevel,preferredSports:n.preferredSports,trainingGoals:n.goals,availableDays:i.availableDays||this.getDefaultAvailableDays(),preferredWorkoutTimes:this.getDefaultWorkoutTimes()}}return{age:n.age,sex:"other",restingHR:n.restingHR,maxHR:n.maxHR,fitnessLevel:n.fitnessLevel,preferredSports:n.preferredSports,trainingGoals:n.goals,availableDays:this.getDefaultAvailableDays(),preferredWorkoutTimes:this.getDefaultWorkoutTimes()}}static normalizeSex(e){if(!e)return"other";const t=e.toLowerCase();return t==="male"||t==="m"?"male":t==="female"||t==="f"?"female":"other"}static getDefaultAvailableDays(){return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}static getDefaultWorkoutTimes(){return[{dayOfWeek:"Monday",timeSlot:"evening",duration:60},{dayOfWeek:"Wednesday",timeSlot:"evening",duration:60},{dayOfWeek:"Friday",timeSlot:"evening",duration:60},{dayOfWeek:"Saturday",timeSlot:"morning",duration:90}]}static validateFirebaseActivity(e){const t=[],n=[];e.date||t.push("date"),typeof e.duration!="number"&&t.push("duration"),typeof e.distance!="number"&&t.push("distance"),e.sport||t.push("sport"),typeof e.trainingLoad!="number"&&t.push("trainingLoad");const r=["zone1Minutes","zone2Minutes","zone3Minutes","zone4Minutes","zone5Minutes"].filter(a=>typeof e[a]!="number");return r.length>0&&t.push(...r),e.avgHR||n.push("Missing average HR - may affect fatigue calculations"),e.maxHR||n.push("Missing max HR - may affect intensity analysis"),{valid:t.length===0,missingFields:t,warnings:n}}static validateFirebaseRecoveryMetrics(e){const t=[],n=[];return e.date||t.push("date"),typeof e.subjectiveFatigue!="number"&&t.push("subjectiveFatigue"),e.bodyBattery===void 0&&n.push("Missing body battery - may affect recovery assessment"),e.sleepScore===void 0&&n.push("Missing sleep score - may affect recovery assessment"),e.hrv===void 0&&n.push("Missing HRV - may affect fatigue detection"),e.restingHR===void 0&&n.push("Missing resting HR - may affect stress detection"),{valid:t.length===0,missingFields:t,warnings:n}}static assessDataQuality(e,t){let n=100;const i=[];e.length===0?(n-=50,i.push("No activity data available")):e.length<5?(n-=30,i.push("Limited activity history")):e.length<15?(n-=15,i.push("Moderate activity history")):i.push("Good activity history"),t.length===0?(n-=30,i.push("No recovery data available")):t.length<7?(n-=20,i.push("Limited recovery data")):t.length<14?(n-=10,i.push("Moderate recovery data")):i.push("Good recovery data history");const a=e.filter(d=>d.avgHR&&d.maxHR).length/Math.max(1,e.length);if(a<.3?(n-=15,i.push("Limited heart rate data")):a<.7&&(n-=5,i.push("Moderate heart rate coverage")),t.filter(d=>d.bodyBattery!==void 0||d.sleepScore!==void 0||d.hrv!==void 0).length/Math.max(1,t.length)<.3&&(n-=10,i.push("Limited biometric recovery data")),e.length>0){const d=new Date(Math.max(...e.map(m=>new Date(m.date).getTime()))),p=(Date.now()-d.getTime())/(1e3*60*60*24);p>14?(n-=15,i.push("Activity data is getting stale")):p>7&&(n-=5,i.push("Recent activity data available"))}let u;return n>=85?u="excellent":n>=70?u="good":n>=50?u="fair":u="poor",{score:Math.max(0,n),category:u,factors:i}}}const ya=class ya{static async getDashboardInsights(e){try{const[t,n]=await Promise.all([pe.getActivities(new Date(Date.now()-2592e6)),pe.getRecoveryMetrics(new Date(Date.now()-2592e6))]),i=Rn.firebaseActivitiesToActivityMetrics(t),r=n,a=await this.createUserProfile(e),o=new Date().toISOString().split("T")[0],l=`dashboard_${e}_${o}`;if(this.cachedRecommendations.has(l)){const E=this.cachedRecommendations.get(l);if(Date.now()-E.timestamp<this.cacheTimeout)return E.data}const[u,d,p]=await Promise.all([this.getWorkoutRecommendation(e,i,r,a),this.getFatigueAssessment(e,i,r,a),this.getPerformanceAnalysis(e,i,r,a)]),m=this.calculateQuickStats(u,d,p),w={workoutRecommendation:u!=null&&u.success?u.data:null,fatigueAssessment:d!=null&&d.success?d.data:null,performanceAnalysis:p!=null&&p.success?p.data:null,quickStats:m,lastUpdated:new Date().toISOString()};return this.cachedRecommendations.set(l,{data:w,timestamp:Date.now()}),w}catch(t){return console.error("Error getting dashboard insights:",t),{quickStats:{readinessScore:50,trendDirection:"stable",nextRecommendation:"Unable to generate recommendation",riskLevel:"low"},lastUpdated:new Date().toISOString()}}}static async getTomorrowWorkoutRecommendation(e){try{const[t,n]=await Promise.all([pe.getActivities(new Date(Date.now()-24192e5)),pe.getRecoveryMetrics(new Date(Date.now()-12096e5))]),i=Rn.firebaseActivitiesToActivityMetrics(t),r=n,a=await this.createUserProfile(e);return await this.getWorkoutRecommendation(e,i,r,a)}catch(t){return{success:!1,error:`Failed to get workout recommendation: ${t instanceof Error?t.message:"Unknown error"}`,warnings:[],context:{userId:e,timestamp:new Date().toISOString(),inputData:{},algorithms:[],parameters:{},version:"1.0.0"},processingTime:0}}}static async getCurrentFatigueAssessment(e){try{const[t,n]=await Promise.all([pe.getActivities(new Date(Date.now()-24192e5)),pe.getRecoveryMetrics(new Date(Date.now()-12096e5))]),i=Rn.firebaseActivitiesToActivityMetrics(t),r=n,a=await this.createUserProfile(e);return await Is.assessFatigue(e,i,r,a)}catch(t){return{success:!1,error:`Failed to assess fatigue: ${t instanceof Error?t.message:"Unknown error"}`,warnings:[],context:{userId:e,timestamp:new Date().toISOString(),inputData:{},algorithms:[],parameters:{},version:"1.0.0"},processingTime:0}}}static async getPerformanceInsights(e){try{const[t,n]=await Promise.all([pe.getActivities(new Date(Date.now()-7776e6)),pe.getRecoveryMetrics(new Date(Date.now()-2592e6))]),i=Rn.firebaseActivitiesToActivityMetrics(t),r=n,a=await this.createUserProfile(e);return await pa.analyzePerformance(e,i,r,a)}catch(t){return{success:!1,error:`Failed to analyze performance: ${t instanceof Error?t.message:"Unknown error"}`,warnings:[],context:{userId:e,timestamp:new Date().toISOString(),inputData:{},algorithms:[],parameters:{},version:"1.0.0"},processingTime:0}}}static async adjustTrainingPlan(e,t){try{const n=await this.createUserProfile(e);return await nl.adjustPlan(e,t,n)}catch(n){return{success:!1,error:`Failed to adjust plan: ${n instanceof Error?n.message:"Unknown error"}`,warnings:[],context:{userId:e,timestamp:new Date().toISOString(),inputData:{},algorithms:[],parameters:{},version:"1.0.0"},processingTime:0}}}static async quickTrainingDecision(e){try{const[t,n]=await Promise.all([pe.getActivities(new Date(Date.now()-12096e5)),pe.getRecoveryMetrics(new Date(Date.now()-6048e5))]),i=Rn.firebaseActivitiesToActivityMetrics(t),r=n,a=r.length>0?r[0]:{date:new Date().toISOString().split("T")[0],userId:e,subjectiveFatigue:5,recordedAt:new Date},o=await Is.quickFatigueCheck(e,i,a);let l=70;return t.length>=7&&(l+=15),n.length>=3&&(l+=15),{...o,confidence:Math.min(95,l)}}catch{return{canTrain:!0,recommendation:"easy",reasons:["Error assessing fatigue - defaulting to easy training"],confidence:30}}}static async getWeatherAdjustedRecommendation(e,t){try{const[n,i]=await Promise.all([pe.getActivities(new Date(Date.now()-24192e5)),pe.getRecoveryMetrics(new Date(Date.now()-12096e5))]),r=Rn.firebaseActivitiesToActivityMetrics(n),a=i,o=await this.createUserProfile(e),l={userId:e,currentDate:new Date().toISOString().split("T")[0],recentActivities:r,recoveryMetrics:a,userProfile:o,weatherData:t};return await fa.recommendTomorrowWorkout(l)}catch(n){return{success:!1,error:`Failed to get weather-adjusted recommendation: ${n instanceof Error?n.message:"Unknown error"}`,warnings:[],context:{userId:e,timestamp:new Date().toISOString(),inputData:{},algorithms:[],parameters:{},version:"1.0.0"},processingTime:0}}}static async getWorkoutRecommendation(e,t,n,i){const r={userId:e,currentDate:new Date().toISOString().split("T")[0],recentActivities:t,recoveryMetrics:n,userProfile:i};return await fa.recommendTomorrowWorkout(r)}static async getFatigueAssessment(e,t,n,i){return await Is.assessFatigue(e,t,n,i)}static async getPerformanceAnalysis(e,t,n,i){return await pa.analyzePerformance(e,t,n,i)}static async createUserProfile(e){try{const t=Ye.getInstance();return Rn.createUserTrainingProfileFromService(t)}catch(t){return console.warn("Failed to load user profile, using defaults:",t),Rn.createUserTrainingProfile()}}static calculateQuickStats(e,t,n){let i=50;if(t!=null&&t.success&&t.data)switch(t.data.overallStatus){case"fresh":i=85;break;case"normal":i=70;break;case"fatigued":i=40;break;case"overtrained":i=20;break}let r="stable";n!=null&&n.success&&n.data&&(r=n.data.overallTrend);let a="Continue with current training";if(e!=null&&e.success&&e.data){const l=e.data.recommendedWorkout;a=`${l.type}: ${l.description}`}let o="low";return t!=null&&t.success&&t.data&&(o=t.data.riskLevel),{readinessScore:i,trendDirection:r,nextRecommendation:a,riskLevel:o}}static clearCache(){this.cachedRecommendations.clear()}static getCacheStats(){var n,i;const e=Array.from(this.cachedRecommendations.entries());if(e.length===0)return{size:0};const t=e.map(([r,a])=>({key:r,timestamp:a.timestamp}));return t.sort((r,a)=>r.timestamp-a.timestamp),{size:e.length,oldestEntry:(n=t[0])==null?void 0:n.key,newestEntry:(i=t[t.length-1])==null?void 0:i.key}}};ya.cachedRecommendations=new Map,ya.cacheTimeout=60*60*1e3;let Qt=ya;class sc{constructor(){this.cachedData=null,this.cacheExpiry=null,this.CACHE_DURATION_MS=5*60*1e3,this.aiInsightsEnabled=!0,this.realtimeUnsubscribe=null,this.realtimeCallbacks={},this.userProfileService=Ye.getInstance()}async getDashboardData(e=!1){var t;if(!e&&this.cachedData&&this.cacheExpiry&&new Date<this.cacheExpiry)return this.cachedData;try{if(!this.userProfileService.isAuthenticated())return console.warn("User not authenticated, using localStorage fallback"),this.getLocalStorageData();let n=[],i=[];const r=await pe.getActivities(),a=[];n=r.map(this.convertFirebaseActivityToMetrics);const o=new Map;for(const p of r){o.set(p.id,p.date);const m=await pe.getLapDataForActivity(p.id);a.push(...m)}i=a.map(p=>this.convertFirebaseLapToMetrics(p,o.get(p.activityId)));const l=Ai.calculateDashboardMetrics(n);let u;if(this.aiInsightsEnabled&&this.userProfileService.isAuthenticated())try{u=await Qt.getDashboardInsights(((t=this.userProfileService.getCurrentUser())==null?void 0:t.uid)||"")}catch(p){console.warn("Failed to load AI insights:",p)}const d={metrics:l,activities:n,laps:i,lastUpdated:new Date,aiInsights:u};return this.cachedData=d,this.cacheExpiry=new Date(Date.now()+this.CACHE_DURATION_MS),d}catch(n){console.error("Failed to load dashboard data from Firebase:",n);try{return console.warn("Falling back to localStorage"),this.getLocalStorageData()}catch(i){return console.error("localStorage fallback also failed:",i),this.cachedData?(console.warn("Using expired cached data due to error"),this.cachedData):this.getEmptyDashboardData()}}}async getRecentActivities(e=7){try{const t=await this.getDashboardData(),n=new Date;return n.setDate(n.getDate()-e),t.activities.filter(i=>new Date(i.date)>=n).sort((i,r)=>new Date(r.date).getTime()-new Date(i.date).getTime())}catch(t){return console.error("Failed to get recent activities:",t),[]}}async getMetricsForDateRange(e,t){try{const i=(await this.getDashboardData()).activities.filter(r=>{const a=new Date(r.date);return a>=e&&a<=t});return Ai.calculateDashboardMetrics(i)}catch(n){return console.error("Failed to get metrics for date range:",n),Ai.calculateDashboardMetrics([])}}async getActivitySummary(){try{const t=(await this.getDashboardData()).activities,n=t.reduce((u,d)=>u+d.distance,0),i=t.reduce((u,d)=>u+d.duration,0),r=t.reduce((u,d)=>u+d.trainingLoad,0),a=t.filter(u=>u.avgHR),o=a.length>0?a.reduce((u,d)=>u+(d.avgHR||0),0)/a.length:0,l=t.reduce((u,d)=>(u[d.sport]=(u[d.sport]||0)+1,u),{});return{totalActivities:t.length,totalDistance:Math.round(n*10)/10,totalDuration:Math.round(i),totalTrainingLoad:Math.round(r),averageHR:Math.round(o),sportBreakdown:l}}catch(e){return console.error("Failed to get activity summary:",e),{totalActivities:0,totalDistance:0,totalDuration:0,totalTrainingLoad:0,averageHR:0,sportBreakdown:{}}}}async getLapsForActivity(e){try{return this.userProfileService.isAuthenticated()?(await pe.getLapDataForActivity(e)).map(n=>this.convertFirebaseLapToMetrics(n,void 0)):(console.warn("User not authenticated, cannot load laps"),[])}catch(t){return console.error("Failed to get laps for activity:",t),[]}}async testConnection(){try{if(this.userProfileService.isAuthenticated())try{return{success:!0,message:`Firebase connection successful. Found ${(await pe.getActivities()).length} activities.`}}catch(e){console.warn("Firebase connection failed, testing localStorage fallback:",e)}return localStorage.setItem("test","test"),localStorage.removeItem("test"),{success:!0,message:"Local storage connection successful (offline mode)"}}catch(e){return{success:!1,message:`Connection failed: ${e.message}`}}}async initialize(){try{return(await this.testConnection()).success?(await this.getDashboardData(),!0):!1}catch(e){return console.error("Failed to initialize dashboard service:",e),!1}}async signIn(){try{return this.userProfileService.isAuthenticated()}catch(e){return console.error("Sign in check failed:",e),!1}}clearCache(){this.cachedData=null,this.cacheExpiry=null}isCacheValid(){return this.cachedData!==null&&this.cacheExpiry!==null&&new Date<this.cacheExpiry}getCacheStatus(){return{hasCachedData:this.cachedData!==null,cacheExpiry:this.cacheExpiry,isValid:this.isCacheValid()}}getEmptyDashboardData(){return{metrics:Ai.calculateDashboardMetrics([]),activities:[],laps:[],lastUpdated:new Date}}async getLocalStorageData(){let e=[],t=[];const n=localStorage.getItem("dashboard-activities"),i=localStorage.getItem("dashboard-laps");n&&(e=JSON.parse(n)),i&&(t=JSON.parse(i));const a={metrics:Ai.calculateDashboardMetrics(e),activities:e,laps:t,lastUpdated:new Date};return this.cachedData=a,this.cacheExpiry=new Date(Date.now()+this.CACHE_DURATION_MS),a}convertFirebaseActivityToMetrics(e){return{date:e.date,activityId:e.id,sport:e.sport,subSport:e.subSport,duration:e.duration,distance:e.distance,avgHR:e.avgHR,maxHR:e.maxHR,hrDrift:e.hrDrift,zone1Minutes:e.zone1Minutes,zone2Minutes:e.zone2Minutes,zone3Minutes:e.zone3Minutes,zone4Minutes:e.zone4Minutes,zone5Minutes:e.zone5Minutes,trainingLoad:e.trainingLoad,calories:e.calories,totalAscent:e.totalAscent,totalDescent:e.totalDescent,avgSpeed:e.avgSpeed,maxSpeed:e.maxSpeed,avgPace:e.avgPace,notes:e.notes}}convertFirebaseLapToMetrics(e,t){return{date:t||new Date().toISOString().split("T")[0],activityId:e.activityId,lapNumber:e.lapNumber,lapDuration:e.lapDuration,lapDistance:e.lapDistance,avgHR:e.avgHR,maxHR:e.maxHR,avgSpeed:e.avgSpeed,maxSpeed:e.maxSpeed,avgPace:e.avgPace,elevationGain:e.elevationGain,elevationLoss:e.elevationLoss,avgPower:e.avgPower,maxPower:e.maxPower,normalizedPower:e.normalizedPower,startTime:e.startTime,endTime:e.endTime,splitType:e.splitType}}async addActivity(e){try{if(this.userProfileService.isAuthenticated()){const t={date:e.date,sport:e.sport,subSport:e.subSport,duration:e.duration,distance:e.distance,avgHR:e.avgHR,maxHR:e.maxHR,hrDrift:e.hrDrift,zone1Minutes:e.zone1Minutes,zone2Minutes:e.zone2Minutes,zone3Minutes:e.zone3Minutes,zone4Minutes:e.zone4Minutes,zone5Minutes:e.zone5Minutes,trainingLoad:e.trainingLoad,calories:e.calories,totalAscent:e.totalAscent,totalDescent:e.totalDescent,avgSpeed:e.avgSpeed,maxSpeed:e.maxSpeed,avgPace:e.avgPace,notes:e.notes,processed:!0},n=this.removeUndefinedValues(t),i=await pe.addActivity(n);return this.clearCache(),i}else return this.addActivityToLocalStorage(e)}catch(t){throw console.error("Failed to add activity:",t),t}}async addLapData(e){try{if(this.userProfileService.isAuthenticated()){const t=e.map(n=>{const i={activityId:n.activityId||"",lapNumber:n.lapNumber,lapDuration:n.lapDuration,lapDistance:n.lapDistance,avgHR:n.avgHR,maxHR:n.maxHR,avgSpeed:n.avgSpeed,maxSpeed:n.maxSpeed,avgPace:n.avgPace,elevationGain:n.elevationGain,elevationLoss:n.elevationLoss,avgPower:n.avgPower,maxPower:n.maxPower,normalizedPower:n.normalizedPower,startTime:n.startTime,endTime:n.endTime,splitType:n.splitType};return this.removeUndefinedValues(i)});await pe.addLapData(t),this.clearCache()}else this.addLapDataToLocalStorage(e)}catch(t){throw console.error("Failed to add lap data:",t),t}}addActivityToLocalStorage(e){const t=localStorage.getItem("dashboard-activities"),n=t?JSON.parse(t):[],i=`activity_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r={...e,activityId:i};return n.push(r),localStorage.setItem("dashboard-activities",JSON.stringify(n)),this.clearCache(),i}addLapDataToLocalStorage(e){const t=localStorage.getItem("dashboard-laps"),n=t?JSON.parse(t):[];n.push(...e),localStorage.setItem("dashboard-laps",JSON.stringify(n)),this.clearCache()}async exportDashboardData(){try{const e=await this.getDashboardData();return JSON.stringify({exportDate:new Date().toISOString(),activities:e.activities,laps:e.laps,metrics:e.metrics},null,2)}catch(e){throw console.error("Failed to export dashboard data:",e),e}}async getTrendAnalysis(e=4){var t,n,i;try{const r=await this.getDashboardData(),a=new Date,o=[];for(let m=e-1;m>=0;m--){const w=new Date(a);w.setDate(a.getDate()-m*7-a.getDay()+1);const E=new Date(w);E.setDate(w.getDate()+6);const I=r.activities.filter(Y=>{const K=new Date(Y.date);return K>=w&&K<=E}).reduce((Y,K)=>Y+K.trainingLoad,0),B=m===e-1?I:((t=o[o.length-1])==null?void 0:t.load)||0,G=B>0?(I-B)/B*100:0;o.push({week:`${w.getMonth()+1}/${w.getDate()}`,load:Math.round(I),change:Math.round(G)})}const l=o.reduce((m,w)=>m+w.load,0)/e,u=((n=o[0])==null?void 0:n.load)||0,d=((i=o[o.length-1])==null?void 0:i.load)||0;let p="stable";if(u>0){const m=(d-u)/u*100;m>10?p="increasing":m<-10&&(p="decreasing")}return{weeklyLoads:o,totalTrend:p,avgWeeklyLoad:Math.round(l)}}catch(r){return console.error("Failed to get trend analysis:",r),{weeklyLoads:[],totalTrend:"stable",avgWeeklyLoad:0}}}removeUndefinedValues(e){const t={};for(const[n,i]of Object.entries(e))i!==void 0&&(t[n]=i);return t}enableRealtimeSync(e){var t,n;try{return this.userProfileService.isAuthenticated()?(this.disableRealtimeSync(),this.realtimeCallbacks=e||{},this.realtimeUnsubscribe=pe.subscribeToActivities(i=>{this.handleRealtimeActivitiesUpdate(i)},i=>{var r,a;console.error("Real-time activities sync error:",i),(a=(r=this.realtimeCallbacks).onError)==null||a.call(r,i)}),console.log("Real-time synchronization enabled"),!0):(console.warn("Cannot enable real-time sync: User not authenticated"),!1)}catch(i){return console.error("Failed to enable real-time sync:",i),(n=(t=this.realtimeCallbacks).onError)==null||n.call(t,i),!1}}disableRealtimeSync(){this.realtimeUnsubscribe&&(this.realtimeUnsubscribe(),this.realtimeUnsubscribe=null,console.log("Real-time synchronization disabled"))}isRealtimeSyncEnabled(){return this.realtimeUnsubscribe!==null}async handleRealtimeActivitiesUpdate(e){var t,n,i,r;try{const a=e.map(this.convertFirebaseActivityToMetrics),o=[],l=new Map;for(const m of e){l.set(m.id,m.date);try{const w=await pe.getLapDataForActivity(m.id);o.push(...w)}catch(w){console.warn(`Failed to load laps for activity ${m.id}:`,w)}}const u=o.map(m=>this.convertFirebaseLapToMetrics(m,l.get(m.activityId))),p={metrics:Ai.calculateDashboardMetrics(a),activities:a,laps:u,lastUpdated:new Date};this.cachedData=p,this.cacheExpiry=new Date(Date.now()+this.CACHE_DURATION_MS),(n=(t=this.realtimeCallbacks).onDataChange)==null||n.call(t,p)}catch(a){console.error("Error handling real-time activities update:",a),(r=(i=this.realtimeCallbacks).onError)==null||r.call(i,a)}}getSyncStatus(){return{isEnabled:this.isRealtimeSyncEnabled(),hasCallbacks:Object.keys(this.realtimeCallbacks).length>0,cacheStatus:this.getCacheStatus()}}async getAIWorkoutRecommendation(){var e;try{if(!this.aiInsightsEnabled||!this.userProfileService.isAuthenticated())return null;const t=((e=this.userProfileService.getCurrentUser())==null?void 0:e.uid)||"";return await Qt.getTomorrowWorkoutRecommendation(t)}catch(t){return console.error("Failed to get AI workout recommendation:",t),null}}async getAIFatigueAssessment(){var e;try{if(!this.aiInsightsEnabled||!this.userProfileService.isAuthenticated())return null;const t=((e=this.userProfileService.getCurrentUser())==null?void 0:e.uid)||"";return await Qt.getCurrentFatigueAssessment(t)}catch(t){return console.error("Failed to get AI fatigue assessment:",t),null}}async getAIPerformanceInsights(){var e;try{if(!this.aiInsightsEnabled||!this.userProfileService.isAuthenticated())return null;const t=((e=this.userProfileService.getCurrentUser())==null?void 0:e.uid)||"";return await Qt.getPerformanceInsights(t)}catch(t){return console.error("Failed to get AI performance insights:",t),null}}async getQuickTrainingDecision(){var e;try{if(!this.aiInsightsEnabled||!this.userProfileService.isAuthenticated())return null;const t=((e=this.userProfileService.getCurrentUser())==null?void 0:e.uid)||"";return await Qt.quickTrainingDecision(t)}catch(t){return console.error("Failed to get quick training decision:",t),null}}setAIInsightsEnabled(e){this.aiInsightsEnabled=e,e||this.cachedData&&(this.cachedData.aiInsights=void 0)}isAIInsightsEnabled(){return this.aiInsightsEnabled&&this.userProfileService.isAuthenticated()}async refreshAIInsights(){var e;if(!(!this.aiInsightsEnabled||!this.userProfileService.isAuthenticated()))try{const t=((e=this.userProfileService.getCurrentUser())==null?void 0:e.uid)||"",n=await Qt.getDashboardInsights(t);this.cachedData&&(this.cachedData.aiInsights=n,this.cachedData.lastUpdated=new Date)}catch(t){console.error("Failed to refresh AI insights:",t)}}getAIInsightsStatus(){var t;const e=(t=this.cachedData)==null?void 0:t.aiInsights;return{enabled:this.aiInsightsEnabled,available:this.isAIInsightsEnabled(),lastUpdated:e==null?void 0:e.lastUpdated,hasRecommendation:!!(e!=null&&e.workoutRecommendation),hasFatigueAssessment:!!(e!=null&&e.fatigueAssessment),hasPerformanceAnalysis:!!(e!=null&&e.performanceAnalysis)}}}class G1{constructor(){this.hrCalculator=new Og(rh),this.dashboardService=new sc}async processBatchFiles(e,t={}){const n=Date.now(),i={activitiesProcessed:0,activitiesSkipped:0,totalActivities:[],totalLaps:[],errors:[],processingTimeMs:0};try{for(const r of e)try{let a;typeof r=="string"?a=await this.loadJsonFile(r):a=await this.parseFileContent(r);const o=this.extractActivityMetrics(a,typeof r=="string"?r:r.name),l=this.extractLapMetrics(a,o.date,o.activityId);try{const u=await this.dashboardService.addActivity(o),d=l.map(p=>({...p,activityId:u}));await this.dashboardService.addLapData(d),o.activityId=u}catch(u){console.warn("Failed to save activity to Firebase, data will only be in result:",u)}i.totalActivities.push(o),i.totalLaps.push(...l),i.activitiesProcessed++}catch(a){i.activitiesSkipped++,i.errors.push(`Error processing ${typeof r=="string"?r:r.name}: ${a.message}`)}}catch(r){i.errors.push(`Batch processing error: ${r.message}`)}return i.processingTimeMs=Date.now()-n,i}extractActivityMetrics(e,t){const n=this.getPrimarySession(e),i=e.records||[],r=Array.isArray(e.activity)?e.activity[0]:e.activity,a=(n==null?void 0:n.start_time)||(r==null?void 0:r.timestamp)||new Date,o=new Date(a).toISOString().split("T")[0],l=this.convertToMinutes((n==null?void 0:n.total_elapsed_time)||(n==null?void 0:n.total_timer_time)||0),u=this.extractDistance(e,n),d=this.analyzeHeartRate(i),p=this.calculateHRZoneDistribution(i,l),m=d.avgHR?this.hrCalculator.calculateTRIMP(d.avgHR,l):0,w=this.normalizeSport((n==null?void 0:n.sport)||(r==null?void 0:r.event)||"unknown"),E={date:o,activityId:this.generateActivityId(o,w),sport:w,subSport:(n==null?void 0:n.sub_sport)||void 0,duration:l,distance:u,avgHR:d.avgHR||void 0,maxHR:d.maxHR||void 0,hrDrift:d.hrDrift||void 0,zone1Minutes:p.zone1,zone2Minutes:p.zone2,zone3Minutes:p.zone3,zone4Minutes:p.zone4,zone5Minutes:p.zone5,trainingLoad:m,calories:(n==null?void 0:n.total_calories)||void 0,totalAscent:(n==null?void 0:n.total_ascent)||void 0,totalDescent:(n==null?void 0:n.total_descent)||void 0,avgSpeed:this.convertToKmh(n==null?void 0:n.avg_speed),maxSpeed:this.convertToKmh(n==null?void 0:n.max_speed),fileName:t};return this.hrCalculator.isPaceSport(w)&&u>0&&(E.avgPace=l/u),E}extractLapMetrics(e,t,n){const i=e.laps||[],r=[];return i.forEach((a,o)=>{const l=this.convertToMinutes(a.total_elapsed_time||a.total_timer_time||0),u=this.extractLapDistance(a),d={date:t,activityId:n,lapNumber:o+1,lapDuration:l,lapDistance:u,avgHR:a.avg_heart_rate,maxHR:a.max_heart_rate,avgSpeed:this.convertToKmh(a.avg_speed),maxSpeed:this.convertToKmh(a.max_speed),elevationGain:a.total_ascent,elevationLoss:a.total_descent,avgPower:a.avg_power,maxPower:a.max_power,normalizedPower:a.normalized_power,startTime:a.start_time?new Date(a.start_time):void 0,endTime:a.timestamp?new Date(a.timestamp):void 0};if(u>0){const p=this.extractSportFromActivity(e);this.hrCalculator.isPaceSport(p)&&(d.avgPace=l/u)}r.push(d)}),r}analyzeHeartRate(e){const t=e.filter(o=>o.heart_rate&&o.heart_rate>0);if(t.length===0)return{};const n=t.map(o=>o.heart_rate),i=Math.round(n.reduce((o,l)=>o+l,0)/n.length),r=Math.max(...n);let a;if(t.length>=6){const o=Math.floor(t.length/3),l=t.slice(0,o).map(m=>m.heart_rate),u=t.slice(-o).map(m=>m.heart_rate),d=l.reduce((m,w)=>m+w,0)/l.length,p=u.reduce((m,w)=>m+w,0)/u.length;a=Math.round((p-d)/d*100*10)/10}return{avgHR:i,maxHR:r,hrDrift:a}}calculateHRZoneDistribution(e,t){const n=e.filter(a=>a.heart_rate&&a.heart_rate>0);if(n.length===0)return{zone1:0,zone2:0,zone3:0,zone4:0,zone5:0,totalTime:t};const i=t/n.length,r={zone1:0,zone2:0,zone3:0,zone4:0,zone5:0};return n.forEach(a=>{const l=`zone${this.hrCalculator.getHRZone(a.heart_rate)}`;r[l]+=i}),Object.keys(r).forEach(a=>{const o=a;r[o]=Math.round(r[o]*10)/10}),{...r,totalTime:t}}async loadJsonFile(e){const n=await(await sl(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])).readFile(e,"utf-8");return JSON.parse(n)}async parseFileContent(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=r=>{var a;try{const o=(a=r.target)==null?void 0:a.result,l=JSON.parse(o);t(l)}catch(o){n(new Error(`Failed to parse JSON: ${o.message}`))}},i.onerror=()=>n(new Error("Failed to read file")),i.readAsText(e)})}getPrimarySession(e){return e.sessions&&e.sessions.length>0?e.sessions[0]:e.activity&&!Array.isArray(e.activity)&&e.activity.sessions?e.activity.sessions[0]:null}extractSportFromActivity(e){const t=this.getPrimarySession(e),n=Array.isArray(e.activity)?e.activity[0]:e.activity;return this.normalizeSport((t==null?void 0:t.sport)||(n==null?void 0:n.event)||"unknown")}normalizeSport(e){const t={cycling:"Bike",bike:"Bike",road_cycling:"Bike",mountain_biking:"Bike",running:"Run",run:"Run",trail_running:"Run",track_running:"Run",swimming:"Swim",swim:"Swim",walking:"Walk",walk:"Walk",hiking:"Hike"},n=e.toLowerCase().replace(/[^a-z_]/g,"");return t[n]||e}generateActivityId(e,t){return`${e}_${t.toLowerCase()}_${Math.random().toString(36).substr(2,6)}`}convertToMinutes(e){return e?Math.round(e/60*10)/10:0}convertToKm(e){return e?Math.round(e/1e3*100)/100:0}convertToKmh(e){return e?Math.round(e*3.6*10)/10:0}extractDistance(e,t){if(console.log("Extracting distance - session data:",{total_distance:t==null?void 0:t.total_distance,avg_speed:t==null?void 0:t.avg_speed,enhanced_avg_speed:t==null?void 0:t.enhanced_avg_speed,total_timer_time:t==null?void 0:t.total_timer_time,total_elapsed_time:t==null?void 0:t.total_elapsed_time}),t!=null&&t.total_distance&&t.total_distance>0){console.log("Using session total_distance:",t.total_distance);const r=this.convertToKm(t.total_distance);return console.log("Converted distance (assuming meters):",r,"km"),console.log("Distance already in km from parser, using as-is:",t.total_distance),Math.round(t.total_distance*100)/100}const n=Array.isArray(e.activity)?e.activity[0]:e.activity;if(n!=null&&n.total_distance&&n.total_distance>0)return console.log("Using activity total_distance:",n.total_distance),Math.round(n.total_distance*100)/100;if(t!=null&&t.enhanced_avg_speed&&(t!=null&&t.total_timer_time)){const r=t.enhanced_avg_speed*(t.total_timer_time/3600);if(r>0)return console.log("Calculated distance from enhanced_avg_speed:",r,"km"),Math.round(r*100)/100}if(t!=null&&t.avg_speed&&(t!=null&&t.total_timer_time)){const r=t.avg_speed*(t.total_timer_time/3600);if(r>0)return console.log("Calculated distance from avg_speed:",r,"km"),Math.round(r*100)/100}const i=e.records||[];if(i.length>0){const r=this.calculateDistanceFromRecords(i);if(r>0)return console.log("Calculated distance from GPS records:",r),r}if(i.length>0){const r=i[i.length-1];if(r.distance&&r.distance>0)return console.log("Using distance from last record:",r.distance),Math.round(r.distance*100)/100}return console.log("No distance data found in any source"),0}calculateDistanceFromRecords(e){let t=0,n=null,i=null;for(const r of e){const a=r.position_lat||r.lat,o=r.position_long||r.lng||r.lon;if(a&&o&&n!==null&&i!==null){const l=this.haversineDistance(n,i,a,o);t+=l}a&&o&&(n=a,i=o)}return t}haversineDistance(e,t,n,i){const a=this.toRadians(n-e),o=this.toRadians(i-t),l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(n))*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}toRadians(e){return e*(Math.PI/180)}extractLapDistance(e){if(e!=null&&e.total_distance&&e.total_distance>0)return Math.round(e.total_distance*100)/100;if(e!=null&&e.avg_speed&&(e!=null&&e.total_timer_time)){const t=e.avg_speed*(e.total_timer_time/3600);if(t>0)return Math.round(t*100)/100}if(e!=null&&e.enhanced_avg_speed&&(e!=null&&e.total_timer_time)){const t=e.enhanced_avg_speed*(e.total_timer_time/3600);if(t>0)return Math.round(t*100)/100}return 0}}const Cs=class Cs{static handleFile(e){return this.handleFileBasic(e)}static handleFileWithAnalysis(e){return new Promise(async(t,n)=>{try{const i=await this.handleFileBasic(e),r=this.analysisService.extractActivityMetrics(i,e.name),a=this.analysisService.extractLapMetrics(i,r.date,r.activityId);t({parsedData:i,activityMetrics:r,lapMetrics:a})}catch(i){n(i)}})}static async processAndSaveToFirebase(e,t={}){const{saveToFirebase:n=!0,showProgress:i=!0}=t;try{if(i&&Q.showLoading("ðŸ“– Processing FIT file..."),n&&!xe.isAuthenticated())throw new Error("User not authenticated. Please sign in to save data.");const r=await this.handleFileWithAnalysis(e);i&&Q.showLoading("ðŸ’¾ Saving to Firebase...");let a;if(n&&(a=await this.dashboardService.addActivity(r.activityMetrics),r.lapMetrics.length>0)){const o=r.lapMetrics.map(l=>({...l,activityId:a}));await this.dashboardService.addLapData(o)}if(i){const o=n?`âœ… Activity saved successfully! (${r.lapMetrics.length} laps processed)`:"âœ… FIT file processed successfully!";Q.showStatus(o,"success")}return{success:!0,activityId:a}}catch(r){const a=r.message;return i&&Q.showStatus(`âŒ Error: ${a}`,"error"),console.error("File processing error:",r),{success:!1,error:a}}}static async processBatchFiles(e,t={}){const n=[];let i=0,r=0;Q.showLoading(`Processing ${e.length} files...`);for(let o=0;o<e.length;o++){const l=e[o];try{Q.showLoading(`Processing file ${o+1}/${e.length}: ${l.name}`);const u=await this.processAndSaveToFirebase(l,{...t,showProgress:!1});n.push(u),u.success?i++:r++}catch(u){r++,n.push({success:!1,error:`Failed to process ${l.name}: ${u.message}`})}}const a=`Batch complete: ${i} successful, ${r} failed`;return Q.showStatus(a,r>0?"error":"success"),{successful:i,failed:r,results:n}}static handleFileBasic(e){return new Promise((t,n)=>{if(!e.name.toLowerCase().endsWith(".fit")){Q.showStatus("âŒ Please select a .fit file","error"),n(new Error("Invalid file type"));return}Q.showLoading("ðŸ“– Parsing FIT file...");const i=new FileReader;i.onload=async r=>{var a;try{if(!((a=r.target)!=null&&a.result))throw new Error("Failed to read file");const o=r.target.result,l=await this.parser.parse(o);console.log("Parsed data:",l),this.displayFileInfo(e,l),Q.showStatus("âœ… File parsed successfully!","success"),t(l)}catch(o){const l=o.message;Q.showStatus(`âŒ Error parsing file: ${l}`,"error"),console.error("Parse error:",o),n(o)}},i.onerror=()=>{Q.showStatus("âŒ Error reading file","error"),n(new Error("File read error"))},i.readAsArrayBuffer(e)})}static displayFileInfo(e,t){var o,l,u;const n=document.getElementById("fileInfo");if(!n)return;const i=t.records?t.records.length:0,r=t.sessions?t.sessions.length:0,a=t.activity?Array.isArray(t.activity)?t.activity.length:1:0;n.innerHTML=`
      <div class="file-info">
        <h3>ðŸ“Š File Information</h3>
        <p><strong>Filename:</strong> ${e.name}</p>
        <p><strong>Size:</strong> ${(e.size/1024).toFixed(2)} KB</p>
        <p><strong>Protocol Version:</strong> ${((o=t.header)==null?void 0:o.protocolVersion)||"N/A"}</p>
        <p><strong>Profile Version:</strong> ${((l=t.header)==null?void 0:l.profileVersion)||"N/A"}</p>
        <p><strong>Records:</strong> ${i}</p>
        <p><strong>Sessions:</strong> ${r}</p>
        <p><strong>Activities:</strong> ${a}</p>
        <p><strong>Raw Messages:</strong> ${((u=t.rawMessages)==null?void 0:u.length)||0}</p>
      </div>
    `}};Cs.parser=new $g({speedUnit:"km/h",lengthUnit:"km",temperatureUnit:"celsius",mode:"both"}),Cs.analysisService=new G1,Cs.dashboardService=new sc;let ri=Cs;class K1{constructor(e){this.container=null,this.workouts=[],this.onWorkoutSelect=e,this.config={viewType:"week",startDate:new Date().toISOString().split("T")[0],showPlannedOnly:!1,showActualOnly:!1,showComparison:!0,highlightAdherence:!0}}async initialize(e,t){if(this.container=document.getElementById("workout-calendar"),this.workouts=e,this.config=t,!this.container){console.error("Workout calendar container not found");return}this.render()}async updateWorkouts(e){this.workouts=e,this.render()}updateView(e){this.config=e,this.render()}render(){if(!this.container)return;this.container.innerHTML="";const e=this.generateModernCalendarHTML();this.container.innerHTML=e,this.attachEventListeners()}generateModernCalendarHTML(){const e=new Date(this.config.startDate),t=[];for(let n=-3;n<=3;n++){const i=new Date(e);i.setDate(e.getDate()+n);const r=this.getWorkoutsForDate(i);t.push(this.generateModernDayCard(i,r,n===0))}return`
      <div class="modern-calendar-container">
        <div class="calendar-header">
          <div class="calendar-title">
            <h3>Training Calendar</h3>
            <p class="calendar-subtitle">${this.getWeekRangeText()}</p>
          </div>
          <div class="calendar-legend">
            <div class="legend-item">
              <div class="legend-dot planned"></div>
              <span>Planned</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot completed"></div>
              <span>Completed</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot rest"></div>
              <span>Rest</span>
            </div>
          </div>
        </div>
        
        <div class="modern-calendar-grid">
          ${t.join("")}
        </div>
        
        <div class="calendar-footer">
          <div class="week-stats">
            ${this.generateWeekStats()}
          </div>
        </div>
      </div>
    `}generateModernDayCard(e,t,n){const i=e.toISOString().split("T")[0],r=e.toLocaleDateString("en-US",{weekday:"long"}),a=e.toLocaleDateString("en-US",{weekday:"short"}),o=e.getDate(),l=e.toLocaleDateString("en-US",{month:"short"}),u=i===new Date().toISOString().split("T")[0],d=this.getPrimaryWorkout(t),p=this.getModernCardClass(d,u,n);if(!d)return this.generateModernRestDay(e,u,n);const m=this.getStatusIcon(d),w=this.getIntensityColor(d),E=this.formatDuration(d),C=this.getSmartDescription(d);return`
      <div class="${p}" data-date="${i}" data-workout-id="${d.workoutId||""}">
        <div class="day-header">
          <div class="date-info">
            <div class="day-name">${n?r:a}</div>
            <div class="date-number">${o}</div>
            <div class="month-name">${l}</div>
          </div>
          <div class="status-indicator ${d.status}">
            ${m}
          </div>
        </div>
        
        <div class="workout-content">
          <div class="workout-type" style="border-left: 4px solid ${w}">
            ${this.formatWorkoutType(d.workoutType)}
          </div>
          
          <div class="workout-details">
            <div class="duration">${E}</div>
            ${d.expectedFatigue?`<div class="intensity">Intensity: ${this.getIntensityLabel(d.expectedFatigue)}</div>`:""}
          </div>
          
          <div class="workout-description">
            ${C}
          </div>
          
          ${this.generateModernMetrics(d)}
        </div>
        
        ${t.length>1?`<div class="multiple-indicator">+${t.length-1}</div>`:""}
        ${this.generateAdherenceBadge(d)}
      </div>
    `}generateModernRestDay(e,t,n){const i=e.toISOString().split("T")[0],r=e.toLocaleDateString("en-US",{weekday:"long"}),a=e.toLocaleDateString("en-US",{weekday:"short"}),o=e.getDate(),l=e.toLocaleDateString("en-US",{month:"short"});return`
      <div class="modern-day-card rest-day ${t?"today":""} ${n?"center-day":""}" data-date="${i}">
        <div class="day-header">
          <div class="date-info">
            <div class="day-name">${n?r:a}</div>
            <div class="date-number">${o}</div>
            <div class="month-name">${l}</div>
          </div>
          <div class="status-indicator rest">
            ðŸ’¤
          </div>
        </div>
        
        <div class="rest-content">
          <div class="rest-icon">ðŸŒ¿</div>
          <div class="rest-text">Rest Day</div>
          <div class="rest-subtitle">Recovery time</div>
        </div>
      </div>
    `}getModernCardClass(e,t,n){let i=["modern-day-card"];return e&&i.push("has-workout",e.status),t&&i.push("today"),n&&i.push("center-day"),i.join(" ")}getStatusIcon(e){switch(e.status){case"completed":return"âœ…";case"planned":return"ðŸ“…";case"missed":return"â­ï¸";case"unplanned":return"ðŸ”„";default:return"â“"}}getIntensityColor(e){const t=e.expectedFatigue||50;return t<30?"#4CAF50":t<60?"#FF9800":t<80?"#F44336":"#9C27B0"}getIntensityLabel(e){return e<30?"Easy":e<60?"Moderate":e<80?"Hard":"Very Hard"}formatDuration(e){var r;const t=e.durationMin||((r=e.actualWorkout)==null?void 0:r.duration)||0;if(t<60)return`${t}min`;const n=Math.floor(t/60),i=t%60;return i>0?`${n}h ${i}m`:`${n}h`}getSmartDescription(e){if(e.actualWorkout){const{distance:t,sport:n}=e.actualWorkout;return`${t.toFixed(1)}km ${n}`}return e.description.length>40?`${e.description.substring(0,37)}...`:e.description}generateModernMetrics(e){if(!e.actualWorkout)return"";const{avgHR:t,trainingLoad:n,distance:i}=e.actualWorkout,r=[];return i&&r.push(`ðŸ“ ${i.toFixed(1)}km`),t&&r.push(`â¤ï¸ ${t}bpm`),n&&r.push(`âš¡ ${Math.round(n)} TRIMP`),r.length>0?`<div class="workout-metrics">${r.join(" â€¢ ")}</div>`:""}generateAdherenceBadge(e){var r;if(!((r=e.comparison)!=null&&r.adherence))return"";const{score:t,category:n}=e.comparison.adherence;return`
      <div class="adherence-badge ${n==="excellent"?"success":n==="good"?"warning":"error"}">
        ${Math.round(t)}%
      </div>
    `}getWeekRangeText(){const e=new Date(this.config.startDate);e.setDate(e.getDate()-3);const t=new Date(e);t.setDate(e.getDate()+6);const n=e.toLocaleDateString("en-US",{month:"short",day:"numeric"}),i=t.toLocaleDateString("en-US",{month:"short",day:"numeric"});return`${n} - ${i}`}generateWeekStats(){const e=this.getWorkoutsForWeek(),t=e.filter(r=>r.status==="completed").length,n=e.filter(r=>r.status==="planned").length,i=e.filter(r=>r.actualWorkout).reduce((r,a)=>{var o;return r+(((o=a.actualWorkout)==null?void 0:o.trainingLoad)||0)},0);return`
      <div class="stat-item">
        <span class="stat-value">${t}</span>
        <span class="stat-label">Completed</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">${n}</span>
        <span class="stat-label">Planned</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">${Math.round(i)}</span>
        <span class="stat-label">TRIMP</span>
      </div>
    `}getWorkoutsForDate(e){const t=e.toISOString().split("T")[0];return this.workouts.filter(n=>n.date===t)}getWorkoutsForWeek(){const e=new Date(this.config.startDate);e.setDate(e.getDate()-3);const t=new Date(e);return t.setDate(e.getDate()+6),this.workouts.filter(n=>{const i=new Date(n.date);return i>=e&&i<=t})}getPrimaryWorkout(e){if(e.length===0)return null;if(e.length===1)return e[0];const t=e.find(i=>i.status==="completed");if(t)return t;const n=e.find(i=>i.status==="planned");return n||e[0]}formatWorkoutType(e){return e.split(/[-_\s]/).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}attachEventListeners(){this.container&&this.container.querySelectorAll(".modern-day-card.has-workout").forEach(e=>{e.addEventListener("click",t=>{const n=t.currentTarget.dataset.workoutId,i=t.currentTarget.dataset.date;if(i){const r=this.workouts.find(a=>a.date===i&&(n?a.workoutId===n:!0));r&&this.onWorkoutSelect(r)}})})}}const it=[];for(let s=0;s<256;++s)it.push((s+256).toString(16).slice(1));function Q1(s,e=0){return(it[s[e+0]]+it[s[e+1]]+it[s[e+2]]+it[s[e+3]]+"-"+it[s[e+4]]+it[s[e+5]]+"-"+it[s[e+6]]+it[s[e+7]]+"-"+it[s[e+8]]+it[s[e+9]]+"-"+it[s[e+10]]+it[s[e+11]]+it[s[e+12]]+it[s[e+13]]+it[s[e+14]]+it[s[e+15]]).toLowerCase()}let Ao;const Y1=new Uint8Array(16);function J1(){if(!Ao){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ao=crypto.getRandomValues.bind(crypto)}return Ao(Y1)}const Z1=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yd={randomUUID:Z1};function Jd(s,e,t){var i;if(Yd.randomUUID&&!s)return Yd.randomUUID();s=s||{};const n=s.random??((i=s.rng)==null?void 0:i.call(s))??J1();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Q1(n)}const lc=class lc{static async createPlannedWorkout(e){try{const t=Jd(),n=new Date,i={id:t,userId:e.userId,date:e.date,sport:e.sport,name:e.name,description:e.description,status:"planned",planned:{durationMin:e.durationMin,distanceKm:e.distanceKm,targetMetrics:e.targetMetrics,segments:e.segments,tags:e.tags,expectedFatigue:e.expectedFatigue,notes:e.notes},location:e.location,createdAt:n,updatedAt:n},r=await si(Ie(ne,this.COLLECTION_NAME),{...i,createdAt:ke.fromDate(i.createdAt),updatedAt:ke.fromDate(i.updatedAt)});return console.log(`âœ… Created planned workout with ID: ${r.id}`),i}catch(t){throw console.error("âŒ Error creating planned workout:",t),new Error(`Failed to create planned workout: ${t}`)}}static async matchPlannedWorkout(e,t){try{console.log(`ðŸ” Matching workout for user ${e} on ${t.date}`);const n=ve(Ie(ne,this.COLLECTION_NAME),Re("userId","==",e),Re("date","==",t.date),Re("status","==","planned")),i=await st(n),r=[];if(i.forEach(l=>{var d;const u=l.data();r.push({...u,id:u.id,createdAt:u.createdAt.toDate(),updatedAt:u.updatedAt.toDate(),actual:u.actual?{...u.actual,processedAt:(d=u.actual.processedAt)==null?void 0:d.toDate(),zones:u.actual.zones||[]}:void 0})}),r.length===0)return console.log("ðŸ” No planned workouts found for matching"),null;console.log(`ðŸ” Found ${r.length} planned workout candidates`);const a=r.map(l=>this.scoreWorkoutMatch(l,t));a.sort((l,u)=>u.confidence-l.confidence);const o=a[0];return o.confidence>=.5?(console.log(`âœ… Best match found with confidence ${o.confidence.toFixed(2)}`),o):(console.log(`âš ï¸ No confident match found. Best confidence: ${o.confidence.toFixed(2)}`),null)}catch(n){throw console.error("âŒ Error matching planned workout:",n),new Error(`Failed to match planned workout: ${n}`)}}static scoreWorkoutMatch(e,t){var l,u;let n=0,i=0;const r=[],a={sportMatch:!1,dateMatch:!1,durationDiff:void 0,distanceDiff:void 0};if(i+=40,e.sport===t.sport&&(n+=40,a.sportMatch=!0,r.push("Sport matches")),i+=20,e.date===t.date&&(n+=20,a.dateMatch=!0,r.push("Date matches")),i+=20,(l=e.planned)!=null&&l.durationMin&&t.durationMin){const d=Math.abs(e.planned.durationMin-t.durationMin);a.durationDiff=d,d<=5?(n+=20,r.push("Duration within 5 minutes")):d<=15?(n+=15,r.push("Duration within 15 minutes")):d<=30?(n+=10,r.push("Duration within 30 minutes")):r.push(`Duration differs by ${d} minutes`)}if(i+=20,(u=e.planned)!=null&&u.distanceKm&&t.distanceKm){const d=Math.abs(e.planned.distanceKm-t.distanceKm);a.distanceDiff=d,d<=.5?(n+=20,r.push("Distance within 500m")):d<=1?(n+=15,r.push("Distance within 1km")):d<=2?(n+=10,r.push("Distance within 2km")):r.push(`Distance differs by ${d.toFixed(1)}km`)}const o=i>0?n/i:0;return{workout:e,confidence:o,matchReasons:r,differences:a}}static async updateWorkoutWithActual(e,t){try{console.log(`ðŸ”„ Updating workout ${e} with actual data`);const n={durationMin:t.durationMin,distanceKm:t.distanceKm,avgHR:t.avgHR,maxHR:t.maxHR,avgPace:t.avgPace,avgPower:t.avgPower,maxPower:t.maxPower,trainingLoad:t.trainingLoad,ascentM:t.ascentM,descentM:t.descentM,zones:t.zones,calories:t.calories,avgCadence:t.avgCadence,avgSpeed:t.avgSpeed,rawData:t.rawData,processedAt:new Date,dataSource:"garmin_fit"},i={status:"completed",matchedActivityId:t.activityId,actual:{...n,processedAt:ke.fromDate(n.processedAt)},updatedAt:ke.fromDate(new Date)},r=ve(Ie(ne,this.COLLECTION_NAME),Re("id","==",e)),a=await st(r);if(a.empty)throw new Error(`Workout with ID ${e} not found`);const o=a.docs[0].ref;await Cn(o,i);const u=(await ep(o)).data(),d={...u,id:u.id,createdAt:u.createdAt.toDate(),updatedAt:u.updatedAt.toDate(),actual:{...u.actual,processedAt:u.actual.processedAt.toDate()}};return console.log(`âœ… Updated workout ${e} with actual data`),d}catch(n){throw console.error("âŒ Error updating workout with actual data:",n),new Error(`Failed to update workout: ${n}`)}}static async handleUnplannedWorkout(e,t){try{console.log(`âž• Creating unplanned workout for user ${e}`);const n=Jd(),i=new Date,r={durationMin:t.durationMin,distanceKm:t.distanceKm,avgHR:t.avgHR,maxHR:t.maxHR,avgPace:t.avgPace,avgPower:t.avgPower,maxPower:t.maxPower,trainingLoad:t.trainingLoad,ascentM:t.ascentM,descentM:t.descentM,zones:t.zones,calories:t.calories,avgCadence:t.avgCadence,avgSpeed:t.avgSpeed,rawData:t.rawData,processedAt:i,dataSource:"garmin_fit"},a={id:n,userId:e,date:t.date,sport:t.sport,name:`Unplanned ${t.sport} - ${t.date}`,description:"Imported from Garmin FIT file",status:"unplanned",matchedActivityId:t.activityId,actual:r,createdAt:i,updatedAt:i};return await si(Ie(ne,this.COLLECTION_NAME),{...a,actual:{...r,processedAt:ke.fromDate(r.processedAt)},createdAt:ke.fromDate(a.createdAt),updatedAt:ke.fromDate(a.updatedAt)}),console.log(`âœ… Created unplanned workout with ID: ${n}`),a}catch(n){throw console.error("âŒ Error creating unplanned workout:",n),new Error(`Failed to create unplanned workout: ${n}`)}}static async processParsedFitData(e,t){try{console.log(`âš™ï¸ Processing FIT data for user ${e}`);const n=await this.matchPlannedWorkout(e,t);return n?{workout:await this.updateWorkoutWithActual(n.workout.id,t),wasMatched:!0}:{workout:await this.handleUnplannedWorkout(e,t),wasMatched:!1}}catch(n){throw console.error("âŒ Error processing parsed FIT data:",n),new Error(`Failed to process FIT data: ${n}`)}}static async processBatchFitData(e,t){const n={successful:[],failed:[],matched:0,unplanned:0};console.log(`ðŸ”„ Processing batch of ${t.length} FIT files`);for(const i of t)try{const r=await this.processParsedFitData(e,i);n.successful.push(r.workout),r.wasMatched?n.matched++:n.unplanned++}catch(r){n.failed.push({input:i,error:r instanceof Error?r.message:"Unknown error"})}return console.log(`âœ… Batch processing complete: ${n.successful.length} successful, ${n.failed.length} failed`),n}static async getUserWorkouts(e,t){try{let n=ve(Ie(ne,this.COLLECTION_NAME),Re("userId","==",e),Ft("date","desc"));t&&(n=ve(n));const i=await st(n),r=[];return i.forEach(a=>{var l;const o=a.data();r.push({...o,id:o.id,createdAt:o.createdAt.toDate(),updatedAt:o.updatedAt.toDate(),actual:o.actual?{...o.actual,processedAt:(l=o.actual.processedAt)==null?void 0:l.toDate(),zones:o.actual.zones||[]}:void 0})}),r}catch(n){throw console.error("âŒ Error fetching user workouts:",n),new Error(`Failed to fetch workouts: ${n}`)}}static async getWorkoutsByDateRange(e,t,n){try{const i=ve(Ie(ne,this.COLLECTION_NAME),Re("userId","==",e),Re("date",">=",t),Re("date","<=",n),Ft("date","desc")),r=await st(i),a=[];return r.forEach(o=>{var u;const l=o.data();a.push({...l,id:l.id,createdAt:l.createdAt.toDate(),updatedAt:l.updatedAt.toDate(),actual:l.actual?{...l.actual,processedAt:(u=l.actual.processedAt)==null?void 0:u.toDate()}:void 0})}),a}catch(i){throw console.error("âŒ Error fetching workouts by date range:",i),new Error(`Failed to fetch workouts: ${i}`)}}static async markWorkoutAsMissed(e){try{const t=ve(Ie(ne,this.COLLECTION_NAME),Re("id","==",e)),n=await st(t);if(n.empty)throw new Error(`Workout with ID ${e} not found`);const i=n.docs[0].ref;await Cn(i,{status:"missed",updatedAt:ke.fromDate(new Date)}),console.log(`âœ… Marked workout ${e} as missed`)}catch(t){throw console.error("âŒ Error marking workout as missed:",t),new Error(`Failed to mark workout as missed: ${t}`)}}static async deleteWorkout(e){try{const t=ve(Ie(ne,this.COLLECTION_NAME),Re("id","==",e)),n=await st(t);if(n.empty)throw new Error(`Workout with ID ${e} not found`);const i=n.docs[0].ref;await Or(i),console.log(`âœ… Deleted workout ${e}`)}catch(t){throw console.error("âŒ Error deleting workout:",t),new Error(`Failed to delete workout: ${t}`)}}};lc.COLLECTION_NAME="workouts";let _i=lc;class X1{constructor(e,t,n={}){this.workouts=[],this.userId=null,this.container=e,this.config=t,this.onWorkoutClick=n.onWorkoutClick,this.userId=xe.getCurrentUserId(),this.initialize()}async initialize(){try{this.setupEventListeners(),await this.loadWorkouts(),this.render()}catch(e){console.error("Failed to initialize unified workout calendar:",e),this.showError("Failed to load workout calendar")}}async loadWorkouts(){if(!this.userId){console.log("User not authenticated, cannot load workouts"),this.workouts=[];return}try{console.log("ðŸ“… Loading workouts for calendar...");const e=this.getDateRange();if(console.log("ðŸ“… Date range:",e),this.workouts=await _i.getWorkoutsByDateRange(this.userId,e.startDate,e.endDate),console.log(`ðŸ“… Raw workouts loaded: ${this.workouts.length}`),this.workouts=this.applyFilters(this.workouts),console.log(`âœ… Loaded ${this.workouts.length} filtered workouts for calendar (${e.startDate} to ${e.endDate})`),this.workouts.length>0){const t=this.workouts.map(n=>n.date).sort();console.log("ðŸ“… Workout dates:",t)}}catch(e){console.error("Failed to load workouts:",e),this.workouts=[]}}getDateRange(){const e=new Date(this.config.startDate);let t,n;switch(this.config.viewType){case"week":t=new Date(e),t.setDate(e.getDate()-e.getDay()),n=new Date(t),n.setDate(t.getDate()+6);break;case"month":const i=new Date(e.getFullYear(),e.getMonth(),1),r=new Date(e.getFullYear(),e.getMonth()+1,0);t=new Date(i),t.setDate(i.getDate()-i.getDay()),n=new Date(r),n.setDate(r.getDate()+(6-r.getDay()));break;case"day":t=new Date(e),n=new Date(e);break;default:t=e,n=e}return{startDate:t.toISOString().split("T")[0],endDate:n.toISOString().split("T")[0]}}applyFilters(e){let t=[...e];return this.config.showStatusFilter&&this.config.showStatusFilter.length>0&&(t=t.filter(n=>this.config.showStatusFilter.includes(n.status))),this.config.showSportFilter&&this.config.showSportFilter.length>0&&(t=t.filter(n=>this.config.showSportFilter.includes(n.sport))),t}render(){if(!this.container){console.error("No container element for calendar");return}this.container.innerHTML="";let e="";switch(this.config.viewType){case"week":e=this.generateWeekView();break;case"month":e=this.generateMonthView();break;case"day":e=this.generateDayView();break;default:this.showError("Invalid view type");return}this.container.innerHTML=e,this.attachEventListeners()}generateWeekView(){const e=this.getDateRange(),t=new Date(e.startDate),n=[];for(let i=0;i<7;i++){const r=new Date(t);r.setDate(t.getDate()+i);const a=r.toISOString().split("T")[0],o=this.workouts.filter(l=>l.date===a);n.push(this.generateDayCard(r,o))}return`
      <div class="unified-calendar week-view">
        <div class="calendar-header">
          <div class="calendar-title">
            <h3>Week of ${t.toLocaleDateString()}</h3>
            <div class="view-switcher">
              <button class="btn btn-small view-btn ${this.config.viewType==="day"?"active":""}" data-view="day">Day</button>
              <button class="btn btn-small view-btn ${this.config.viewType==="week"?"active":""}" data-view="week">Week</button>
              <button class="btn btn-small view-btn ${this.config.viewType==="month"?"active":""}" data-view="month">Month</button>
            </div>
          </div>
          <div class="calendar-controls">
            <button class="btn btn-ghost" id="prev-week">â€¹</button>
            <button class="btn btn-ghost" id="today">Today</button>
            <button class="btn btn-ghost" id="next-week">â€º</button>
          </div>
        </div>
        <div class="calendar-grid week-grid">
          ${n.join("")}
        </div>
      </div>
    `}generateMonthView(){const e=this.getDateRange(),t=new Date(e.startDate);new Date(e.endDate);const n=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,0),r=new Date(n);r.setDate(n.getDate()-n.getDay());const a=new Date(i);a.setDate(i.getDate()+(6-i.getDay()));const o=[],l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(let u=new Date(r);u<=a;u.setDate(u.getDate()+1)){const d=u.toISOString().split("T")[0],p=this.workouts.filter(w=>w.date===d),m=u.getMonth()===n.getMonth();o.push(this.generateMonthDayCard(new Date(u),p,m))}return`
      <div class="unified-calendar month-view">
        <div class="calendar-header">
          <div class="calendar-title">
            <h3>${t.toLocaleDateString("en-US",{month:"long",year:"numeric"})}</h3>
            <div class="view-switcher">
              <button class="btn btn-small view-btn ${this.config.viewType==="day"?"active":""}" data-view="day">Day</button>
              <button class="btn btn-small view-btn ${this.config.viewType==="week"?"active":""}" data-view="week">Week</button>
              <button class="btn btn-small view-btn ${this.config.viewType==="month"?"active":""}" data-view="month">Month</button>
            </div>
          </div>
          <div class="calendar-controls">
            <button class="btn btn-ghost" id="prev-month">â€¹</button>
            <button class="btn btn-ghost" id="today">Today</button>
            <button class="btn btn-ghost" id="next-month">â€º</button>
          </div>
        </div>
        
        <!-- Weekday headers -->
        <div class="month-header">
          ${l.map(u=>`<div class="weekday-header">${u}</div>`).join("")}
        </div>
        
        <div class="calendar-grid month-grid">
          ${o.join("")}
        </div>
      </div>
    `}generateDayView(){const e=new Date(this.config.startDate),t=this.workouts.filter(n=>n.date===this.config.startDate);return`
      <div class="unified-calendar day-view">
        <div class="calendar-header">
          <div class="calendar-title">
            <h3>${e.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}</h3>
            <div class="view-switcher">
              <button class="btn btn-small view-btn ${this.config.viewType==="day"?"active":""}" data-view="day">Day</button>
              <button class="btn btn-small view-btn ${this.config.viewType==="week"?"active":""}" data-view="week">Week</button>
              <button class="btn btn-small view-btn ${this.config.viewType==="month"?"active":""}" data-view="month">Month</button>
            </div>
          </div>
          <div class="calendar-controls">
            <button class="btn btn-ghost" id="prev-day">â€¹</button>
            <button class="btn btn-ghost" id="today">Today</button>
            <button class="btn btn-ghost" id="next-day">â€º</button>
          </div>
        </div>
        <div class="day-workouts">
          ${t.length>0?t.map(n=>this.generateWorkoutCard(n,!0)).join(""):'<div class="rest-day"><span class="rest-icon">ðŸ’¤</span><span class="rest-text">Rest Day - No Workouts Scheduled</span></div>'}
        </div>
      </div>
    `}generateDayCard(e,t,n=!1){const i=e.toISOString().split("T")[0],r=e.toLocaleDateString("en-US",{weekday:"short"}),a=e.getDate(),o=this.config.highlightToday&&i===new Date().toISOString().split("T")[0];if(t.length===0)return`
        <div class="day-card empty-day ${o?"today":""}" data-date="${i}">
          <div class="day-header">
            <span class="day-name">${r}</span>
            <span class="day-number">${a}</span>
          </div>
          <div class="day-content">
            <div class="rest-day">
              <span class="rest-icon">ðŸ’¤</span>
              <span class="rest-text">Rest</span>
            </div>
          </div>
        </div>
      `;const l=t.map(u=>this.generateWorkoutCard(u,n)).join("");return`
      <div class="day-card has-workouts ${o?"today":""}" data-date="${i}">
        <div class="day-header">
          <span class="day-name">${r}</span>
          <span class="day-number">${a}</span>
          ${t.length>1?`<span class="workout-count">${t.length}</span>`:""}
        </div>
        <div class="day-content">
          ${l}
        </div>
      </div>
    `}generateMonthDayCard(e,t,n){const i=e.toISOString().split("T")[0],r=e.getDate(),a=this.config.highlightToday&&i===new Date().toISOString().split("T")[0],o=t.length,l=t.some(m=>m.status==="completed"||m.status==="unplanned"),u=t.some(m=>m.status==="planned"),d=t.some(m=>m.status==="missed");let p="";return l?p="has-completed":d?p="has-missed":u&&(p="has-planned"),`
      <div class="month-day-card ${n?"":"other-month"} ${a?"today":""} ${p}" data-date="${i}">
        <div class="month-day-number">${r}</div>
        ${o>0?`
          <div class="month-day-indicators">
            ${o<=3?t.map(m=>`<div class="workout-dot status-${m.status}" title="${m.name}"></div>`).join(""):`<div class="workout-count-badge">${o}</div>`}
          </div>
        `:""}
      </div>
    `}generateWorkoutCard(e,t=!1){var m,w,E,C,I,B,G,Y,K;const n=this.getSportIcon(e.sport),i=`status-${e.status}`,r=this.getStatusIcon(e.status),a=((m=e.actual)==null?void 0:m.durationMin)||((w=e.planned)==null?void 0:w.durationMin),o=((E=e.actual)==null?void 0:E.distanceKm)||((C=e.planned)==null?void 0:C.distanceKm),l=e.status==="completed"||e.status==="unplanned",u=e.actual&&e.planned,d=u?(e.actual.durationMin-e.planned.durationMin)/e.planned.durationMin*100:null,p=u&&e.planned.distanceKm?(e.actual.distanceKm-e.planned.distanceKm)/e.planned.distanceKm*100:null;return`
      <div class="workout-card ${i} ${l?"completed-workout":""}" data-workout-id="${e.id}">
        <div class="workout-header">
          <span class="sport-icon">${n}</span>
          <span class="workout-name">${e.name}</span>
          <div class="workout-status">
            <span class="status-icon">${r}</span>
            ${l?'<span class="completion-badge">âœ“</span>':""}
          </div>
        </div>
        
        ${t?`
          <div class="workout-details">
            <div class="workout-description">${e.description||""}</div>
            
            <!-- Actual Performance Metrics (if completed) -->
            ${e.actual?`
              <div class="actual-metrics">
                <h5 class="metrics-title">
                  <span class="actual-icon">ðŸ“Š</span> Actual Performance
                  ${e.actual.processedAt?`<small>Uploaded ${new Date(e.actual.processedAt).toLocaleDateString()}</small>`:""}
                </h5>
                <div class="workout-metrics">
                  ${e.actual.durationMin?`<span class="metric"><span class="metric-label">Duration:</span> ${e.actual.durationMin}min</span>`:""}
                  ${e.actual.distanceKm?`<span class="metric"><span class="metric-label">Distance:</span> ${e.actual.distanceKm.toFixed(2)}km</span>`:""}
                  ${e.actual.avgHR?`<span class="metric"><span class="metric-label">Avg HR:</span> ${e.actual.avgHR} bpm</span>`:""}
                  ${e.actual.maxHR?`<span class="metric"><span class="metric-label">Max HR:</span> ${e.actual.maxHR} bpm</span>`:""}
                  ${e.actual.avgPace?`<span class="metric"><span class="metric-label">Avg Pace:</span> ${e.actual.avgPace}</span>`:""}
                  ${e.actual.avgPower?`<span class="metric"><span class="metric-label">Avg Power:</span> ${e.actual.avgPower}W</span>`:""}
                  ${e.actual.trainingLoad?`<span class="metric"><span class="metric-label">Training Load:</span> ${e.actual.trainingLoad}</span>`:""}
                  ${e.actual.calories?`<span class="metric"><span class="metric-label">Calories:</span> ${e.actual.calories}</span>`:""}
                  ${e.actual.ascentM?`<span class="metric"><span class="metric-label">Elevation:</span> â†—${e.actual.ascentM}m â†˜${e.actual.descentM||0}m</span>`:""}
                </div>
                
                <!-- HR Zones Distribution -->
                ${e.actual.zones&&e.actual.zones.length>0?`
                  <div class="hr-zones">
                    <h6>Heart Rate Zones</h6>
                    <div class="zones-grid">
                      ${e.actual.zones.map((ee,ae)=>`
                        <div class="zone zone-${ae+1}">
                          <span class="zone-label">Z${ae+1}</span>
                          <span class="zone-time">${Math.round(ee.timeMin||0)}min</span>
                        </div>
                      `).join("")}
                    </div>
                  </div>
                `:""}
              </div>
            `:""}

            <!-- Planned vs Actual Comparison (if both available) -->
            ${u?`
              <div class="planned-vs-actual">
                <h5 class="comparison-title">
                  <span class="comparison-icon">âš–ï¸</span> Planned vs Actual
                </h5>
                <div class="comparison-metrics">
                  ${d!==null?`
                    <div class="comparison-item ${Math.abs(d)>10?d>0?"over":"under":"on-target"}">
                      <span class="comparison-label">Duration:</span>
                      <span class="planned-value">${e.planned.durationMin}min</span>
                      <span class="comparison-arrow">â†’</span>
                      <span class="actual-value">${e.actual.durationMin}min</span>
                      <span class="comparison-diff">(${d>0?"+":""}${d.toFixed(1)}%)</span>
                    </div>
                  `:""}
                  ${p!==null?`
                    <div class="comparison-item ${Math.abs(p)>10?p>0?"over":"under":"on-target"}">
                      <span class="comparison-label">Distance:</span>
                      <span class="planned-value">${e.planned.distanceKm.toFixed(1)}km</span>
                      <span class="comparison-arrow">â†’</span>
                      <span class="actual-value">${e.actual.distanceKm.toFixed(1)}km</span>
                      <span class="comparison-diff">(${p>0?"+":""}${p.toFixed(1)}%)</span>
                    </div>
                  `:""}
                </div>
              </div>
            `:""}
            
            <!-- Planned Metrics (if not completed or no actual data) -->
            ${e.planned&&!e.actual?`
              <div class="planned-metrics">
                <h5 class="metrics-title">
                  <span class="planned-icon">ðŸŽ¯</span> Planned Workout
                </h5>
                <div class="workout-metrics">
                  ${e.planned.durationMin?`<span class="metric"><span class="metric-label">Duration:</span> ${e.planned.durationMin}min</span>`:""}
                  ${e.planned.distanceKm?`<span class="metric"><span class="metric-label">Distance:</span> ${e.planned.distanceKm}km</span>`:""}
                  ${(I=e.planned.targetMetrics)!=null&&I.expectedAvgHR?`<span class="metric"><span class="metric-label">Target HR:</span> ${e.planned.targetMetrics.expectedAvgHR} bpm</span>`:""}
                  ${e.planned.expectedFatigue?`<span class="metric"><span class="metric-label">Expected Fatigue:</span> ${e.planned.expectedFatigue}/100</span>`:""}
                </div>
              </div>
            `:""}

            ${(B=e.planned)!=null&&B.tags&&e.planned.tags.length>0?`
              <div class="workout-tags">
                ${e.planned.tags.map(ee=>`<span class="tag">${ee}</span>`).join("")}
              </div>
            `:""}

            ${(G=e.planned)!=null&&G.notes?`
              <div class="workout-notes">${e.planned.notes}</div>
            `:""}
          </div>
        `:`
          <div class="workout-summary">
            <div class="workout-metrics-compact">
              ${a?`<span class="metric-compact duration">${a}min</span>`:""}
              ${o?`<span class="metric-compact distance">${o.toFixed(1)}km</span>`:""}
              ${(Y=e.actual)!=null&&Y.avgHR?`<span class="metric-compact hr">${e.actual.avgHR}bpm</span>`:""}
              ${(K=e.actual)!=null&&K.trainingLoad?`<span class="metric-compact load">Load: ${e.actual.trainingLoad}</span>`:""}
            </div>
            ${u&&(Math.abs(d||0)>10||Math.abs(p||0)>10)?`
              <div class="quick-comparison">
                ${d!==null&&Math.abs(d)>10?`<span class="diff-indicator ${d>0?"over":"under"}">${d>0?"+":""}${d.toFixed(0)}%</span>`:""}
              </div>
            `:""}
          </div>
        `}
      </div>
    `}getSportIcon(e){return{run:"ðŸƒ",bike:"ðŸš´",swim:"ðŸŠ",strength:"ðŸ’ª",yoga:"ðŸ§˜",other:"âš½"}[e]||"âš½"}getStatusIcon(e){return{planned:"ðŸ“…",completed:"âœ…",missed:"âŒ",unplanned:"âš¡"}[e]||"â“"}showEmptyState(){this.container.innerHTML=`
      <div class="calendar-empty-state">
        <div class="empty-icon">ðŸ“…</div>
        <h3>No Workouts Found</h3>
        <p>No workouts scheduled for this period.</p>
        <button class="btn btn-primary" id="create-workout-btn">Create Workout</button>
      </div>
    `;const e=document.getElementById("create-workout-btn");e==null||e.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("show-plan-generation"))})}showError(e){this.container.innerHTML=`
      <div class="calendar-error-state">
        <div class="error-icon">âŒ</div>
        <h3>Error Loading Calendar</h3>
        <p>${e}</p>
        <button class="btn btn-secondary" id="retry-btn">Retry</button>
      </div>
    `;const t=document.getElementById("retry-btn");t==null||t.addEventListener("click",()=>{this.loadWorkouts().then(()=>this.render())})}setupEventListeners(){document.addEventListener("workouts-updated",()=>{console.log("ðŸ“… Workouts updated, refreshing calendar..."),this.loadWorkouts().then(()=>this.render())}),document.addEventListener("auth-state-changed",e=>{var t,n;this.userId=((n=(t=e.detail)==null?void 0:t.user)==null?void 0:n.uid)||null,this.loadWorkouts().then(()=>this.render())})}attachEventListeners(){const e=this.container.querySelector("#prev-week, #prev-month, #prev-day"),t=this.container.querySelector("#next-week, #next-month, #next-day"),n=this.container.querySelector("#today");e==null||e.addEventListener("click",()=>this.navigatePrevious()),t==null||t.addEventListener("click",()=>this.navigateNext()),n==null||n.addEventListener("click",()=>this.navigateToToday()),this.container.querySelectorAll(".view-btn").forEach(o=>{o.addEventListener("click",l=>{const u=l.target.dataset.view;u&&u!==this.config.viewType&&this.switchView(u)})}),this.container.querySelectorAll(".workout-card").forEach(o=>{o.addEventListener("click",l=>{l.preventDefault();const u=o.dataset.workoutId;if(u&&this.onWorkoutClick){const d=this.workouts.find(p=>p.id===u);d&&this.onWorkoutClick(d)}})}),this.container.querySelectorAll(".month-day-card").forEach(o=>{o.addEventListener("click",l=>{const u=o.dataset.date;u&&this.updateConfig({viewType:"day",startDate:u})})})}async switchView(e){console.log(`ðŸ“… Switching calendar view from ${this.config.viewType} to ${e}`),await this.updateConfig({viewType:e})}async navigatePrevious(){const e=new Date(this.config.startDate);switch(this.config.viewType){case"week":e.setDate(e.getDate()-7);break;case"month":e.setMonth(e.getMonth()-1);break;case"day":e.setDate(e.getDate()-1);break}await this.updateConfig({startDate:e.toISOString().split("T")[0]})}async navigateNext(){const e=new Date(this.config.startDate);switch(this.config.viewType){case"week":e.setDate(e.getDate()+7);break;case"month":e.setMonth(e.getMonth()+1);break;case"day":e.setDate(e.getDate()+1);break}await this.updateConfig({startDate:e.toISOString().split("T")[0]})}async navigateToToday(){const e=new Date().toISOString().split("T")[0];await this.updateConfig({startDate:e})}async updateConfig(e){console.log("ðŸ“… Updating calendar config:",e),this.config={...this.config,...e},await this.loadWorkouts(),this.render(),console.log("ðŸ“… Calendar updated successfully")}async refresh(){await this.loadWorkouts(),this.render()}getCurrentWorkouts(){return[...this.workouts]}}class ek{static generateSegmentsHTML(e,t){if(!e||e.length===0)return'<p class="no-segments">No detailed segments available</p>';let n='<div class="workout-segments">';t&&t.length>0&&t.forEach((r,a)=>{n+=this.generateSegmentGroupHTML(r,a)});const i=[...e].sort((r,a)=>r.order-a.order);return n+='<div class="segments-list">',i.forEach((r,a)=>{n+=this.generateSegmentHTML(r,a)}),n+="</div>",n+=this.generateWorkoutSummary(e),n+="</div>",n}static generateSegmentGroupHTML(e,t){return`
      <div class="segment-group" data-group-id="${e.id}">
        <div class="segment-group-header">
          <h4 class="segment-group-name">
            <span class="group-icon">ðŸ”„</span>
            ${e.name}
            ${e.repeatCount&&e.repeatCount>1?`<span class="repeat-count">Ã— ${e.repeatCount}</span>`:""}
          </h4>
          ${e.description?`<p class="segment-group-description">${e.description}</p>`:""}
        </div>
        
        <div class="segment-group-segments">
          ${e.segments.map((n,i)=>this.generateSegmentHTML(n,i,!0)).join("")}
        </div>
        
        ${e.restBetweenRepeatsMin?`
          <div class="group-rest-info">
            <span class="rest-icon">â³</span>
            ${e.restBetweenRepeatsMin}min rest between repeats
          </div>
        `:""}
      </div>
    `}static generateSegmentHTML(e,t,n=!1){const i=`segment segment-${e.type} segment-${e.measurement}`,r=this.getSegmentIcon(e.type),a=this.getSegmentColor(e.type);return`
      <div class="${i}" data-segment-id="${e.id}" style="border-left-color: ${a}">
        <div class="segment-header">
          <div class="segment-title">
            <span class="segment-number">${n?"":t+1}</span>
            <span class="segment-icon">${r}</span>
            <span class="segment-name">${e.name}</span>
            <span class="segment-type-badge ${e.type}">${this.formatSegmentType(e.type)}</span>
          </div>
          ${e.description?`<div class="segment-description">${e.description}</div>`:""}
        </div>
        
        <div class="segment-content">
          ${this.generateSegmentSpecificContent(e)}
        </div>
        
        ${e.notes?`<div class="segment-notes"><strong>Notes:</strong> ${e.notes}</div>`:""}
        
        ${e.restAfterMin?`
          <div class="segment-rest">
            <span class="rest-icon">â³</span>
            <span class="rest-duration">${e.restAfterMin}min rest</span>
          </div>
        `:""}
      </div>
    `}static generateSegmentSpecificContent(e){switch(e.measurement){case"time":return this.generateTimeBasedContent(e);case"distance":return this.generateDistanceBasedContent(e);case"reps":return this.generateRepBasedContent(e);case"rounds":return this.generateRoundBasedContent(e);case"custom":return this.generateCustomContent(e);default:return'<div class="segment-info">Basic segment</div>'}}static generateTimeBasedContent(e){let t='<div class="segment-metrics">';const n=e.durationSec?`${e.durationMin}:${e.durationSec.toString().padStart(2,"0")}`:`${e.durationMin} min`;return t+=`<div class="metric duration"><span class="metric-icon">â±ï¸</span><span class="metric-value">${n}</span></div>`,e.targetHRZone?t+=`<div class="metric hr-zone"><span class="metric-icon">â¤ï¸</span><span class="metric-value">Zone ${e.targetHRZone}</span></div>`:e.targetHR&&(t+=`<div class="metric hr-target"><span class="metric-icon">â¤ï¸</span><span class="metric-value">${e.targetHR} bpm</span></div>`),e.targetPace&&(t+=`<div class="metric pace"><span class="metric-icon">ðŸƒ</span><span class="metric-value">${e.targetPace}/km</span></div>`),e.targetPower&&(t+=`<div class="metric power"><span class="metric-icon">âš¡</span><span class="metric-value">${e.targetPower}W</span></div>`),e.targetRPE&&(t+=`<div class="metric rpe"><span class="metric-icon">ðŸ’ª</span><span class="metric-value">RPE ${e.targetRPE}/10</span></div>`),t+="</div>",t}static generateDistanceBasedContent(e){let t='<div class="segment-metrics">';return t+=`<div class="metric distance"><span class="metric-icon">ðŸ“</span><span class="metric-value">${e.distanceKm} km</span></div>`,e.targetPace&&(t+=`<div class="metric pace"><span class="metric-icon">ðŸƒ</span><span class="metric-value">${e.targetPace}/km</span></div>`),e.targetHRZone?t+=`<div class="metric hr-zone"><span class="metric-icon">â¤ï¸</span><span class="metric-value">Zone ${e.targetHRZone}</span></div>`:e.targetHR&&(t+=`<div class="metric hr-target"><span class="metric-icon">â¤ï¸</span><span class="metric-value">${e.targetHR} bpm</span></div>`),e.targetPower&&(t+=`<div class="metric power"><span class="metric-icon">âš¡</span><span class="metric-value">${e.targetPower}W</span></div>`),e.targetRPE&&(t+=`<div class="metric rpe"><span class="metric-icon">ðŸ’ª</span><span class="metric-value">RPE ${e.targetRPE}/10</span></div>`),t+="</div>",t}static generateRepBasedContent(e){let t='<div class="segment-metrics">';return e.sets&&e.sets>1?t+=`<div class="metric sets-reps"><span class="metric-icon">ðŸ”¢</span><span class="metric-value">${e.sets} Ã— ${e.reps}</span></div>`:t+=`<div class="metric reps"><span class="metric-icon">ðŸ”¢</span><span class="metric-value">${e.reps} reps</span></div>`,e.weight&&(t+=`<div class="metric weight"><span class="metric-icon">ðŸ‹ï¸</span><span class="metric-value">${e.weight} ${e.weightUnit||"kg"}</span></div>`),e.equipment&&(t+=`<div class="metric equipment"><span class="metric-icon">ðŸ”§</span><span class="metric-value">${this.formatEquipment(e.equipment)}</span></div>`),e.targetRPE&&(t+=`<div class="metric rpe"><span class="metric-icon">ðŸ’ª</span><span class="metric-value">RPE ${e.targetRPE}/10</span></div>`),t+="</div>",(e.exercise||e.muscleGroups)&&(t+='<div class="exercise-details">',e.exercise&&(t+=`<div class="exercise-name"><strong>Exercise:</strong> ${this.formatExerciseName(e.exercise)}</div>`),e.muscleGroups&&e.muscleGroups.length>0&&(t+=`<div class="muscle-groups"><strong>Targets:</strong> ${e.muscleGroups.map(n=>this.formatMuscleGroup(n)).join(", ")}</div>`),t+="</div>"),e.restBetweenSetsMin&&(t+=`<div class="rest-info"><span class="rest-icon">â³</span> ${e.restBetweenSetsMin}min rest between sets</div>`),t}static generateRoundBasedContent(e){let t='<div class="segment-metrics">';return t+=`<div class="metric rounds"><span class="metric-icon">ðŸ”„</span><span class="metric-value">${e.rounds} rounds</span></div>`,t+=`<div class="metric work-time"><span class="metric-icon">â±ï¸</span><span class="metric-value">${e.workTimeMin}min work</span></div>`,t+=`<div class="metric rest-time"><span class="metric-icon">â³</span><span class="metric-value">${e.restTimeMin}min rest</span></div>`,e.targetHR&&(t+=`<div class="metric hr-target"><span class="metric-icon">â¤ï¸</span><span class="metric-value">${e.targetHR} bpm</span></div>`),e.targetRPE&&(t+=`<div class="metric rpe"><span class="metric-icon">ðŸ’ª</span><span class="metric-value">RPE ${e.targetRPE}/10</span></div>`),t+="</div>",e.exercises&&e.exercises.length>0&&(t+='<div class="round-exercises">',t+='<div class="exercises-label"><strong>Exercises:</strong></div>',t+='<ul class="exercises-list">',e.exercises.forEach(n=>{t+=`<li class="exercise-item">${n}</li>`}),t+="</ul>",t+="</div>"),t}static generateCustomContent(e){let t='<div class="segment-metrics">';return t+=`<div class="metric custom-measurement"><span class="metric-icon">ðŸ“Š</span><span class="metric-value">${e.customValue} ${e.customMeasurement}</span></div>`,t+="</div>",e.customInstructions&&(t+=`<div class="custom-instructions"><strong>Instructions:</strong> ${e.customInstructions}</div>`),t}static generateWorkoutSummary(e){const t=this.calculateTotalDuration(e),n=e.length,i=[...new Set(e.map(r=>r.type))];return`
      <div class="workout-summary">
        <h5>Workout Summary</h5>
        <div class="summary-metrics">
          <div class="summary-metric">
            <span class="summary-icon">â±ï¸</span>
            <span class="summary-label">Total Duration:</span>
            <span class="summary-value">${t} min</span>
          </div>
          <div class="summary-metric">
            <span class="summary-icon">ðŸ”¢</span>
            <span class="summary-label">Segments:</span>
            <span class="summary-value">${n}</span>
          </div>
          <div class="summary-metric">
            <span class="summary-icon">ðŸŽ¯</span>
            <span class="summary-label">Focus:</span>
            <span class="summary-value">${i.map(r=>this.formatSegmentType(r)).join(", ")}</span>
          </div>
        </div>
      </div>
    `}static getSegmentIcon(e){return{warmup:"ðŸŒ¡ï¸",cooldown:"â„ï¸",interval:"ðŸ”¥",tempo:"âš¡",recovery:"ðŸ’š",strength_set:"ðŸ’ª",stretch:"ðŸ¤¸",rest:"ðŸ˜´",custom:"âš™ï¸"}[e]||"âš½"}static getSegmentColor(e){return{warmup:"#fbbf24",cooldown:"#60a5fa",interval:"#ef4444",tempo:"#f97316",recovery:"#22c55e",strength_set:"#8b5cf6",stretch:"#06b6d4",rest:"#6b7280",custom:"#ec4899"}[e]||"#6b7280"}static formatSegmentType(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}static formatEquipment(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}static formatExerciseName(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}static formatMuscleGroup(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}static calculateTotalDuration(e){return e.reduce((t,n)=>{let i=0;switch(n.measurement){case"time":i=n.durationMin;break;case"rounds":const r=n;i=r.rounds*(r.workTimeMin+r.restTimeMin);break;case"reps":const a=n;a.restBetweenSetsMin&&a.sets&&(i+=a.restBetweenSetsMin*(a.sets-1));break}return n.restAfterMin&&(i+=n.restAfterMin),t+i},0)}}class tk{generateComparisonHTML(e){return e.status==="planned"&&!e.actualWorkout?this.generatePlannedOnlyHTML(e):e.status==="unplanned"&&e.actualWorkout?this.generateUnplannedHTML(e):e.actualWorkout&&e.comparison?this.generateFullComparisonHTML(e,e.comparison):this.generateBasicWorkoutHTML(e)}generatePlannedOnlyHTML(e){const t=this.getIntensityColor(e.expectedFatigue),n=this.getIntensityLabel(e.expectedFatigue);return`
      <div class="workout-comparison-content">
        <div class="comparison-header">
          <div class="workout-status planned">
            <span class="status-icon">ðŸ“…</span>
            <span class="status-text">Planned Workout</span>
          </div>
          <div class="workout-date">
            <span class="date-text">${new Date(e.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}</span>
          </div>
        </div>

        <div class="planned-workout-details">
          <h4>Planned Details</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <div class="label">Workout Type</div>
              <div class="value">${this.formatWorkoutType(e.workoutType)}</div>
            </div>
            <div class="detail-item">
              <div class="label">Duration</div>
              <div class="value">${e.durationMin} <span class="unit">minutes</span></div>
            </div>
            <div class="detail-item">
              <div class="label">Expected Intensity</div>
              <div class="value" style="color: ${t}">${n}</div>
            </div>
            <div class="detail-item">
              <div class="label">Expected Load</div>
              <div class="value">${(e.expectedFatigue*5).toFixed(0)} <span class="unit">TRIMP</span></div>
            </div>
          </div>

          <div class="workout-description">
            <h5>ðŸ“ Workout Description</h5>
            <p>${e.description}</p>
          </div>

          ${e.userNotes?`
            <div class="user-notes">
              <h5>ðŸ“‹ Personal Notes</h5>
              <p>${e.userNotes}</p>
            </div>
          `:""}

          <div class="workout-actions">
            <button class="btn btn-primary" onclick="markWorkoutCompleted('${e.date}')">
              âœ… Mark as Completed
            </button>
            <button class="btn btn-secondary" onclick="editWorkout('${e.date}')">
              âœï¸ Edit Workout
            </button>
          </div>
        </div>
      </div>
    `}generateUnplannedHTML(e){const t=e.actualWorkout;return`
      <div class="workout-comparison-content">
        <div class="comparison-header">
          <div class="workout-status unplanned">
            <span class="status-icon">âš¡</span>
            <span class="status-text">Unplanned Workout</span>
          </div>
        </div>

        <div class="actual-workout-details">
          <h4>Workout Summary</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <div class="label">Sport</div>
              <div class="value">${t.sport}</div>
            </div>
            <div class="detail-item">
              <div class="label">Duration</div>
              <div class="value">${t.duration.toFixed(1)} minutes</div>
            </div>
            <div class="detail-item">
              <div class="label">Distance</div>
              <div class="value">${t.distance.toFixed(2)} km</div>
            </div>
            <div class="detail-item">
              <div class="label">Training Load</div>
              <div class="value">${t.trainingLoad.toFixed(0)} TRIMP</div>
            </div>
          </div>

          ${this.generateHeartRateSection(t)}
          ${this.generateHRZonesChart(t)}
          
          <div class="workout-actions">
            <button class="btn btn-secondary" onclick="addToPlannedWorkouts('${e.date}')">
              Add to Future Plans
            </button>
          </div>
        </div>
      </div>
    `}generateFullComparisonHTML(e,t){const n=e.actualWorkout;return`
      <div class="workout-comparison-content">
        <div class="comparison-header">
          <div class="workout-status completed">
            <span class="status-icon">âœ…</span>
            <span class="status-text">Completed Workout</span>
          </div>
          <div class="adherence-badge ${t.adherence.category}">
            ${t.adherence.score}/100
          </div>
        </div>

        ${this.generateComparisonOverview(t)}
        ${this.generateDetailedComparison(e,t)}
        ${this.generatePerformanceAnalysis(t)}
        ${this.generateHeartRateSection(n)}
        ${this.generateHRZonesComparison(t.intensityVariance.zoneCompliance)}
        ${this.generateFeedbackSection(t.adherence.feedback)}
        
        <div class="workout-actions">
          <button class="btn btn-secondary" onclick="viewFullActivity('${e.date}')">
            View Full Activity
          </button>
          <button class="btn btn-secondary" onclick="addWorkoutNotes('${e.date}')">
            Add Notes
          </button>
        </div>
      </div>
    `}generateBasicWorkoutHTML(e){return`
      <div class="workout-comparison-content">
        <div class="comparison-header">
          <div class="workout-status ${e.status}">
            <span class="status-icon">${this.getStatusIcon(e.status)}</span>
            <span class="status-text">${this.formatStatus(e.status)}</span>
          </div>
        </div>

        <div class="basic-workout-details">
          <div class="detail-grid">
            <div class="detail-item">
              <div class="label">Workout Type</div>
              <div class="value">${this.formatWorkoutType(e.workoutType)}</div>
            </div>
            <div class="detail-item">
              <div class="label">Date</div>
              <div class="value">${new Date(e.date).toLocaleDateString()}</div>
            </div>
            <div class="detail-item">
              <div class="label">Description</div>
              <div class="value">${e.description}</div>
            </div>
          </div>
        </div>
      </div>
    `}generateComparisonOverview(e){const t=e.durationVariance,n=this.getVarianceClass(t.percentageChange),i=t.percentageChange>0?"+":"",r=e.performance.trainingLoadVariance,a=this.getVarianceClass(r,10);return`
      <div class="comparison-overview">
        <h4>Performance Overview</h4>
        <div class="overview-metrics">
          <div class="metric-item">
            <div class="metric-label">Duration</div>
            <div class="metric-comparison">
              <span class="planned">${t.planned}min</span>
              <span class="arrow">â†’</span>
              <span class="actual">${t.actual}min</span>
              <span class="variance ${n}">
                (${i}${t.percentageChange.toFixed(1)}%)
              </span>
            </div>
          </div>
          
          <div class="metric-item">
            <div class="metric-label">Training Load</div>
            <div class="metric-comparison">
              <span class="planned">${(e.intensityVariance.plannedFatigue*5).toFixed(0)}</span>
              <span class="arrow">â†’</span>
              <span class="actual">${r>0?"+":""}${r.toFixed(0)}</span>
              <span class="variance ${a}">TRIMP</span>
            </div>
          </div>

          <div class="metric-item">
            <div class="metric-label">Zone Compliance</div>
            <div class="metric-value">
              <span class="compliance-score ${this.getComplianceClass(e.intensityVariance.zoneCompliance.compliance.overallCompliance)}">
                ${e.intensityVariance.zoneCompliance.compliance.overallCompliance.toFixed(1)}%
              </span>
            </div>
          </div>
        </div>
      </div>
    `}generateDetailedComparison(e,t){const n=e.actualWorkout;return`
      <div class="detailed-comparison">
        <h4>Planned vs Actual</h4>
        <div class="comparison-table">
          <div class="comparison-row header">
            <div class="metric-name">Metric</div>
            <div class="planned-value">Planned</div>
            <div class="actual-value">Actual</div>
            <div class="variance-value">Variance</div>
          </div>
          
          <div class="comparison-row">
            <div class="metric-name">Duration</div>
            <div class="planned-value">${t.durationVariance.planned} min</div>
            <div class="actual-value">${t.durationVariance.actual} min</div>
            <div class="variance-value ${this.getVarianceClass(t.durationVariance.percentageChange)}">
              ${t.durationVariance.difference>0?"+":""}${t.durationVariance.difference} min
            </div>
          </div>

          <div class="comparison-row">
            <div class="metric-name">Intensity</div>
            <div class="planned-value">${t.intensityVariance.plannedFatigue}/100</div>
            <div class="actual-value">${t.intensityVariance.actualFatigue.toFixed(0)}/100</div>
            <div class="variance-value ${this.getVarianceClass(t.intensityVariance.difference,5)}">
              ${t.intensityVariance.difference>0?"+":""}${t.intensityVariance.difference.toFixed(0)}
            </div>
          </div>

          ${n.distance?`
            <div class="comparison-row">
              <div class="metric-name">Distance</div>
              <div class="planned-value">Est.</div>
              <div class="actual-value">${n.distance.toFixed(2)} km</div>
              <div class="variance-value neutral">-</div>
            </div>
          `:""}

          ${n.avgHR?`
            <div class="comparison-row">
              <div class="metric-name">Avg Heart Rate</div>
              <div class="planned-value">Est.</div>
              <div class="actual-value">${n.avgHR} bpm</div>
              <div class="variance-value neutral">-</div>
            </div>
          `:""}
        </div>
      </div>
    `}generatePerformanceAnalysis(e){const t=e.performance;return`
      <div class="performance-analysis">
        <h4>Performance Analysis</h4>
        <div class="analysis-items">
          ${t.hrDrift!==void 0?`
            <div class="analysis-item">
              <div class="analysis-label">HR Drift</div>
              <div class="analysis-value ${this.getHRDriftClass(t.hrDrift)}">
                ${t.hrDrift.toFixed(1)}%
              </div>
              <div class="analysis-description">
                ${this.getHRDriftDescription(t.hrDrift)}
              </div>
            </div>
          `:""}

          ${t.paceConsistency!==void 0?`
            <div class="analysis-item">
              <div class="analysis-label">Pace Consistency</div>
              <div class="analysis-value ${this.getPaceConsistencyClass(t.paceConsistency)}">
                CV: ${(t.paceConsistency*100).toFixed(1)}%
              </div>
              <div class="analysis-description">
                ${this.getPaceConsistencyDescription(t.paceConsistency)}
              </div>
            </div>
          `:""}

          <div class="analysis-item">
            <div class="analysis-label">Training Load Impact</div>
            <div class="analysis-value ${this.getVarianceClass(t.trainingLoadVariance,10)}">
              ${t.trainingLoadVariance>0?"+":""}${t.trainingLoadVariance.toFixed(0)} TRIMP
            </div>
            <div class="analysis-description">
              ${this.getLoadImpactDescription(t.trainingLoadVariance)}
            </div>
          </div>
        </div>
      </div>
    `}generateHeartRateSection(e){return e.avgHR?`
      <div class="heart-rate-section">
        <h4>Heart Rate Analysis</h4>
        <div class="hr-metrics">
          <div class="hr-metric">
            <div class="hr-label">Average</div>
            <div class="hr-value">${e.avgHR} bpm</div>
          </div>
          ${e.maxHR?`
            <div class="hr-metric">
              <div class="hr-label">Maximum</div>
              <div class="hr-value">${e.maxHR} bpm</div>
            </div>
          `:""}
          ${e.hrDrift!==void 0?`
            <div class="hr-metric">
              <div class="hr-label">HR Drift</div>
              <div class="hr-value ${this.getHRDriftClass(e.hrDrift)}">${e.hrDrift.toFixed(1)}%</div>
            </div>
          `:""}
        </div>
      </div>
    `:""}generateHRZonesChart(e){const t=[{name:"Z1",minutes:e.zone1Minutes,color:"#4CAF50"},{name:"Z2",minutes:e.zone2Minutes,color:"#8BC34A"},{name:"Z3",minutes:e.zone3Minutes,color:"#FFC107"},{name:"Z4",minutes:e.zone4Minutes,color:"#FF9800"},{name:"Z5",minutes:e.zone5Minutes,color:"#F44336"}],n=t.reduce((i,r)=>i+r.minutes,0);return`
      <div class="hr-zones-section">
        <h4>Heart Rate Zones</h4>
        <div class="zones-chart">
          ${t.map(i=>{const r=n>0?i.minutes/n*100:0;return`
              <div class="zone-bar">
                <div class="zone-label">${i.name}</div>
                <div class="zone-bar-track">
                  <div class="zone-bar-fill" style="width: ${r}%; background-color: ${i.color}"></div>
                </div>
                <div class="zone-time">${i.minutes.toFixed(1)}min</div>
              </div>
            `}).join("")}
        </div>
      </div>
    `}generateHRZonesComparison(e){const t=["zone1","zone2","zone3","zone4","zone5"],n=["Z1","Z2","Z3","Z4","Z5"];return`
      <div class="hr-zones-comparison">
        <h4>Zone Distribution Comparison</h4>
        <div class="zones-comparison-chart">
          ${t.map((i,r)=>{const a=e.plannedZones[i],o=e.actualZones[i],l=e.compliance[`${i}Variance`],u=this.getVarianceClass(l,2);return`
              <div class="zone-comparison-row">
                <div class="zone-name">${n[r]}</div>
                <div class="zone-planned">${a.toFixed(1)}min</div>
                <div class="zone-actual">${o.toFixed(1)}min</div>
                <div class="zone-variance ${u}">
                  ${l>0?"+":""}${l.toFixed(1)}min
                </div>
              </div>
            `}).join("")}
        </div>
        <div class="overall-compliance">
          <strong>Overall Zone Compliance: ${e.compliance.overallCompliance.toFixed(1)}%</strong>
        </div>
      </div>
    `}generateFeedbackSection(e){return`
      <div class="feedback-section">
        <h4>Workout Feedback</h4>
        <div class="feedback-list">
          ${e.map(t=>`
            <div class="feedback-item">
              <span class="feedback-icon">ðŸ’¡</span>
              <span class="feedback-text">${t}</span>
            </div>
          `).join("")}
        </div>
      </div>
    `}formatWorkoutType(e){return e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}formatStatus(e){return{planned:"Planned",completed:"Completed",missed:"Missed",unplanned:"Unplanned"}[e]||e}getStatusIcon(e){return{planned:"ðŸ“…",completed:"âœ…",missed:"âŒ",unplanned:"âš¡"}[e]||"â“"}getVarianceClass(e,t=5){return Math.abs(e)<=t?"neutral":e>0?"positive":"negative"}getComplianceClass(e){return e>=90?"excellent":e>=80?"good":e>=70?"fair":"poor"}getHRDriftClass(e){return Math.abs(e)<=3?"excellent":Math.abs(e)<=6?"good":Math.abs(e)<=10?"fair":"poor"}getHRDriftDescription(e){return Math.abs(e)<=3?"Excellent heart rate control throughout workout":Math.abs(e)<=6?"Good heart rate stability":Math.abs(e)<=10?"Moderate heart rate drift - consider pacing":"High heart rate drift - review pacing strategy"}getPaceConsistencyClass(e){return e<=.05?"excellent":e<=.1?"good":e<=.15?"fair":"poor"}getPaceConsistencyDescription(e){return e<=.05?"Very consistent pacing throughout":e<=.1?"Good pacing consistency":e<=.15?"Moderate pace variation":"High pace variation - work on consistency"}getLoadImpactDescription(e){return Math.abs(e)<=10?"Training load matched plan well":e>10?"Higher than planned training stimulus":"Lower than planned training stimulus"}getIntensityColor(e){return e<30?"#4CAF50":e<60?"#FF9800":e<80?"#F44336":"#9C27B0"}getIntensityLabel(e){return e<30?"Easy":e<60?"Moderate":e<80?"Hard":"Very Hard"}}class Zd{constructor(e){this.todaysMetrics=null,this.container=e,this.currentDate=new Date().toISOString().split("T")[0],this.initialize()}async initialize(){await this.loadTodaysMetrics(),this.render(),this.attachEventListeners()}async loadTodaysMetrics(){try{console.log("ðŸ” Loading recovery metrics for date:",this.currentDate);const e=await pe.getRecoveryMetrics();console.log("ðŸ“Š Retrieved recovery metrics:",{totalCount:e.length,dates:e.map(t=>t.date),targetDate:this.currentDate}),this.todaysMetrics=e.find(t=>t.date===this.currentDate)||null,this.todaysMetrics?console.log("âœ… Found today's recovery metrics:",this.todaysMetrics):console.log("â„¹ï¸ No recovery metrics found for today:",this.currentDate)}catch(e){console.error("âŒ Error loading today's recovery metrics:",e)}}render(){var t,n,i,r,a,o,l,u,d,p;const e=this.todaysMetrics!==null;console.log("ðŸŽ¨ Rendering recovery metrics UI:",{hasDataToday:e,currentDate:this.currentDate,containerExists:!!this.container,containerInDOM:this.container?document.contains(this.container):!1,containerParent:(n=(t=this.container)==null?void 0:t.parentElement)==null?void 0:n.tagName,metricsData:this.todaysMetrics?"Present":"None"}),this.container.innerHTML=`
      <div class="recovery-metrics-tracker">
        <div class="recovery-header">
          <h3>ðŸƒâ€â™‚ï¸ Daily Recovery Metrics</h3>
          <div class="recovery-date">
            <span class="date-display">${this.formatDate(this.currentDate)}</span>
            ${e?'<span class="data-status recorded">âœ… Recorded</span>':'<span class="data-status pending">â³ Pending</span>'}
          </div>
        </div>

        <form id="recovery-form" class="recovery-form">
          <div class="metrics-grid">
            <div class="metric-group">
              <label for="sleep-score">ðŸ˜´ Sleep Score</label>
              <div class="input-with-range">
                <input 
                  type="number" 
                  id="sleep-score" 
                  min="0" 
                  max="100" 
                  value="${((i=this.todaysMetrics)==null?void 0:i.sleepScore)||""}"
                  placeholder="0-100"
                />
                <span class="range-label">Poor â† â†’ Excellent</span>
              </div>
            </div>

            <div class="metric-group">
              <label for="body-battery">ðŸ”‹ Body Battery</label>
              <div class="input-with-range">
                <input 
                  type="number" 
                  id="body-battery" 
                  min="0" 
                  max="100" 
                  value="${((r=this.todaysMetrics)==null?void 0:r.bodyBattery)||""}"
                  placeholder="0-100"
                />
                <span class="range-label">Drained â† â†’ Charged</span>
              </div>
            </div>

            <div class="metric-group">
              <label for="hrv">ðŸ’“ HRV (Heart Rate Variability)</label>
              <div class="input-with-range">
                <input 
                  type="number" 
                  id="hrv" 
                  min="10" 
                  max="100" 
                  step="0.1"
                  value="${((a=this.todaysMetrics)==null?void 0:a.hrv)||""}"
                  placeholder="ms"
                />
                <span class="range-label">Lower â† â†’ Higher variability</span>
              </div>
            </div>

            <div class="metric-group">
              <label for="resting-hr">â¤ï¸ Resting Heart Rate</label>
              <div class="input-with-range">
                <input 
                  type="number" 
                  id="resting-hr" 
                  min="30" 
                  max="120" 
                  value="${((o=this.todaysMetrics)==null?void 0:o.restingHR)||""}"
                  placeholder="bpm"
                />
                <span class="range-label">Typical range: 50-80 bpm</span>
              </div>
            </div>

            <div class="metric-group">
              <label for="subjective-fatigue">ðŸ˜« Subjective Fatigue</label>
              <div class="input-with-range">
                <input 
                  type="range" 
                  id="subjective-fatigue" 
                  min="1" 
                  max="10" 
                  value="${((l=this.todaysMetrics)==null?void 0:l.subjectiveFatigue)||5}"
                />
                <div class="range-labels">
                  <span>Fresh (1)</span>
                  <span id="fatigue-value">${((u=this.todaysMetrics)==null?void 0:u.subjectiveFatigue)||5}</span>
                  <span>Exhausted (10)</span>
                </div>
              </div>
            </div>

            <div class="metric-group">
              <label for="stress-level">ðŸ˜¤ Stress Level</label>
              <div class="input-with-range">
                <input 
                  type="number" 
                  id="stress-level" 
                  min="0" 
                  max="100" 
                  value="${((d=this.todaysMetrics)==null?void 0:d.stressLevel)||""}"
                  placeholder="0-100"
                />
                <span class="range-label">Calm â† â†’ Very Stressed</span>
              </div>
            </div>
          </div>

          <div class="notes-section">
            <label for="recovery-notes">ðŸ“ Notes</label>
            <textarea 
              id="recovery-notes" 
              placeholder="How are you feeling today? Any additional context..."
              rows="3"
            >${((p=this.todaysMetrics)==null?void 0:p.notes)||""}</textarea>
          </div>

          <div class="form-actions">
            <button type="button" id="quick-fill-btn" class="btn btn-secondary">
              âš¡ Quick Fill (Average Values)
            </button>
            <button type="submit" class="btn btn-primary">
              ðŸ’¾ ${e?"Update":"Save"} Today's Metrics
            </button>
          </div>
        </form>

        <div class="recovery-insights" id="recovery-insights">
          ${this.generateInsights()}
        </div>

        <div class="recent-trends">
          <h4>ðŸ“Š Recent Trend</h4>
          <div id="recovery-trend-chart" class="trend-chart">
            Loading recent recovery data...
          </div>
        </div>
      </div>
    `}generateInsights(){if(!this.todaysMetrics)return`
        <div class="insight-card">
          <h4>ðŸ’¡ Recovery Insights</h4>
          <p>Enter your daily metrics to get personalized recovery insights and training readiness recommendations.</p>
        </div>
      `;const e=[],t=this.todaysMetrics;t.sleepScore!==void 0&&(t.sleepScore>=80?e.push("ðŸŒŸ Excellent sleep quality - you're well-recovered for intense training"):t.sleepScore>=60?e.push("âœ… Good sleep - moderate training intensity recommended"):e.push("âš ï¸ Poor sleep quality - consider easy training or rest day")),t.bodyBattery!==void 0&&(t.bodyBattery>=75?e.push("ðŸ”‹ High energy levels - great day for challenging workouts"):t.bodyBattery>=50?e.push("âš¡ Moderate energy - steady-state training recommended"):e.push("ðŸª« Low energy - focus on recovery or easy movement")),t.hrv!==void 0&&t.hrv>0&&e.push(`ðŸ’“ HRV: ${t.hrv}ms - ${t.hrv>40?"Good recovery status":"Consider easier training"}`);const n=this.calculateReadinessScore();return e.push(`ðŸŽ¯ Training Readiness: ${n}/100 - ${this.getReadinessMessage(n)}`),`
      <div class="insight-card">
        <h4>ðŸ’¡ Today's Recovery Insights</h4>
        <ul>
          ${e.map(i=>`<li>${i}</li>`).join("")}
        </ul>
      </div>
    `}calculateReadinessScore(){if(!this.todaysMetrics)return 50;let e=0,t=0;if(this.todaysMetrics.sleepScore!==void 0&&(e+=this.todaysMetrics.sleepScore,t++),this.todaysMetrics.bodyBattery!==void 0&&(e+=this.todaysMetrics.bodyBattery,t++),this.todaysMetrics.hrv!==void 0){const n=Math.min(100,this.todaysMetrics.hrv/40*100);e+=n,t++}if(this.todaysMetrics.subjectiveFatigue!==void 0){const n=(11-this.todaysMetrics.subjectiveFatigue)*10;e+=n,t++}if(this.todaysMetrics.stressLevel!==void 0){const n=100-this.todaysMetrics.stressLevel;e+=n,t++}return t>0?Math.round(e/t):50}getReadinessMessage(e){return e>=80?"Ready for intense training! ðŸ’ª":e>=60?"Good for moderate training ðŸ‘":e>=40?"Easy training recommended ðŸš¶â€â™‚ï¸":"Focus on recovery today ðŸ˜´"}attachEventListeners(){const e=this.container.querySelector("#recovery-form"),t=this.container.querySelector("#quick-fill-btn"),n=this.container.querySelector("#subjective-fatigue"),i=this.container.querySelector("#fatigue-value");e==null||e.addEventListener("submit",async r=>{r.preventDefault(),await this.saveMetrics()}),t==null||t.addEventListener("click",()=>{this.quickFillAverageValues()}),n==null||n.addEventListener("input",r=>{const a=r.target.value;i&&(i.textContent=a)})}async saveMetrics(){try{const e=this.getFormData();if(!this.hasAnyMetricData(e)){Q.showStatus("Please enter at least one recovery metric","warning");return}const t={date:this.currentDate,subjectiveFatigue:e.subjectiveFatigue||5};e.sleepScore!==void 0&&(t.sleepScore=e.sleepScore),e.bodyBattery!==void 0&&(t.bodyBattery=e.bodyBattery),e.hrv!==void 0&&(t.hrv=e.hrv),e.restingHR!==void 0&&(t.restingHR=e.restingHR),e.stressLevel!==void 0&&(t.stressLevel=e.stressLevel),e.notes&&e.notes.trim()&&(t.notes=e.notes.trim()),await pe.addRecoveryMetrics(t),await this.loadTodaysMetrics(),this.render(),Q.showStatus("Recovery metrics saved successfully! ðŸ’¾","success"),window.dispatchEvent(new CustomEvent("recovery-metrics-updated",{detail:{date:this.currentDate,metrics:this.todaysMetrics}}))}catch(e){console.error("Error saving recovery metrics:",e),Q.showStatus(`Failed to save metrics: ${e.message}`,"error")}}getFormData(){var t,n;const e=i=>{var o;const r=this.container.querySelector(`#${i}`),a=(o=r==null?void 0:r.value)==null?void 0:o.trim();return a?parseFloat(a):void 0};return{sleepScore:e("sleep-score"),bodyBattery:e("body-battery"),hrv:e("hrv"),restingHR:e("resting-hr"),subjectiveFatigue:e("subjective-fatigue")||5,stressLevel:e("stress-level"),notes:((n=(t=this.container.querySelector("#recovery-notes"))==null?void 0:t.value)==null?void 0:n.trim())||void 0}}hasAnyMetricData(e){return!!(e.sleepScore!==void 0||e.bodyBattery!==void 0||e.hrv!==void 0||e.restingHR!==void 0||e.stressLevel!==void 0||e.notes)}quickFillAverageValues(){const e=this.container.querySelector("#sleep-score"),t=this.container.querySelector("#body-battery"),n=this.container.querySelector("#hrv"),i=this.container.querySelector("#resting-hr"),r=this.container.querySelector("#stress-level");e&&!e.value&&(e.value="75"),t&&!t.value&&(t.value="70"),n&&!n.value&&(n.value="35"),i&&!i.value&&(i.value="60"),r&&!r.value&&(r.value="30"),Q.showStatus("Quick filled with average values âš¡","info")}formatDate(e){return new Date(e+"T00:00:00").toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}async updateDate(e){this.currentDate=e,await this.loadTodaysMetrics(),this.render(),this.attachEventListeners()}getCurrentMetrics(){return this.todaysMetrics}getReadinessScore(){return this.calculateReadinessScore()}async refreshData(){console.log("ðŸ”„ Refreshing recovery metrics data...");try{await this.loadTodaysMetrics(),console.log("ðŸŽ¨ About to re-render after data load..."),this.render(),console.log("ðŸ”— Reattaching event listeners..."),this.attachEventListeners(),console.log("âœ… Recovery metrics data refreshed successfully")}catch(e){console.error("âŒ Error during recovery metrics refresh:",e)}}}const cc=class cc{static modifyWorkout(e,t,n,i,r,a={}){const o={...this.DEFAULT_ADJUSTMENT_OPTIONS,...a},l=e.findIndex(Y=>Y.date===t);if(l===-1)return this.createFailureResult("Workout not found for the specified date");const u=e[l],d=[],p=[...e];let m;switch(n){case"change-to-rest":m=this.createRestDay(u);break;case"change-workout-type":if(!(i!=null&&i.workoutType))return this.createFailureResult("New workout type must be specified");m=this.changeWorkoutType(u,i.workoutType);break;case"adjust-duration":if(!(i!=null&&i.durationMin))return this.createFailureResult("New duration must be specified");m=this.adjustDuration(u,i.durationMin);break;case"adjust-intensity":if(!(i!=null&&i.expectedFatigue))return this.createFailureResult("New intensity level must be specified");m=this.adjustIntensity(u,i.expectedFatigue);break;default:return this.createFailureResult("Invalid modification type")}p[l]=m,d.push({date:t,type:n,reason:r,originalWorkout:u,newWorkout:m,timestamp:new Date().toISOString()});const w=this.calculateTotalLoad([u]),C=this.calculateTotalLoad([m])-w;if(o.redistributeLoad&&Math.abs(C)>5){const Y=this.rebalancePlan(p,l,C,o);Y.success&&(p.splice(0,p.length,...Y.adjustedPlan),d.push(...Y.modifications))}const I=this.calculateImpactSummary(e,p,d),B=this.generateWarnings(d,I,o),G=this.generateRecommendations(d,I);return{success:!0,adjustedPlan:p,modifications:d,impactSummary:I,warnings:B,recommendations:G}}static createRestDay(e){return{...e,workoutType:"rest",description:"Rest day - recovery and relaxation",expectedFatigue:0,durationMin:0,workoutId:"rest-zone1"}}static changeWorkoutType(e,t){const n=Le.getWorkoutsByType(t);if(n.length===0)return{...e,workoutType:t,description:`${t} workout`,expectedFatigue:Math.min(e.expectedFatigue,60),workoutId:`${t}-basic`};const i=e.expectedFatigue,r=n.reduce((a,o)=>{const l=Math.abs(a.fatigueScore-i);return Math.abs(o.fatigueScore-i)<l?o:a});return{...e,workoutType:r.type,description:r.description,expectedFatigue:r.fatigueScore,durationMin:r.durationMin,workoutId:`${r.type}-${r.tag}`}}static adjustDuration(e,t){const n=t/Math.max(e.durationMin,1),i=Math.round(e.expectedFatigue*Math.sqrt(n));return{...e,durationMin:t,expectedFatigue:Math.max(0,Math.min(100,i)),description:`${e.description} (${t} min)`}}static adjustIntensity(e,t){const n=t<=40?"Easy":t<=65?"Moderate":t<=85?"Hard":"Extreme";return{...e,expectedFatigue:Math.max(0,Math.min(100,t)),description:`${n} ${e.workoutType} (intensity adjusted)`}}static rebalancePlan(e,t,n,i){const r=[...e],a=[],o=e.length-t-1;if(o<=0)return{success:!0,adjustedPlan:r,modifications:[],impactSummary:{daysAffected:0,totalLoadChange:0,weeklyVolumeChange:0},warnings:["No remaining days to redistribute load"],recommendations:[]};if(n>=0)return{success:!0,adjustedPlan:r,modifications:[],impactSummary:{daysAffected:0,totalLoadChange:0,weeklyVolumeChange:0},warnings:[],recommendations:[]};const u=Math.abs(n)/o;for(let d=t+1;d<r.length;d++){const p=r[d];if(p.workoutType==="rest"||i.preserveHardDays&&p.expectedFatigue>70)continue;const m=p.expectedFatigue,w=Math.min(m+i.maxDailyFatigueIncrease,85);if(w>m){const E=Math.min(u,w-m),C=Math.round(E*.5),I={...p},B={...p,expectedFatigue:m+E,durationMin:p.durationMin+C,description:`${p.description} (adjusted for load redistribution)`};r[d]=B,a.push({date:p.date,type:"adjust-intensity",reason:"Load redistribution due to plan modification",originalWorkout:I,newWorkout:B,timestamp:new Date().toISOString()})}}return{success:!0,adjustedPlan:r,modifications:a,impactSummary:{daysAffected:a.length,totalLoadChange:0,weeklyVolumeChange:0},warnings:[],recommendations:[]}}static calculateTotalLoad(e){return e.reduce((t,n)=>t+n.expectedFatigue,0)}static calculateImpactSummary(e,t,n){const i=this.calculateTotalLoad(e),r=this.calculateTotalLoad(t),a=e.reduce((l,u)=>l+u.durationMin,0),o=t.reduce((l,u)=>l+u.durationMin,0);return{daysAffected:n.length,totalLoadChange:r-i,weeklyVolumeChange:o-a}}static generateWarnings(e,t,n){const i=[];return Math.abs(t.totalLoadChange)>50&&i.push(`Significant training load change: ${t.totalLoadChange>0?"+":""}${t.totalLoadChange}`),Math.abs(t.weeklyVolumeChange)>60&&i.push(`Weekly volume changed by ${t.weeklyVolumeChange} minutes`),t.daysAffected>3&&i.push(`Multiple days affected (${t.daysAffected}) - may impact training progression`),i}static generateRecommendations(e,t){const n=[];return t.totalLoadChange<-30&&n.push("Consider adding an extra easy workout this week to maintain training volume"),e.some(i=>i.type==="change-to-rest")&&n.push("Ensure adequate nutrition and hydration on rest days for optimal recovery"),t.daysAffected>2&&n.push("Monitor your response to the adjusted training load over the next few days"),n}static createFailureResult(e){return{success:!1,adjustedPlan:[],modifications:[],impactSummary:{daysAffected:0,totalLoadChange:0,weeklyVolumeChange:0},warnings:[e],recommendations:[]}}static getWorkoutSubstitutions(e){const t=e.workoutType,n=e.expectedFatigue;return[...Le.getWorkoutsByType("run"),...Le.getWorkoutsByType("bike"),...Le.getWorkoutsByType("strength"),...Le.getWorkoutsByType("mobility")].filter(r=>r.type!==t).filter(r=>Math.abs(r.fatigueScore-n)<=20).sort((r,a)=>Math.abs(r.fatigueScore-n)-Math.abs(a.fatigueScore-n)).slice(0,5)}};cc.DEFAULT_ADJUSTMENT_OPTIONS={redistributeLoad:!0,maintainWeeklyVolume:!0,preserveHardDays:!0,maxDailyFatigueIncrease:15};let As=cc;const xs=class xs{static async saveTrainingPlan(e,t){var n,i;try{const r=((n=e.plan[0])==null?void 0:n.date)||new Date().toISOString().split("T")[0],a=((i=e.plan[e.plan.length-1])==null?void 0:i.date)||r,o={planName:t||`Training Plan ${new Date().toLocaleDateString()}`,planType:"custom",startDate:r,endDate:a,totalWeeks:Math.ceil(e.plan.length/7),config:{sport:"multi",weeklyHours:this.calculateWeeklyHours(e.plan),fitnessLevel:"intermediate",goals:e.recommendations.slice(0,3),availableDays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]},workouts:[],generatedBy:"ai",version:"1.0",isActive:!1},l=e.plan.map(d=>({date:d.date,workoutType:d.workoutType,description:d.description,expectedFatigue:d.expectedFatigue,durationMin:d.durationMin,sport:d.sport||this.inferSportFromWorkoutType(d.workoutType),completed:!1,actualFatigue:d.actualFatigue,adherenceScore:100,workoutZones:d.workoutZones,workoutTags:d.workoutTags,hrTargetZone:d.hrTargetZone||"Zone 2",customParameters:d.customParameters,generatedAt:new Date,generatedBy:"algorithm",createdAt:new Date,metadata:{basedOnMetrics:!0,adjustmentReason:e.warnings.length>0?e.warnings[0]:void 0}})),u=await pe.saveGeneratedPlanWithWorkouts(o,l);return console.log(`Saved training plan to Firebase: ${o.planName} (${e.plan.length} workouts)`),u}catch(r){if(console.error("Firebase save failed:",r),this.FALLBACK_TO_LOCAL)return console.log("Falling back to localStorage..."),this.saveTrainingPlanLocal(e,t);throw r}}static async getStoredTrainingPlans(){try{return(await pe.getGeneratedPlans()).map(this.convertFromFirebasePlan)}catch(e){return console.error("Firebase load failed:",e),this.FALLBACK_TO_LOCAL?(console.log("Falling back to localStorage..."),this.getStoredTrainingPlansLocal()):[]}}static async getTrainingPlan(e){try{const n=(await pe.getGeneratedPlans()).find(i=>i.id===e);return n?this.convertFromFirebasePlan(n):null}catch(t){return console.error("Firebase load failed:",t),this.FALLBACK_TO_LOCAL?(console.log("Falling back to localStorage..."),this.getTrainingPlanLocal(e)):null}}static async setActivePlan(e){try{return await pe.setActivePlan(e),console.log(`Set active plan: ${e}`),!0}catch(t){return console.error("Firebase update failed:",t),this.FALLBACK_TO_LOCAL?(console.log("Falling back to localStorage..."),this.setActivePlanLocal(e)):!1}}static async getActivePlan(){try{const e=await pe.getActivePlan();return e?this.convertFromFirebasePlan(e):null}catch(e){return console.error("Firebase load failed:",e),this.FALLBACK_TO_LOCAL?(console.log("Falling back to localStorage..."),this.getActivePlanLocal()):null}}static async deleteTrainingPlan(e){try{return await pe.deleteGeneratedPlan(e),console.log(`Deleted training plan: ${e}`),!0}catch(t){return console.error("Firebase delete failed:",t),this.FALLBACK_TO_LOCAL?(console.log("Falling back to localStorage..."),this.deleteTrainingPlanLocal(e)):!1}}static saveWorkoutsFromPlan(e){const t=this.getStoredWorkouts(),n=new Date().toISOString(),i=t.filter(o=>o.planId!==e.id),r=e.plan.map(o=>({id:this.generateId("workout"),date:o.date,workoutType:o.workoutType,description:o.description,status:"planned",planId:e.id,createdAt:n,updatedAt:n,expectedFatigue:o.expectedFatigue,durationMin:o.durationMin,workoutId:o.workoutId})),a=[...i,...r];localStorage.setItem(this.STORAGE_KEYS.WORKOUTS,JSON.stringify(a)),console.log(`Saved ${r.length} workouts from plan ${e.name}`)}static getStoredWorkouts(){try{const e=localStorage.getItem(this.STORAGE_KEYS.WORKOUTS);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading workouts:",e),[]}}static getWorkoutsForDateRange(e,t){return this.getStoredWorkouts().filter(i=>i.date>=e&&i.date<=t)}static getWorkoutsForDate(e){return this.getStoredWorkouts().filter(t=>t.date===e)}static updateWorkout(e,t){const n=this.getStoredWorkouts(),i=n.findIndex(r=>r.id===e);return i===-1?(console.error(`Workout ${e} not found`),!1):(n[i]={...n[i],...t,updatedAt:new Date().toISOString()},localStorage.setItem(this.STORAGE_KEYS.WORKOUTS,JSON.stringify(n)),console.log(`Updated workout: ${e}`),!0)}static completeWorkout(e,t){return this.updateWorkout(e,{status:"completed",...t})}static markWorkoutMissed(e,t){return this.updateWorkout(e,{status:"missed",notes:t})}static skipWorkout(e,t){return this.updateWorkout(e,{status:"skipped",notes:t})}static addUnplannedWorkout(e){const t=this.generateId("workout"),n=new Date().toISOString(),i={id:t,date:e.date,workoutType:e.workoutType,description:e.description,status:"completed",createdAt:n,updatedAt:n,expectedFatigue:e.actualFatigue||50,durationMin:e.actualDuration,actualDuration:e.actualDuration,actualFatigue:e.actualFatigue,actualDistance:e.actualDistance,avgHR:e.avgHR,maxHR:e.maxHR,trainingLoad:e.trainingLoad,calories:e.calories,notes:e.notes},r=this.getStoredWorkouts();return r.push(i),localStorage.setItem(this.STORAGE_KEYS.WORKOUTS,JSON.stringify(r)),console.log(`Added unplanned workout: ${t}`),t}static deleteWorkoutsByPlan(e){const n=this.getStoredWorkouts().filter(i=>i.planId!==e);localStorage.setItem(this.STORAGE_KEYS.WORKOUTS,JSON.stringify(n))}static convertToTrackedWorkouts(e){return e.map(t=>{const n={workoutId:t.id,date:t.date,workoutType:t.workoutType,description:t.description,expectedFatigue:t.expectedFatigue,durationMin:t.durationMin,status:t.status==="skipped"?"missed":t.status,lastModified:t.updatedAt};return t.status==="completed"&&t.actualDuration&&(n.actualWorkout={date:t.date,sport:t.workoutType,duration:t.actualDuration,distance:t.actualDistance||0,trainingLoad:t.trainingLoad||0,avgHR:t.avgHR,maxHR:t.maxHR,calories:t.calories,zone1Minutes:0,zone2Minutes:0,zone3Minutes:0,zone4Minutes:0,zone5Minutes:0,notes:t.notes}),n})}static getPlanStatistics(e){if(!this.getTrainingPlan(e))return null;const n=this.getStoredWorkouts().filter(u=>u.planId===e),i=n.filter(u=>u.status==="completed"),r=n.filter(u=>u.status==="missed"||u.status==="skipped"),a=n.filter(u=>u.status==="planned"),o=n.reduce((u,d)=>u+d.durationMin,0),l=i.reduce((u,d)=>u+(d.actualDuration||0),0);return{totalWorkouts:n.length,completedWorkouts:i.length,missedWorkouts:r.length,plannedWorkouts:a.length,adherenceRate:n.length>0?i.length/n.length*100:0,totalPlannedDuration:o,totalActualDuration:l}}static exportPlan(e){const t=this.getTrainingPlan(e);if(!t)throw new Error(`Training plan ${e} not found`);const n=this.getStoredWorkouts().filter(a=>a.planId===e),i=this.getPlanStatistics(e),r={plan:t,workouts:n,statistics:i,exportedAt:new Date().toISOString(),version:"1.0"};return JSON.stringify(r,null,2)}static clearAllData(){Object.values(this.STORAGE_KEYS).forEach(e=>{localStorage.removeItem(e)}),console.log("Cleared all workout storage data")}static getStorageInfo(){const e=this.getStoredTrainingPlans(),t=this.getStoredWorkouts(),n=localStorage.getItem(this.STORAGE_KEYS.ACTIVE_PLAN),i=JSON.stringify(e).length,r=JSON.stringify(t).length,a=Math.round((i+r)/1024);return{trainingPlansCount:e.length,workoutsCount:t.length,activePlanId:n,estimatedSizeKB:a}}static convertFromFirebasePlan(e){return{id:e.id,name:e.planName,generatedAt:e.generatedAt.toISOString(),startDate:e.startDate,endDate:e.endDate,plan:e.workouts.map(t=>({date:t.date,workoutType:t.workoutType,description:t.description,expectedFatigue:t.expectedFatigue,durationMin:t.durationMin,sport:t.sport,workoutId:t.id,completed:t.completed,actualFatigue:t.actualFatigue,workoutZones:t.workoutZones,workoutTags:t.workoutTags,hrTargetZone:t.hrTargetZone||"Zone 2",customParameters:t.customParameters})),readinessMetrics:{score:75,fatigue7DayAvg:45,recoveryScore:70,trainingLoad7Day:250,recentHardDays:1},recommendations:e.config.goals,warnings:[],isActive:e.isActive}}static calculateWeeklyHours(e){const t=e.reduce((i,r)=>i+r.durationMin,0),n=Math.ceil(e.length/7);return Math.round(t/60/n)}static saveTrainingPlanLocal(e,t){var u,d;const n=this.generateId("plan"),i=((u=e.plan[0])==null?void 0:u.date)||new Date().toISOString().split("T")[0],r=((d=e.plan[e.plan.length-1])==null?void 0:d.date)||i,a={id:n,name:t||`Training Plan ${new Date().toLocaleDateString()}`,generatedAt:e.generatedAt,startDate:i,endDate:r,plan:e.plan,readinessMetrics:e.readinessMetrics,recommendations:e.recommendations,warnings:e.warnings,isActive:!1},o=this.getStoredTrainingPlansLocal();o.push(a);const l=o.sort((p,m)=>new Date(m.generatedAt).getTime()-new Date(p.generatedAt).getTime()).slice(0,this.MAX_STORED_PLANS);return localStorage.setItem(this.STORAGE_KEYS.TRAINING_PLANS,JSON.stringify(l)),console.log(`Saved training plan to localStorage: ${a.name} (${e.plan.length} workouts)`),n}static getStoredTrainingPlansLocal(){try{const e=localStorage.getItem(this.STORAGE_KEYS.TRAINING_PLANS);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading training plans from localStorage:",e),[]}}static getTrainingPlanLocal(e){return this.getStoredTrainingPlansLocal().find(n=>n.id===e)||null}static setActivePlanLocal(e){const t=this.getStoredTrainingPlansLocal();return t.some(i=>i.id===e)?(t.forEach(i=>{i.isActive=i.id===e}),localStorage.setItem(this.STORAGE_KEYS.TRAINING_PLANS,JSON.stringify(t)),localStorage.setItem(this.STORAGE_KEYS.ACTIVE_PLAN,e),console.log(`Set active plan in localStorage: ${e}`),!0):(console.error(`Training plan ${e} not found`),!1)}static getActivePlanLocal(){const e=localStorage.getItem(this.STORAGE_KEYS.ACTIVE_PLAN);return e?this.getTrainingPlanLocal(e):null}static deleteTrainingPlanLocal(e){const t=this.getStoredTrainingPlansLocal(),n=t.length,i=t.filter(a=>a.id!==e);return i.length===n?(console.warn(`Training plan ${e} not found for deletion`),!1):(localStorage.setItem(this.STORAGE_KEYS.TRAINING_PLANS,JSON.stringify(i)),localStorage.getItem(this.STORAGE_KEYS.ACTIVE_PLAN)===e&&localStorage.removeItem(this.STORAGE_KEYS.ACTIVE_PLAN),console.log(`Deleted training plan from localStorage: ${e}`),!0)}static generateId(e){return`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static isAuthenticated(){return xe.getCurrentUser()!==null}static getCurrentUserId(){const e=xe.getCurrentUser();return e?e.uid:null}static inferSportFromWorkoutType(e){return{run:"run",easy_run:"run",tempo_run:"run",interval_run:"run",long_run:"run",recovery_run:"run",fartlek:"run",hill_repeats:"run",track_workout:"run",bike:"bike",easy_bike:"bike",tempo_bike:"bike",interval_bike:"bike",endurance_bike:"bike",recovery_bike:"bike",strength:"strength",strength_training:"strength",resistance:"strength",swim:"swim",swimming:"swim",yoga:"yoga",mobility:"other",rest:"other",brick:"other"}[e]||"other"}};xs.MAX_STORED_PLANS=10,xs.FALLBACK_TO_LOCAL=!0,xs.STORAGE_KEYS={TRAINING_PLANS:"train_training_plans",WORKOUTS:"train_workouts",ACTIVE_PLAN:"train_active_plan_id",USER_PREFERENCES:"train_user_preferences"};let Gt=xs;class nk{constructor(e){this.currentPlan=null,this.planModifications=[],this.aiInsightsEnabled=!0,this.trainingHubReference=null,this.trainingHubReference=e,this.initializeEventListeners(),this.loadCurrentPlan()}initializeEventListeners(){const e=document.getElementById("unified-generate-plan-btn");e==null||e.addEventListener("click",()=>this.openPlanGenerationModal()),document.querySelectorAll(".template-select-btn").forEach(l=>{l.addEventListener("click",u=>{const d=u.target.dataset.template;this.openPlanGenerationModalWithTemplate(d)})});const n=document.getElementById("manage-saved-plans-btn");n==null||n.addEventListener("click",()=>this.showSavedPlans());const i=document.getElementById("export-csv-btn");i==null||i.addEventListener("click",()=>this.exportToCSV());const r=document.getElementById("export-sheets-btn");r==null||r.addEventListener("click",()=>this.exportToSheets());const a=document.getElementById("regenerate-plan-btn");a==null||a.addEventListener("click",()=>this.openPlanGenerationModal());const o=document.getElementById("ai-recommend-btn");o==null||o.addEventListener("click",()=>this.getAIRecommendation()),document.addEventListener("workouts-updated",l=>{l.detail.source==="plan-generation"&&this.refreshCurrentPlan()}),document.addEventListener("click",l=>{const u=document.getElementById("workout-modification-modal");l.target===u&&this.closeModificationModal()}),document.addEventListener("keydown",l=>{l.key==="Escape"&&this.closeModificationModal()})}openPlanGenerationModal(){this.trainingHubReference?this.trainingHubReference.showPlanGenerationModal():window.trainingHub?window.trainingHub.showPlanGenerationModal():Q.showStatus("Plan generation not available","error")}openPlanGenerationModalWithTemplate(e){this.openPlanGenerationModal(),e&&console.log(`Template ${e} selected - opening modal`)}loadCurrentPlan(){var e,t,n,i;this.trainingHubReference?this.currentPlan=((t=(e=this.trainingHubReference).getCurrentPlan)==null?void 0:t.call(e))||null:window.trainingHub&&(this.currentPlan=((i=(n=window.trainingHub).getCurrentPlan)==null?void 0:i.call(n))||null),this.currentPlan?(this.displayGeneratedPlan(),this.updatePlanStatus()):this.updatePlanStatus()}refreshCurrentPlan(){this.loadCurrentPlan()}updatePlanStatus(){const e=document.getElementById("current-plan-status"),t=document.getElementById("plan-stats");if(e)if(this.currentPlan&&this.currentPlan.plan.length>0){const n=this.currentPlan.plan.length,i=new Date(this.currentPlan.plan[0].date),r=new Date(this.currentPlan.plan[this.currentPlan.plan.length-1].date),a=new Date,o=Math.max(0,Math.ceil((r.getTime()-a.getTime())/(1e3*60*60*24))),l=Math.max(0,Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24))),u=Math.min(100,Math.round(l/n*100));if(e.textContent=`Active plan: ${n} days (${i.toLocaleDateString()} - ${r.toLocaleDateString()})`,t){t.style.display="flex";const d=document.getElementById("plan-days-remaining"),p=document.getElementById("plan-completion"),m=document.getElementById("plan-adherence");d&&(d.textContent=o.toString()),p&&(p.textContent=`${u}%`),m&&(m.textContent="85%")}}else e.textContent="No active training plan",t&&(t.style.display="none")}generateSampleFatigueScores(){const e=[];for(let t=0;t<7;t++)e.push(Math.floor(Math.random()*30)+20);return e}generateSampleWorkouts(){const e=[],t=new Date;for(let n=1;n<=7;n++){const i=new Date(t);i.setDate(i.getDate()-n),Math.random()>.3&&e.push({date:i.toISOString().split("T")[0],type:["run","bike","strength"][Math.floor(Math.random()*3)],duration:Math.floor(Math.random()*60)+30,fatigue:Math.floor(Math.random()*40)+20,trainingLoad:Math.floor(Math.random()*60)+30})}return e}getDefaultEventDate(){const e=new Date;return e.setDate(e.getDate()+12*7),e.toISOString().split("T")[0]}displayGeneratedPlan(){if(!this.currentPlan)return;const e=document.getElementById("generatedPlanSection");e&&(e.style.display="block"),this.updatePlanMetadata(),this.displayReadinessSummary(),this.displayWorkoutCalendar();const t=document.getElementById("export-csv-btn"),n=document.getElementById("export-sheets-btn");t&&(t.disabled=!1),n&&(n.disabled=!1)}updatePlanMetadata(){var t,n;if(!this.currentPlan)return;const e=document.getElementById("plan-meta");if(e){const i=(t=this.currentPlan.plan[0])==null?void 0:t.date,r=(n=this.currentPlan.plan[this.currentPlan.plan.length-1])==null?void 0:n.date;e.textContent=`${this.currentPlan.plan.length} days â€¢ ${i} to ${r}`}}displayReadinessSummary(){if(!this.currentPlan)return;const{readinessMetrics:e,recommendations:t,warnings:n}=this.currentPlan,i=document.getElementById("readiness-score-display");i&&(i.textContent=`${Math.round(e.score)}/100`,i.className=`readiness-score-large ${this.getReadinessClass(e.score)}`);const r=document.getElementById("readiness-indicators");r&&(r.innerHTML=this.generateReadinessIndicators(e));const a=document.getElementById("recommendations-list");a&&(a.innerHTML=t.map(u=>`<li>${u}</li>`).join(""));const o=document.getElementById("warnings-card"),l=document.getElementById("warnings-list");n.length>0&&o&&l?(o.style.display="block",l.innerHTML=n.map(u=>`<li>${u}</li>`).join("")):o&&(o.style.display="none")}displayWorkoutCalendar(){if(!this.currentPlan)return;const e=document.getElementById("workout-cards");e&&(e.innerHTML=this.currentPlan.plan.map(t=>this.createWorkoutCard(t)).join(""),this.attachWorkoutCardListeners())}createWorkoutCard(e){const t=this.getFatigueSeverity(e.expectedFatigue),n=this.getFatigueClass(e.expectedFatigue),i=Math.min(100,e.expectedFatigue),r=new Date(e.date),a=r.toLocaleDateString("en-US",{weekday:"short"}),o=r.toLocaleDateString("en-US",{month:"short",day:"numeric"});return`
      <div class="workout-card workout-${t}" data-date="${e.date}">
        <div class="workout-header">
          <div class="workout-date">${a}, ${o}</div>
          <button class="modify-workout-btn" data-date="${e.date}" title="Modify workout">
            <span>âš™ï¸</span>
          </button>
        </div>
        <div class="workout-type">${e.workoutType}</div>
        <div class="workout-description">${e.description}</div>
        <div class="workout-stats">
          <div class="workout-duration">${e.durationMin} min</div>
          <div class="workout-fatigue">
            <div class="fatigue-bar">
              <div class="fatigue-fill ${n}" style="width: ${i}%"></div>
            </div>
            <div class="fatigue-value">${e.expectedFatigue}</div>
          </div>
        </div>
        ${this.getModificationIndicator(e.date)}
      </div>
    `}generateReadinessIndicators(e){const t=[];return e.fatigue7DayAvg<50?t.push('<div class="indicator">Low Fatigue</div>'):e.fatigue7DayAvg>70&&t.push('<div class="indicator">High Fatigue</div>'),e.recentHardDays<=1?t.push('<div class="indicator">Well Recovered</div>'):e.recentHardDays>=3&&t.push('<div class="indicator">High Load</div>'),e.daysUntilRace&&e.daysUntilRace<=14&&t.push('<div class="indicator">Race Soon</div>'),t.join("")}getReadinessClass(e){return e>=80?"excellent":e>=60?"good":e>=40?"fair":"poor"}getFatigueSeverity(e){return e<=40?"low":e<=65?"moderate":e<=85?"hard":"extreme"}getFatigueClass(e){return e<=40?"low":e<=65?"moderate":e<=85?"hard":"extreme"}async exportToCSV(){Q.showStatus("CSV export coming soon!","info")}async exportToSheets(){if(this.currentPlan)try{Q.showStatus("Exporting to Google Sheets...","info"),Q.showStatus("Google Sheets export coming soon! Use CSV export for now.","info")}catch(e){console.error("Error exporting to Sheets:",e),Q.showStatus("Failed to export plan to Google Sheets","error")}}async regeneratePlan(){await this.generatePlan()}attachWorkoutCardListeners(){document.querySelectorAll(".modify-workout-btn").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation();const i=t.dataset.date;i&&this.openModificationModal(i)})})}openModificationModal(e){if(!this.currentPlan)return;const t=this.currentPlan.plan.find(n=>n.date===e);t&&this.createModificationModal(t)}createModificationModal(e){const t=document.getElementById("workout-modification-modal");t&&t.remove();const n=document.createElement("div");n.id="workout-modification-modal",n.className="modification-modal";const r=new Date(e.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});n.innerHTML=`
      <div class="modal-content">
        <div class="modal-header">
          <h3>Modify Workout - ${r}</h3>
          <button class="close-modal-btn">&times;</button>
        </div>
        
        <div class="modal-body">
          <div class="current-workout">
            <h4>Current Workout</h4>
            <div class="workout-summary">
              <div><strong>Type:</strong> ${e.workoutType}</div>
              <div><strong>Duration:</strong> ${e.durationMin} minutes</div>
              <div><strong>Intensity:</strong> ${e.expectedFatigue}/100</div>
              <div><strong>Description:</strong> ${e.description}</div>
            </div>
          </div>

          <div class="modification-options">
            <h4>Modification Options</h4>
            
            <div class="quick-actions">
              <button class="action-btn rest-btn" data-action="rest" data-date="${e.date}">
                ðŸ›Œ Make Rest Day
              </button>
              <button class="action-btn substitute-btn" data-action="substitute" data-date="${e.date}">
                ðŸ”„ Substitute Workout
              </button>
            </div>

            <div class="custom-adjustments">
              <div class="adjustment-group">
                <label for="duration-adjustment">Duration (minutes):</label>
                <input type="number" id="duration-adjustment" value="${e.durationMin}" min="0" max="180">
              </div>
              
              <div class="adjustment-group">
                <label for="intensity-adjustment">Intensity (0-100):</label>
                <input type="range" id="intensity-adjustment" value="${e.expectedFatigue}" min="0" max="100">
                <span class="intensity-value">${e.expectedFatigue}</span>
              </div>

              <div class="adjustment-group">
                <label for="workout-type-select">Workout Type:</label>
                <select id="workout-type-select">
                  <option value="run" ${e.workoutType==="run"?"selected":""}>Run</option>
                  <option value="bike" ${e.workoutType==="bike"?"selected":""}>Bike</option>
                  <option value="strength" ${e.workoutType==="strength"?"selected":""}>Strength</option>
                  <option value="brick" ${e.workoutType==="brick"?"selected":""}>Brick</option>
                  <option value="mobility" ${e.workoutType==="mobility"?"selected":""}>Mobility</option>
                  <option value="rest" ${e.workoutType==="rest"?"selected":""}>Rest</option>
                </select>
              </div>

              <div class="adjustment-group">
                <label for="modification-reason">Reason (optional):</label>
                <input type="text" id="modification-reason" placeholder="e.g., feeling tired, schedule conflict">
              </div>
            </div>

            <div class="rebalance-options">
              <h5>Rebalancing Options</h5>
              <label class="checkbox-label">
                <input type="checkbox" id="redistribute-load" checked>
                Redistribute training load to other days
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="maintain-volume" checked>
                Try to maintain weekly volume
              </label>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancel-modification">Cancel</button>
          <button class="btn btn-primary" id="apply-modification" data-date="${e.date}">Apply Changes</button>
        </div>
      </div>
    `,document.body.appendChild(n),this.attachModalEventListeners(e),n.style.display="flex"}attachModalEventListeners(e){const t=document.querySelector(".close-modal-btn");t==null||t.addEventListener("click",()=>this.closeModificationModal());const n=document.getElementById("cancel-modification");n==null||n.addEventListener("click",()=>this.closeModificationModal());const i=document.querySelector(".rest-btn");i==null||i.addEventListener("click",u=>{const d=u.target.dataset.date;d&&this.quickModifyWorkout(d,"change-to-rest")});const r=document.querySelector(".substitute-btn");r==null||r.addEventListener("click",()=>this.showSubstitutionOptions(e));const a=document.getElementById("intensity-adjustment"),o=document.querySelector(".intensity-value");a==null||a.addEventListener("input",u=>{o&&(o.textContent=u.target.value)});const l=document.getElementById("apply-modification");l==null||l.addEventListener("click",()=>this.applyWorkoutModification(e))}async quickModifyWorkout(e,t){if(this.currentPlan)try{const n=t==="change-to-rest"?"User requested rest day":"Quick modification",i=As.modifyWorkout(this.currentPlan.plan,e,t,{},n);i.success?(this.applyPlanAdjustment(i),this.closeModificationModal(),Q.showStatus("Workout modified successfully!","success")):Q.showStatus("Failed to modify workout: "+i.warnings.join(", "),"error")}catch(n){console.error("Error modifying workout:",n),Q.showStatus("Error modifying workout","error")}}async applyWorkoutModification(e){if(this.currentPlan)try{const t=document.getElementById("duration-adjustment"),n=document.getElementById("intensity-adjustment"),i=document.getElementById("workout-type-select"),r=document.getElementById("modification-reason"),a=document.getElementById("redistribute-load").checked,o=document.getElementById("maintain-volume").checked,l=parseInt(t.value),u=parseInt(n.value),d=i.value,p=r.value||"User modification";let m="adjust-duration",w={};d!==e.workoutType?(m="change-workout-type",w.workoutType=d):l!==e.durationMin?(m="adjust-duration",w.durationMin=l):u!==e.expectedFatigue&&(m="adjust-intensity",w.expectedFatigue=u),l!==e.durationMin&&u!==e.expectedFatigue&&(w.durationMin=l,w.expectedFatigue=u);const E={redistributeLoad:a,maintainWeeklyVolume:o,preserveHardDays:!0,maxDailyFatigueIncrease:15},C=As.modifyWorkout(this.currentPlan.plan,e.date,m,w,p,E);C.success?(this.applyPlanAdjustment(C),this.closeModificationModal(),Q.showStatus("Workout modified successfully!","success")):Q.showStatus("Failed to modify workout: "+C.warnings.join(", "),"error")}catch(t){console.error("Error applying workout modification:",t),Q.showStatus("Error applying modifications","error")}}showSubstitutionOptions(e){const t=As.getWorkoutSubstitutions(e);if(t.length===0){Q.showStatus("No suitable workout substitutions found","info");return}const n=document.querySelector(".custom-adjustments");if(!n)return;const i=document.querySelector(".substitution-options");i&&i.remove();const r=document.createElement("div");r.className="substitution-options",r.innerHTML=`
      <h5>Workout Substitutions</h5>
      <div class="substitution-list">
        ${t.map(o=>`
          <button class="substitution-option" data-workout-type="${o.type}" data-workout-tag="${o.tag}">
            <div class="sub-type">${o.type}</div>
            <div class="sub-description">${o.description}</div>
            <div class="sub-stats">${o.durationMin}min â€¢ ${o.fatigueScore}/100</div>
          </button>
        `).join("")}
      </div>
    `,n.appendChild(r),r.querySelectorAll(".substitution-option").forEach(o=>{o.addEventListener("click",()=>{const l=o.dataset.workoutType;l&&(document.getElementById("workout-type-select").value=l)})})}applyPlanAdjustment(e){this.currentPlan&&(this.currentPlan.plan=e.adjustedPlan,this.planModifications.push(...e.modifications),this.displayWorkoutCalendar(),e.warnings.length>0&&console.warn("Plan adjustment warnings:",e.warnings),e.recommendations.length>0&&console.info("Plan adjustment recommendations:",e.recommendations),this.showAdjustmentImpact(e.impactSummary))}showAdjustmentImpact(e){if(e.daysAffected>1){const t=`Plan adjusted: ${e.daysAffected} days affected, load change: ${e.totalLoadChange>0?"+":""}${e.totalLoadChange}`;Q.showStatus(t,"info")}}getModificationIndicator(e){return this.planModifications.filter(n=>n.date===e).length===0?"":'<div class="modification-indicator" title="This workout has been modified">ðŸ“</div>'}closeModificationModal(){const e=document.getElementById("workout-modification-modal");e&&e.remove()}showSection(){const e=document.getElementById("trainingPlanSection");e&&(e.style.display="block")}hideSection(){const e=document.getElementById("trainingPlanSection");e&&(e.style.display="none")}async getAIRecommendation(){if(!this.aiInsightsEnabled){Q.showStatus("AI insights are disabled","info");return}try{Q.showStatus("Getting AI recommendations for your training plan...","info");const e=await Qt.getTomorrowWorkoutRecommendation("current-user"),t=await Qt.getCurrentFatigueAssessment("current-user");e.success&&e.data?this.displayAIRecommendation(e.data,t.data):Q.showStatus("Unable to generate AI recommendation","warning")}catch(e){console.error("Error getting AI recommendation:",e),Q.showStatus("Failed to get AI recommendation","error")}}displayAIRecommendation(e,t){var i;let n=document.getElementById("ai-recommendations-section");if(!n){n=document.createElement("div"),n.id="ai-recommendations-section",n.className="ai-recommendations-panel";const r=document.querySelector(".plan-generation-form");(i=r==null?void 0:r.parentNode)==null||i.insertBefore(n,r.nextSibling)}n.innerHTML=`
      <div class="ai-panel-header">
        <h3>ðŸ¤– AI Training Insights</h3>
        <button id="close-ai-panel" class="close-btn">&times;</button>
      </div>
      
      <div class="ai-insights">
        <div class="insight-card recommendation-card">
          <h4>Tomorrow's Recommended Workout</h4>
          <div class="workout-recommendation">
            <div class="workout-type">${e.recommendedWorkout.type}</div>
            <div class="workout-description">${e.recommendedWorkout.description}</div>
            <div class="workout-stats">
              <span class="duration">${e.recommendedWorkout.durationMin} min</span>
              <span class="intensity">Intensity: ${e.recommendedWorkout.fatigueScore}/100</span>
            </div>
            <div class="confidence">Confidence: ${e.confidence}%</div>
          </div>
          
          ${e.reasoning&&e.reasoning.length>0?`
            <div class="reasoning">
              <h5>Why this workout?</h5>
              <ul>
                ${e.reasoning.map(r=>`<li>${r}</li>`).join("")}
              </ul>
            </div>
          `:""}
          
          ${e.alternatives&&e.alternatives.length>0?`
            <div class="alternatives">
              <h5>Alternative Options</h5>
              <div class="alternative-workouts">
                ${e.alternatives.map(r=>`
                  <div class="alternative-workout">
                    <div class="alt-type">${r.type}</div>
                    <div class="alt-description">${r.description}</div>
                    <div class="alt-stats">${r.durationMin}min â€¢ ${r.fatigueScore}/100</div>
                  </div>
                `).join("")}
              </div>
            </div>
          `:""}
        </div>

        ${t?`
          <div class="insight-card fatigue-card">
            <h4>Fatigue Assessment</h4>
            <div class="fatigue-status status-${t.overallStatus}">
              <div class="status-indicator">${this.getFatigueEmoji(t.overallStatus)}</div>
              <div class="status-text">Status: ${t.overallStatus}</div>
              <div class="risk-level">Risk Level: ${t.riskLevel}</div>
            </div>
            
            <div class="recommendation">
              <strong>Recommendation:</strong> ${this.getRecommendationText(t.recommendation)}
            </div>
            
            ${t.indicators&&t.indicators.length>0?`
              <div class="indicators">
                <h5>Key Indicators</h5>
                <div class="indicator-list">
                  ${t.indicators.filter(r=>r.status!=="normal").map(r=>`
                      <div class="indicator ${r.status}">
                        <span class="metric">${r.metric}</span>
                        <span class="description">${r.description}</span>
                      </div>
                    `).join("")}
                </div>
              </div>
            `:""}
          </div>
        `:""}

        <div class="ai-actions">
          <button class="btn btn-primary" id="apply-ai-recommendation">
            Apply AI Recommendation to Plan
          </button>
          <button class="btn btn-secondary" id="get-weekly-plan">
            Generate AI Weekly Plan
          </button>
        </div>
      </div>
    `,this.attachAIEventListeners(e),n.scrollIntoView({behavior:"smooth"})}attachAIEventListeners(e){const t=document.getElementById("close-ai-panel");t==null||t.addEventListener("click",()=>{const r=document.getElementById("ai-recommendations-section");r==null||r.remove()});const n=document.getElementById("apply-ai-recommendation");n==null||n.addEventListener("click",()=>{this.applyAIRecommendation(e)});const i=document.getElementById("get-weekly-plan");i==null||i.addEventListener("click",()=>{this.generateAIWeeklyPlan()})}async applyAIRecommendation(e){if(!this.currentPlan){Q.showStatus("Please generate a base plan first","warning");return}try{const t=new Date;t.setDate(t.getDate()+1);const n=t.toISOString().split("T")[0],i=this.currentPlan.plan.find(r=>r.date===n);if(i){const r={date:n,workoutType:e.recommendedWorkout.type,description:`${e.recommendedWorkout.description} (AI recommended)`,expectedFatigue:e.recommendedWorkout.fatigueScore,durationMin:e.recommendedWorkout.durationMin,completed:!1},a=this.currentPlan.plan.findIndex(o=>o.date===n);a>=0&&(this.currentPlan.plan[a]=r,this.planModifications.push({date:n,type:"change-workout-type",reason:"Applied AI recommendation",originalWorkout:i,newWorkout:r,timestamp:new Date().toISOString()}),this.displayWorkoutCalendar(),Q.showStatus("AI recommendation applied to tomorrow's workout","success"))}else Q.showStatus("No workout found for tomorrow to replace","warning")}catch(t){console.error("Error applying AI recommendation:",t),Q.showStatus("Failed to apply AI recommendation","error")}}async generateAIWeeklyPlan(){try{Q.showStatus("Generating AI-optimized weekly plan...","info"),Q.showStatus("AI weekly plan generation coming soon! Apply single recommendations for now.","info")}catch(e){console.error("Error generating AI weekly plan:",e),Q.showStatus("Failed to generate AI weekly plan","error")}}getFatigueEmoji(e){switch(e){case"fresh":return"âœ¨";case"normal":return"ðŸ‘";case"fatigued":return"ðŸ˜´";case"overtrained":return"âš ï¸";default:return"â“"}}getRecommendationText(e){switch(e){case"full-training":return"Full training load recommended";case"active-recovery":return"Active recovery recommended";case"rest":return"Rest day recommended";case"medical-attention":return"Consider medical consultation";default:return"Continue with planned training"}}setAIEnabled(e){this.aiInsightsEnabled=e;const t=document.getElementById("ai-recommend-btn");if(t&&(t.disabled=!e,t.title=e?"Get AI workout recommendation":"AI features disabled"),!e){const n=document.getElementById("ai-recommendations-section");n==null||n.remove()}}isAIEnabled(){return this.aiInsightsEnabled}async savePlanToStorage(){if(!this.currentPlan){console.warn("No current plan to save");return}try{if(!Gt.isAuthenticated()){console.log("User not authenticated, plan will only be stored locally");return}const e=this.generatePlanName(),t=await Gt.saveTrainingPlan(this.currentPlan,e);await Gt.setActivePlan(t),console.log(`Plan saved with ID: ${t}`)}catch(e){console.error("Error saving plan:",e),Q.showStatus("Plan generated but saving failed. It will be available this session only.","warning")}}async loadSavedPlan(){try{if(!Gt.isAuthenticated())return;const e=await Gt.getActivePlan();e&&this.isPlanStillRelevant(e)&&(this.loadPlanFromStorage(e),Q.showStatus("Loaded your saved training plan","info"))}catch(e){console.error("Error loading saved plan:",e)}}loadPlanFromStorage(e){this.currentPlan={plan:e.plan,readinessMetrics:e.readinessMetrics,recommendations:e.recommendations,warnings:e.warnings,generatedAt:e.generatedAt},this.displayGeneratedPlan();const t=document.getElementById("generatedPlanSection");if(t&&(t.style.display="block",!document.getElementById("loaded-plan-indicator"))){const i=document.createElement("div");i.id="loaded-plan-indicator",i.className="alert alert-info",i.innerHTML=`
          <span>ðŸ“‹</span> <strong>${e.name}</strong> - Generated ${new Date(e.generatedAt).toLocaleDateString()}
          <button class="btn btn-ghost btn-small" id="load-different-plan">Load Different Plan</button>
        `;const r=t.querySelector(".plan-header");r&&t.insertBefore(i,r.nextSibling);const a=document.getElementById("load-different-plan");a==null||a.addEventListener("click",()=>this.showPlanSelectionModal())}}isPlanStillRelevant(e){const t=new Date().toISOString().split("T")[0];return e.endDate>=t}generatePlanName(){var r;if(!this.currentPlan)return"Training Plan";const e=(r=this.currentPlan.plan[0])==null?void 0:r.date,t=this.currentPlan.plan.length,n=this.getTopWorkoutTypes();let i=`${t}-Day Plan`;if(n.length>0&&(i+=` (${n.slice(0,2).join(", ")})`),e){const a=new Date(e);i+=` - ${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`}return i}getTopWorkoutTypes(){if(!this.currentPlan)return[];const e=this.currentPlan.plan.reduce((t,n)=>(t[n.workoutType]=(t[n.workoutType]||0)+1,t),{});return Object.entries(e).sort(([,t],[,n])=>n-t).map(([t])=>t)}async showPlanSelectionModal(){try{const e=await Gt.getStoredTrainingPlans();if(e.length===0){Q.showStatus("No saved plans found","info");return}this.createPlanSelectionModal(e)}catch(e){console.error("Error loading saved plans:",e),Q.showStatus("Error loading saved plans","error")}}createPlanSelectionModal(e){const t=document.getElementById("plan-selection-modal");t==null||t.remove();const n=document.createElement("div");n.id="plan-selection-modal",n.className="modal-overlay",n.innerHTML=`
      <div class="modal-content">
        <div class="modal-header">
          <h3>Select Training Plan</h3>
          <button class="btn btn-ghost close-modal-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="plans-list">
            ${e.map(i=>`
              <div class="plan-item" data-plan-id="${i.id}">
                <div class="plan-info">
                  <h4>${i.name}</h4>
                  <p class="plan-details">
                    ${i.plan.length} days â€¢ ${i.startDate} to ${i.endDate}
                    ${i.isActive?'<span class="active-badge">Active</span>':""}
                  </p>
                  <p class="plan-summary">${i.recommendations.slice(0,2).join(", ")}</p>
                </div>
                <div class="plan-actions">
                  <button class="btn btn-primary load-plan-btn" data-plan-id="${i.id}">Load Plan</button>
                  <button class="btn btn-danger delete-plan-btn" data-plan-id="${i.id}">Delete</button>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary close-modal-btn">Close</button>
        </div>
      </div>
    `,document.body.appendChild(n),n.style.display="flex",this.attachPlanSelectionEventListeners(e)}attachPlanSelectionEventListeners(e){document.querySelectorAll("#plan-selection-modal .close-modal-btn").forEach(a=>{a.addEventListener("click",()=>{var o;(o=document.getElementById("plan-selection-modal"))==null||o.remove()})}),document.querySelectorAll(".load-plan-btn").forEach(a=>{a.addEventListener("click",async o=>{var u;const l=o.target.dataset.planId;if(l){const d=e.find(p=>p.id===l);d&&(await Gt.setActivePlan(l),this.loadPlanFromStorage(d),(u=document.getElementById("plan-selection-modal"))==null||u.remove(),Q.showStatus(`Loaded plan: ${d.name}`,"success"))}})}),document.querySelectorAll(".delete-plan-btn").forEach(a=>{a.addEventListener("click",async o=>{const l=o.target.dataset.planId;if(l&&confirm("Are you sure you want to delete this training plan?"))try{await Gt.deleteTrainingPlan(l);const u=document.querySelector(`[data-plan-id="${l}"]`);u==null||u.remove(),Q.showStatus("Plan deleted successfully","success")}catch(u){console.error("Error deleting plan:",u),Q.showStatus("Error deleting plan","error")}})});const r=document.getElementById("plan-selection-modal");r==null||r.addEventListener("click",a=>{a.target===r&&r.remove()})}async showSavedPlans(){await this.showPlanSelectionModal()}notifyWorkoutCalendarUpdate(){const e=new CustomEvent("workouts-updated",{detail:{source:"plan-generation",timestamp:new Date().toISOString()}});document.dispatchEvent(e),window.dispatchEvent(new Event("recovery-metrics-updated"))}clearCurrentPlan(){this.currentPlan=null,this.planModifications=[];const e=document.getElementById("generatedPlanSection");e&&(e.style.display="none");const t=document.getElementById("loaded-plan-indicator");t==null||t.remove(),Q.showStatus("Cleared current plan","info")}}async function ik(){var e,t,n,i;const s=xe.getCurrentUserId();if(!s){console.error("âŒ User not authenticated, cannot create sample data");return}console.log("ðŸ—ï¸ Creating sample workout data...");try{const r={activityId:"sample-activity-12345",sport:"run",date:new Date().toISOString().split("T")[0],startTime:new Date,durationMin:45,distanceKm:8.5,avgHR:155,maxHR:175,avgPace:"5:18",avgPower:void 0,maxPower:void 0,ascentM:120,descentM:115,calories:450,avgCadence:170,avgSpeed:11.3,zones:[{zone:1,minutes:5,timeMin:5},{zone:2,minutes:15,timeMin:15},{zone:3,minutes:18,timeMin:18},{zone:4,minutes:6,timeMin:6},{zone:5,minutes:1,timeMin:1}],trainingLoad:85,rawData:{sample:!0,created:new Date().toISOString()}},a=await _i.handleUnplannedWorkout(s,r);console.log("âœ… Created sample workout:",a),console.log("ðŸŽ¯ Workout details:"),console.log(`   Name: ${a.name}`),console.log(`   Date: ${a.date}`),console.log(`   Sport: ${a.sport}`),console.log(`   Duration: ${(e=a.actual)==null?void 0:e.durationMin} min`),console.log(`   Distance: ${(t=a.actual)==null?void 0:t.distanceKm} km`),console.log(`   Avg HR: ${(n=a.actual)==null?void 0:n.avgHR} bpm`),console.log(`   Training Load: ${(i=a.actual)==null?void 0:i.trainingLoad}`),document.dispatchEvent(new CustomEvent("workouts-updated")),console.log("ðŸ”„ Components should refresh automatically with new data")}catch(r){console.error("âŒ Failed to create sample workout:",r)}}class Xd{constructor(e){this.recentWorkouts=[],this.container=e,this.initialize()}async initialize(){await this.loadRecentWorkouts(),this.render(),this.setupEventListeners()}async loadRecentWorkouts(){try{const e=xe.getCurrentUserId();if(!e){console.log("User not authenticated, cannot load recent workouts");return}console.log("ðŸ“Š Loading recent workouts...");const n=(await _i.getUserWorkouts(e,50)).filter(i=>(i.status==="completed"||i.status==="unplanned")&&i.actual);n.length>0?(n.sort((i,r)=>{var l,u;const a=((l=i.actual)==null?void 0:l.processedAt)||i.updatedAt;return(((u=r.actual)==null?void 0:u.processedAt)||r.updatedAt).getTime()-a.getTime()}),this.recentWorkouts=n.slice(0,3),console.log(`âœ… Found ${this.recentWorkouts.length} recent workouts`)):(console.log("ðŸ“Š No recent completed workouts found"),this.recentWorkouts=[])}catch(e){console.error("âŒ Error loading recent workouts:",e),this.recentWorkouts=[]}}render(){if(!this.recentWorkouts||this.recentWorkouts.length===0){this.showEmptyState();return}const e=this.recentWorkouts.map(t=>this.renderSingleWorkout(t)).join("");this.container.innerHTML=`
      <div class="recent-workouts-container">
        <div class="recent-workouts-header">
          <h3 class="section-title">
            <span class="section-icon">ðŸ“Š</span>
            Recent Workouts (${this.recentWorkouts.length})
          </h3>
          <button class="btn btn-ghost refresh-btn" id="refresh-recent-workout" aria-label="Refresh recent workouts">
            <span aria-hidden="true">ðŸ”„</span>
          </button>
        </div>
        <div class="recent-workouts-list">
          ${e}
        </div>
      </div>
    `,this.container.dispatchEvent(new CustomEvent("recent-workouts-rendered",{detail:{workouts:this.recentWorkouts}}))}renderSingleWorkout(e){const t=e.actual;if(!t)return console.warn("No actual workout data available"),"";const n=t.processedAt?new Date(t.processedAt):new Date(e.updatedAt);return`
      <div class="recent-workout-card">
        <div class="workout-header">
          <div class="workout-title">
            <div class="sport-icon">${this.getSportIcon(e.sport)}</div>
            <div class="workout-info">
              <h4 class="workout-name">${e.name}</h4>
              <div class="workout-metadata">
                <span class="workout-date">${new Date(e.date).toLocaleDateString()}</span>
                <span class="status-badge ${e.status}">${this.getStatusLabel(e.status)}</span>
                <span class="upload-time">Uploaded ${this.formatTimeAgo(n)}</span>
              </div>
            </div>
          </div>
          <button class="btn btn-ghost refresh-btn" id="refresh-recent-workout" aria-label="Refresh recent workout">
            <span aria-hidden="true">ðŸ”„</span>
          </button>
        </div>

        <div class="workout-content">
          <!-- Main Performance Metrics -->
          <div class="performance-overview">
            <div class="primary-metrics">
              ${t.durationMin?`
                <div class="metric-large">
                  <div class="metric-icon">â±ï¸</div>
                  <div class="metric-details">
                    <div class="metric-value">${t.durationMin}</div>
                    <div class="metric-label">Minutes</div>
                  </div>
                </div>
              `:""}
              
              ${t.distanceKm?`
                <div class="metric-large">
                  <div class="metric-icon">ðŸ“</div>
                  <div class="metric-details">
                    <div class="metric-value">${t.distanceKm.toFixed(2)}</div>
                    <div class="metric-label">Kilometers</div>
                  </div>
                </div>
              `:""}
              
              ${t.avgHR?`
                <div class="metric-large">
                  <div class="metric-icon">ðŸ’—</div>
                  <div class="metric-details">
                    <div class="metric-value">${t.avgHR}</div>
                    <div class="metric-label">Avg HR</div>
                  </div>
                </div>
              `:""}
              
              ${t.trainingLoad?`
                <div class="metric-large">
                  <div class="metric-icon">âš¡</div>
                  <div class="metric-details">
                    <div class="metric-value">${t.trainingLoad}</div>
                    <div class="metric-label">Training Load</div>
                  </div>
                </div>
              `:""}
            </div>
          </div>

          <!-- Secondary Metrics Grid -->
          <div class="secondary-metrics">
            ${t.maxHR?`
              <div class="metric-item">
                <span class="metric-label">Max HR</span>
                <span class="metric-value">${t.maxHR} bpm</span>
              </div>
            `:""}
            
            ${t.avgPace?`
              <div class="metric-item">
                <span class="metric-label">Avg Pace</span>
                <span class="metric-value">${t.avgPace}</span>
              </div>
            `:""}
            
            ${t.avgPower?`
              <div class="metric-item">
                <span class="metric-label">Avg Power</span>
                <span class="metric-value">${t.avgPower}W</span>
              </div>
            `:""}
            
            ${t.maxPower?`
              <div class="metric-item">
                <span class="metric-label">Max Power</span>
                <span class="metric-value">${t.maxPower}W</span>
              </div>
            `:""}
            
            ${t.calories?`
              <div class="metric-item">
                <span class="metric-label">Calories</span>
                <span class="metric-value">${t.calories}</span>
              </div>
            `:""}
            
            ${t.avgCadence?`
              <div class="metric-item">
                <span class="metric-label">Avg Cadence</span>
                <span class="metric-value">${t.avgCadence} rpm</span>
              </div>
            `:""}
            
            ${t.avgSpeed?`
              <div class="metric-item">
                <span class="metric-label">Avg Speed</span>
                <span class="metric-value">${t.avgSpeed.toFixed(1)} km/h</span>
              </div>
            `:""}
            
            ${t.ascentM?`
              <div class="metric-item">
                <span class="metric-label">Elevation Gain</span>
                <span class="metric-value">â†—${t.ascentM}m</span>
              </div>
            `:""}
            
            ${t.descentM?`
              <div class="metric-item">
                <span class="metric-label">Elevation Loss</span>
                <span class="metric-value">â†˜${t.descentM}m</span>
              </div>
            `:""}
          </div>

          <!-- HR Zones (if available) -->
          ${t.zones&&t.zones.length>0?`
            <div class="hr-zones-section">
              <h5 class="section-title">
                <span class="section-icon">â¤ï¸</span>
                Heart Rate Zones
              </h5>
              <div class="zones-display">
                ${t.zones.map((i,r)=>{const a=this.getZoneTime(i),o=this.calculateZonePercentage(a,t.durationMin||0);return`
                    <div class="zone-item zone-${r+1}">
                      <div class="zone-header">
                        <span class="zone-label">Z${r+1}</span>
                        <span class="zone-percentage">${o}%</span>
                      </div>
                      <div class="zone-bar">
                        <div class="zone-fill" style="width: ${o}%"></div>
                      </div>
                      <div class="zone-time">${Math.round(a)} min</div>
                    </div>
                  `}).join("")}
              </div>
            </div>
          `:""}

          <!-- Planned vs Actual Comparison (if available) -->
          ${e.planned&&this.hasComparison(e)?`
            <div class="comparison-section">
              <h5 class="section-title">
                <span class="section-icon">âš–ï¸</span>
                Planned vs Actual
              </h5>
              <div class="comparison-grid">
                ${e.planned.durationMin&&t.durationMin?this.renderComparison("Duration",e.planned.durationMin,t.durationMin,"min"):""}
                ${e.planned.distanceKm&&t.distanceKm?this.renderComparison("Distance",e.planned.distanceKm,t.distanceKm,"km",1):""}
              </div>
            </div>
          `:""}

          <!-- Data Source Info -->
          <div class="data-source-info">
            <div class="source-details">
              <span class="source-label">Data Source:</span>
              <span class="source-value">${t.dataSource||"Unknown"}</span>
              <span class="upload-details">â€¢ Processed ${n.toLocaleDateString()} at ${n.toLocaleTimeString()}</span>
            </div>
          </div>
        </div>
      </div>
    `}showEmptyState(){this.container.innerHTML=`
      <div class="recent-workout-empty">
        <div class="empty-state">
          <div class="empty-icon">ðŸ“Š</div>
          <h4>No Recent Workouts</h4>
          <p>Upload your first FIT file or connect Strava to see detailed workout information here.</p>
          <div class="empty-actions">
            <button class="btn btn-secondary" id="go-to-import">
              <span aria-hidden="true">ðŸ“</span> Import Workout Data
            </button>
            
          </div>
        </div>
      </div>
    `}setupEventListeners(){const e=this.container.querySelector("#refresh-recent-workout");e==null||e.addEventListener("click",()=>{this.refresh()});const t=this.container.querySelector("#go-to-import");t==null||t.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("show-import-modal"))});const n=this.container.querySelector("#create-sample-data");n==null||n.addEventListener("click",async()=>{console.log("ðŸ§ª Creating sample workout data...");try{await ik()}catch(i){console.error("âŒ Failed to create sample data:",i)}})}hasComparison(e){return!!(e.planned&&e.actual&&(e.planned.durationMin||e.planned.distanceKm))}renderComparison(e,t,n,i,r=0){const o=(n-t)/t*100,l=o>10,u=o<-10;return`
      <div class="comparison-item ${l?"over":u?"under":"on-target"}">
        <div class="comparison-label">${e}</div>
        <div class="comparison-values">
          <span class="planned-value">${t.toFixed(r)}${i}</span>
          <span class="comparison-arrow">â†’</span>
          <span class="actual-value">${n.toFixed(r)}${i}</span>
        </div>
        <div class="comparison-diff">
          ${o>0?"+":""}${o.toFixed(1)}%
        </div>
      </div>
    `}calculateZonePercentage(e,t){return t===0?0:Math.round(e/t*100)}getZoneTime(e){return e.timeMin||e.minutes||e.time||0}getSportIcon(e){return{run:"ðŸƒ",bike:"ðŸš´",swim:"ðŸŠ",strength:"ðŸ’ª",yoga:"ðŸ§˜",other:"âš½"}[e]||"âš½"}getStatusLabel(e){return{completed:"Completed",unplanned:"Unplanned",planned:"Planned",missed:"Missed"}[e]||e}formatTimeAgo(e){const n=new Date().getTime()-e.getTime(),i=Math.floor(n/(1e3*60*60)),r=Math.floor(i/24);return i<1?"just now":i<24?`${i}h ago`:r===1?"yesterday":r<7?`${r}d ago`:e.toLocaleDateString()}async refresh(){const e=this.container.querySelector("#refresh-recent-workout");e&&e.classList.add("loading"),await this.loadRecentWorkouts(),this.render(),e&&e.classList.remove("loading")}getRecentWorkouts(){return this.recentWorkouts}}const Mt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class Jt{constructor(){this.config=null,this.initializeDefaultConfig()}initializeDefaultConfig(){const e=(Mt==null?void 0:Mt.VITE_STRAVA_CLIENT_ID)||"",t=(Mt==null?void 0:Mt.VITE_STRAVA_CLIENT_SECRET)||"";this.config={clientId:e,clientSecret:t,configured:!!(e&&t)},this.config.configured?console.log("âœ… Strava configuration initialized from environment variables"):(console.warn("âš ï¸ Strava configuration not found in environment variables"),console.log("Please set VITE_STRAVA_CLIENT_ID and VITE_STRAVA_CLIENT_SECRET in your .env file"))}static getInstance(){return Jt.instance||(Jt.instance=new Jt),Jt.instance}configure(e,t){this.config={clientId:e.trim(),clientSecret:t.trim(),configured:!0},console.log("âœ… Strava configuration updated")}getConfig(){return this.config?{clientId:this.config.clientId,configured:this.config.configured}:null}getClientSecret(){var e;return((e=this.config)==null?void 0:e.clientSecret)||""}isConfigured(){var e;return((e=this.config)==null?void 0:e.configured)&&!!this.config.clientId&&!!this.config.clientSecret}clearConfig(){this.config=null,console.log("ðŸ§¹ Strava configuration cleared")}async loadFromStorage(){try{const e=localStorage.getItem("strava_config_encrypted");if(e){const t=JSON.parse(e),n=(Mt==null?void 0:Mt.VITE_STRAVA_CLIENT_ID)||"",i=(Mt==null?void 0:Mt.VITE_STRAVA_CLIENT_SECRET)||"";if(t.clientId!==n||t.clientSecret!==i)return this.configure(t.clientId,t.clientSecret),console.log("âœ… Custom Strava configuration loaded from storage"),!0}}catch(e){console.error("Error loading Strava config from storage:",e)}return console.log("ðŸ“‹ Using default Strava configuration"),!1}async saveToStorage(){try{if(!this.config)return!1;const e=JSON.stringify({clientId:this.config.clientId,clientSecret:this.config.clientSecret});return localStorage.setItem("strava_config_encrypted",e),!0}catch(e){return console.error("Error saving Strava config to storage:",e),!1}}}class _n{constructor(){this.config={clientId:"",clientSecret:"",redirectUri:window.location.origin,scope:"read,activity:read"},this.authState=null,this.loadConfiguration(),this.initializeAsync()}loadConfiguration(){const e=Jt.getInstance(),t=e.getConfig();this.config={clientId:(t==null?void 0:t.clientId)||"",clientSecret:e.getClientSecret(),redirectUri:window.location.origin,scope:"read,activity:read"}}async initializeAsync(){try{const t=await Jt.getInstance().loadFromStorage();t&&this.loadConfiguration(),console.log("ðŸ”§ Strava configuration initialized:",{hasClientId:!!this.config.clientId,hasClientSecret:!!this.config.clientSecret,redirectUri:this.config.redirectUri,scope:this.config.scope,loadedFromStorage:t})}catch(e){console.error("Error initializing Strava configuration:",e)}}static getInstance(){return _n.instance||(_n.instance=new _n),_n.instance}async initiateOAuthFlow(){if(!this.config.clientId)throw new Error("Strava client ID not configured");const e=this.generateRandomString(32);this.authState={state:e,redirectUri:this.config.redirectUri},localStorage.setItem("strava_auth_state",JSON.stringify(this.authState)),console.log("ðŸ”’ Stored auth state for validation:",e);const t=this.buildAuthorizationUrl(e);window.location.href=t}async handleOAuthCallback(e,t,n){const i=localStorage.getItem("strava_auth_state");if(console.log("ðŸ” Checking stored auth state:",{storedState:!!i,receivedState:t}),!i)throw new Error("No stored auth state found");const r=JSON.parse(i);if(console.log("ðŸ” Validating state:",{stored:r.state,received:t,match:r.state===t}),r.state!==t)throw new Error("Invalid state parameter - possible CSRF attack");localStorage.removeItem("strava_auth_state"),console.log("âœ… Auth state validated and cleared");const a=await this.exchangeCodeForTokens(e);return{isConnected:!0,athleteId:a.athlete.id,username:a.athlete.username,firstname:a.athlete.firstname,lastname:a.athlete.lastname,profileImageUrl:a.athlete.profile_medium,connectedAt:new Date,lastSyncAt:null,tokens:{accessToken:a.access_token,refreshToken:a.refresh_token,expiresAt:a.expires_at,expiresIn:a.expires_in,tokenType:a.token_type,scope:n},syncPreferences:{autoSync:!0,syncInterval:"daily",syncHistoryDays:30,activityTypes:["Ride","Run","Swim"],includePrivateActivities:!1,overwriteExisting:!1}}}async refreshAccessToken(e){const t=new URLSearchParams({client_id:this.config.clientId,client_secret:this.config.clientSecret,refresh_token:e,grant_type:"refresh_token"}),n=await fetch("https://www.strava.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()});if(!n.ok){const r=await n.text();let a=n.statusText;try{const o=JSON.parse(r);a=o.message||o.error_description||n.statusText}catch{a=r||n.statusText}throw new Error(`Token refresh failed: ${a}`)}const i=await n.json();return{accessToken:i.access_token,refreshToken:i.refresh_token,expiresAt:i.expires_at,expiresIn:i.expires_in,tokenType:i.token_type,scope:i.athlete?"":"read,activity:read"}}isTokenExpired(e){const t=Math.floor(Date.now()/1e3);return e.expiresAt<=t+300}async getValidAccessToken(e){if(!e.tokens)throw new Error("No tokens available in connection");if(this.isTokenExpired(e.tokens)){const t=await this.refreshAccessToken(e.tokens.refreshToken);e.tokens=t}return e.tokens.accessToken}async revokeAuthorization(e){try{const t=await fetch("https://www.strava.com/oauth/deauthorize",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});t.ok||console.warn("Failed to revoke Strava authorization:",t.statusText)}catch(t){console.warn("Error revoking Strava authorization:",t)}}buildAuthorizationUrl(e){return`https://www.strava.com/oauth/authorize?${new URLSearchParams({client_id:this.config.clientId,response_type:"code",redirect_uri:this.config.redirectUri,approval_prompt:"force",scope:this.config.scope,state:e}).toString()}`}async exchangeCodeForTokens(e){var r;console.log("ðŸ” Token exchange configuration:",{clientId:this.config.clientId,hasClientSecret:!!this.config.clientSecret,redirectUri:this.config.redirectUri,codeLength:e.length});const t=new URLSearchParams({client_id:this.config.clientId,client_secret:this.config.clientSecret,code:e,grant_type:"authorization_code"});console.log("ðŸ“¤ Sending token exchange request to Strava...");const n=await fetch("https://www.strava.com/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()});if(console.log("ðŸ“¥ Strava token response:",{status:n.status,statusText:n.statusText,ok:n.ok}),!n.ok){const a=await n.text();console.error("âŒ Strava token exchange error response:",a);let o=n.statusText;try{const l=JSON.parse(a);o=l.message||l.error_description||l.error||n.statusText,console.error("âŒ Parsed error details:",l)}catch{o=a||n.statusText}throw new Error(`Token exchange failed: ${o}`)}const i=await n.json();return console.log("âœ… Token exchange successful:",{hasAccessToken:!!i.access_token,hasRefreshToken:!!i.refresh_token,expiresAt:i.expires_at,athleteId:(r=i.athlete)==null?void 0:r.id}),i}generateRandomString(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=new Uint8Array(e);return crypto.getRandomValues(n),Array.from(n,i=>t[i%t.length]).join("")}updateConfig(e){this.config={...this.config,...e},this.loadConfiguration()}getConfig(){return{clientId:this.config.clientId,redirectUri:this.config.redirectUri,scope:this.config.scope}}}const sk={Ride:"cycling",VirtualRide:"cycling",EBikeRide:"cycling",Run:"running",TrailRun:"running",VirtualRun:"running",Walk:"walking",Hike:"hiking",Swim:"swimming",Workout:"strength_training",WeightTraining:"strength_training",Yoga:"yoga",Crossfit:"crossfit",Elliptical:"elliptical",StairStepper:"stair_stepper",Rowing:"rowing",Kayaking:"kayaking",Canoeing:"canoeing",Surfing:"surfing",Kitesurf:"kitesurfing",Windsurf:"windsurfing",Ski:"alpine_skiing",Snowboard:"snowboarding",NordicSki:"cross_country_skiing",IceSkate:"ice_skating",InlineSkate:"inline_skating",RockClimbing:"rock_climbing",Soccer:"soccer",Tennis:"tennis",Golf:"golf",Badminton:"badminton"};class oi{constructor(){}static getInstance(){return oi.instance||(oi.instance=new oi),oi.instance}mapStravaActivityToFirebase(e,t,n,i=60){const r=this.formatDateString(e.start_date_local),a=this.mapStravaTypeToSport(e.type,e.sport_type),o=Math.round(e.moving_time/60),l=Math.round(e.distance/1e3*100)/100,u=e.has_heartrate?this.calculateHRZones(e,n,o):this.getEmptyHRZones(),d=e.has_heartrate?this.calculateTrainingLoad(o,e.average_heartrate||0,i,200):0,p=e.average_speed?Math.round(e.average_speed*3.6*100)/100:void 0,m=e.max_speed?Math.round(e.max_speed*3.6*100)/100:void 0,w=this.isRunningActivity(a)&&p?Math.round(60/p*100)/100:void 0,E={id:`strava-${e.id}`,userId:t,date:r,sport:a,duration:o,distance:l,zone1Minutes:u.zone1Minutes,zone2Minutes:u.zone2Minutes,zone3Minutes:u.zone3Minutes,zone4Minutes:u.zone4Minutes,zone5Minutes:u.zone5Minutes,trainingLoad:d,stravaActivityId:e.id,dataSource:"strava",uploadedAt:new Date,processed:!0};return e.sport_type!==e.type&&e.sport_type&&(E.subSport=e.sport_type),e.average_heartrate&&(E.avgHR=e.average_heartrate),e.max_heartrate&&(E.maxHR=e.max_heartrate),this.calculateHRDrift(e)!==void 0&&(E.hrDrift=this.calculateHRDrift(e)),e.calories&&(E.calories=e.calories),e.total_elevation_gain&&(E.totalAscent=e.total_elevation_gain),p&&(E.avgSpeed=p),m&&(E.maxSpeed=m),w&&(E.avgPace=w),e.description&&e.description.trim()&&(E.notes=e.description.trim()),E}mapStravaLapsToFirebase(e,t,n){return e.map((i,r)=>({id:`${n}-lap-${i.lap_index||r+1}`,userId:t,activityId:n,lapNumber:i.lap_index||r+1,lapDuration:Math.round(i.moving_time/60),lapDistance:Math.round(i.distance/1e3*100)/100,avgHR:i.average_heartrate||void 0,maxHR:i.max_heartrate||void 0,avgSpeed:i.average_speed?Math.round(i.average_speed*3.6*100)/100:void 0,maxSpeed:i.max_speed?Math.round(i.max_speed*3.6*100)/100:void 0,avgPace:i.average_speed?Math.round(60/(i.average_speed*3.6)*100)/100:void 0,elevationGain:i.total_elevation_gain||void 0,elevationLoss:void 0,avgPower:i.average_watts||void 0,maxPower:void 0,normalizedPower:void 0,startTime:new Date(i.start_date),endTime:new Date(new Date(i.start_date).getTime()+i.elapsed_time*1e3),splitType:"auto"}))}mapStravaTypeToSport(e,t){return sk[t||e]||e.toLowerCase()}isRunningActivity(e){return["running","trail_running","walking","hiking"].includes(e)}formatDateString(e){const t=new Date(e);return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")}calculateHRZones(e,t,n){if(!e.has_heartrate||!e.average_heartrate)return this.getEmptyHRZones();const i=e.average_heartrate,r=this.getHRZoneForBPM(i,t),a=this.getEmptyHRZones();switch(r){case 1:a.zone1Minutes=Math.round(n*.8),a.zone2Minutes=Math.round(n*.2);break;case 2:a.zone1Minutes=Math.round(n*.2),a.zone2Minutes=Math.round(n*.6),a.zone3Minutes=Math.round(n*.2);break;case 3:a.zone2Minutes=Math.round(n*.2),a.zone3Minutes=Math.round(n*.6),a.zone4Minutes=Math.round(n*.2);break;case 4:a.zone3Minutes=Math.round(n*.2),a.zone4Minutes=Math.round(n*.6),a.zone5Minutes=Math.round(n*.2);break;case 5:a.zone4Minutes=Math.round(n*.3),a.zone5Minutes=Math.round(n*.7);break}return a}getEmptyHRZones(){return{zone1Minutes:0,zone2Minutes:0,zone3Minutes:0,zone4Minutes:0,zone5Minutes:0}}getHRZoneForBPM(e,t){return e>=t.zone5.min?5:e>=t.zone4.min?4:e>=t.zone3.min?3:e>=t.zone2.min?2:1}calculateHRDrift(e){!e.has_heartrate||e.average_heartrate}calculateTrainingLoad(e,t,n,i){if(!t||t<=n)return 0;const r=(t-n)/(i-n),a=e*r*Math.exp(1.92*r);return Math.round(a*10)/10}extractActivitySummary(e){const t=this.formatDuration(e.moving_time),n=(e.distance/1e3).toFixed(2)+" km";return{name:e.name,type:e.type,date:new Date(e.start_date_local).toLocaleDateString(),duration:t,distance:n,hasHeartRate:e.has_heartrate,isPrivate:e.private}}formatDuration(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60);return t>0?`${t}h ${n}m`:`${n}m`}createActivityMapping(e,t){return{stravaActivityId:e.id,firebaseActivityId:t,lastUpdated:new Date,syncStatus:"synced"}}}class Nn{constructor(){this.rateLimitStatus=null,this.requestQueue=[],this.isProcessingQueue=!1,this.authManager=_n.getInstance(),this.dataMapper=oi.getInstance(),this.config={baseUrl:"https://www.strava.com/api/v3",authUrl:"https://www.strava.com/oauth",tokenUrl:"https://www.strava.com/oauth/token",apiVersion:"v3",maxRetries:3,retryDelayMs:1e3,rateLimitBuffer:10}}static getInstance(){return Nn.instance||(Nn.instance=new Nn),Nn.instance}async getActivities(e,t={}){const n=await this.authManager.getValidAccessToken(e),i=new URLSearchParams({page:(t.page||1).toString(),per_page:(t.per_page||30).toString()});return t.before&&i.append("before",t.before.toString()),t.after&&i.append("after",t.after.toString()),await this.makeAuthenticatedRequest(`${this.config.baseUrl}/athlete/activities?${i.toString()}`,n)}async getActivity(e,t){const n=await this.authManager.getValidAccessToken(e);return await this.makeAuthenticatedRequest(`${this.config.baseUrl}/activities/${t}`,n)}async getAthleteProfile(e){const t=await this.authManager.getValidAccessToken(e);return await this.makeAuthenticatedRequest(`${this.config.baseUrl}/athlete`,t)}async syncRecentActivities(e,t,n){const i=e.syncPreferences,r=[],a=[];let o=1,l=!0,u=0;const d=e.lastSyncAt?Math.floor(e.lastSyncAt.getTime()/1e3):Math.floor((Date.now()-i.syncHistoryDays*24*60*60*1e3)/1e3);try{for(;l&&o<=10;){const m=await this.getActivities(e,{after:d,page:o,per_page:50});if(m.length===0){l=!1;break}const w=m.filter(E=>!(i.activityTypes.length>0&&!i.activityTypes.includes(E.type)||!i.includePrivateActivities&&E.private));r.push(...w),u+=w.length,n&&n({current:r.length,total:r.length+(m.length===50?50:0),activity:w[0]}),o++,m.length<50&&(l=!1),await this.waitForRateLimit()}}catch(m){a.push({activityId:0,error:`Sync failed: ${m instanceof Error?m.message:String(m)}`,timestamp:new Date,retryCount:0})}let p=0;if(r.length>0){console.log(`ðŸ“Š Saving ${r.length} Strava activities to Firebase...`);const m=await _i.getUserWorkouts(t,200);for(let w=0;w<r.length;w++){const E=r[w];try{if(m.some(I=>I.id===`strava-${E.id}`))console.log(`â­ï¸ Skipped: ${E.name} (already exists)`);else{const I={dataSource:"Strava",processedAt:new Date};E.moving_time&&(I.durationMin=Math.round(E.moving_time/60)),E.distance&&(I.distanceKm=Number((E.distance/1e3).toFixed(2))),E.average_heartrate&&(I.avgHR=E.average_heartrate),E.max_heartrate&&(I.maxHR=E.max_heartrate),E.average_speed&&(I.avgSpeed=Number((E.average_speed*3.6).toFixed(1))),E.average_watts&&(I.avgPower=E.average_watts),E.max_watts&&(I.maxPower=E.max_watts),E.average_cadence&&(I.avgCadence=E.average_cadence),E.total_elevation_gain&&(I.ascentM=E.total_elevation_gain),E.calories&&(I.calories=E.calories);const B=this.calculateSimpleTrainingLoad(E);B&&(I.trainingLoad=B);const G=this.calculatePace(E);G&&(I.avgPace=G);const Y={id:`strava-${E.id}`,userId:t,name:E.name,sport:this.mapStravaTypeToSport(E.type),date:new Date(E.start_date_local).toISOString().split("T")[0],status:"completed",source:"strava",createdAt:new Date,updatedAt:new Date,actual:I,metadata:{stravaActivityId:E.id,stravaActivityType:E.type,stravaURL:`https://www.strava.com/activities/${E.id}`,importedAt:new Date,originalStartDate:E.start_date,visibility:E.private?"private":"public"}};await _i.handleUnplannedWorkout({date:Y.date,sport:Y.sport,name:Y.name,source:Y.source,userId:Y.userId,actualWorkout:Y.actual},Y.metadata),p++,console.log(`âœ… Saved: ${E.name} (${new Date(E.start_date_local).toLocaleDateString()})`)}}catch(C){console.error(`âŒ Error saving activity ${E.id}:`,C),a.push({activityId:E.id,error:`Save failed: ${C instanceof Error?C.message:String(C)}`,timestamp:new Date,retryCount:0})}}}return console.log(`âœ… Strava sync complete: ${p} workouts saved, ${r.length} fetched, ${a.length} errors`),{activities:r,savedWorkouts:p,errors:a,newActivities:u,totalFetched:r.length}}async makeAuthenticatedRequest(e,t,n={}){return new Promise((i,r)=>{const a=async()=>{try{if(!this.canMakeRequest())throw new Error("Rate limit exceeded. Please wait before making more requests.");const o=await fetch(e,{...n,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json",...n.headers}});if(this.updateRateLimitStatus(o),!o.ok){if(o.status===429)throw new Error("Rate limit exceeded");if(o.status===401)throw new Error("Unauthorized - token may be expired or invalid");if(o.status===403)throw new Error("Forbidden - insufficient permissions");{const d=await o.json().catch(()=>({}));throw new Error(d.message||`HTTP ${o.status}: ${o.statusText}`)}}const l=await o.json();i(l)}catch(o){r(o)}};this.requestQueue.push(a),this.processQueue()})}async processQueue(){if(!(this.isProcessingQueue||this.requestQueue.length===0)){for(this.isProcessingQueue=!0;this.requestQueue.length>0;){const e=this.requestQueue.shift();if(e){try{await e()}catch(t){console.error("Request failed:",t)}await this.waitForRateLimit()}}this.isProcessingQueue=!1}}canMakeRequest(){if(!this.rateLimitStatus)return!0;const e=Math.floor(Date.now()/1e3),t=this.config.rateLimitBuffer/100,n=this.rateLimitStatus.fifteenMinute;if(n.usage>=n.limit*(1-t)&&e<n.resetTime)return!1;const i=this.rateLimitStatus.daily;return!(i.usage>=i.limit*(1-t))}async waitForRateLimit(){if(!this.rateLimitStatus){await new Promise(n=>setTimeout(n,200));return}const e=Math.floor(Date.now()/1e3),t=this.rateLimitStatus.fifteenMinute;if(t.usage>=t.limit-5){const n=Math.max(0,(t.resetTime-e)*1e3);n>0&&(console.log(`Waiting ${n}ms for Strava rate limit reset`),await new Promise(i=>setTimeout(i,n)))}else await new Promise(n=>setTimeout(n,200))}updateRateLimitStatus(e){const t=e.headers.get("X-RateLimit-Limit"),n=e.headers.get("X-RateLimit-Usage"),i=e.headers.get("X-ReadRateLimit-Limit"),r=e.headers.get("X-ReadRateLimit-Usage");if(t&&n){const[a,o]=n.split(",").map(Number),[l]=t.split(",").map(Number),[u,d]=(r==null?void 0:r.split(",").map(Number))||[0,2e3],[p]=(i==null?void 0:i.split(",").map(Number))||[2e3],m=new Date,w=m.getMinutes(),E=Math.ceil((w+1)/15)*15,C=new Date(m);C.setMinutes(E%60),C.setSeconds(0),C.setMilliseconds(0),E>=60&&C.setHours(C.getHours()+1),this.rateLimitStatus={fifteenMinute:{limit:l,usage:a,resetTime:Math.floor(C.getTime()/1e3)},daily:{limit:p,usage:u,resetTime:Math.floor(new Date().setHours(24,0,0,0)/1e3)},lastUpdated:Math.floor(Date.now()/1e3)}}}getRateLimitStatus(){return this.rateLimitStatus}async testConnection(e){try{return await this.getAthleteProfile(e),!0}catch(t){return console.error("Strava connection test failed:",t),!1}}updateConfig(e){this.config={...this.config,...e}}mapStravaTypeToSport(e){return{Run:"run",Ride:"bike",Swim:"swim",Walk:"run",Hike:"run",VirtualRun:"run",VirtualRide:"bike",Workout:"strength",WeightTraining:"strength",Crossfit:"strength",Yoga:"yoga"}[e]||"other"}calculateSimpleTrainingLoad(e){if(!e.average_heartrate||!e.moving_time)return;const t=e.average_heartrate,n=e.moving_time/60,i=60,a=(t-i)/(190-i);if(a<=0)return;const o=n*a*Math.exp(1.92*a);return Math.round(o)}calculatePace(e){if(!e.average_speed||!this.isRunningActivity(e.type))return;const t=e.average_speed*3.6;if(t<=0)return;const n=60/t,i=Math.floor(n),r=Math.round((n-i)*60);return`${i}:${r.toString().padStart(2,"0")}`}isRunningActivity(e){return["Run","VirtualRun","Walk","Hike"].includes(e)}}class rc{constructor(e,t){this.container=e,this.onConfigured=t}show(){console.log("ðŸ”§ StravaConfigurationModal.show() - Creating modal");const e=this.createModal();console.log("ðŸ”§ Modal created, adding to body"),document.body.appendChild(e),console.log("ðŸ”§ Modal styles after append:",{position:e.style.position,zIndex:e.style.zIndex,display:e.style.display,visibility:e.style.visibility,opacity:e.style.opacity}),console.log("ðŸ”§ Modal bounding rect:",e.getBoundingClientRect()),this.attachEventListeners(e),setTimeout(()=>{const t=e.querySelector("#strava-client-id");t==null||t.focus(),console.log("ðŸ”§ Focus attempted on input:",t)},100),console.log("ðŸ”§ StravaConfigurationModal.show() - Complete")}createModal(){const e=document.createElement("div");return e.className="strava-config-modal",e.style.cssText=`
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      z-index: 9999 !important;
      display: block !important;
      background-color: rgba(0, 0, 0, 0.8) !important;
      pointer-events: auto !important;
    `,e.innerHTML=`
      <div class="modal-overlay" style="
        position: absolute;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        display: flex !important;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      ">
        <div class="modal-content" style="
          background: white !important;
          border-radius: 12px;
          width: 100%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
          display: block !important;
        ">
          <div class="modal-header">
            <h3>ðŸ”§ Configure Strava API</h3>
            <button class="modal-close" id="close-config-modal" type="button">&times;</button>
          </div>
          
          <div class="modal-body">
            <div class="config-info">
              <div class="info-section">
                <h4>ðŸ“‹ Setup Instructions</h4>
                <ol>
                  <li>Go to <a href="https://www.strava.com/settings/api" target="_blank" rel="noopener">Strava API Settings</a></li>
                  <li>Create a new application or use an existing one</li>
                  <li>Set the <strong>Authorization Callback Domain</strong> to: <code>${window.location.origin}</code></li>
                  <li>Copy your <strong>Client ID</strong> and <strong>Client Secret</strong> below</li>
                </ol>
              </div>
              
              <div class="security-warning">
                <span class="warning-icon">âš ï¸</span>
                <div>
                  <strong>Security Notice:</strong> Your credentials are stored locally and encrypted. Never share your Client Secret publicly.
                </div>
              </div>
            </div>

            <form id="strava-config-form" class="config-form">
              <div class="form-group">
                <label for="strava-client-id">Client ID</label>
                <input 
                  type="text" 
                  id="strava-client-id" 
                  name="clientId"
                  placeholder="Your Strava Client ID"
                  required
                  autocomplete="off"
                >
                <small class="help-text">Found in your Strava API application settings</small>
              </div>

              <div class="form-group">
                <label for="strava-client-secret">Client Secret</label>
                <input 
                  type="password" 
                  id="strava-client-secret" 
                  name="clientSecret"
                  placeholder="Your Strava Client Secret"
                  required
                  autocomplete="off"
                >
                <small class="help-text">Keep this secret! Never share it publicly</small>
              </div>

              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="save-config" checked>
                  <span>Save configuration securely for future use</span>
                </label>
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn-secondary" id="cancel-config">Cancel</button>
            <button type="submit" form="strava-config-form" class="btn-primary" id="save-config-btn">
              ðŸ’¾ Save Configuration
            </button>
          </div>
        </div>
      </div>
    `,e}attachEventListeners(e){var u;const t=e.querySelector("#strava-config-form"),n=e.querySelector("#close-config-modal"),i=e.querySelector("#cancel-config"),r=e.querySelector("#save-config-btn"),a=()=>{e.remove()};n==null||n.addEventListener("click",a),i==null||i.addEventListener("click",a),(u=e.querySelector(".modal-overlay"))==null||u.addEventListener("click",d=>{d.target===e.querySelector(".modal-overlay")&&a()});const o=d=>{d.key==="Escape"&&(a(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o),t==null||t.addEventListener("submit",async d=>{d.preventDefault(),await this.handleConfigSave(e,t)}),e.querySelectorAll('input[type="text"], input[type="password"]').forEach(d=>{d.addEventListener("input",()=>{this.validateForm(t,r)})}),this.validateForm(t,r)}validateForm(e,t){const n=e.querySelector("#strava-client-id").value.trim(),i=e.querySelector("#strava-client-secret").value.trim(),r=n.length>0&&i.length>0;t.disabled=!r,t.style.opacity=r?"1":"0.6"}async handleConfigSave(e,t){console.log("ðŸ”§ Form submission started"),console.log("ðŸ”§ Form element:",t),console.log("ðŸ”§ Looking for save button with ID: save-config-btn");const n=new FormData(t),i=n.get("clientId").trim(),r=n.get("clientSecret").trim(),a=t.querySelector("#save-config").checked,o=e.querySelector("#save-config-btn");if(console.log("ðŸ”§ Save button found:",o),console.log("ðŸ”§ All buttons in form:",t.querySelectorAll("button")),console.log("ðŸ”§ All elements with save-config-btn:",document.querySelectorAll("#save-config-btn")),!o){console.error("âŒ Save button not found! Cannot proceed.");return}const l=o.innerHTML;try{o.disabled=!0,o.innerHTML="â³ Saving...";const u=Jt.getInstance();u.configure(i,r),a&&await u.saveToStorage(),_n.getInstance().updateConfig({}),o.innerHTML="âœ… Saved!",setTimeout(()=>{var p;e.remove(),(p=this.onConfigured)==null||p.call(this),this.showSuccessMessage()},1e3)}catch(u){console.error("Error saving Strava configuration:",u),o.innerHTML="âŒ Error",o.style.backgroundColor="#dc2626",setTimeout(()=>{o.disabled=!1,o.innerHTML=l,o.style.backgroundColor=""},2e3)}}showSuccessMessage(){const e=document.createElement("div");e.className="config-success-message",e.innerHTML=`
      <div class="success-content">
        <span class="success-icon">âœ…</span>
        <span>Strava configuration saved! You can now connect to Strava.</span>
      </div>
    `,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}static show(e){document.querySelectorAll(".strava-config-modal").forEach(n=>n.remove());try{const n=document.createElement("div");new rc(n,e).show()}catch(n){console.error("âŒ Error showing Strava configuration modal:",n)}}static isConfigurationNeeded(){return!Jt.getInstance().isConfigured()}}class Up{constructor(e,t){this.connection=null,this.container=e,this.authManager=_n.getInstance(),this.stravaService=Nn.getInstance(),this.userProfileService=Ye.getInstance(),this.onConnectionChange=t,this.initialize()}async initialize(){const e=this.userProfileService.getUserProfile();this.connection=(e==null?void 0:e.stravaConnection)||null;const t=new URLSearchParams(window.location.search),n=t.has("code")&&t.has("state")&&t.has("scope");console.log("ðŸ” Checking for OAuth callback:",{hasCode:t.has("code"),hasState:t.has("state"),hasScope:t.has("scope"),willHandle:n}),n&&await this.handleOAuthCallback(),this.render()}async handleOAuthCallback(){const e=new URLSearchParams(window.location.search),t=e.get("code"),n=e.get("state"),i=e.get("scope"),r=e.get("error");if(r){this.showError(`Strava authorization failed: ${r}`),window.history.replaceState({},document.title,window.location.pathname);return}if(t&&n&&i)try{this.showConnecting();const a=await this.authManager.handleOAuthCallback(t,n,i);if(!await this.stravaService.testConnection(a))throw new Error("Failed to validate Strava connection");await this.userProfileService.updateProfile({stravaConnection:a}),this.connection=a,this.showSuccess("Successfully connected to Strava!"),this.render(),this.onConnectionChange&&this.onConnectionChange(!0),window.history.replaceState({},document.title,window.location.pathname)}catch(a){console.error("Strava OAuth callback error:",a),this.showError(`Failed to connect to Strava: ${a instanceof Error?a.message:String(a)}`),window.history.replaceState({},document.title,window.location.pathname)}}render(){var e;(e=this.connection)!=null&&e.isConnected?this.renderConnectedState():this.renderDisconnectedState()}renderDisconnectedState(){this.container.innerHTML=`
      <div class="strava-connector">
        <div class="strava-info">
          <div class="strava-logo">
            <svg width="40" height="40" viewBox="0 0 432 432" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M157.5 0L157.5 216L216 324L274.5 216L274.5 0H216L157.5 0Z" fill="#FC4C02"/>
              <path d="M216 216L274.5 324L333 216H274.5L216 324L157.5 216H216Z" fill="#FC4C02"/>
            </svg>
          </div>
          <h3>Connect with Strava</h3>
          <p>Import your activities automatically from Strava to analyze your training data.</p>
          <ul class="benefits-list">
            <li>âœ“ Automatic activity import</li>
            <li>âœ“ Heart rate zone analysis</li>
            <li>âœ“ Training load calculations</li>
            <li>âœ“ Performance tracking</li>
          </ul>
        </div>
        
        <div class="strava-actions">
          <button id="connectStravaBtn" class="strava-connect-btn">
            <svg width="18" height="18" viewBox="0 0 432 432" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M157.5 0L157.5 216L216 324L274.5 216L274.5 0H216L157.5 0Z" fill="white"/>
              <path d="M216 216L274.5 324L333 216H274.5L216 324L157.5 216H216Z" fill="white"/>
            </svg>
            Connect with Strava
          </button>
          <div class="strava-disclaimer">
            <p>By connecting, you agree to Strava's data sharing terms. Your data will only be visible to you.</p>
          </div>
        </div>
        
        <div class="strava-branding">
          <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8dGV4dCB4PSIwIiB5PSIxOCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzc2NzY3NiI+UG93ZXJlZCBieSBTdHJhdmE8L3RleHQ+Cjwvc3ZnPg==" alt="Powered by Strava" class="powered-by-strava" />
        </div>
      </div>
    `,this.attachEventListeners()}renderConnectedState(){const e=this.connection,t=e.lastSyncAt?new Date(e.lastSyncAt).toLocaleDateString():"Never";this.container.innerHTML=`
      <div class="strava-connector connected">
        <div class="connection-status">
          <div class="status-header">
            <div class="athlete-info">
              ${e.profileImageUrl?`<img src="${e.profileImageUrl}" alt="Profile" class="athlete-avatar" />`:'<div class="athlete-avatar-placeholder"></div>'}
              <div class="athlete-details">
                <h4>${e.firstname} ${e.lastname}</h4>
                <p>@${e.username}</p>
              </div>
            </div>
            <div class="connection-badge">
              <span class="status-indicator connected"></span>
              Connected
            </div>
          </div>
          
          <div class="sync-info">
            <p><strong>Last sync:</strong> ${t}</p>
            <p><strong>Auto sync:</strong> ${e.syncPreferences.autoSync?"Enabled":"Disabled"}</p>
          </div>
        </div>

        <div class="strava-actions">
          <button id="syncStravaBtn" class="btn-primary">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
              <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
            </svg>
            Sync Now
          </button>
          <button id="settingsStravaBtn" class="btn-secondary">Settings</button>
          <button id="disconnectStravaBtn" class="btn-danger-outline">Disconnect</button>
        </div>

        <div class="rate-limit-info">
          <div class="rate-limit-indicator">
            <span class="rate-limit-label">API Usage</span>
            <div class="rate-limit-bar">
              <div class="rate-limit-fill" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="strava-branding">
          <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8dGV4dCB4PSIwIiB5PSIxOCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzc2NzY3NiI+UG93ZXJlZCBieSBTdHJhdmE8L3RleHQ+Cjwvc3ZnPg==" alt="Powered by Strava" class="powered-by-strava" />
        </div>
      </div>
    `,this.attachEventListeners(),this.updateRateLimitDisplay()}attachEventListeners(){const e=this.container.querySelector("#connectStravaBtn"),t=this.container.querySelector("#syncStravaBtn"),n=this.container.querySelector("#settingsStravaBtn"),i=this.container.querySelector("#disconnectStravaBtn");e&&e.addEventListener("click",()=>this.handleConnect()),t&&t.addEventListener("click",()=>this.handleSync()),n&&n.addEventListener("click",()=>this.showSettings()),i&&i.addEventListener("click",()=>this.handleDisconnect())}async handleConnect(){try{if(!Jt.getInstance().isConfigured()){console.log("ðŸ”§ Strava not configured, showing configuration modal"),rc.show(()=>{this.attemptConnection()});return}await this.attemptConnection()}catch(e){console.error("Strava connect error:",e),this.showError(`Failed to initiate Strava connection: ${e instanceof Error?e.message:String(e)}`)}}async attemptConnection(){this.showConnecting(),await this.authManager.initiateOAuthFlow()}async handleSync(){if(this.connection)try{this.showSyncing();const e=(await sl(async()=>{const{AuthService:n}=await Promise.resolve().then(()=>Vp);return{AuthService:n}},void 0)).AuthService.getCurrentUserId();if(!e)throw new Error("User ID not found. Please sign in again.");const t=await this.stravaService.syncRecentActivities(this.connection,e,n=>{this.updateSyncProgress(n.current,n.total)});this.connection.lastSyncAt=new Date,await this.userProfileService.updateProfile({stravaConnection:this.connection}),this.showSyncComplete(t.savedWorkouts,t.totalFetched),this.render(),document.dispatchEvent(new CustomEvent("workouts-updated"))}catch(e){console.error("Strava sync error:",e),this.showError(`Sync failed: ${e instanceof Error?e.message:String(e)}`)}}async handleDisconnect(){var t;if(!(!((t=this.connection)!=null&&t.tokens)||!confirm("Are you sure you want to disconnect from Strava? This will stop automatic activity imports.")))try{await this.authManager.revokeAuthorization(this.connection.tokens.accessToken),await this.userProfileService.updateProfile({stravaConnection:void 0}),this.connection=null,this.render(),this.onConnectionChange&&this.onConnectionChange(!1),this.showSuccess("Successfully disconnected from Strava")}catch(n){console.error("Strava disconnect error:",n),this.showError(`Failed to disconnect: ${n instanceof Error?n.message:String(n)}`)}}showSettings(){var t,n,i;if(!this.connection)return;const e=document.createElement("div");e.className="strava-settings-modal",e.innerHTML=`
      <div class="modal-content">
        <div class="modal-header">
          <h3>Strava Sync Settings</h3>
          <button class="modal-close" type="button">&times;</button>
        </div>
        <div class="modal-body">
          <div class="setting-group">
            <label>
              <input type="checkbox" id="autoSync" ${this.connection.syncPreferences.autoSync?"checked":""}>
              Enable automatic sync
            </label>
          </div>
          <div class="setting-group">
            <label for="syncInterval">Sync frequency:</label>
            <select id="syncInterval">
              <option value="manual" ${this.connection.syncPreferences.syncInterval==="manual"?"selected":""}>Manual only</option>
              <option value="hourly" ${this.connection.syncPreferences.syncInterval==="hourly"?"selected":""}>Every hour</option>
              <option value="daily" ${this.connection.syncPreferences.syncInterval==="daily"?"selected":""}>Daily</option>
              <option value="weekly" ${this.connection.syncPreferences.syncInterval==="weekly"?"selected":""}>Weekly</option>
            </select>
          </div>
          <div class="setting-group">
            <label for="syncHistoryDays">Days of history to sync:</label>
            <input type="number" id="syncHistoryDays" value="${this.connection.syncPreferences.syncHistoryDays}" min="1" max="90">
          </div>
          <div class="setting-group">
            <label>
              <input type="checkbox" id="includePrivate" ${this.connection.syncPreferences.includePrivateActivities?"checked":""}>
              Include private activities
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-primary" id="saveSettings">Save</button>
          <button class="btn-secondary" id="cancelSettings">Cancel</button>
        </div>
      </div>
    `,document.body.appendChild(e),(t=e.querySelector(".modal-close"))==null||t.addEventListener("click",()=>{document.body.removeChild(e)}),(n=e.querySelector("#cancelSettings"))==null||n.addEventListener("click",()=>{document.body.removeChild(e)}),(i=e.querySelector("#saveSettings"))==null||i.addEventListener("click",async()=>{await this.saveSettings(e),document.body.removeChild(e)})}async saveSettings(e){if(!this.connection)return;const t=e.querySelector("#autoSync").checked,n=e.querySelector("#syncInterval").value,i=parseInt(e.querySelector("#syncHistoryDays").value),r=e.querySelector("#includePrivate").checked;this.connection.syncPreferences={...this.connection.syncPreferences,autoSync:t,syncInterval:n,syncHistoryDays:i,includePrivateActivities:r},await this.userProfileService.updateProfile({stravaConnection:this.connection}),this.showSuccess("Settings saved successfully")}updateRateLimitDisplay(){const e=this.stravaService.getRateLimitStatus();if(!e)return;const t=this.container.querySelector(".rate-limit-fill");if(t){const n=e.fifteenMinute.usage/e.fifteenMinute.limit*100;t.style.width=`${Math.min(n,100)}%`,n>80?t.style.backgroundColor="#ff6b6b":n>60?t.style.backgroundColor="#ffd93d":t.style.backgroundColor="#6bcf7f"}}showConnecting(){this.showStatus("Connecting to Strava...","info")}showSyncing(){this.showStatus("Syncing activities from Strava...","info")}showSyncComplete(e,t){this.showStatus(`Sync complete! ${e} new workouts saved (${t} total fetched)`,"success")}showSuccess(e){this.showStatus(e,"success")}showError(e){this.showStatus(e,"error")}showStatus(e,t){const n=document.createElement("div");n.className=`status-message ${t}`,n.textContent=e,this.container.appendChild(n),setTimeout(()=>{n.parentNode===this.container&&this.container.removeChild(n)},5e3)}updateSyncProgress(e,t){const n=this.container.querySelector(".sync-progress");n&&(n.textContent=`Syncing: ${e}/${t} activities`)}}class rk{constructor(e,t){this.currentUser=null,this.userProfile=null,this.container=e,this.onAuthStateChanged=t,this.initialize()}async initialize(){try{if(this.currentUser=await xe.initialize(),this.currentUser){try{this.userProfile=await xe.getUserProfile()}catch(e){console.warn("Failed to get user profile, continuing without it:",e),this.userProfile=null}this.renderUserProfile()}else this.renderAuthForms();xe.addAuthStateListener(async e=>{if(this.currentUser=e,e){try{this.userProfile=await xe.getUserProfile()}catch(t){console.warn("Failed to get user profile in auth state change, continuing without it:",t),this.userProfile=null}this.renderUserProfile()}else this.userProfile=null,this.renderAuthForms();this.onAuthStateChanged(e,this.userProfile)})}catch(e){console.error("Failed to initialize AuthManager:",e),this.renderAuthForms()}}renderAuthForms(){this.container.innerHTML=`
      <div class="auth-container">
        <div class="auth-header">
          <h1>trAIn - Training Analytics</h1>
          <p>Sign in to access your personalized training dashboard</p>
        </div>

        <div class="auth-tabs">
          <button class="auth-tab active" data-tab="login">Sign In</button>
          <button class="auth-tab" data-tab="register">Sign Up</button>
        </div>

        <div class="auth-forms">
          <!-- Login Form -->
          <form id="loginForm" class="auth-form active">
            <div class="form-group">
              <label for="loginEmail">Email</label>
              <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="auth-btn">Sign In</button>
            <div class="auth-links">
              <button type="button" class="link-btn" id="forgotPasswordBtn">Forgot Password?</button>
            </div>
          </form>

          <!-- Register Form -->
          <form id="registerForm" class="auth-form">
            <div class="form-group">
              <label for="registerDisplayName">Display Name</label>
              <input type="text" id="registerDisplayName" required>
            </div>
            <div class="form-group">
              <label for="registerEmail">Email</label>
              <input type="email" id="registerEmail" required>
            </div>
            <div class="form-group">
              <label for="registerPassword">Password</label>
              <input type="password" id="registerPassword" required minlength="6">
            </div>
            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <input type="password" id="confirmPassword" required minlength="6">
            </div>
            <button type="submit" class="auth-btn">Create Account</button>
          </form>

          <!-- Password Reset Form -->
          <form id="resetPasswordForm" class="auth-form">
            <div class="form-group">
              <label for="resetEmail">Email</label>
              <input type="email" id="resetEmail" required>
            </div>
            <button type="submit" class="auth-btn">Send Reset Email</button>
            <div class="auth-links">
              <button type="button" class="link-btn" id="backToLoginBtn">Back to Sign In</button>
            </div>
          </form>
        </div>

        <div class="auth-status" id="authStatus"></div>
      </div>
    `,this.attachAuthEventListeners()}renderUserProfile(){var n,i,r,a,o;const e=((n=this.userProfile)==null?void 0:n.displayName)||((i=this.currentUser)==null?void 0:i.email)||"User",t=((r=this.currentUser)==null?void 0:r.email)||"";this.container.innerHTML=`
      <div class="user-profile">
        <div class="user-info">
          <div class="user-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="user-details">
            <h3>${e}</h3>
            <p>${t}</p>
          </div>
        </div>
        <div class="user-stats">
          <div class="stat">
            <span class="stat-value">${((a=this.userProfile)==null?void 0:a.stats.totalActivities)||0}</span>
            <span class="stat-label">Activities</span>
          </div>
          <div class="stat">
            <span class="stat-value">${Math.round((((o=this.userProfile)==null?void 0:o.stats.totalTrainingTime)||0)/60)}</span>
            <span class="stat-label">Hours</span>
          </div>
        </div>
        <div class="user-actions">
          <button class="profile-btn" id="editProfileBtn">Edit Profile</button>
          <button class="logout-btn" id="logoutBtn">Sign Out</button>
        </div>
      </div>
    `,this.attachUserProfileListeners()}attachAuthEventListeners(){const e=this.container.querySelectorAll(".auth-tab"),t=this.container.querySelectorAll(".auth-form");e.forEach(l=>{l.addEventListener("click",()=>{const u=l.dataset.tab;e.forEach(d=>d.classList.remove("active")),l.classList.add("active"),t.forEach(d=>{d.classList.remove("active"),d.id===`${u}Form`&&d.classList.add("active")})})});const n=this.container.querySelector("#loginForm");n==null||n.addEventListener("submit",async l=>{l.preventDefault(),await this.handleLogin()});const i=this.container.querySelector("#registerForm");i==null||i.addEventListener("submit",async l=>{l.preventDefault(),await this.handleRegister()});const r=this.container.querySelector("#resetPasswordForm");r==null||r.addEventListener("submit",async l=>{l.preventDefault(),await this.handlePasswordReset()});const a=this.container.querySelector("#forgotPasswordBtn");a==null||a.addEventListener("click",()=>{t.forEach(u=>u.classList.remove("active"));const l=this.container.querySelector("#resetPasswordForm");l==null||l.classList.add("active")});const o=this.container.querySelector("#backToLoginBtn");o==null||o.addEventListener("click",()=>{t.forEach(u=>u.classList.remove("active"));const l=this.container.querySelector("#loginForm");l==null||l.classList.add("active")})}attachUserProfileListeners(){const e=this.container.querySelector("#logoutBtn");e==null||e.addEventListener("click",async()=>{try{await xe.logout(),this.showStatus("Signed out successfully","success")}catch(n){this.showStatus(`Sign out failed: ${n.message}`,"error")}});const t=this.container.querySelector("#editProfileBtn");t==null||t.addEventListener("click",()=>{this.showEditProfileModal()})}async handleLogin(){const e=this.container.querySelector("#loginEmail").value,t=this.container.querySelector("#loginPassword").value;try{this.showStatus("Signing in...","info"),await xe.login(e,t),this.showStatus("Signed in successfully!","success")}catch(n){this.showStatus(`Sign in failed: ${n.message}`,"error")}}async handleRegister(){const e=this.container.querySelector("#registerDisplayName").value,t=this.container.querySelector("#registerEmail").value,n=this.container.querySelector("#registerPassword").value,i=this.container.querySelector("#confirmPassword").value;if(n!==i){this.showStatus("Passwords do not match","error");return}try{this.showStatus("Creating account...","info"),await xe.register(t,n,e),this.showStatus("Account created successfully!","success")}catch(r){this.showStatus(`Registration failed: ${r.message}`,"error")}}async handlePasswordReset(){const e=this.container.querySelector("#resetEmail").value;try{this.showStatus("Sending reset email...","info"),await xe.resetPassword(e),this.showStatus("Password reset email sent! Check your inbox.","success")}catch(t){this.showStatus(`Reset failed: ${t.message}`,"error")}}showEditProfileModal(){var r,a,o,l,u,d,p,m,w,E,C,I,B;const e=document.createElement("div");e.className="modal-overlay",e.innerHTML=`
      <div class="modal">
        <div class="modal-header">
          <h3>Edit Profile</h3>
          <button class="modal-close">&times;</button>
        </div>
        <form id="editProfileForm" class="modal-form">
          <div class="form-group">
            <label for="editDisplayName">Display Name</label>
            <input type="text" id="editDisplayName" value="${((r=this.userProfile)==null?void 0:r.displayName)||""}" required>
          </div>
          <div class="form-group">
            <label for="editTimezone">Timezone</label>
            <select id="editTimezone">
              <option value="${((o=(a=this.userProfile)==null?void 0:a.preferences)==null?void 0:o.timezone)||Intl.DateTimeFormat().resolvedOptions().timeZone}">
                ${((u=(l=this.userProfile)==null?void 0:l.preferences)==null?void 0:u.timezone)||Intl.DateTimeFormat().resolvedOptions().timeZone}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="editUnits">Units</label>
            <select id="editUnits">
              <option value="metric" ${((p=(d=this.userProfile)==null?void 0:d.preferences)==null?void 0:p.units)==="metric"?"selected":""}>Metric (km, kg)</option>
              <option value="imperial" ${((w=(m=this.userProfile)==null?void 0:m.preferences)==null?void 0:w.units)==="imperial"?"selected":""}>Imperial (miles, lbs)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editRestingHR">Resting Heart Rate</label>
            <input type="number" id="editRestingHR" value="${((C=(E=this.userProfile)==null?void 0:E.preferences)==null?void 0:C.restingHR)||60}" min="30" max="100">
          </div>
          <div class="form-group">
            <label for="editMaxHR">Maximum Heart Rate</label>
            <input type="number" id="editMaxHR" value="${((B=(I=this.userProfile)==null?void 0:I.preferences)==null?void 0:B.maxHR)||190}" min="150" max="220">
          </div>
          <div class="modal-actions">
            <button type="button" class="cancel-btn">Cancel</button>
            <button type="submit" class="save-btn">Save Changes</button>
          </div>
        </form>
      </div>
    `,document.body.appendChild(e);const t=e.querySelector(".modal-close"),n=e.querySelector(".cancel-btn");[t,n].forEach(G=>{G==null||G.addEventListener("click",()=>{document.body.removeChild(e)})}),e.querySelector("#editProfileForm").addEventListener("submit",async G=>{G.preventDefault(),await this.handleProfileUpdate(e)})}async handleProfileUpdate(e){var o;const t=e.querySelector("#editDisplayName").value,n=e.querySelector("#editTimezone").value,i=e.querySelector("#editUnits").value,r=parseInt(e.querySelector("#editRestingHR").value),a=parseInt(e.querySelector("#editMaxHR").value);try{const l={displayName:t,preferences:{...(o=this.userProfile)==null?void 0:o.preferences,timezone:n,units:i,restingHR:r,maxHR:a}};await xe.updateUserProfile(l),this.userProfile=await xe.getUserProfile(),this.renderUserProfile(),document.body.removeChild(e),this.showStatus("Profile updated successfully!","success")}catch(l){this.showStatus(`Profile update failed: ${l.message}`,"error")}}showStatus(e,t){const n=this.container.querySelector("#authStatus");n&&(n.className=`auth-status ${t}`,n.textContent=e,setTimeout(()=>{n.textContent="",n.className="auth-status"},5e3))}getCurrentUser(){return this.currentUser}getUserProfile(){return this.userProfile}isAuthenticated(){return this.currentUser!==null}}class ak{constructor(e){this.currentView="dashboard",this.onViewChange=e,this.initialize()}initialize(){const e=window.location.hash.substring(1);(e==="profile"||e==="dashboard"||e==="training-plan")&&(this.currentView=e),this.setupNavigation(),window.addEventListener("popstate",()=>{this.handleHashChange()}),this.showView(this.currentView)}setupNavigation(){document.querySelectorAll(".nav-btn").forEach(t=>{t.addEventListener("click",n=>{const i=n.target.dataset.view;i&&this.navigateTo(i)})})}navigateTo(e){e!==this.currentView&&(this.currentView=e,window.location.hash=e,this.showView(e),this.onViewChange(e))}handleHashChange(){const e=window.location.hash.substring(1);e&&(e==="profile"||e==="dashboard"||e==="training-plan")&&(this.showView(e),this.currentView=e,this.onViewChange(e))}showView(e){document.querySelectorAll(".view-container").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(`${e}-view`);t&&t.classList.add("active"),document.querySelectorAll(".nav-btn").forEach(n=>{n.classList.remove("active"),n.dataset.view===e&&n.classList.add("active")})}getCurrentView(){return this.currentView}updateNavUser(e,t){const n=document.getElementById("nav-user");if(n){n.innerHTML=`
        <div class="nav-user-info">
          <span class="nav-username">${e}</span>
          <button class="nav-logout-btn" id="nav-logout-btn">Sign Out</button>
        </div>
      `;const i=document.getElementById("nav-logout-btn");i==null||i.addEventListener("click",()=>{const r=new CustomEvent("logout-requested");document.dispatchEvent(r)})}}}class Li{constructor(){this.isRunning=!1,this.stravaService=Nn.getInstance(),this.dataMapper=oi.getInstance(),this.userProfileService=Ye.getInstance()}static getInstance(){return Li.instance||(Li.instance=new Li),Li.instance}async syncRecentActivities(){var e;if(this.isRunning)return console.log("ðŸ”„ Strava sync already running, skipping..."),{synced:0,skipped:0,errors:0};this.isRunning=!0,console.log("ðŸš€ Starting automatic Strava activity sync...");try{const t=await this.getStravaConnection();if(!t)return console.log("ðŸ“‹ No Strava connection found, skipping sync"),{synced:0,skipped:0,errors:0};const{afterTimestamp:n,beforeTimestamp:i}=this.getDateRange();console.log("ðŸ“… Syncing activities from yesterday and today:",{after:new Date(n*1e3).toISOString(),before:new Date(i*1e3).toISOString()});const r=await this.stravaService.getActivities(t,{after:n,before:i,per_page:10});if(console.log(`ðŸ“Š Found ${r.length} recent Strava activities`),r.length===0)return{synced:0,skipped:0,errors:0};const a=await this.getExistingActivities(n,i),o=new Set(a.filter(p=>p.stravaActivityId).map(p=>p.stravaActivityId.toString()));let l=0,u=0,d=0;for(const p of r)try{if(o.has(p.id.toString())){console.log(`â­ï¸ Skipping existing activity: ${p.name} (ID: ${p.id})`),u++;continue}const m=this.userProfileService.getUserProfile(),w=this.userProfileService.getTrainingProfile(),E=this.dataMapper.mapStravaActivityToFirebase(p,this.userProfileService.getUserId(),w.hrZones,((e=m==null?void 0:m.preferences)==null?void 0:e.restingHR)||60),C=await pe.addActivity(E);console.log(`âœ… Synced activity: ${p.name} (Strava ID: ${p.id}, Firebase ID: ${C})`),l++}catch(m){console.error(`âŒ Error syncing activity ${p.name}:`,m),d++}return console.log(`ðŸŽ¯ Strava sync completed: ${l} synced, ${u} skipped, ${d} errors`),{synced:l,skipped:u,errors:d}}catch(t){return console.error("âŒ Error during Strava auto-sync:",t),{synced:0,skipped:0,errors:1}}finally{this.isRunning=!1}}async getStravaConnection(){try{return this.userProfileService.getStravaConnection()}catch(e){return console.error("Error getting Strava connection:",e),null}}getDateRange(){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(t);n.setDate(n.getDate()-1);const i=new Date(t);return i.setDate(i.getDate()+1),{afterTimestamp:Math.floor(n.getTime()/1e3),beforeTimestamp:Math.floor(i.getTime()/1e3)}}async getExistingActivities(e,t){try{const n=new Date(e*1e3),i=new Date(t*1e3);return await pe.getActivities(n,i)}catch(n){return console.error("Error getting existing activities:",n),[]}}shouldRunSync(){return!this.isRunning&&this.userProfileService.isAuthenticated()}}class ok{constructor(e){this.canvas=null,this.chart=null,this.container=e,this.initialize()}async initialize(){this.canvas=document.createElement("canvas"),this.canvas.id="fitness-fatigue-chart",this.container.appendChild(this.canvas),await this.loadChartJS()}async loadChartJS(){if(!(typeof window.Chart<"u"))return new Promise((e,t)=>{const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js",n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load Chart.js")),document.head.appendChild(n)})}async update(e){if(!this.canvas){console.error("Canvas not initialized");return}const{fitnessForm:t,chartData:n}=e,i=n.fitnessFormHistory;if(i.length===0){this.showNoData();return}this.chart&&this.chart.destroy();const r=window.Chart;if(!r){console.error("Chart.js not loaded");return}const a=this.canvas.getContext("2d");a&&(this.chart=new r(a,{type:"line",data:{labels:i.map(o=>this.formatDate(o.date)),datasets:[{label:"CTL (Fitness)",data:i.map(o=>o.ctl),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:0,pointHoverRadius:4},{label:"ATL (Fatigue)",data:i.map(o=>o.atl),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderWidth:2,fill:!1,tension:.4,pointRadius:0,pointHoverRadius:4},{label:"TSB (Form)",data:i.map(o=>o.tsb),borderColor:"rgb(59, 130, 246)",backgroundColor:o=>o.parsed.y>0?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)",borderWidth:2,fill:!0,tension:.4,pointRadius:0,pointHoverRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{boxWidth:12,padding:15,font:{size:12}}},tooltip:{callbacks:{title:o=>o[0].label,label:o=>{const l=o.dataset.label||"",u=Math.round(o.parsed.y*10)/10;if(l.includes("TSB")){let d="";return u>25?d=" (Fresh)":u>=5?d=" (Optimal)":u>=-10?d=" (Productive)":u>=-30?d=" (Overreaching)":d=" (High Risk)",`${l}: ${u}${d}`}return`${l}: ${u}`}}},annotation:{annotations:{zeroLine:{type:"line",yMin:0,yMax:0,borderColor:"rgba(0, 0, 0, 0.3)",borderWidth:1,borderDash:[5,5]}}}},scales:{x:{display:!0,grid:{display:!1},ticks:{maxRotation:0,autoSkipPadding:20,font:{size:10}}},y:{display:!0,grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{font:{size:11}}}}}}),this.updateStatusSummary(t))}updateStatusSummary(e){if(!this.container.querySelector(".fitness-form-summary")){const a=document.createElement("div");a.className="fitness-form-summary",this.container.appendChild(a)}const n=this.container.querySelector(".fitness-form-summary");if(!n)return;const i={fresh:"var(--color-success)",optimal:"var(--color-success)",productive:"var(--color-info)",maintaining:"var(--color-warning)",overreaching:"var(--color-warning)",high_risk:"var(--color-danger)"},r={fresh:"Fresh - Consider increasing load",optimal:"Optimal - Peak performance zone",productive:"Productive - Building fitness",maintaining:"Maintaining - Steady state",overreaching:"Overreaching - Need recovery",high_risk:"High Risk - Reduce training!"};n.innerHTML=`
      <div class="fitness-form-grid">
        <div class="form-metric">
          <div class="form-metric-label">CTL (Fitness)</div>
          <div class="form-metric-value">${e.ctl}</div>
          <div class="form-metric-change ${e.ctlChange>=0?"positive":"negative"}">
            ${e.ctlChange>=0?"â†‘":"â†“"} ${Math.abs(e.ctlChange)} (7d)
          </div>
        </div>
        <div class="form-metric">
          <div class="form-metric-label">ATL (Fatigue)</div>
          <div class="form-metric-value">${e.atl}</div>
        </div>
        <div class="form-metric">
          <div class="form-metric-label">TSB (Form)</div>
          <div class="form-metric-value" style="color: ${i[e.status]}">${e.tsb}</div>
        </div>
        <div class="form-status">
          <div class="status-badge" style="background: ${i[e.status]}">
            ${r[e.status]}
          </div>
        </div>
      </div>
    `}showNoData(){if(!this.canvas)return;this.canvas.style.display="none";let e=this.container.querySelector(".no-data-message");e||(e=document.createElement("div"),e.className="no-data-message",e.textContent="No training data available. Import activities to see fitness-fatigue trends.",this.container.appendChild(e)),e.style.display="block"}formatDate(e){const t=new Date(e),n=t.toLocaleDateString("en-US",{month:"short"}),i=t.getDate();return`${n} ${i}`}destroy(){this.chart&&(this.chart.destroy(),this.chart=null)}}class lk{constructor(e,t={}){this.intensityData=new Map,this.container=e,this.config={months:t.months||3,cellSize:t.cellSize||14,cellGap:t.cellGap||3},this.initialize()}initialize(){this.container.className="intensity-heat-map",this.render()}update(e){const t=e.chartData.intensityHeatMap;this.intensityData.clear(),t.forEach(n=>{this.intensityData.set(n.date,{intensity:n.intensity,load:n.load,duration:n.duration})}),this.render()}render(){const e=new Date,t=new Date(e);t.setMonth(e.getMonth()-this.config.months),t.setDate(1);const n=this.calculateWeeks(t,e),i=`
      <div class="heat-map-header">
        <h3>Training Intensity Heat Map</h3>
        <div class="heat-map-legend">
          <span class="legend-label">Less</span>
          ${this.renderLegendCells()}
          <span class="legend-label">More</span>
        </div>
      </div>
      <div class="heat-map-grid">
        ${this.renderMonthLabels(n)}
        <div class="heat-map-body">
          ${this.renderDayLabels()}
          ${this.renderWeeks(n)}
        </div>
      </div>
      <div class="heat-map-tooltip" id="heat-map-tooltip" style="display: none;"></div>
    `;this.container.innerHTML=i,this.attachEventListeners()}calculateWeeks(e,t){const n=[];let i=[],r=new Date(e);const a=r.getDay();for(r.setDate(r.getDate()-a);r<=t;)i.push(new Date(r)),r.getDay()===6&&(n.push(i),i=[]),r.setDate(r.getDate()+1);return i.length>0&&n.push(i),n}renderMonthLabels(e){const t=[];let n=-1,i=0;return e.forEach(r=>{const a=r[0],o=a.getMonth();o!==n?(n!==-1&&t.push({label:new Date(a.getFullYear(),n).toLocaleDateString("en-US",{month:"short"}),span:i}),n=o,i=1):i++}),i>0&&n!==-1&&t.push({label:new Date(e[e.length-1][0].getFullYear(),n).toLocaleDateString("en-US",{month:"short"}),span:i}),`
      <div class="heat-map-months">
        <div class="month-spacer"></div>
        ${t.map(r=>`
          <div class="month-label" style="grid-column: span ${r.span}">${r.label}</div>
        `).join("")}
      </div>
    `}renderDayLabels(){return`
      <div class="heat-map-days">
        ${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((t,n)=>`
          <div class="day-label" style="grid-row: ${n+1}">
            ${n%2===1?t:""} <!-- Only show odd days to reduce clutter -->
          </div>
        `).join("")}
      </div>
    `}renderWeeks(e){return`
      <div class="heat-map-weeks">
        ${e.map((t,n)=>this.renderWeek(t,n)).join("")}
      </div>
    `}renderWeek(e,t){return`
      <div class="heat-map-week" style="grid-column: ${t+1}">
        ${e.map((n,i)=>this.renderDay(n,i)).join("")}
      </div>
    `}renderDay(e,t){const n=e.toISOString().split("T")[0],i=this.intensityData.get(n),r=new Date().toISOString().split("T")[0],a=n===r,o=e>new Date;let l=0;return i&&!o&&(i.load===0?l=0:i.load<50?l=1:i.load<100?l=2:i.load<150?l=3:l=4),`
      <div
        class="${["heat-map-cell",o?"future":`intensity-${l}`,a?"today":""].filter(Boolean).join(" ")}"
        data-date="${n}"
        data-load="${(i==null?void 0:i.load)||0}"
        data-duration="${(i==null?void 0:i.duration)||0}"
        data-intensity="${(i==null?void 0:i.intensity.toFixed(2))||0}"
        style="grid-row: ${t+1}"
        role="gridcell"
        aria-label="${this.getAriaLabel(e,i)}"
      ></div>
    `}renderLegendCells(){return[0,1,2,3,4].map(e=>`<div class="legend-cell intensity-${e}"></div>`).join("")}getAriaLabel(e,t){const n=e.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});return!t||t.load===0?`${n}: No training`:`${n}: ${Math.round(t.duration)} minutes, Training load ${Math.round(t.load)}`}attachEventListeners(){const e=this.container.querySelectorAll(".heat-map-cell"),t=this.container.querySelector("#heat-map-tooltip");t&&e.forEach(n=>{n.addEventListener("mouseenter",i=>{const r=i.target,a=r.dataset.date,o=parseFloat(r.dataset.load||"0"),l=parseFloat(r.dataset.duration||"0"),u=parseFloat(r.dataset.intensity||"0");if(!a)return;const d=new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});o===0?t.innerHTML=`
            <div class="tooltip-date">${d}</div>
            <div class="tooltip-content">No training</div>
          `:t.innerHTML=`
            <div class="tooltip-date">${d}</div>
            <div class="tooltip-content">
              <div class="tooltip-row">
                <span class="tooltip-label">Duration:</span>
                <span class="tooltip-value">${Math.round(l)} min</span>
              </div>
              <div class="tooltip-row">
                <span class="tooltip-label">Training Load:</span>
                <span class="tooltip-value">${Math.round(o)}</span>
              </div>
              <div class="tooltip-row">
                <span class="tooltip-label">Intensity:</span>
                <span class="tooltip-value">${u.toFixed(2)} load/min</span>
              </div>
            </div>
          `;const p=r.getBoundingClientRect(),m=this.container.getBoundingClientRect();t.style.display="block",t.style.left=`${p.left-m.left+p.width/2}px`,t.style.top=`${p.top-m.top-10}px`}),n.addEventListener("mouseleave",()=>{t.style.display="none"})})}destroy(){this.container.innerHTML=""}}class ck{constructor(e,t={}){this.activities=[],this.filteredActivities=[],this.container=e,this.onFilterChange=t.onFilterChange,this.filters=this.getDefaultFilters(),this.initialize()}getDefaultFilters(){return{searchTerm:"",sports:[],dateRange:{start:null,end:null},durationRange:{min:null,max:null},loadRange:{min:null,max:null},sortBy:"date",sortOrder:"desc"}}initialize(){this.render(),this.attachEventListeners()}updateActivities(e){this.activities=e,this.applyFilters()}render(){const e=this.getAvailableSports();this.container.innerHTML=`
      <div class="workout-filter-container">
        <div class="filter-header">
          <h3>ðŸ” Search & Filter Workouts</h3>
          <button class="btn btn-ghost btn-small" id="clear-filters">Clear All</button>
        </div>

        <div class="filter-grid">
          <!-- Search -->
          <div class="filter-group filter-search">
            <label for="workout-search">Search</label>
            <input
              type="text"
              id="workout-search"
              class="input"
              placeholder="Search workouts..."
              value="${this.filters.searchTerm}"
            />
          </div>

          <!-- Sport Filter -->
          <div class="filter-group filter-sport">
            <label>Sport Type</label>
            <div class="sport-chips">
              ${e.map(t=>`
                <label class="chip-label">
                  <input
                    type="checkbox"
                    name="sport-filter"
                    value="${t}"
                    ${this.filters.sports.includes(t)?"checked":""}
                  />
                  <span class="chip">${t}</span>
                </label>
              `).join("")}
            </div>
          </div>

          <!-- Date Range -->
          <div class="filter-group filter-date">
            <label>Date Range</label>
            <div class="date-range-inputs">
              <input
                type="date"
                id="date-start"
                class="input input-small"
                value="${this.filters.dateRange.start||""}"
                placeholder="Start date"
              />
              <span class="range-separator">to</span>
              <input
                type="date"
                id="date-end"
                class="input input-small"
                value="${this.filters.dateRange.end||""}"
                placeholder="End date"
              />
            </div>
          </div>

          <!-- Duration Range -->
          <div class="filter-group filter-duration">
            <label>Duration (minutes)</label>
            <div class="range-inputs">
              <input
                type="number"
                id="duration-min"
                class="input input-small"
                placeholder="Min"
                value="${this.filters.durationRange.min||""}"
                min="0"
              />
              <span class="range-separator">to</span>
              <input
                type="number"
                id="duration-max"
                class="input input-small"
                placeholder="Max"
                value="${this.filters.durationRange.max||""}"
                min="0"
              />
            </div>
          </div>

          <!-- Training Load Range -->
          <div class="filter-group filter-load">
            <label>Training Load</label>
            <div class="range-inputs">
              <input
                type="number"
                id="load-min"
                class="input input-small"
                placeholder="Min"
                value="${this.filters.loadRange.min||""}"
                min="0"
              />
              <span class="range-separator">to</span>
              <input
                type="number"
                id="load-max"
                class="input input-small"
                placeholder="Max"
                value="${this.filters.loadRange.max||""}"
                min="0"
              />
            </div>
          </div>

          <!-- Sort Options -->
          <div class="filter-group filter-sort">
            <label for="sort-by">Sort By</label>
            <div class="sort-controls">
              <select id="sort-by" class="input">
                <option value="date" ${this.filters.sortBy==="date"?"selected":""}>Date</option>
                <option value="duration" ${this.filters.sortBy==="duration"?"selected":""}>Duration</option>
                <option value="distance" ${this.filters.sortBy==="distance"?"selected":""}>Distance</option>
                <option value="load" ${this.filters.sortBy==="load"?"selected":""}>Training Load</option>
              </select>
              <button class="btn btn-ghost btn-icon" id="sort-order" aria-label="Toggle sort order">
                ${this.filters.sortOrder==="desc"?"â†“":"â†‘"}
              </button>
            </div>
          </div>
        </div>

        <!-- Results Summary -->
        <div class="filter-results" id="filter-results">
          <span class="results-count">Showing <strong>0</strong> of <strong>0</strong> workouts</span>
        </div>
      </div>
    `}getAvailableSports(){const e=new Set;return this.activities.forEach(t=>{t.sport&&e.add(t.sport)}),Array.from(e).sort()}attachEventListeners(){const e=this.container.querySelector("#workout-search");e==null||e.addEventListener("input",m=>{this.filters.searchTerm=m.target.value,this.applyFilters()}),this.container.querySelectorAll('input[name="sport-filter"]').forEach(m=>{m.addEventListener("change",()=>{this.filters.sports=Array.from(this.container.querySelectorAll('input[name="sport-filter"]:checked')).map(w=>w.value),this.applyFilters()})});const n=this.container.querySelector("#date-start"),i=this.container.querySelector("#date-end");n==null||n.addEventListener("change",m=>{this.filters.dateRange.start=m.target.value||null,this.applyFilters()}),i==null||i.addEventListener("change",m=>{this.filters.dateRange.end=m.target.value||null,this.applyFilters()});const r=this.container.querySelector("#duration-min"),a=this.container.querySelector("#duration-max");r==null||r.addEventListener("change",m=>{const w=m.target.value;this.filters.durationRange.min=w?parseFloat(w):null,this.applyFilters()}),a==null||a.addEventListener("change",m=>{const w=m.target.value;this.filters.durationRange.max=w?parseFloat(w):null,this.applyFilters()});const o=this.container.querySelector("#load-min"),l=this.container.querySelector("#load-max");o==null||o.addEventListener("change",m=>{const w=m.target.value;this.filters.loadRange.min=w?parseFloat(w):null,this.applyFilters()}),l==null||l.addEventListener("change",m=>{const w=m.target.value;this.filters.loadRange.max=w?parseFloat(w):null,this.applyFilters()});const u=this.container.querySelector("#sort-by");u==null||u.addEventListener("change",m=>{this.filters.sortBy=m.target.value,this.applyFilters()});const d=this.container.querySelector("#sort-order");d==null||d.addEventListener("click",()=>{this.filters.sortOrder=this.filters.sortOrder==="desc"?"asc":"desc",d.textContent=this.filters.sortOrder==="desc"?"â†“":"â†‘",this.applyFilters()});const p=this.container.querySelector("#clear-filters");p==null||p.addEventListener("click",()=>{this.clearFilters()})}applyFilters(){let e=[...this.activities];if(this.filters.searchTerm){const t=this.filters.searchTerm.toLowerCase();e=e.filter(n=>{var i;return n.sport.toLowerCase().includes(t)||n.activityId.toLowerCase().includes(t)||((i=n.fileName)==null?void 0:i.toLowerCase().includes(t))})}this.filters.sports.length>0&&(e=e.filter(t=>this.filters.sports.includes(t.sport))),this.filters.dateRange.start&&(e=e.filter(t=>t.date>=this.filters.dateRange.start)),this.filters.dateRange.end&&(e=e.filter(t=>t.date<=this.filters.dateRange.end)),this.filters.durationRange.min!==null&&(e=e.filter(t=>t.duration>=this.filters.durationRange.min)),this.filters.durationRange.max!==null&&(e=e.filter(t=>t.duration<=this.filters.durationRange.max)),this.filters.loadRange.min!==null&&(e=e.filter(t=>t.trainingLoad>=this.filters.loadRange.min)),this.filters.loadRange.max!==null&&(e=e.filter(t=>t.trainingLoad<=this.filters.loadRange.max)),e=this.sortActivities(e),this.filteredActivities=e,this.updateResultsCount(),this.onFilterChange&&this.onFilterChange(this.filteredActivities)}sortActivities(e){const t=[...e],n=this.filters.sortOrder==="desc"?-1:1;return t.sort((i,r)=>{let a=0;switch(this.filters.sortBy){case"date":a=i.date.localeCompare(r.date);break;case"duration":a=i.duration-r.duration;break;case"distance":a=(i.distance||0)-(r.distance||0);break;case"load":a=i.trainingLoad-r.trainingLoad;break}return a*n}),t}updateResultsCount(){const e=this.container.querySelector("#filter-results");e&&(e.innerHTML=`
      <span class="results-count">
        Showing <strong>${this.filteredActivities.length}</strong> of <strong>${this.activities.length}</strong> workouts
      </span>
    `)}clearFilters(){this.filters=this.getDefaultFilters(),this.render(),this.attachEventListeners(),this.applyFilters()}getFilteredActivities(){return this.filteredActivities}getFilters(){return{...this.filters}}}class uk{constructor(e){this.laps=[],this.charts=[],this.container=e,this.initialize()}async initialize(){await this.loadChartJS()}async loadChartJS(){if(!(typeof window.Chart<"u"))return new Promise((e,t)=>{const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js",n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load Chart.js")),document.head.appendChild(n)})}async update(e){if(this.laps=e,e.length===0){this.showNoData();return}this.render()}render(){this.destroyCharts(),this.container.innerHTML=`
      <div class="lap-charts-container">
        <div class="lap-summary">
          <h4>Lap Analysis (${this.laps.length} laps)</h4>
        </div>

        <div class="lap-charts-grid">
          <!-- Pace/Speed Chart -->
          <div class="chart-card">
            <h5>Pace/Speed by Lap</h5>
            <canvas id="lap-pace-chart"></canvas>
          </div>

          <!-- Heart Rate Chart -->
          ${this.hasHeartRateData()?`
            <div class="chart-card">
              <h5>Heart Rate by Lap</h5>
              <canvas id="lap-hr-chart"></canvas>
            </div>
          `:""}

          <!-- Elevation Chart -->
          ${this.hasElevationData()?`
            <div class="chart-card">
              <h5>Elevation Gain/Loss by Lap</h5>
              <canvas id="lap-elevation-chart"></canvas>
            </div>
          `:""}

          <!-- Power Chart (for cycling) -->
          ${this.hasPowerData()?`
            <div class="chart-card">
              <h5>Power by Lap</h5>
              <canvas id="lap-power-chart"></canvas>
            </div>
          `:""}
        </div>

        <!-- Lap Table -->
        <div class="lap-table-container">
          <h5>Lap Details Table</h5>
          ${this.renderLapTable()}
        </div>
      </div>
    `,this.createPaceChart(),this.hasHeartRateData()&&this.createHRChart(),this.hasElevationData()&&this.createElevationChart(),this.hasPowerData()&&this.createPowerChart()}createPaceChart(){const e=document.getElementById("lap-pace-chart");if(!e)return;const t=window.Chart;if(!t)return;const n=e.getContext("2d");if(!n)return;const i=this.laps.some(l=>l.avgPace),r=this.laps.some(l=>l.avgSpeed),a=[];i&&a.push({label:"Avg Pace (min/km)",data:this.laps.map(l=>l.avgPace),borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.1)",borderWidth:2,fill:!1,yAxisID:"y-pace"}),r&&a.push({label:"Avg Speed (km/h)",data:this.laps.map(l=>l.avgSpeed),borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderWidth:2,fill:!1,yAxisID:"y-speed"});const o=new t(n,{type:"line",data:{labels:this.laps.map((l,u)=>`Lap ${u+1}`),datasets:a},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top"}},scales:{...i&&{"y-pace":{type:"linear",display:!0,position:"left",reverse:!0,title:{display:!0,text:"Pace (min/km)"}}},...r&&{"y-speed":{type:"linear",display:!0,position:i?"right":"left",title:{display:!0,text:"Speed (km/h)"}}}}}});this.charts.push(o)}createHRChart(){const e=document.getElementById("lap-hr-chart");if(!e)return;const t=window.Chart;if(!t)return;const n=e.getContext("2d");if(!n)return;const i=new t(n,{type:"bar",data:{labels:this.laps.map((r,a)=>`Lap ${a+1}`),datasets:[{label:"Avg HR",data:this.laps.map(r=>r.avgHR),backgroundColor:"rgba(239, 68, 68, 0.5)",borderColor:"rgb(239, 68, 68)",borderWidth:1},{label:"Max HR",data:this.laps.map(r=>r.maxHR),backgroundColor:"rgba(220, 38, 38, 0.5)",borderColor:"rgb(220, 38, 38)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{y:{beginAtZero:!1,title:{display:!0,text:"Heart Rate (bpm)"}}}}});this.charts.push(i)}createElevationChart(){const e=document.getElementById("lap-elevation-chart");if(!e)return;const t=window.Chart;if(!t)return;const n=e.getContext("2d");if(!n)return;const i=new t(n,{type:"bar",data:{labels:this.laps.map((r,a)=>`Lap ${a+1}`),datasets:[{label:"Elevation Gain",data:this.laps.map(r=>r.elevationGain||0),backgroundColor:"rgba(34, 197, 94, 0.5)",borderColor:"rgb(34, 197, 94)",borderWidth:1},{label:"Elevation Loss",data:this.laps.map(r=>-(r.elevationLoss||0)),backgroundColor:"rgba(239, 68, 68, 0.5)",borderColor:"rgb(239, 68, 68)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{y:{title:{display:!0,text:"Elevation (m)"}}}}});this.charts.push(i)}createPowerChart(){const e=document.getElementById("lap-power-chart");if(!e)return;const t=window.Chart;if(!t)return;const n=e.getContext("2d");if(!n)return;const i=new t(n,{type:"line",data:{labels:this.laps.map((r,a)=>`Lap ${a+1}`),datasets:[{label:"Avg Power",data:this.laps.map(r=>r.avgPower),borderColor:"rgb(251, 191, 36)",backgroundColor:"rgba(251, 191, 36, 0.1)",borderWidth:2,fill:!1},{label:"Normalized Power",data:this.laps.map(r=>r.normalizedPower),borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",borderWidth:2,fill:!1,borderDash:[5,5]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"}},scales:{y:{title:{display:!0,text:"Power (watts)"}}}}});this.charts.push(i)}renderLapTable(){const e=this.laps.some(o=>o.lapDistance&&o.lapDistance>0),t=this.laps.some(o=>o.avgPace),n=this.laps.some(o=>o.avgSpeed),i=this.laps.some(o=>o.avgHR),r=this.laps.some(o=>o.elevationGain||o.elevationLoss),a=this.laps.some(o=>o.avgPower);return`
      <div class="lap-table-scroll">
        <table class="lap-table">
          <thead>
            <tr>
              <th>Lap</th>
              <th>Duration</th>
              ${e?"<th>Distance</th>":""}
              ${t?"<th>Avg Pace</th>":""}
              ${n?"<th>Avg Speed</th>":""}
              ${i?"<th>Avg HR</th>":""}
              ${i?"<th>Max HR</th>":""}
              ${r?"<th>Elev +/-</th>":""}
              ${a?"<th>Avg Power</th>":""}
            </tr>
          </thead>
          <tbody>
            ${this.laps.map((o,l)=>{var u,d;return`
              <tr>
                <td>${l+1}</td>
                <td>${this.formatDuration(o.lapDuration)}</td>
                ${e?`<td>${(u=o.lapDistance)==null?void 0:u.toFixed(2)} km</td>`:""}
                ${t?`<td>${this.formatPace(o.avgPace)}</td>`:""}
                ${n?`<td>${(d=o.avgSpeed)==null?void 0:d.toFixed(1)} km/h</td>`:""}
                ${i?`<td>${o.avgHR?Math.round(o.avgHR):"-"} bpm</td>`:""}
                ${i?`<td>${o.maxHR?Math.round(o.maxHR):"-"} bpm</td>`:""}
                ${r?`<td>+${o.elevationGain||0}m / -${o.elevationLoss||0}m</td>`:""}
                ${a?`<td>${o.avgPower?Math.round(o.avgPower):"-"} W</td>`:""}
              </tr>
            `}).join("")}
          </tbody>
        </table>
      </div>
    `}hasHeartRateData(){return this.laps.some(e=>e.avgHR&&e.avgHR>0)}hasElevationData(){return this.laps.some(e=>e.elevationGain||e.elevationLoss)}hasPowerData(){return this.laps.some(e=>e.avgPower&&e.avgPower>0)}formatDuration(e){const t=Math.floor(e),n=Math.round((e-t)*60);return`${t}:${n.toString().padStart(2,"0")}`}formatPace(e){if(!e)return"-";const t=Math.floor(e),n=Math.round((e-t)*60);return`${t}:${n.toString().padStart(2,"0")}`}showNoData(){this.container.innerHTML=`
      <div class="no-lap-data">
        <p>No lap data available for this workout.</p>
      </div>
    `}destroyCharts(){this.charts.forEach(e=>{e&&e.destroy()}),this.charts=[]}destroy(){this.destroyCharts(),this.container.innerHTML=""}}class dk{constructor(){this.unifiedWorkoutCalendar=null,this.stravaConnector=null,this.isImportModalOpen=!1,this.currentPlan=null,this.fitnessFatigueChart=null,this.intensityHeatMap=null,this.workoutFilter=null,this.lapCharts=null,this.state=this.initializeState(),this.dashboardService=new sc,this.userProfileService=Ye.getInstance(),this.stravaAutoSync=Li.getInstance();const e=document.getElementById("auth-container");if(!e)throw new Error("Auth container not found");this.authManager=new rk(e,this.onAuthStateChanged.bind(this)),this.workoutCalendar=new K1(this.onWorkoutSelected.bind(this)),this.workoutComparison=new tk,this.initializeEventListeners()}onAuthStateChanged(e,t){try{const n=e!==null;if(console.log("ðŸ”„ Auth state changed (TrainingHub):",{isAuthenticated:n,userId:e==null?void 0:e.uid,email:e==null?void 0:e.email,hasProfile:!!t,timestamp:new Date().toISOString()}),n){const i=document.getElementById("auth-container"),r=document.getElementById("main-content");console.log("ðŸ” DOM elements check:",{hasAuthContainer:!!i,hasMainContent:!!r,authDisplay:i==null?void 0:i.style.display,mainDisplay:r==null?void 0:r.style.display}),i?(i.style.display="none",console.log("âœ… Auth container hidden")):console.warn("âš ï¸ Auth container not found"),r?(r.style.display="block",console.log("âœ… Main content set to block")):console.warn("âš ï¸ Main content element not found"),console.log("âœ… Main content should now be visible"),this.updateStravaFooterBadge(),this.router=new ak(d=>this.onViewChange(d));const a=document.getElementById("recovery-metrics-container");a&&(this.recoveryTracker=new Zd(a));const o=document.getElementById("recent-workout-container");o&&(this.recentWorkoutDisplay=new Xd(o)),this.trainingPlanManager=new nk(this),this.setupTrainingPlanIntegration();const l=this.userProfileService.getDisplayName(),u=this.userProfileService.getEmail();this.router.updateNavUser(l,u),this.initializePhase1Components(),this.initializeEventListeners(),this.initializeUnifiedCalendar(),this.loadInitialData()}else this.dashboardService.disableRealtimeSync(),setTimeout(()=>{if(this.userProfileService.isAuthenticated())console.log("ðŸ” Authentication restored during delay, staying logged in");else{const r=document.getElementById("auth-container"),a=document.getElementById("main-content");console.log("ðŸ” No authentication found after delay, showing login screen"),r&&(r.style.display="block"),a&&(a.style.display="none")}},500)}catch(n){console.error("âŒ Error in auth state change handler:",n);const i=document.getElementById("auth-container"),r=document.getElementById("main-content");i&&(i.style.display="block"),r&&(r.style.display="none")}}initializeState(){return{calendar:{viewType:"month",startDate:new Date().toISOString().split("T")[0],showPlannedOnly:!1,showActualOnly:!1,showComparison:!0,highlightAdherence:!0},trackedWorkouts:[],isLoading:!1,errors:[],notifications:[]}}initializeEventListeners(){var i,r,a,o,l,u,d,p,m,w;const e=document.getElementById("refresh-calendar-btn");e==null||e.addEventListener("click",()=>this.refreshCalendar());const t=document.getElementById("sync-data-btn");t==null||t.addEventListener("click",()=>this.syncTrainingData());const n=document.getElementById("import-data-btn");n&&!n.hasAttribute("data-listener-added")&&(n.setAttribute("data-listener-added","true"),n.addEventListener("click",E=>{E.preventDefault(),E.stopPropagation(),console.log("ðŸ“ Import data button clicked"),this.navigateToImportPage()})),(i=document.getElementById("prev-week-btn"))==null||i.addEventListener("click",()=>{this.navigateWeek(-1)}),(r=document.getElementById("next-week-btn"))==null||r.addEventListener("click",()=>{this.navigateWeek(1)}),(a=document.getElementById("generate-plan-btn"))==null||a.addEventListener("click",()=>{this.showPlanGenerationModal()}),window.addEventListener("recovery-metrics-updated",()=>{this.loadInitialData()}),document.addEventListener("workouts-updated",()=>{console.log("ðŸ“Š Workouts updated, refreshing recent workout display..."),this.recentWorkoutDisplay&&this.recentWorkoutDisplay.refresh()}),document.addEventListener("show-import-modal",E=>{console.log("ðŸ“‹ Custom show-import-modal event triggered"),this.navigateToImportPage()}),(o=document.getElementById("refresh-ai-btn"))==null||o.addEventListener("click",()=>{this.refreshAIInsights()}),(l=document.getElementById("toggle-ai-btn"))==null||l.addEventListener("click",()=>{this.toggleAIInsights()}),this.setupFileHandling(),document.addEventListener("logout-requested",()=>{this.handleLogout()}),(u=document.getElementById("close-plan-modal"))==null||u.addEventListener("click",()=>{this.hidePlanGenerationModal()}),(d=document.getElementById("cancel-plan-generation"))==null||d.addEventListener("click",()=>{this.hidePlanGenerationModal()}),(p=document.getElementById("confirm-plan-generation"))==null||p.addEventListener("click",()=>{this.generatePlan()}),(m=document.getElementById("analytics-timeframe"))==null||m.addEventListener("change",E=>{const C=E.target.value;this.updateAnalyticsTimeframe(C)}),(w=document.getElementById("close-detail-panel"))==null||w.addEventListener("click",()=>{this.hideWorkoutDetail()})}async loadInitialData(){this.setState({isLoading:!0});try{await this.dashboardService.initialize();const e=await this.dashboardService.getDashboardData(),t=await this.loadWorkoutsFromFirebaseOrLocal();this.setState({trackedWorkouts:t}),this.updateHeaderMetricsFromDashboard(e),this.updatePhase1Components(e),this.displayAIInsights(e.aiInsights),await this.workoutCalendar.initialize(this.state.trackedWorkouts,this.state.calendar),this.updateAnalytics(),this.dashboardService.enableRealtimeSync({onDataChange:i=>{this.handleRealtimeDataUpdate(i)},onError:i=>{console.error("Real-time sync error:",i),this.addError("Real-time sync error: "+i.message)}})?(console.log("âœ… Real-time synchronization enabled"),this.updateSyncButtonStatus(!0)):(console.warn("âš ï¸ Real-time synchronization could not be enabled"),this.updateSyncButtonStatus(!1)),console.log(`Loaded ${e.activities.length} activities from Firebase`),this.runStravaAutoSync()}catch(e){console.error("Error loading initial data:",e),this.addError("Failed to load training data")}finally{this.setState({isLoading:!1})}}loadSavedWorkouts(){try{const e=localStorage.getItem("training-hub-workouts");return e?JSON.parse(e):[]}catch(e){return console.warn("Error loading saved workouts:",e),[]}}async loadWorkoutsFromFirebaseOrLocal(){let e=[];if(this.userProfileService.isAuthenticated())try{const t=await pe.getActivePlan();if(t&&t.workouts&&t.workouts.length>0){e=t.workouts.map(r=>({date:r.date,workoutType:r.workoutType,description:r.description||"",durationMin:r.durationMin||60,sport:r.sport||"running",status:"planned",expectedFatigue:r.expectedFatigue||50,workoutZones:r.workoutZones||[],workoutTags:r.workoutTags||[],hrTargetZone:r.hrTargetZone||"Zone 2",customParameters:r.customParameters||{}})),console.log(`âœ… Loaded ${e.length} workouts from Firebase active plan`);const n=await pe.getTrackedWorkouts(),i=new Map(n.map(r=>[r.date,r]));e=e.map(r=>{const a=i.get(r.date);return a?{...r,status:a.status,userNotes:a.userNotes||"",userRating:a.userRating||null,comparison:a.comparison||null,completedAt:a.lastUpdated.toISOString()}:r}),console.log(`âœ… Merged with ${n.length} tracked workouts from Firebase`)}}catch(t){console.warn("Failed to load workouts from Firebase, falling back to localStorage:",t)}return e.length===0&&(e=this.loadSavedWorkouts(),console.log(`ðŸ“ Loaded ${e.length} workouts from localStorage`)),e}saveWorkouts(){try{localStorage.setItem("training-hub-workouts",JSON.stringify(this.state.trackedWorkouts)),this.userProfileService.isAuthenticated()&&this.saveWorkoutsToFirebase().catch(e=>{console.warn("Failed to save workouts to Firebase:",e)})}catch(e){console.warn("Error saving workouts:",e)}}async saveWorkoutsToFirebase(){try{const e=this.state.trackedWorkouts.filter(t=>t.status!=="planned"||t.userNotes||t.userRating||t.comparison);for(const t of e){const i=(await pe.getTrackedWorkouts()).find(a=>a.date===t.date),r={date:t.date,status:t.status,userNotes:t.userNotes||"",userRating:t.userRating||null,comparison:t.comparison||null,lastUpdated:new Date};i?await pe.updateTrackedWorkout(i.id,r):await pe.addTrackedWorkout(r)}}catch(e){throw console.error("Error saving workouts to Firebase:",e),e}}setState(e){this.state={...this.state,...e},this.state.lastUpdated=new Date().toISOString()}addError(e){this.setState({errors:[...this.state.errors,e]}),Q.showStatus(e,"error")}updateHeaderMetrics(){var r,a,o;const e=this.calculateCurrentMetrics(),t=(r=document.getElementById("readiness-metric"))==null?void 0:r.querySelector(".metric-value"),n=(a=document.getElementById("weekly-load-metric"))==null?void 0:a.querySelector(".metric-value"),i=(o=document.getElementById("streak-metric"))==null?void 0:o.querySelector(".metric-value");t&&(t.textContent=e.readiness.toString()),n&&(n.textContent=e.weeklyLoad.toString()),i&&(i.textContent=`${e.streak}d`)}updateHeaderMetricsFromDashboard(e){var m,w,E,C,I,B,G,Y;const t=(m=document.getElementById("readiness-metric"))==null?void 0:m.querySelector(".metric-value"),n=(w=document.getElementById("weekly-load-metric"))==null?void 0:w.querySelector(".metric-value"),i=(E=document.getElementById("streak-metric"))==null?void 0:E.querySelector(".metric-value"),r=new Date,a=new Date(r);a.setDate(r.getDate()-r.getDay());const l=e.activities.filter(K=>{const ee=new Date(K.date);return ee>=a&&ee<=r}).reduce((K,ee)=>K+(ee.trainingLoad||0),0);let u=0;const d=e.activities.sort((K,ee)=>new Date(ee.date).getTime()-new Date(K.date).getTime());if(d.length>0){const K=new Date().toISOString().split("T")[0],ee=new Date(Date.now()-864e5).toISOString().split("T")[0];if(((C=d[0])==null?void 0:C.date)===K||((I=d[0])==null?void 0:I.date)===ee){let ae=((B=d[0])==null?void 0:B.date)===K?K:ee;for(const M of d)if(M.date===ae){u++;const A=new Date(ae);A.setDate(A.getDate()-1),ae=A.toISOString().split("T")[0]}else break}}let p=85-l/50;(Y=(G=e.aiInsights)==null?void 0:G.quickStats)!=null&&Y.readinessScore&&(p=e.aiInsights.quickStats.readinessScore),this.recoveryTracker&&(p=this.recoveryTracker.getReadinessScore()*.6+p*.4),p=Math.min(100,Math.max(30,p)),t&&(t.textContent=Math.round(p).toString()),n&&(n.textContent=Math.round(l).toString()),i&&(i.textContent=`${u}d`)}calculateCurrentMetrics(){const e=new Date,t=new Date(e);t.setDate(e.getDate()-e.getDay());const n=this.state.trackedWorkouts.filter(u=>{const d=new Date(u.date);return d>=t&&d<=e&&u.status==="completed"}),i=n.reduce((u,d)=>{var p;return u+(((p=d.actualWorkout)==null?void 0:p.trainingLoad)||d.expectedFatigue*5)},0);let r=0,a=new Date(e);for(;;){const u=a.toISOString().split("T")[0];if(this.state.trackedWorkouts.find(p=>p.date===u&&p.status==="completed"))r++,a.setDate(a.getDate()-1);else break}const o=n.slice(-3).reduce((u,d)=>{var p;return u+(((p=d.actualWorkout)==null?void 0:p.trainingLoad)||d.expectedFatigue*5)},0)/3,l=Math.max(0,Math.min(100,100-o/10));return{readiness:Math.round(l),weeklyLoad:Math.round(i),streak:r}}initializePhase1Components(){try{const e=document.getElementById("fitness-form-chart-container");e&&(this.fitnessFatigueChart=new ok(e),console.log("âœ… Fitness-Fatigue-Form chart initialized"));const t=document.getElementById("intensity-heatmap-container");t&&(this.intensityHeatMap=new lk(t),console.log("âœ… Intensity heat map initialized"));const n=document.getElementById("workout-filter-container");n&&(this.workoutFilter=new ck(n,{onFilterChange:a=>this.handleFilteredWorkouts(a)}),console.log("âœ… Workout filter initialized"));const i=document.getElementById("toggle-filter");i==null||i.addEventListener("click",()=>{const a=document.getElementById("workout-filter-container");if(a){const o=a.style.display!=="none";a.style.display=o?"none":"block"}});const r=document.getElementById("fitness-form-info");r==null||r.addEventListener("click",()=>{this.showFitnessFormInfo()})}catch(e){console.error("âŒ Error initializing Phase 1 components:",e)}}updatePhase1Components(e){try{this.fitnessFatigueChart&&e.metrics&&this.fitnessFatigueChart.update(e.metrics),this.intensityHeatMap&&e.metrics&&this.intensityHeatMap.update(e.metrics),this.workoutFilter&&e.activities&&this.workoutFilter.updateActivities(e.activities)}catch(t){console.error("âŒ Error updating Phase 1 components:",t)}}handleFilteredWorkouts(e){const t=document.getElementById("filtered-workouts-container");if(t){if(e.length===0){t.innerHTML='<div class="no-results">No workouts match your filters</div>';return}t.innerHTML=`
      <div class="filtered-workouts-list">
        ${e.map(n=>`
          <div class="workout-card" data-activity-id="${n.activityId}">
            <div class="workout-header">
              <span class="sport-icon">${this.getSportIcon(n.sport)}</span>
              <span class="workout-date">${new Date(n.date).toLocaleDateString()}</span>
            </div>
            <div class="workout-stats">
              <div class="stat">
                <span class="stat-label">Duration</span>
                <span class="stat-value">${Math.round(n.duration)} min</span>
              </div>
              ${n.distance?`
                <div class="stat">
                  <span class="stat-label">Distance</span>
                  <span class="stat-value">${n.distance.toFixed(2)} km</span>
                </div>
              `:""}
              ${n.avgHR?`
                <div class="stat">
                  <span class="stat-label">Avg HR</span>
                  <span class="stat-value">${Math.round(n.avgHR)} bpm</span>
                </div>
              `:""}
              <div class="stat">
                <span class="stat-label">Load</span>
                <span class="stat-value">${Math.round(n.trainingLoad)}</span>
              </div>
            </div>
          </div>
        `).join("")}
      </div>
    `,t.querySelectorAll(".workout-card").forEach(n=>{n.addEventListener("click",async()=>{const i=n.getAttribute("data-activity-id");i&&await this.showWorkoutDetailWithLaps(i)})})}}async showWorkoutDetailWithLaps(e){try{const t=document.getElementById("workout-detail-panel"),n=document.getElementById("workout-detail-content");if(!t||!n)return;const i=await this.dashboardService.getLapsForActivity(e);if(t.style.display="block",i&&i.length>0){n.innerHTML='<div id="lap-charts-container"></div>';const r=document.getElementById("lap-charts-container");r&&(this.lapCharts=new uk(r),await this.lapCharts.update(i))}else n.innerHTML='<div class="no-lap-data">No lap data available for this workout</div>'}catch(t){console.error("Error showing workout detail with laps:",t)}}getSportIcon(e){const t={Run:"ðŸƒ",Bike:"ðŸš´",Swim:"ðŸŠ",Walk:"ðŸš¶",Hike:"â›°ï¸",Strength:"ðŸ‹ï¸",Yoga:"ðŸ§˜",Other:"ðŸƒ"};return t[e]||t.Other}showFitnessFormInfo(){document.body.insertAdjacentHTML("beforeend",`
      <div class="modal-overlay" id="fitness-form-info-modal">
        <div class="modal-content modal-small">
          <header class="modal-header">
            <h3>About Fitness-Fatigue-Form</h3>
            <button class="btn btn-ghost close-modal-btn" onclick="document.getElementById('fitness-form-info-modal').remove()">Ã—</button>
          </header>
          <div class="modal-body">
            <h4>CTL (Chronic Training Load) - Fitness</h4>
            <p>42-day exponential average of training stress. Represents your baseline fitness level.</p>

            <h4>ATL (Acute Training Load) - Fatigue</h4>
            <p>7-day exponential average of training stress. Represents recent fatigue.</p>

            <h4>TSB (Training Stress Balance) - Form</h4>
            <p>CTL minus ATL. Indicates your current readiness to perform:</p>
            <ul>
              <li><strong>TSB > 25:</strong> Fresh (may be under-training)</li>
              <li><strong>TSB 5-25:</strong> Optimal (peak performance zone)</li>
              <li><strong>TSB -10 to 5:</strong> Productive (building fitness)</li>
              <li><strong>TSB -30 to -10:</strong> Overreaching (need recovery)</li>
              <li><strong>TSB < -30:</strong> High Risk (reduce training)</li>
            </ul>
          </div>
        </div>
      </div>
    `)}navigateWeek(e){const t=new Date(this.state.calendar.startDate);t.setDate(t.getDate()+e*7);const n={...this.state.calendar,startDate:t.toISOString().split("T")[0]};this.setState({calendar:n}),this.workoutCalendar.updateView(n),this.updateCurrentPeriodDisplay()}updateCurrentPeriodDisplay(){const e=new Date(this.state.calendar.startDate),t=new Date(e);t.setDate(e.getDate()+6);const n=document.getElementById("current-period");if(n){const i=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"});n.textContent=`${i.format(e)} - ${i.format(t)}`}}onWorkoutSelected(e){this.setState({selectedWorkout:e}),this.showWorkoutDetail(e)}navigateToImportPage(){const e=document.querySelector(".view-container.active");e&&(e.classList.remove("active"),e.style.display="none");const t=document.getElementById("import-data-view");if(t){t.style.display="block",t.classList.add("active");const i=window.app;i&&i.importDataPage&&i.importDataPage.show()}document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active")),console.log("ðŸ“ Navigated to import data page")}setupFileHandling(){var r;const e=document.getElementById("fileInput"),t=document.getElementById("dropZone");e&&t&&(e.addEventListener("change",a=>{const o=a.target.files;o&&o.length>0&&this.handleSingleFile(o[0])}),t.addEventListener("click",()=>e.click()),this.setupDragAndDrop(t,[".fit"],a=>{a.length>0&&this.handleSingleFile(a[0])}));const n=document.getElementById("bulkFileInput"),i=document.getElementById("bulkDropZone");n&&i&&(n.addEventListener("change",a=>{const o=Array.from(a.target.files||[]);this.handleBulkFiles(o)}),i.addEventListener("click",()=>n.click()),this.setupDragAndDrop(i,[".fit"],a=>{this.handleBulkFiles(a)})),(r=document.querySelector('[data-action="analyze-activities"]'))==null||r.addEventListener("click",()=>{this.processBulkFiles()})}setupDragAndDrop(e,t,n){e.addEventListener("dragover",i=>{i.preventDefault(),e.classList.add("dragover")}),e.addEventListener("dragleave",()=>{e.classList.remove("dragover")}),e.addEventListener("drop",i=>{var a;i.preventDefault(),e.classList.remove("dragover");const r=Array.from(((a=i.dataTransfer)==null?void 0:a.files)||[]).filter(o=>t.some(l=>o.name.toLowerCase().endsWith(l)));r.length>0&&n(r)})}async handleSingleFile(e){try{Q.showStatus("Processing FIT file...","info");const t=await ri.handleFileWithAnalysis(e);t.activityMetrics&&(await this.processNewActivity(t.activityMetrics,t.lapMetrics),Q.showStatus("Activity processed and saved successfully!","success"))}catch(t){console.error("Error processing file:",t),this.addError(`Failed to process ${e.name}: ${t.message}`)}}handleBulkFiles(e){const t=document.getElementById("selectedFiles"),n=document.getElementById("bulkActions");t&&n&&(t.innerHTML=e.map((i,r)=>`
        <div class="file-item">
          <div class="file-info">
            <div class="file-name">${i.name}</div>
            <div class="file-size">${(i.size/1024).toFixed(2)} KB</div>
          </div>
          <button class="remove-file" data-index="${r}">Ã—</button>
        </div>
      `).join(""),n.style.display=e.length>0?"flex":"none",this.bulkFiles=e)}async processBulkFiles(){const e=this.bulkFiles;if(!(!e||e.length===0))try{Q.showStatus(`Processing ${e.length} FIT files...`,"info");let t=0,n=0;for(const o of e)try{Q.showStatus(`Processing ${o.name} (${t+1}/${e.length})...`,"info");const l=await ri.handleFileWithAnalysis(o);l.activityMetrics&&(await this.processNewActivity(l.activityMetrics,l.lapMetrics),t++)}catch(l){console.error(`Error processing ${o.name}:`,l),n++}const i=n>0?`Processed ${t} files, ${n} failed`:`Successfully processed all ${t} files!`;Q.showStatus(i,n>0?"warning":"success"),this.bulkFiles=[];const r=document.getElementById("selectedFiles");r&&(r.innerHTML="");const a=document.getElementById("bulkActions");a&&(a.style.display="none")}catch(t){console.error("Bulk processing failed:",t),this.addError("Bulk processing failed")}}async processNewActivity(e,t){const n=Pi.matchWorkout(e,t||[],this.state.trackedWorkouts.filter(r=>r.status==="planned"));let i;n.recommendation.shouldAutoMatch&&n.recommendation.bestMatch?(i=Pi.createTrackedWorkout(n.recommendation.bestMatch,e,t),this.setState({trackedWorkouts:this.state.trackedWorkouts.filter(r=>r.date!==n.recommendation.bestMatch.date).concat(i)})):(i=Pi.createTrackedWorkout({date:e.date,workoutType:e.sport.toLowerCase(),description:`${e.sport} workout`,expectedFatigue:Math.min(100,e.trainingLoad/5),durationMin:e.duration,workoutId:`unplanned-${Date.now()}`,completed:!1},e,t),i.status="unplanned",this.setState({trackedWorkouts:[...this.state.trackedWorkouts,i]}));try{await this.dashboardService.addActivity(e),t&&t.length>0&&await this.dashboardService.addLapData(t)}catch(r){console.warn("Failed to save to Firebase, data will be kept locally:",r)}this.saveWorkouts(),this.updateHeaderMetrics(),this.workoutCalendar&&this.workoutCalendar&&await this.workoutCalendar.updateWorkouts(this.state.trackedWorkouts),this.updateAnalytics()}showPlanGenerationModal(){const e=document.getElementById("plan-generation-modal");if(e){const n=Ye.getInstance().getTrainingProfile(),i=document.getElementById("athlete-age");i&&n.age&&(i.value=n.age.toString());const r=document.getElementById("fitness-level");r&&n.fitnessLevel&&(r.value=n.fitnessLevel);const a=document.getElementById("event-date");a&&(a.value=this.getDefaultEventDate()),(n.excludedExercises||[]).forEach(l=>{const u=document.getElementById(`exclude-${l}`);u&&(u.checked=!0)}),e.style.display="flex"}}hidePlanGenerationModal(){const e=document.getElementById("plan-generation-modal");e&&(e.style.display="none")}async generatePlan(){try{Q.showStatus("Generating enhanced training plan...","info");const e=await this.gatherEnhancedPlanOptions(),t=Do.generateEnhancedPlan(e),n=t.plan.map(a=>Pi.createTrackedWorkout(a)).filter(a=>!this.state.trackedWorkouts.some(o=>o.date===a.date));if(this.userProfileService.isAuthenticated())try{Q.showStatus("Saving training plan to cloud...","info");const a=e.startDate||new Date().toISOString().split("T")[0],o=e.weeks||8,l=new Date(new Date(a).getTime()+o*7*24*60*60*1e3).toISOString().split("T")[0],u={planName:`${e.planType||"Custom"} - ${e.sport||"Multi-Sport"} Plan`,planType:e.planType||"custom",startDate:a,endDate:l,totalWeeks:o,config:{sport:e.sport||"running",weeklyHours:e.weeklyHours||5,fitnessLevel:e.user.fitnessLevel,goals:e.goals||["fitness"],availableDays:e.trainingDays||["Monday","Wednesday","Friday"]},workouts:[],generatedBy:"user",version:"1.0.0",isActive:!0},d=n.map(m=>({date:m.date,workoutType:m.workoutType,description:m.description,durationMin:m.durationMin,sport:m.sport||"running",expectedFatigue:m.expectedFatigue,workoutZones:m.workoutZones||[],workoutTags:m.workoutTags||[],hrTargetZone:m.hrTargetZone||"Zone 2",customParameters:m.customParameters||{},completed:!1,generatedAt:new Date,generatedBy:"user",createdAt:new Date})),p=await pe.saveGeneratedPlanWithWorkouts(u,d);console.log("Saved generated plan to Firebase with ID:",p)}catch(a){console.warn("Failed to save plan to Firebase, using local storage:",a),Q.showStatus("Plan generated (saved locally)","info")}this.setState({trackedWorkouts:[...this.state.trackedWorkouts,...n]}),this.saveWorkouts(),this.workoutCalendar&&this.workoutCalendar&&await this.workoutCalendar.updateWorkouts(this.state.trackedWorkouts),this.updateHeaderMetrics(),this.hidePlanGenerationModal();const i=t.recommendations.slice(0,3).join("; "),r=`Generated ${n.length} workouts! ${i?`Insights: ${i}`:""}`;Q.showStatus(r,"success")}catch(e){console.error("Error generating plan:",e),this.addError("Failed to generate training plan")}}async gatherEnhancedPlanOptions(){var G,Y,K,ee,ae,M;const e=Ye.getInstance(),t=e.getTrainingProfile(),n=(G=document.getElementById("athlete-age"))==null?void 0:G.value,i=(Y=document.getElementById("fitness-level"))==null?void 0:Y.value,r=(K=document.getElementById("event-date"))==null?void 0:K.value,a=parseInt((ee=document.getElementById("plan-duration"))==null?void 0:ee.value)||10,o=parseInt((ae=document.getElementById("body-battery"))==null?void 0:ae.value)||void 0,l=parseInt((M=document.getElementById("sleep-score"))==null?void 0:M.value)||void 0,u=[];document.querySelectorAll('input[name="excludedExercises"]:checked').forEach(A=>{const R=A;u.push(R.value)}),console.log("ðŸš« Excluded exercises:",u);const d=n?parseInt(n):t.age,p=i||t.fitnessLevel,m=u.sort(),w=t.excludedExercises.sort();if(JSON.stringify(m)!==JSON.stringify(w)){console.log("ðŸ’¾ Saving exercise exclusions to user preferences");try{const A=e.getUserProfile(),R=A==null?void 0:A.preferences;R?await e.updateProfile({preferences:{...R,excludedExercises:u}}):await e.updateProfile({preferences:{timezone:"UTC",units:"metric",hrZones:{zone1:{min:50,max:60},zone2:{min:60,max:70},zone3:{min:70,max:80},zone4:{min:80,max:90},zone5:{min:90,max:100}},fitnessLevel:"intermediate",restingHR:60,maxHR:190,age:30,sports:["running"],goals:["general_fitness"],excludedExercises:u}}),console.log("âœ… Exercise exclusions saved successfully")}catch(A){console.warn("Failed to save exercise exclusions:",A)}}let E=[],C=[];try{E=(await this.dashboardService.getDashboardData()).activities,C=this.state.trackedWorkouts.filter(R=>R.status==="completed"&&R.actualWorkout).map(R=>({date:R.date,workoutType:R.workoutType,expectedDuration:R.durationMin,actualDuration:R.actualWorkout.duration,expectedFatigue:R.expectedFatigue,actualFatigue:R.actualFatigue||Math.round(R.actualWorkout.trainingLoad/5),completed:!0,sport:R.actualWorkout.sport,trainingLoad:R.actualWorkout.trainingLoad})),console.log(`Enhanced plan generation: Using ${E.length} historical activities and ${C.length} completed workouts`)}catch(A){console.warn("Could not load historical data for enhanced planning, using basic planning:",A)}const I=this.state.trackedWorkouts.filter(A=>A.status==="completed"&&A.actualWorkout).slice(-7).map(A=>({date:A.date,type:A.workoutType,duration:A.actualWorkout.duration,fatigue:A.actualWorkout.trainingLoad/5,trainingLoad:A.actualWorkout.trainingLoad})),B=I.length>0?I.map(A=>A.fatigue):[25,30,35,25,40,30,35];return{user:{age:d,sex:"male",eventDate:r||this.getDefaultEventDate(),trainingDays:5,fitnessLevel:p},recoveryMetrics:this.getEnhancedRecoveryMetrics(o,l,t.restingHR),recentFatigueScores:B,recentWorkouts:I,planDuration:a,availabilityToday:!0,excludedExercises:u,historicalActivities:E,completedWorkouts:C}}getEnhancedRecoveryMetrics(e,t,n){var r;const i=(r=this.recoveryTracker)==null?void 0:r.getCurrentMetrics();return{bodyBattery:(i==null?void 0:i.bodyBattery)??e,sleepScore:(i==null?void 0:i.sleepScore)??t,hrv:i==null?void 0:i.hrv,restingHR:(i==null?void 0:i.restingHR)??n,subjectiveFatigue:i==null?void 0:i.subjectiveFatigue,stressLevel:i==null?void 0:i.stressLevel,hasCurrentDayData:i!==null,dataSource:i?"daily-tracker":"form-input"}}getDefaultEventDate(){const e=new Date;return e.setDate(e.getDate()+12*7),e.toISOString().split("T")[0]}showWorkoutDetail(e){const t=document.getElementById("workout-detail-panel"),n=document.getElementById("workout-detail-title"),i=document.getElementById("workout-detail-content");t&&n&&i&&(n.textContent=`${e.workoutType} - ${new Date(e.date).toLocaleDateString()}`,i.innerHTML=this.workoutComparison.generateComparisonHTML(e),t.style.display="block",setTimeout(()=>t.classList.add("visible"),10))}hideWorkoutDetail(){const e=document.getElementById("workout-detail-panel");e&&(e.classList.remove("visible"),setTimeout(()=>e.style.display="none",300))}updateAnalyticsTimeframe(e){this.updateAnalytics(e)}updateAnalytics(e="week"){const t=this.calculatePeriodSummary(e);this.updateAdherenceOverview(t),this.updatePerformanceMetrics()}calculatePeriodSummary(e){const t=new Date,n=new Date(t);switch(e){case"week":n.setDate(t.getDate()-7);break;case"month":n.setDate(t.getDate()-30);break;case"quarter":n.setDate(t.getDate()-90);break}const i=this.state.trackedWorkouts.filter(d=>{const p=new Date(d.date);return p>=n&&p<=t}),r=i.filter(d=>d.status!=="unplanned"),a=i.filter(d=>d.status==="completed"),o={totalWorkouts:r.length,totalDuration:r.reduce((d,p)=>d+p.durationMin,0),totalTrainingLoad:r.reduce((d,p)=>d+p.expectedFatigue*5,0),workoutsByType:this.groupWorkoutsByType(r)},l={completedWorkouts:a.length,totalDuration:a.reduce((d,p)=>{var m;return d+(((m=p.actualWorkout)==null?void 0:m.duration)||p.durationMin)},0),totalTrainingLoad:a.reduce((d,p)=>{var m;return d+(((m=p.actualWorkout)==null?void 0:m.trainingLoad)||p.expectedFatigue*5)},0),workoutsByType:this.groupWorkoutsByType(a,!0)},u={completionRate:o.totalWorkouts>0?l.completedWorkouts/o.totalWorkouts*100:0,durationAdherence:o.totalDuration>0?l.totalDuration/o.totalDuration*100:0,loadAdherence:o.totalTrainingLoad>0?l.totalTrainingLoad/o.totalTrainingLoad*100:0,overallScore:0};return u.overallScore=(u.completionRate+u.durationAdherence+u.loadAdherence)/3,{startDate:n.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0],planned:o,actual:l,adherence:u,insights:{consistencyScore:u.completionRate,intensityTrend:"stable",recommendations:[],warnings:[]}}}groupWorkoutsByType(e,t=!1){return e.reduce((n,i)=>{var a;const r=t&&((a=i.actualWorkout)==null?void 0:a.sport)||i.workoutType;return n[r]=(n[r]||0)+1,n},{})}updateAdherenceOverview(e){const t=Math.round(e.adherence.completionRate),n=document.getElementById("completion-rate-circle"),i=document.getElementById("planned-workouts"),r=document.getElementById("completed-workouts"),a=document.getElementById("load-variance");if(n){const o=n.querySelector(".metric-value");o&&(o.textContent=`${t}%`),n.style.setProperty("--percentage",t.toString())}if(i&&(i.textContent=e.planned.totalWorkouts.toString()),r&&(r.textContent=e.actual.completedWorkouts.toString()),a){const o=Math.round(e.adherence.loadAdherence-100);a.textContent=`${o>0?"+":""}${o}%`}}updatePerformanceMetrics(){const e=document.getElementById("avg-duration-variance"),t=document.getElementById("zone-compliance"),n=document.getElementById("consistency-score");e&&(e.textContent="+2.3%"),t&&(t.textContent="87%"),n&&(n.textContent="8.2/10")}async syncData(){try{Q.showStatus("Syncing data...","info");const e=await this.dashboardService.getDashboardData(!0),t=e.activities.map(o=>({date:o.date,workoutType:o.sport,description:`${o.sport} - ${o.distance.toFixed(2)}km in ${o.duration} min`,expectedFatigue:Math.round(o.trainingLoad/5),durationMin:o.duration,completed:!0,status:"completed",actualWorkout:o,actualFatigue:Math.round(o.trainingLoad/5),completedAt:o.date,comparison:void 0})),n=this.state.trackedWorkouts.filter(o=>o.status==="planned"),i=this.state.trackedWorkouts.filter(o=>o.status==="completed"),r=t.filter(o=>!i.some(l=>{var u,d;return l.date===o.date&&l.workoutType===o.workoutType&&((u=l.actualWorkout)==null?void 0:u.activityId)===((d=o.actualWorkout)==null?void 0:d.activityId)})),a=[...n,...i,...r];this.setState({trackedWorkouts:a}),this.updateHeaderMetricsFromDashboard(e),this.updateAnalytics(),this.workoutCalendar&&this.workoutCalendar&&await this.workoutCalendar.updateWorkouts(a),Q.showStatus(`Data synced! Loaded ${e.activities.length} activities from Firebase.`,"success")}catch(e){console.error("Sync error:",e),this.addError("Failed to sync data")}}async handleRealtimeDataUpdate(e){try{console.log(`ðŸ”„ Real-time update: ${e.activities.length} activities`);const t=e.activities.map(o=>({date:o.date,workoutType:o.sport,description:`${o.sport} - ${o.distance.toFixed(2)}km in ${o.duration} min`,expectedFatigue:Math.round(o.trainingLoad/5),durationMin:o.duration,completed:!0,status:"completed",actualWorkout:o,actualFatigue:Math.round(o.trainingLoad/5),completedAt:o.date,comparison:void 0})),n=this.state.trackedWorkouts.filter(o=>o.status==="planned"),i=this.state.trackedWorkouts.filter(o=>o.status==="completed"),r=t.filter(o=>!i.some(l=>{var u,d;return l.date===o.date&&l.workoutType===o.workoutType&&((u=l.actualWorkout)==null?void 0:u.activityId)===((d=o.actualWorkout)==null?void 0:d.activityId)})),a=[...n,...i,...r];this.setState({trackedWorkouts:a}),this.updateHeaderMetricsFromDashboard(e),this.updateAnalytics(),this.workoutCalendar&&await this.workoutCalendar.updateWorkouts(a),r.length>0&&Q.showStatus(`ðŸ”„ ${r.length} new activities synced`,"info")}catch(t){console.error("Error handling real-time update:",t),this.addError("Real-time update failed")}}updateSyncButtonStatus(e){const t=document.getElementById("sync-data-btn");t&&(e?(t.innerHTML="ðŸ”„ Live Sync",t.style.color="#4CAF50",t.title="Real-time synchronization active - click to refresh manually"):(t.innerHTML="ðŸ”„ Sync Data",t.style.color="#666",t.title="Click to sync data manually"))}showImportModal(){const e=document.getElementById("import-modal");if(e&&(console.log("âš ï¸ Import modal already exists in DOM, removing it first"),e.remove(),this.isImportModalOpen=!1),this.isImportModalOpen){console.log("âš ï¸ Import modal already open, ignoring duplicate call");return}this.isImportModalOpen=!0,console.log("ðŸ”„ Opening import modal..."),document.querySelectorAll(".strava-settings-modal").forEach(i=>i.remove());const n=document.createElement("div");n.className="modal-overlay",n.id="import-modal",n.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    `,n.innerHTML=`
      <div class="modal-content large-modal" style="
        background: #FFFFFF;
        border-radius: 12px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 800px;
      ">
        <div class="modal-header" style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 24px;
          border-bottom: 1px solid #D0D7DE;
        ">
          <h3 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: #1A1A1A;">
            ðŸ“ Import Training Data
          </h3>
          <button class="close-btn" id="close-import-modal" aria-label="Close import modal" style="
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #4D4D4D;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
          ">&times;</button>
        </div>
        <div class="modal-body" style="padding: 24px;">
          <div class="import-options" style="display: flex; flex-direction: column; gap: 24px;">
            
            <!-- Import Method Selection -->
            <div class="import-method-tabs" style="display: flex; border-bottom: 1px solid #D0D7DE; margin-bottom: 16px;">
              <button class="import-tab active" data-method="fit" style="
                padding: 12px 24px;
                border: none;
                background: none;
                border-bottom: 2px solid #00B26F;
                color: #00B26F;
                font-weight: 600;
                cursor: pointer;
              ">ðŸ“ FIT Files</button>
              <button class="import-tab" data-method="strava" style="
                padding: 12px 24px;
                border: none;
                background: none;
                border-bottom: 2px solid transparent;
                color: #666;
                font-weight: 500;
                cursor: pointer;
              ">ðŸƒ Strava</button>
            </div>

            <!-- FIT File Import -->
            <div class="import-method-content" id="fit-import-content">
              <div class="drop-zone" id="fit-drop-zone" style="
                border: 2px dashed #D0D7DE;
                border-radius: 12px;
                padding: 32px;
                text-align: center;
                background: #F7F9FB;
                transition: all 0.3s ease;
                cursor: pointer;
              ">
                <div class="drop-zone-content" style="
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  gap: 16px;
                ">
                  <div class="drop-zone-icon" style="font-size: 3rem; opacity: 0.7;">ðŸ“</div>
                  <p class="drop-zone-text" style="
                    font-size: 1.1rem;
                    color: #4D4D4D;
                    margin: 0;
                  ">Drop .fit files here or click to select</p>
                  <button class="btn btn-secondary" id="select-files-btn" style="
                    background-color: #00B26F;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 500;
                  ">
                    <span aria-hidden="true">ðŸ“‚</span> Select Files
                  </button>
                </div>
                <input type="file" id="fit-file-input" accept=".fit" multiple style="display: none;">
              </div>
            </div>

            <!-- Strava Import -->
            <div class="import-method-content" id="strava-import-content" style="display: none;">
              <div id="strava-connector-container" style="
                border: 2px solid #FC4C02;
                border-radius: 12px;
                padding: 24px;
                background: #FFF8F6;
              "></div>
            </div>
            
            <div class="import-settings" style="background: #F7F9FB; padding: 20px; border-radius: 8px;">
              <h4 style="margin: 0 0 16px 0; font-size: 1.1rem; color: #1A1A1A;">Import Settings</h4>
              <div class="settings-grid" style="display: flex; flex-direction: column; gap: 12px;">
                <label class="checkbox-label" style="
                  display: flex;
                  align-items: center;
                  gap: 12px;
                  cursor: pointer;
                  padding: 8px;
                  border-radius: 4px;
                  transition: background-color 0.2s ease;
                ">
                  <input type="checkbox" id="auto-save-firebase" checked>
                  <span>Automatically save to Firebase</span>
                </label>
                <label class="checkbox-label" style="
                  display: flex;
                  align-items: center;
                  gap: 12px;
                  cursor: pointer;
                  padding: 8px;
                  border-radius: 4px;
                  transition: background-color 0.2s ease;
                ">
                  <input type="checkbox" id="auto-match-workouts" checked>
                  <span>Auto-match with planned workouts</span>
                </label>
              </div>
            </div>
            
            <div class="selected-files" id="selected-files-list">
              <div class="files-header" style="
                display: none;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
                padding-bottom: 8px;
                border-bottom: 1px solid #D0D7DE;
              ">
                <h4 style="margin: 0; font-size: 1.1rem; color: #1A1A1A;">Selected Files</h4>
                <span class="file-count" id="file-count" style="
                  font-size: 0.9rem;
                  color: #4D4D4D;
                  background: #F7F9FB;
                  padding: 4px 12px;
                  border-radius: 12px;
                ">0 files selected</span>
              </div>
              <div class="files-grid" id="files-grid" style="
                display: flex;
                flex-direction: column;
                gap: 8px;
              "></div>
            </div>
          </div>
        </div>
        
        <div class="modal-footer" style="
          padding: 24px;
          border-top: 1px solid #D0D7DE;
          background: #F7F9FB;
          border-radius: 0 0 12px 12px;
        ">
          <div class="import-actions" style="
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            align-items: center;
          ">
            <button class="btn btn-ghost" id="clear-files-btn" disabled style="
              background: none;
              color: #4D4D4D;
              border: 1px solid #D0D7DE;
              padding: 8px 16px;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 500;
            ">
              Clear All
            </button>
            <button class="btn btn-primary" id="process-files-btn" disabled style="
              background-color: #0066CC;
              color: white;
              border: none;
              padding: 8px 16px;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 500;
            ">
              <span aria-hidden="true">âš¡</span> Process Files
            </button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(n),console.log("ðŸ“‹ Import modal created and added to DOM"),console.log("ðŸ” Modal element:",n),console.log("ðŸ” Close button:",document.getElementById("close-import-modal")),this.initializeImportModalEvents()}initializeImportModalEvents(){const e=document.getElementById("import-modal"),t=document.getElementById("close-import-modal"),n=document.getElementById("fit-drop-zone"),i=document.getElementById("fit-file-input"),r=document.getElementById("select-files-btn"),a=document.getElementById("process-files-btn"),o=document.querySelectorAll(".import-tab");document.querySelectorAll(".import-method-content"),o.forEach(w=>{w.addEventListener("click",E=>{const C=E.target.getAttribute("data-method");this.switchImportMethod(C)})});try{this.initializeStravaConnector()}catch(w){console.error("âŒ Error initializing Strava connector:",w)}const l=document.getElementById("clear-files-btn"),u=document.getElementById("selected-files-list");let d=[];const p=()=>{console.log("ðŸ”„ Closing import modal");const w=document.getElementById("import-modal");w&&(w.remove(),this.isImportModalOpen=!1,console.log("âœ… Import modal closed"))};t?t.addEventListener("click",w=>{w.preventDefault(),w.stopPropagation(),console.log("âŒ Close button clicked"),p()}):console.warn("âš ï¸ Close button not found"),e&&e.addEventListener("click",w=>{w.target===e&&(console.log("âŒ Overlay clicked to close"),p())});const m=w=>{w.key==="Escape"&&document.getElementById("import-modal")&&(console.log("âŒ Escape key pressed to close"),p(),document.removeEventListener("keydown",m))};document.addEventListener("keydown",m),r==null||r.addEventListener("click",()=>{i==null||i.click()}),n==null||n.addEventListener("click",()=>{i==null||i.click()}),n==null||n.addEventListener("dragover",w=>{w.preventDefault(),n.classList.add("dragover")}),n==null||n.addEventListener("dragleave",()=>{n.classList.remove("dragover")}),n==null||n.addEventListener("drop",w=>{var C;w.preventDefault(),n.classList.remove("dragover");const E=Array.from(((C=w.dataTransfer)==null?void 0:C.files)||[]).filter(I=>I.name.toLowerCase().endsWith(".fit"));E.length>0&&(d.push(...E),this.updateFilesList(d,u,a))}),i==null||i.addEventListener("change",w=>{const E=Array.from(w.target.files||[]);if(console.log("Files selected via input:",E.map(I=>({name:I.name,size:I.size,type:I.type}))),E.length===0){console.warn("No files selected from input");return}const C=E.filter(I=>I.name.toLowerCase().endsWith(".fit"));if(C.length===0){Q.showStatus("Please select .fit files only","warning");return}C.length<E.length&&Q.showStatus(`Selected ${C.length} .fit files (${E.length-C.length} non-.fit files ignored)`,"info"),d.push(...C),this.updateFilesList(d,u,a)}),a==null||a.addEventListener("click",async()=>{var w;if(console.log("Process files button clicked"),console.log("Selected files count:",d.length),d.length===0){Q.showStatus("No files selected to process","warning");return}a.setAttribute("disabled","true"),a.textContent="âš¡ Processing...";try{const E=((w=document.getElementById("auto-save-firebase"))==null?void 0:w.checked)??!0;console.log("Processing with auto-save:",E),await this.processFitFiles(d,E),setTimeout(()=>e==null?void 0:e.remove(),2e3)}catch(E){console.error("Error in process button handler:",E),Q.showStatus("Processing failed","error")}finally{a.removeAttribute("disabled"),a.innerHTML='<span aria-hidden="true">âš¡</span> Process Files'}}),l==null||l.addEventListener("click",()=>{d=[],this.updateFilesList(d,u,a)})}updateFilesList(e,t,n){if(!t||!n)return;const i=document.querySelector(".files-header"),r=document.getElementById("files-grid"),a=document.getElementById("file-count"),o=document.getElementById("clear-files-btn");if(e.length===0){i&&(i.style.display="none"),r&&(r.innerHTML=""),n.setAttribute("disabled","true"),o&&o.setAttribute("disabled","true");return}i&&(i.style.display="flex"),a&&(a.textContent=`${e.length} ${e.length===1?"file":"files"} selected`),r&&(r.innerHTML=e.map((l,u)=>`
        <div class="file-item" style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 12px;
          background: #FFFFFF;
          border-radius: 8px;
          border: 1px solid #D0D7DE;
          transition: all 0.2s ease;
        ">
          <div class="file-info" style="
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
          ">
            <div class="file-icon" style="font-size: 1.5rem; opacity: 0.7;">ðŸ“„</div>
            <div class="file-details" style="
              display: flex;
              flex-direction: column;
              min-width: 0;
            ">
              <span class="file-name" title="${l.name}" style="
                font-weight: 500;
                color: #1A1A1A;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
              ">${l.name}</span>
              <span class="file-size" style="
                font-size: 0.85rem;
                color: #4D4D4D;
              ">${(l.size/1024).toFixed(1)} KB</span>
            </div>
          </div>
          <button class="remove-file btn-icon" data-index="${u}" title="Remove file" aria-label="Remove ${l.name}" style="
            background: none;
            border: none;
            color: #4D4D4D;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            font-size: 1.2rem;
            transition: all 0.2s ease;
          " onmouseover="this.style.background='#FEF2F2'; this.style.color='#D93025';" onmouseout="this.style.background='none'; this.style.color='#4D4D4D';">
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
      `).join("")),document.querySelectorAll(".remove-file").forEach(l=>{l.addEventListener("click",u=>{const p=u.target.closest(".remove-file"),m=parseInt(p.dataset.index||"0");e.splice(m,1),this.updateFilesList(e,t,n)})}),n.removeAttribute("disabled"),o&&o.removeAttribute("disabled")}async processFitFiles(e,t){if(e.length===0){console.warn("No files to process"),Q.showStatus("No files selected for processing","warning");return}console.log(`Starting to process ${e.length} files`,{saveToFirebase:t,files:e.map(n=>n.name)}),Q.showStatus(`Processing ${e.length} files...`,"info");try{if(!ri||typeof ri.processBatchFiles!="function")throw console.error("FileService.processBatchFiles is not available"),new Error("File processing service is not available");const n=await ri.processBatchFiles(e,{saveToFirebase:t,showProgress:!0});console.log("File processing completed:",n),n.successful>0&&(console.log("Refreshing data after successful processing"),await this.syncData()),console.log("Import results:",n);const i=`Processing complete! âœ… ${n.successful} successful, âŒ ${n.failed} failed`;console.log(i),n.failed>0?Q.showStatus(`${n.successful}/${e.length} files processed. ${n.failed} failed.`,"warning"):Q.showStatus(`All ${n.successful} files processed successfully!`,"success")}catch(n){console.error("Batch processing error:",n);const i=n instanceof Error?n.message:"Unknown error occurred";Q.showStatus(`Failed to process files: ${i}`,"error"),this.addError("Failed to process files")}}getState(){return{...this.state}}addWorkout(e){this.setState({trackedWorkouts:[...this.state.trackedWorkouts,e]}),this.saveWorkouts()}updateWorkout(e,t){this.setState({trackedWorkouts:this.state.trackedWorkouts.map(n=>n.date===e?{...n,...t}:n)}),this.saveWorkouts()}getCurrentUser(){return this.userProfileService.getCurrentUser()}getUserProfile(){return this.userProfileService.getUserProfile()}getIsAuthenticated(){return this.userProfileService.isAuthenticated()}getAuthManager(){return this.authManager}getDashboardService(){return this.dashboardService}async getDashboardData(e=!1){return await this.dashboardService.getDashboardData(e)}onViewChange(e){e==="profile"?this.renderProfileView():e==="training-plan"?this.showTrainingPlanView():e==="dashboard"&&this.hideTrainingPlanView()}renderProfileView(){var a,o;const e=document.getElementById("profile-content");if(!e)return;const t=this.userProfileService.getDisplayName(),n=this.userProfileService.getEmail(),i=this.userProfileService.getJoinDate(),r=this.userProfileService.getActivityStats();e.innerHTML=`
      <div class="profile-content">
        <div class="profile-card">
          <div class="profile-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="profile-info">
            <h3>${t}</h3>
            <p class="profile-email">${n}</p>
            <p class="profile-joined">Joined: ${i}</p>
          </div>
        </div>
        
        <div class="profile-stats">
          <div class="stat-card">
            <h4>Training Statistics</h4>
            <div class="stat-grid">
              <div class="stat-item">
                <span class="stat-value">${r.totalActivities}</span>
                <span class="stat-label">Total Activities</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">${Math.round(r.totalTrainingTime/60)}</span>
                <span class="stat-label">Hours Trained</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">${r.lastActivityDate||"Never"}</span>
                <span class="stat-label">Last Activity</span>
              </div>
              <div class="stat-item">
                <span class="stat-value">Coming Soon</span>
                <span class="stat-label">Total Distance</span>
              </div>
            </div>
          </div>
        </div>

        <div class="profile-actions">
          <button class="btn btn-secondary" id="edit-profile-btn">Edit Profile</button>
          <button class="btn btn-danger" id="delete-account-btn">Delete Account</button>
        </div>
      </div>
    `,(a=document.getElementById("edit-profile-btn"))==null||a.addEventListener("click",()=>{this.showEditProfileModal()}),(o=document.getElementById("delete-account-btn"))==null||o.addEventListener("click",()=>{this.showDeleteAccountModal()})}displayAIInsights(e){var n,i;const t=document.getElementById("ai-insights-content");if(!t){console.warn("ðŸ¤– AI Insights: Content element not found");return}if(console.log("ðŸ¤– AI Insights Debug:",{aiEnabled:this.dashboardService.isAIInsightsEnabled(),hasInsights:!!e,insights:e}),e&&e.quickStats){console.log("ðŸ¤– Displaying AI insights with valid data"),this.renderAIInsights(e,t);return}if(!this.dashboardService.isAIInsightsEnabled()){t.innerHTML=`
        <div class="ai-disabled">
          <span class="error-icon">ðŸ¤–</span>
          <p>AI insights are disabled or unavailable</p>
          <button class="btn btn-primary enable-btn" id="enable-ai-btn">Enable AI Insights</button>
        </div>
      `,(n=document.getElementById("enable-ai-btn"))==null||n.addEventListener("click",()=>{this.toggleAIInsights()});return}if(!e){t.innerHTML=`
        <div class="ai-error">
          <span class="error-icon">âš ï¸</span>
          <p>Unable to load AI insights</p>
          <button class="btn btn-secondary retry-btn" id="ai-retry-btn">Retry</button>
        </div>
      `,(i=document.getElementById("ai-retry-btn"))==null||i.addEventListener("click",()=>{this.refreshAIInsights()});return}this.renderAIInsights(e,t)}renderAIInsights(e,t){console.log("ðŸŽ¨ Rendering AI insights to DOM element:",t);const n=`
      <div class="ai-insights-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; padding: 1rem;">
        ${this.createReadinessCard(e.quickStats)}
        ${this.createWorkoutRecommendationCard(e.workoutRecommendation)}
        ${this.createFatigueStatusCard(e.fatigueAssessment)}
        ${this.createPerformanceTrendCard(e.performanceAnalysis)}
      </div>
    `;t.innerHTML=n,console.log("âœ… AI insights HTML set, element should now be visible")}createReadinessCard(e){if(!e)return"";const t=e.readinessScore||0,n=t/100*360;return`
      <div class="ai-insight-card" style="
        background: #FFFFFF;
        border: 1px solid #D0D7DE;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        min-height: 200px;
      ">
        <div class="insight-header" style="margin-bottom: 16px;">
          <h4 class="insight-title" style="margin: 0; color: #1A1A1A; font-size: 1.1rem;">ðŸŽ¯ Training Readiness</h4>
        </div>
        <div class="insight-content">
          <div class="readiness-score" style="text-align: center; margin: 20px 0;">
            <div class="score-circle" style="
              display: inline-block;
              width: 80px;
              height: 80px;
              border-radius: 50%;
              background: conic-gradient(#0066CC 0deg ${n}deg, #F0F0F0 ${n}deg 360deg);
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 1.5rem;
              font-weight: bold;
              color: #1A1A1A;
              margin: 0 auto;
            ">
              ${t}
            </div>
            <div class="score-label" style="margin-top: 8px; color: #4D4D4D; font-size: 0.9rem;">Ready to Train</div>
          </div>
          <div class="performance-trend" style="text-align: center; margin-top: 16px;">
            <span class="trend-indicator" style="margin-right: 8px;">${this.getTrendIcon(e.trendDirection)}</span>
            <span class="trend-text" style="color: #4D4D4D; text-transform: capitalize;">${e.trendDirection}</span>
          </div>
          <div style="margin-top: 16px; padding: 12px; background: #F7F9FB; border-radius: 8px;">
            <strong style="color: #1A1A1A;">Recommendation:</strong>
            <p style="margin: 8px 0 0 0; color: #4D4D4D; font-size: 0.9rem;">${e.nextRecommendation}</p>
          </div>
        </div>
      </div>
    `}createWorkoutRecommendationCard(e){if(!e||!e.recommendedWorkout)return`
        <div class="ai-insight-card" style="
          background: #FFFFFF;
          border: 1px solid #D0D7DE;
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          min-height: 200px;
        ">
          <div class="insight-header" style="margin-bottom: 16px;">
            <h4 style="margin: 0; color: #1A1A1A; font-size: 1.1rem;">ðŸƒ Tomorrow's Workout</h4>
          </div>
          <div style="text-align: center; color: #4D4D4D; padding: 40px 0;">
            <div style="font-size: 2rem; margin-bottom: 16px;">ðŸ’¤</div>
            <p>Let your body guide the workout</p>
            <p style="font-size: 0.9rem; margin-top: 12px;">AI is analyzing your recent activities to provide personalized recommendations.</p>
          </div>
        </div>
      `;const t=e.recommendedWorkout;return`
      <div class="ai-insight-card">
        <div class="insight-header">
          <h4 class="insight-title">Tomorrow's Workout</h4>
          <div class="insight-confidence">${e.confidence||0}% confidence</div>
        </div>
        <div class="insight-content">
          <div class="workout-recommendation">
            <div class="workout-type">${t.type}</div>
            <div class="workout-description">${t.description}</div>
            <div class="workout-stats">
              <div class="stat">
                <span>â±ï¸ ${t.durationMin} min</span>
              </div>
              <div class="stat">
                <span>ðŸ’ª ${t.fatigueScore}/100 intensity</span>
              </div>
            </div>
          </div>
        </div>
        <div class="insight-actions">
          <button class="btn btn-primary btn-sm" onclick="this.applyWorkoutRecommendation()">Apply to Plan</button>
        </div>
      </div>
    `}createFatigueStatusCard(e){if(!e)return`
        <div class="ai-insight-card" style="
          background: #FFFFFF;
          border: 1px solid #D0D7DE;
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          min-height: 200px;
        ">
          <div class="insight-header" style="margin-bottom: 16px;">
            <h4 style="margin: 0; color: #1A1A1A; font-size: 1.1rem;">âš¡ Recovery Status</h4>
          </div>
          <div style="text-align: center; color: #4D4D4D; padding: 40px 0;">
            <div style="font-size: 2rem; margin-bottom: 16px;">ðŸ’š</div>
            <p>Feeling good and ready to train</p>
            <div style="margin-top: 16px; padding: 12px; background: #F0FDF4; border-radius: 8px; color: #166534;">
              <strong>Status:</strong> Low Risk
            </div>
          </div>
        </div>
      `;const t=e.overallStatus||"unknown",n=e.riskLevel||"low";return`
      <div class="ai-insight-card">
        <div class="insight-header">
          <h4 class="insight-title">Fatigue Status</h4>
        </div>
        <div class="insight-content">
          <div class="fatigue-status">
            <div class="status-indicator ${t}"></div>
            <div class="status-text">${t}</div>
          </div>
          <p style="margin: 0.5rem 0; color: rgba(255,255,255,0.7); font-size: 0.85rem;">
            Risk Level: <strong style="color: ${this.getRiskColor(n)}">${n}</strong>
          </p>
          <p style="margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.6);">
            ${this.getFatigueRecommendation(t,n)}
          </p>
        </div>
      </div>
    `}createPerformanceTrendCard(e){if(!e)return`
        <div class="ai-insight-card" style="
          background: #FFFFFF;
          border: 1px solid #D0D7DE;
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          min-height: 200px;
        ">
          <div class="insight-header" style="margin-bottom: 16px;">
            <h4 style="margin: 0; color: #1A1A1A; font-size: 1.1rem;">ðŸ“ˆ Performance Trend</h4>
          </div>
          <div style="text-align: center; color: #4D4D4D; padding: 40px 0;">
            <div style="font-size: 2rem; margin-bottom: 16px;">ðŸ“Š</div>
            <p>Building fitness progressively</p>
            <div style="margin-top: 16px; padding: 12px; background: #EFF6FF; border-radius: 8px; color: #1E40AF;">
              <strong>Trend:</strong> Stable Progress
            </div>
          </div>
        </div>
      `;const t=e.overallTrend||"stable";return`
      <div class="ai-insight-card">
        <div class="insight-header">
          <h4 class="insight-title">Performance Trend</h4>
        </div>
        <div class="insight-content">
          <div class="performance-trend">
            <span class="trend-indicator ${t}">${this.getTrendIcon(t)}</span>
            <span class="trend-text">${t}</span>
          </div>
          <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: rgba(255,255,255,0.6);">
            ${this.getPerformanceInsight(t)}
          </p>
        </div>
      </div>
    `}getTrendIcon(e){switch(e){case"improving":return"ðŸ“ˆ";case"declining":return"ðŸ“‰";case"stable":return"âž¡ï¸";default:return"â“"}}getRiskColor(e){switch(e){case"low":return"#4CAF50";case"moderate":return"#2196F3";case"high":return"#FF9800";case"critical":return"#F44336";default:return"#666"}}getFatigueRecommendation(e,t){return t==="critical"?"Consider taking a rest day":e==="overtrained"?"Focus on recovery and light training":e==="fatigued"?"Easy training recommended":e==="fresh"?"Ready for quality training":"Continue with planned training"}getPerformanceInsight(e){switch(e){case"improving":return"Your performance is trending upward - great work!";case"declining":return"Consider adjusting training load or focus on recovery";case"stable":return"Performance is consistent - maintain current approach";default:return"Keep training consistently for best results"}}async refreshAIInsights(){try{Q.showStatus("Refreshing AI insights...","info");const e=await this.dashboardService.getDashboardData(!0);this.displayAIInsights(e.aiInsights),Q.showStatus("AI insights refreshed","success")}catch(e){console.error("Failed to refresh AI insights:",e),Q.showStatus("Failed to refresh AI insights","error")}}toggleAIInsights(){const e=this.dashboardService.isAIInsightsEnabled();this.dashboardService.setAIInsightsEnabled(!e),e?(this.displayAIInsights(null),Q.showStatus("AI insights disabled","info")):(this.refreshAIInsights(),Q.showStatus("AI insights enabled","success"));const t=document.getElementById("toggle-ai-btn");t&&(t.style.color=e?"rgba(255,255,255,0.8)":"#4CAF50",t.title=e?"Enable AI Features":"Disable AI Features")}async handleLogout(){try{const{AuthService:e}=await sl(async()=>{const{AuthService:t}=await Promise.resolve().then(()=>Vp);return{AuthService:t}},void 0);await e.logout(),Q.showStatus("Signed out successfully","success")}catch(e){console.error("Logout failed:",e),Q.showStatus("Logout failed. Please try again.","error")}}showEditProfileModal(){var i,r,a;const e=document.createElement("div");e.className="modal-overlay",e.innerHTML=`
      <div class="modal-content profile-modal">
        <div class="modal-header">
          <h3>ðŸƒâ€â™‚ï¸ Edit Training Profile</h3>
          <button class="close-btn" id="close-profile-modal">&times;</button>
        </div>
        
        <div class="modal-body">
          <form id="profile-form" class="profile-form">
            <!-- Basic Information -->
            <div class="form-section">
              <h4>Basic Information</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="profile-age">Age</label>
                  <input type="number" id="profile-age" min="13" max="100" value="${this.userProfileService.getTrainingProfile().age}" required>
                  <small>Used for heart rate zone calculations and training recommendations</small>
                </div>
                <div class="form-group">
                  <label for="profile-sex">Sex</label>
                  <select id="profile-sex" required>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other/Prefer not to say</option>
                  </select>
                  <small>Used for TRIMP calculations and training load analysis</small>
                </div>
              </div>
            </div>

            <!-- Heart Rate Zones -->
            <div class="form-section">
              <h4>Heart Rate Data</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="profile-resting-hr">Resting Heart Rate (bpm)</label>
                  <input type="number" id="profile-resting-hr" min="30" max="100" value="${this.userProfileService.getTrainingProfile().restingHR}" required>
                  <small>Measure when you first wake up in the morning</small>
                </div>
                <div class="form-group">
                  <label for="profile-max-hr">Maximum Heart Rate (bpm)</label>
                  <input type="number" id="profile-max-hr" min="100" max="250" value="${this.userProfileService.getTrainingProfile().maxHR}" required>
                  <small>Highest HR you've achieved in all-out effort</small>
                </div>
              </div>
            </div>

            <!-- Training Information -->
            <div class="form-section">
              <h4>Training Background</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="profile-fitness-level">Current Fitness Level</label>
                  <select id="profile-fitness-level" required>
                    <option value="beginner">Beginner (0-1 year experience)</option>
                    <option value="intermediate" selected>Intermediate (1-5 years experience)</option>
                    <option value="advanced">Advanced (5+ years experience)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="profile-weekly-hours">Weekly Training Hours</label>
                  <input type="number" id="profile-weekly-hours" min="0" max="40" step="0.5" value="5">
                  <small>Average hours per week you train</small>
                </div>
              </div>
            </div>

            <!-- Sport Preferences -->
            <div class="form-section">
              <h4>Sport Preferences</h4>
              <div class="form-group">
                <label>Primary Sports (select all that apply)</label>
                <div class="checkbox-grid">
                  <label class="checkbox-item">
                    <input type="checkbox" name="sport" value="running" checked> Running
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="sport" value="cycling"> Cycling
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="sport" value="swimming"> Swimming
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="sport" value="triathlon"> Triathlon
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="sport" value="strength"> Strength Training
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="sport" value="other"> Other
                  </label>
                </div>
              </div>
            </div>

            <!-- Training Goals -->
            <div class="form-section">
              <h4>Training Goals</h4>
              <div class="form-group">
                <label>What are your main training goals? (select all that apply)</label>
                <div class="checkbox-grid">
                  <label class="checkbox-item">
                    <input type="checkbox" name="goal" value="fitness" checked> General Fitness
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="goal" value="weight-loss"> Weight Loss
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="goal" value="endurance"> Endurance
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="goal" value="speed"> Speed/Performance
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="goal" value="race"> Race Preparation
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="goal" value="health"> Health/Recovery
                  </label>
                </div>
              </div>
            </div>

            <!-- Training Schedule -->
            <div class="form-section">
              <h4>Training Schedule</h4>
              <div class="form-group">
                <label>Available Training Days</label>
                <div class="checkbox-grid">
                  <label class="checkbox-item">
                    <input type="checkbox" name="day" value="Monday" checked> Monday
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="day" value="Tuesday" checked> Tuesday
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="day" value="Wednesday" checked> Wednesday
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="day" value="Thursday" checked> Thursday
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="day" value="Friday" checked> Friday
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="day" value="Saturday" checked> Saturday
                  </label>
                  <label class="checkbox-item">
                    <input type="checkbox" name="day" value="Sunday"> Sunday
                  </label>
                </div>
              </div>
            </div>

            <!-- AI Settings -->
            <div class="form-section">
              <h4>ðŸ¤– AI Insights Settings</h4>
              <div class="form-group">
                <label class="checkbox-item">
                  <input type="checkbox" id="enable-ai-insights" checked>
                  Enable AI-powered training insights and recommendations
                </label>
                <small>AI uses your profile data and training history to provide personalized recommendations</small>
              </div>
            </div>
          </form>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancel-profile-edit">Cancel</button>
          <button type="submit" form="profile-form" class="btn btn-primary" id="save-profile">Save Profile</button>
        </div>
      </div>
    `,document.body.appendChild(e);const t=this.userProfileService.getTrainingProfile();document.getElementById("profile-fitness-level").value=t.fitnessLevel,t.preferredSports.forEach(o=>{const l=document.querySelector(`input[name="sport"][value="${o}"]`);l&&(l.checked=!0)}),(i=document.getElementById("close-profile-modal"))==null||i.addEventListener("click",()=>{document.body.removeChild(e)}),(r=document.getElementById("cancel-profile-edit"))==null||r.addEventListener("click",()=>{document.body.removeChild(e)}),(a=document.getElementById("profile-form"))==null||a.addEventListener("submit",async o=>{o.preventDefault(),await this.saveProfileData(e)}),e.addEventListener("click",o=>{o.target===e&&document.body.removeChild(e)})}async saveProfileData(e){try{Q.showStatus("Saving profile...","info");const t=parseInt(document.getElementById("profile-age").value),n=document.getElementById("profile-sex").value,i=parseInt(document.getElementById("profile-resting-hr").value),r=parseInt(document.getElementById("profile-max-hr").value),a=document.getElementById("profile-fitness-level").value,o=parseFloat(document.getElementById("profile-weekly-hours").value),l=document.querySelectorAll('input[name="sport"]:checked'),u=Array.from(l).map(C=>C.value),d=document.querySelectorAll('input[name="goal"]:checked'),p=Array.from(d).map(C=>C.value),m=document.querySelectorAll('input[name="day"]:checked'),w=Array.from(m).map(C=>C.value),E=document.getElementById("enable-ai-insights").checked;if(!t||t<13||t>100)throw new Error("Please enter a valid age between 13 and 100");if(!i||i<30||i>100)throw new Error("Please enter a valid resting heart rate between 30 and 100 bpm");if(!r||r<100||r>250)throw new Error("Please enter a valid maximum heart rate between 100 and 250 bpm");if(u.length===0)throw new Error("Please select at least one sport");if(p.length===0)throw new Error("Please select at least one training goal");await this.userProfileService.updateProfile({preferences:{age:t,sex:n,restingHR:i,maxHR:r,fitnessLevel:a,sports:u,goals:p,weeklyHours:o,availableDays:w,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,units:"metric",hrZones:this.calculateHRZones(i,r)}}),this.dashboardService.setAIInsightsEnabled(E),document.body.removeChild(e),this.renderProfileView(),Q.showStatus("Profile saved successfully!","success"),E&&await this.refreshAIInsights()}catch(t){console.error("Error saving profile:",t),Q.showStatus(t instanceof Error?t.message:"Failed to save profile","error")}}calculateHRZones(e,t){const n=t-e;return{zone1:{min:e+Math.round(n*.5),max:e+Math.round(n*.6)},zone2:{min:e+Math.round(n*.6),max:e+Math.round(n*.7)},zone3:{min:e+Math.round(n*.7),max:e+Math.round(n*.8)},zone4:{min:e+Math.round(n*.8),max:e+Math.round(n*.9)},zone5:{min:e+Math.round(n*.9),max:t}}}showDeleteAccountModal(){confirm("Are you sure you want to delete your account? This action cannot be undone.")&&Q.showStatus("Delete account functionality coming soon!","info")}async refreshCalendar(){try{Q.showStatus("Refreshing training calendar...","info"),this.workoutCalendar&&await this.workoutCalendar.refreshFromStorage(),Q.showStatus("Calendar refreshed successfully","success")}catch(e){console.error("Error refreshing calendar:",e),Q.showStatus("Failed to refresh calendar","error")}}initializeUnifiedCalendar(){try{const e=document.getElementById("workout-calendar");if(!e){console.warn("Workout calendar container not found, skipping unified calendar initialization");return}console.log("ðŸ—“ï¸ Initializing unified workout calendar...");const t={viewType:this.state.calendar.viewType,startDate:new Date().toISOString().split("T")[0],highlightToday:!0,showStatusFilter:void 0,showSportFilter:void 0};this.unifiedWorkoutCalendar=new X1(e,t,{onWorkoutClick:n=>this.onUnifiedWorkoutSelected(n)}),console.log("âœ… Unified workout calendar initialized")}catch(e){console.error("âŒ Failed to initialize unified workout calendar:",e)}}onUnifiedWorkoutSelected(e){console.log("ðŸŽ¯ Workout selected from unified calendar:",e.name),console.log("ðŸ“Š Workout data:",e),this.showUnifiedWorkoutDetail(e)}showUnifiedWorkoutDetail(e){console.log("ðŸ” Attempting to show workout detail for:",e.name);const t=document.getElementById("workout-detail-panel"),n=document.getElementById("workout-detail-content");if(console.log("ðŸ“‹ Detail panel found:",!!t),console.log("ðŸ“‹ Detail content found:",!!n),!t||!n){console.warn("Workout detail panel not found - panel:",!!t,"content:",!!n);return}const i=this.generateWorkoutDetailHTML(e);n.innerHTML=i,console.log("âœ… Generated detail HTML, showing panel..."),t.style.display="block",setTimeout(()=>t.classList.add("visible"),10),console.log("ðŸ“‹ Panel shown with visible class and animation");const r=document.getElementById("workout-detail-title");r&&(r.textContent=e.name,console.log("ðŸ“‹ Updated panel title to:",e.name))}generateWorkoutDetailHTML(e){const t=this.getSportIcon(e.sport),n=this.getStatusBadge(e.status);return`
      <div class="workout-detail-content">
        <div class="workout-header">
          <span class="sport-icon">${t}</span>
          <div class="workout-info">
            <h4>${e.name}</h4>
            <p class="workout-date">${new Date(e.date).toLocaleDateString()}</p>
            ${n}
          </div>
        </div>

        ${e.description?`
          <div class="workout-description">
            <h5>Description</h5>
            <p>${e.description}</p>
          </div>
        `:""}

        ${e.planned?`
          <div class="planned-workout-section">
            <h5>ðŸ“‹ Planned Workout</h5>
            <div class="workout-metrics">
              ${e.planned.durationMin?`<div class="metric"><strong>Duration:</strong> ${e.planned.durationMin} min</div>`:""}
              ${e.planned.distanceKm?`<div class="metric"><strong>Distance:</strong> ${e.planned.distanceKm} km</div>`:""}
              ${e.planned.expectedFatigue?`<div class="metric"><strong>Expected Effort:</strong> ${e.planned.expectedFatigue}/100</div>`:""}
            </div>
            ${e.planned.tags&&e.planned.tags.length>0?`
              <div class="workout-tags">
                <strong>Tags:</strong> ${e.planned.tags.map(i=>`<span class="tag">${i}</span>`).join("")}
              </div>
            `:""}
            ${e.planned.notes?`
              <div class="workout-notes">
                <strong>Notes:</strong> <p>${e.planned.notes}</p>
              </div>
            `:""}
          </div>
        `:""}

        ${e.planned&&(e.planned.segments||e.planned.segmentGroups)?`
          <div class="workout-segments-section">
            <h5>ðŸ“‹ Workout Structure</h5>
            ${ek.generateSegmentsHTML(e.planned.segments||[],e.planned.segmentGroups)}
          </div>
        `:""}

        ${e.actual?`
          <div class="actual-workout-section">
            <h5>âœ… Completed Workout</h5>
            <div class="workout-metrics">
              <div class="metric"><strong>Duration:</strong> ${e.actual.durationMin} min</div>
              <div class="metric"><strong>Distance:</strong> ${e.actual.distanceKm.toFixed(2)} km</div>
              ${e.actual.avgHR?`<div class="metric"><strong>Avg HR:</strong> ${e.actual.avgHR} bpm</div>`:""}
              ${e.actual.maxHR?`<div class="metric"><strong>Max HR:</strong> ${e.actual.maxHR} bpm</div>`:""}
              ${e.actual.avgPace?`<div class="metric"><strong>Avg Pace:</strong> ${e.actual.avgPace}/km</div>`:""}
              ${e.actual.trainingLoad?`<div class="metric"><strong>Training Load:</strong> ${e.actual.trainingLoad}</div>`:""}
              ${e.actual.calories?`<div class="metric"><strong>Calories:</strong> ${e.actual.calories}</div>`:""}
            </div>

            ${e.actual.zones&&e.actual.zones.length>0?`
              <div class="hr-zones">
                <strong>Heart Rate Zones:</strong>
                <div class="zones-chart">
                  ${e.actual.zones.map(i=>`
                    <div class="zone-bar">
                      <span class="zone-label">Z${i.zone}</span>
                      <div class="zone-time">${i.minutes}min</div>
                      ${i.percentage?`<div class="zone-percentage">${i.percentage}%</div>`:""}
                    </div>
                  `).join("")}
                </div>
              </div>
            `:""}
          </div>
        `:""}

        <div class="workout-actions">
          ${e.status==="planned"?`
            <button class="btn btn-success" onclick="markWorkoutCompleted('${e.id}')">Mark Completed</button>
            <button class="btn btn-warning" onclick="markWorkoutMissed('${e.id}')">Mark Missed</button>
          `:""}
          <button class="btn btn-secondary" onclick="editWorkout('${e.id}')">Edit</button>
          <button class="btn btn-danger" onclick="deleteWorkout('${e.id}')">Delete</button>
        </div>
      </div>
    `}getStatusBadge(e){return{planned:'<span class="status-badge planned">ðŸ“… Planned</span>',completed:'<span class="status-badge completed">âœ… Completed</span>',missed:'<span class="status-badge missed">âŒ Missed</span>',unplanned:'<span class="status-badge unplanned">âš¡ Unplanned</span>'}[e]||'<span class="status-badge">â“ Unknown</span>'}async syncTrainingData(){var e,t,n,i;try{if(Q.showStatus("Syncing training data...","info"),this.recentWorkoutDisplay&&await this.recentWorkoutDisplay.refresh(),this.unifiedWorkoutCalendar)try{await((t=(e=this.unifiedWorkoutCalendar).refreshFromStorage)==null?void 0:t.call(e))||((i=(n=this.unifiedWorkoutCalendar).refresh)==null||i.call(n))}catch(r){console.warn("Calendar refresh failed:",r)}document.dispatchEvent(new CustomEvent("workouts-updated")),Q.showStatus("Training data synchronized successfully","success")}catch(r){console.error("Error syncing training data:",r),Q.showStatus("Failed to sync training data","error")}}showTrainingPlanView(){this.trainingPlanManager&&this.trainingPlanManager.showSection();const e=document.getElementById("dashboard-content");e&&(e.style.display="none")}hideTrainingPlanView(){this.trainingPlanManager&&this.trainingPlanManager.hideSection();const e=document.getElementById("dashboard-content");e&&(e.style.display="block")}getTrainingPlanManager(){return this.trainingPlanManager||null}setupTrainingPlanIntegration(){document.addEventListener("workouts-updated",e=>{e.detail.source==="plan-generation"&&(console.log("ðŸ”„ Workouts updated from plan generation, refreshing calendar..."),this.unifiedWorkoutCalendar&&this.unifiedWorkoutCalendar.refreshData(),this.recoveryTracker&&console.log("ðŸ”„ Recovery metrics will reflect new workout data"),Q.showStatus("Training plan integrated with workout calendar","success"))})}getCurrentPlan(){return this.currentPlan}isAuthenticated(){return this.userProfileService.isAuthenticated()}switchImportMethod(e){const t=document.querySelectorAll(".import-tab"),n=document.querySelectorAll(".import-method-content");t.forEach(i=>{i.getAttribute("data-method")===e?(i.classList.add("active"),i.style.borderBottomColor="#00B26F",i.style.color="#00B26F",i.style.fontWeight="600"):(i.classList.remove("active"),i.style.borderBottomColor="transparent",i.style.color="#666",i.style.fontWeight="500")}),n.forEach(i=>{const r=i.id;e==="fit"&&r==="fit-import-content"||e==="strava"&&r==="strava-import-content"?i.style.display="block":i.style.display="none"})}initializeStravaConnector(){const e=document.getElementById("strava-connector-container");e&&(this.stravaConnector=new Up(e,t=>{t?(console.log("âœ… Strava connected successfully"),this.updateStravaFooterBadge()):(console.log("âŒ Strava disconnected"),this.updateStravaFooterBadge())}))}updateStravaFooterBadge(){const e=document.getElementById("strava-footer-badge");if(!e)return;this.userProfileService.isStravaConnected()?(e.style.display="block",console.log("ðŸ·ï¸ Showing Strava footer badge")):(e.style.display="none",console.log("ðŸ·ï¸ Hiding Strava footer badge"))}async runStravaAutoSync(){if(!this.stravaAutoSync.shouldRunSync()){console.log("ðŸ”„ Skipping Strava auto-sync (not ready or already running)");return}try{console.log("ðŸš€ Running automatic Strava sync...");const e=await this.stravaAutoSync.syncRecentActivities();if(e.synced>0){console.log(`ðŸŽ‰ Successfully synced ${e.synced} new Strava activities!`);const t=await this.dashboardService.getDashboardData();this.updateHeaderMetricsFromDashboard(t),this.recentWorkoutDisplay&&await this.recentWorkoutDisplay.refresh(),e.synced===1?this.addNotification("âœ… Synced 1 new activity from Strava","success"):this.addNotification(`âœ… Synced ${e.synced} new activities from Strava`,"success")}else e.errors>0&&console.warn(`âš ï¸ Strava sync completed with ${e.errors} errors`)}catch(e){console.error("âŒ Error during automatic Strava sync:",e)}}async refreshAfterAuth(){console.log("ðŸ”„ Refreshing TrainingHub after successful authentication");try{await this.ensureComponentsInitialized(),await new Promise(e=>setTimeout(e,200)),console.log("ðŸ”„ Loading initial data..."),await this.loadInitialData(),await new Promise(e=>setTimeout(e,300)),console.log("ðŸ”„ Refreshing individual components..."),this.recentWorkoutDisplay?(console.log("ðŸ”„ Refreshing recent workout display..."),await this.recentWorkoutDisplay.refresh(),console.log("âœ… Recent workout display refreshed")):console.warn("âš ï¸ Recent workout display not found"),this.recoveryTracker?(console.log("ðŸ”„ Refreshing recovery tracker..."),await this.recoveryTracker.refreshData(),console.log("âœ… Recovery tracker refreshed")):console.warn("âš ï¸ Recovery tracker not found"),this.unifiedWorkoutCalendar?(console.log("ðŸ”„ Refreshing unified workout calendar..."),this.unifiedWorkoutCalendar.refresh?await this.unifiedWorkoutCalendar.refresh():this.unifiedWorkoutCalendar.refreshFromStorage&&await this.unifiedWorkoutCalendar.refreshFromStorage(),console.log("âœ… Unified workout calendar refreshed")):console.warn("âš ï¸ Unified workout calendar not found"),console.log("âœ… TrainingHub refresh completed successfully"),this.runStravaAutoSync()}catch(e){throw console.error("âŒ Error refreshing TrainingHub:",e),e}}async ensureComponentsInitialized(){if(console.log("ðŸ”§ Ensuring all components are initialized..."),!this.recoveryTracker){const e=document.getElementById("recovery-metrics-container");e?(console.log("ðŸ”§ Initializing recovery tracker..."),this.recoveryTracker=new Zd(e)):console.warn("âš ï¸ Recovery container not found in DOM")}if(!this.recentWorkoutDisplay){const e=document.getElementById("recent-workout-container");e?(console.log("ðŸ”§ Initializing recent workout display..."),this.recentWorkoutDisplay=new Xd(e)):console.warn("âš ï¸ Recent workout container not found in DOM")}this.unifiedWorkoutCalendar||(console.log("ðŸ”§ Initializing unified workout calendar..."),this.initializeUnifiedCalendar()),console.log("âœ… Component initialization check completed")}}class hk{constructor(e){this.container=e}render(){this.container.innerHTML=`
      <div class="import-page">
        <div class="import-header">
          <button class="back-button" id="back-to-dashboard">
            <span class="back-icon">â†</span>
            Back to Dashboard
          </button>
          
          <div class="page-title">
            <h1>Import Workout Data</h1>
            <p class="page-subtitle">Choose how you'd like to import your workout data</p>
          </div>
        </div>

        <div class="import-methods">
          <!-- File Upload Method -->
          <div class="import-method-card">
            <div class="method-header">
              <div class="method-icon">ðŸ“</div>
              <h3>Import from Files</h3>
            </div>
            <div class="method-description">
              <p>Upload FIT files, GPX files, or JSON exports from other training platforms.</p>
              <ul class="feature-list">
                <li>Support for .fit, .gpx, .tcx, .json files</li>
                <li>Batch upload multiple files</li>
                <li>Automatic activity detection</li>
                <li>Data validation and cleanup</li>
              </ul>
            </div>
            <div class="method-actions">
              <button class="btn-primary" id="file-upload-btn">
                <span class="btn-icon">ðŸ“¤</span>
                Choose Files
              </button>
              <input type="file" id="file-input" multiple accept=".fit,.gpx,.tcx,.json" style="display: none;">
            </div>
          </div>

          <!-- Strava Integration Method -->
          <div class="import-method-card">
            <div class="method-header">
              <div class="method-icon">ðŸŸ </div>
              <h3>Connect to Strava</h3>
            </div>
            <div class="method-description">
              <p>Sync your activities directly from your Strava account.</p>
              <ul class="feature-list">
                <li>Automatic sync of recent activities</li>
                <li>Real-time updates when you complete workouts</li>
                <li>Access to detailed performance metrics</li>
                <li>Heart rate zones and training data</li>
              </ul>
            </div>
            <div class="method-actions">
              <div id="strava-connector-container"></div>
            </div>
          </div>

          <!-- Manual Entry Method -->
          <div class="import-method-card">
            <div class="method-header">
              <div class="method-icon">âœï¸</div>
              <h3>Manual Entry</h3>
            </div>
            <div class="method-description">
              <p>Manually enter workout details for activities not tracked digitally.</p>
              <ul class="feature-list">
                <li>Quick entry forms</li>
                <li>Support for all activity types</li>
                <li>Custom metrics and notes</li>
                <li>Retroactive data entry</li>
              </ul>
            </div>
            <div class="method-actions">
              <button class="btn-secondary" id="manual-entry-btn">
                <span class="btn-icon">âž•</span>
                Add Workout
              </button>
            </div>
          </div>
        </div>

        <!-- Import Progress Section (initially hidden) -->
        <div class="import-progress" id="import-progress" style="display: none;">
          <div class="progress-header">
            <h3>Importing Data...</h3>
            <button class="btn-ghost" id="cancel-import">Cancel</button>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-details">
            <span id="progress-text">Preparing import...</span>
            <span id="progress-count">0/0</span>
          </div>
          <div class="import-results" id="import-results"></div>
        </div>
      </div>
    `,this.attachEventListeners(),this.initializeStrava()}attachEventListeners(){const e=this.container.querySelector("#back-to-dashboard");e==null||e.addEventListener("click",()=>{this.navigateBack()});const t=this.container.querySelector("#file-upload-btn"),n=this.container.querySelector("#file-input");t==null||t.addEventListener("click",()=>{n==null||n.click()}),n==null||n.addEventListener("change",a=>{this.handleFileUpload(a)});const i=this.container.querySelector("#manual-entry-btn");i==null||i.addEventListener("click",()=>{this.showManualEntryForm()});const r=this.container.querySelector("#cancel-import");r==null||r.addEventListener("click",()=>{this.cancelImport()})}initializeStrava(){const e=this.container.querySelector("#strava-connector-container");e&&(this.stravaConnector=new Up(e))}navigateBack(){this.container.style.display="none",this.container.classList.remove("active");const e=document.querySelector("#dashboard-view");e&&(e.style.display="block",e.classList.add("active")),document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active"));const n=document.querySelector('.nav-item[data-view="dashboard"]');n==null||n.classList.add("active")}async handleFileUpload(e){const t=e.target,n=t.files;if(!n||n.length===0)return;console.log(`ðŸ“ Selected ${n.length} files for upload`),this.showImportProgress();const i=[];let r=0;for(const a of Array.from(n)){try{this.updateProgress(r,n.length,`Processing ${a.name}...`);const o=await this.processFile(a);i.push({file:a.name,success:!0,data:o})}catch(o){console.error(`Error processing file ${a.name}:`,o),i.push({file:a.name,success:!1,error:o instanceof Error?o.message:String(o)})}r++,this.updateProgress(r,n.length,`Processed ${a.name}`)}this.showImportResults(i),t.value=""}async processFile(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=async r=>{var a;try{const o=(a=r.target)==null?void 0:a.result;if(!o)throw new Error("Failed to read file");if(e.name.endsWith(".json")){const l=JSON.parse(o);t(l)}else e.name.endsWith(".fit")?t({type:"fit",size:e.size,name:e.name}):t({type:"other",size:e.size,name:e.name})}catch(o){n(o)}},i.onerror=()=>{n(new Error("Failed to read file"))},e.name.endsWith(".json")?i.readAsText(e):i.readAsArrayBuffer(e)})}showImportProgress(){const e=this.container.querySelector("#import-progress");e&&(e.style.display="block")}updateProgress(e,t,n){const i=this.container.querySelector("#progress-fill"),r=this.container.querySelector("#progress-text"),a=this.container.querySelector("#progress-count");if(i){const o=e/t*100;i.style.width=`${o}%`}r&&(r.textContent=n),a&&(a.textContent=`${e}/${t}`)}showImportResults(e){const t=this.container.querySelector("#import-results");if(!t)return;const n=e.filter(r=>r.success).length,i=e.filter(r=>!r.success).length;t.innerHTML=`
      <div class="results-summary">
        <h4>Import Complete</h4>
        <div class="results-stats">
          <span class="success-count">âœ… ${n} successful</span>
          ${i>0?`<span class="error-count">âŒ ${i} failed</span>`:""}
        </div>
      </div>
      
      <div class="results-details">
        ${e.map(r=>`
          <div class="result-item ${r.success?"success":"error"}">
            <span class="result-file">${r.file}</span>
            <span class="result-status">
              ${r.success?"âœ…":"âŒ "+r.error}
            </span>
          </div>
        `).join("")}
      </div>

      <div class="results-actions">
        <button class="btn-primary" onclick="location.reload()">
          Continue to Dashboard
        </button>
      </div>
    `}cancelImport(){const e=this.container.querySelector("#import-progress");e&&(e.style.display="none")}showManualEntryForm(){console.log("ðŸ“ Manual entry form would be shown here"),alert("Manual entry form coming soon!")}show(){this.container.style.display="block",this.render()}hide(){this.container.style.display="none"}}class fk{constructor(){this.trainingHub=new dk,this.initializeImportDataPage(),this.setupLegacySupport(),this.handleStravaOAuthCallback()}initializeImportDataPage(){const e=document.getElementById("import-data-view");e&&(this.importDataPage=new hk(e))}setupLegacySupport(){window.selectAllFields=Q.selectAllFields,window.deselectAllFields=Q.deselectAllFields,window.exportToJSON=()=>{console.warn("exportToJSON called - functionality moved to TrainingHub")},window.testExport=yg.testExport,window.trainingHub=this.trainingHub,window.app={importDataPage:this.importDataPage}}async handleStravaOAuthCallback(){const e=new URLSearchParams(window.location.search),t=e.has("code")&&e.has("state")&&e.has("scope");if(console.log("ðŸ” Global OAuth callback check:",{hasCode:e.has("code"),hasState:e.has("state"),hasScope:e.has("scope"),willHandle:t}),t){const n=e.get("code"),i=e.get("state"),r=e.get("scope"),a=e.get("error");if(a){console.error("Strava OAuth error:",a),this.showStatus(`Strava authorization failed: ${a}`,"error"),window.history.replaceState({},document.title,window.location.pathname);return}if(n&&i&&r)try{console.log("ðŸ”„ Processing Strava OAuth callback globally..."),this.showStatus("Connecting to Strava...","info");const o=_n.getInstance(),l=Nn.getInstance(),u=Ye.getInstance(),d=o.getConfig();if(console.log("ðŸ” Strava configuration check:",{hasClientId:!!d.clientId,redirectUri:d.redirectUri,scope:d.scope}),!d.clientId)throw new Error("Strava is not configured. Please configure your Strava API credentials first.");const p=await o.handleOAuthCallback(n,i,r);if(!await l.testConnection(p))throw new Error("Failed to validate Strava connection");await u.updateProfile({stravaConnection:p}),console.log("âœ… Strava connection successful"),this.showStatus("Successfully connected to Strava!","success"),window.history.replaceState({},document.title,window.location.pathname),this.ensureTrainingHubInitialized(),setTimeout(()=>{this.navigateToDashboard()},1e3)}catch(o){console.error("Strava OAuth callback error:",o),this.showStatus(`Failed to connect to Strava: ${o instanceof Error?o.message:String(o)}`,"error"),window.history.replaceState({},document.title,window.location.pathname)}}}navigateToImportPage(){if(this.trainingHub){const e=new CustomEvent("navigate",{detail:{view:"import-data"}});document.dispatchEvent(e)}}async ensureTrainingHubInitialized(){if(console.log("ðŸ”„ Ensuring TrainingHub is properly initialized after OAuth"),this.trainingHub)if(await new Promise(e=>setTimeout(e,300)),this.trainingHub.isAuthenticated()){console.log("âœ… TrainingHub authenticated, triggering refresh");try{await this.trainingHub.refreshAfterAuth(),console.log("âœ… TrainingHub refresh after OAuth completed successfully")}catch(e){console.error("âŒ Error refreshing TrainingHub after OAuth:",e),this.showStatus(`Failed to refresh dashboard: ${e instanceof Error?e.message:String(e)}`,"error")}}else console.log("âš ï¸ TrainingHub not authenticated yet, will retry..."),setTimeout(()=>{var e;(e=this.trainingHub)!=null&&e.isAuthenticated()&&(console.log("ðŸ”„ Retrying TrainingHub refresh..."),this.trainingHub.refreshAfterAuth().catch(t=>{console.error("âŒ Retry error refreshing TrainingHub:",t)}))},500);else console.log("âš ï¸ TrainingHub not ready")}navigateToDashboard(){console.log("ðŸ  Navigating back to dashboard after Strava connection");const e=document.getElementById("auth-container"),t=document.getElementById("main-content");if(console.log("ðŸ” Navigation DOM check:",{hasAuthContainer:!!e,hasMainContent:!!t,authDisplay:e==null?void 0:e.style.display,mainDisplay:t==null?void 0:t.style.display}),e&&(e.style.display="none",console.log("âœ… Hidden auth container for navigation")),t)t.style.display="block",console.log("âœ… Shown main content for navigation");else{console.error("âŒ Main content not found during navigation");return}const n=document.getElementById("dashboard-view");n?(n.style.display="block",n.classList.add("active"),console.log("âœ… Dashboard view activated")):console.log("âš ï¸ Dashboard view not found, might be part of main content"),document.querySelectorAll(".view-container:not(#dashboard-view)").forEach(o=>{o.style.display="none",o.classList.remove("active")}),document.querySelectorAll(".nav-btn").forEach(o=>o.classList.remove("active"));const a=document.querySelector('.nav-btn[data-view="dashboard"]');a?(a.classList.add("active"),a.setAttribute("aria-current","page"),console.log("âœ… Dashboard nav button activated")):console.warn("âš ï¸ Dashboard nav button not found"),window.location.pathname!=="/"&&window.history.pushState({},"Dashboard","/"),console.log("ðŸŽ¯ Dashboard navigation completed")}showStatus(e,t){console.log(`ðŸ“¢ Status (${t}):`,e);let n=document.getElementById("global-status");n||(n=document.createElement("div"),n.id="global-status",n.className="global-status-overlay",document.body.appendChild(n)),n.className=`global-status-overlay status-${t}`,n.innerHTML=`
      <div class="status-content">
        <span class="status-icon">${t==="success"?"âœ…":t==="error"?"âŒ":"â„¹ï¸"}</span>
        <span class="status-message">${e}</span>
      </div>
    `,n.style.display="block",setTimeout(()=>{n&&(n.style.display="none")},t==="error"?8e3:4e3)}getTrainingHub(){return this.trainingHub}}function pk(){const s=document.querySelectorAll(".skip-link");s.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.getAttribute("href");if(n){const i=document.querySelector(n);i?(i.focus(),i.scrollIntoView({behavior:"smooth",block:"start"}),console.log("âœ… Skip link activated:",n)):console.warn("âš ï¸ Skip link target not found:",n)}})}),console.log("âœ… Skip links initialized:",s.length)}document.addEventListener("DOMContentLoaded",async()=>{try{pk();const s=new fk;window.app=s}catch(s){console.error("âŒ Failed to initialize Training Hub:",s),Q.showStatus("Failed to initialize application. Please refresh the page.","error")}});
