// New Accessible Main Stylesheet
// WCAG 2.1 AA Compliant Design System

// 1. Theme and Design Tokens
@use 'theme' as *;

// 2. Base Styles
@use 'base/reset';
@use 'base/typography';  
@use 'base/layout';

// 3. Component System
@use 'components/buttons';
@use 'components/forms';
@use 'components/cards';
@use 'components/alerts';
@use 'components/navigation';

// 4. Legacy Components (to be migrated)
// Keep existing styles for components not yet migrated
@use 'modern-calendar';
@use 'workout-popup';
@use 'auth';
@use 'recovery-metrics';

// 4b. Accessibility Overrides for Legacy Components
@use 'accessible-calendar';

// 5. Application Layout
.app-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  padding: var(--spacing-4);
  
  @include respond-above($breakpoint-md) {
    padding: var(--spacing-6);
  }
}

.main-container {
  max-width: $breakpoint-xl;
  margin: 0 auto;
  background-color: var(--color-surface);
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-lg);
  overflow: hidden;
  min-height: calc(100vh - 2 * var(--spacing-4));
  
  @include respond-above($breakpoint-md) {
    min-height: calc(100vh - 2 * var(--spacing-6));
  }
}

.app-header {
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: var(--spacing-4);
  
  @include respond-above($breakpoint-md) {
    padding: var(--spacing-6) var(--spacing-8);
  }
}

.app-main {
  padding: var(--spacing-4);
  
  @include respond-above($breakpoint-md) {
    padding: var(--spacing-6) var(--spacing-8);
  }
}

// 6. View Container System
.view-container {
  display: none;
  
  &.active {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(1rem);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .view-container.active {
    animation: none;
  }
}

// 7. Training Hub Specific Styles (migrated)
.training-hub-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-4);
  margin-bottom: var(--spacing-8);
  padding-bottom: var(--spacing-6);
  border-bottom: 1px solid var(--color-border);
  
  @include respond-below($breakpoint-lg) {
    flex-direction: column;
    align-items: stretch;
    gap: var(--spacing-6);
  }
  
  .hub-title {
    h1 {
      margin: 0 0 var(--spacing-2) 0;
      color: var(--color-text-primary);
      font-size: var(--font-size-h1);
      font-weight: var(--font-weight-bold);
    }
    
    .hub-subtitle {
      margin: 0;
      color: var(--color-text-secondary);
      font-size: 1.125rem;
    }
  }
  
  .hub-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--spacing-4);
    
    @include respond-below($breakpoint-lg) {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .hub-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    
    @include respond-below($breakpoint-lg) {
      justify-content: center;
    }
  }
}

.metric-item {
  @extend .card;
  @extend .card-metric;
  min-width: 120px;
  
  .metric-value {
    font-size: 2.5rem;
    
    @include respond-below($breakpoint-sm) {
      font-size: 2rem;
    }
  }
}

// 8. Section Headers
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-4);
  margin-bottom: var(--spacing-6);
  
  h2 {
    margin: 0;
    color: var(--color-text-primary);
    font-size: var(--font-size-h2);
    font-weight: var(--font-weight-medium);
  }
  
  .section-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
  }
  
  @include respond-below($breakpoint-sm) {
    flex-direction: column;
    align-items: stretch;
    
    .section-actions {
      justify-content: center;
    }
  }
}

// 9. AI Insights Section
.ai-insights-section {
  margin-bottom: var(--spacing-8);
  
  .ai-insights-content {
    .ai-insights-grid {
      @extend .grid-auto-fit;
    }
    
    .ai-loading {
      @extend .card;
      text-align: center;
      padding: var(--spacing-8);
      color: var(--color-text-secondary);
    }
    
    .ai-disabled,
    .ai-error {
      @extend .card;
      text-align: center;
      padding: var(--spacing-8);
      
      .error-icon {
        font-size: 3rem;
        display: block;
        margin-bottom: var(--spacing-4);
      }
      
      p {
        margin-bottom: var(--spacing-4);
        color: var(--color-text-secondary);
      }
    }
  }
  
  .ai-insight-card {
    @extend .card;
    padding: var(--spacing-5);
    
    .insight-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-4);
      
      .insight-title {
        margin: 0;
        font-size: 1.125rem;
        font-weight: var(--font-weight-medium);
        color: var(--color-text-primary);
      }
      
      .insight-confidence {
        font-size: var(--font-size-small);
        color: var(--color-text-secondary);
        padding: var(--spacing-1) var(--spacing-2);
        background-color: rgba(0, 0, 0, 0.05);
        border-radius: var(--border-radius-sm);
      }
    }
    
    .insight-content {
      margin-bottom: var(--spacing-4);
      
      &:last-child {
        margin-bottom: 0;
      }
    }
    
    .insight-actions {
      display: flex;
      gap: var(--spacing-2);
      justify-content: flex-end;
    }
  }
  
  .readiness-score {
    text-align: center;
    
    .score-circle {
      width: 4rem;
      height: 4rem;
      border-radius: 50%;
      background: conic-gradient(
        var(--color-primary) var(--progress, 0deg),
        var(--color-border) 0deg
      );
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      font-weight: var(--font-weight-bold);
      margin: 0 auto var(--spacing-3) auto;
      color: var(--color-text-primary);
      position: relative;
      
      &::before {
        content: '';
        position: absolute;
        inset: 4px;
        background-color: var(--color-surface);
        border-radius: inherit;
      }
      
      span {
        position: relative;
        z-index: 1;
      }
    }
    
    .score-label {
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
      font-weight: var(--font-weight-medium);
    }
  }
}

// 10. Calendar Section
.training-calendar-section {
  margin-bottom: var(--spacing-8);
  
  .calendar-container {
    @extend .card;
    padding: 0;
    overflow: hidden;
  }
  
  .calendar-header {
    padding: var(--spacing-4);
    background-color: rgba(0, 0, 0, 0.02);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-4);
    
    .calendar-controls {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }
    
    .current-period {
      font-weight: var(--font-weight-medium);
      color: var(--color-text-primary);
    }
  }
}

// 11. Modal System
.modal-overlay {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  z-index: $z-modal;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-4);
  opacity: 0;
  transition: opacity var(--transition-slow);
  
  &.show {
    opacity: 1;
  }
  
  // Legacy JavaScript compatibility - show modal when display is set to flex
  &[style*="display: flex"] {
    opacity: 1 !important; // Force visibility override
    pointer-events: auto;
    
    .modal-content {
      transform: scale(1) !important; // Force scale override
    }
  }
  
  // Ensure modal is hidden by default
  &[style*="display: none"] {
    opacity: 0;
    pointer-events: none;
  }
}

.modal-content {
  background-color: var(--color-surface);
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-lg);
  max-width: 90vw;
  max-height: 90vh;
  overflow: hidden;
  transform: scale(0.95);
  transition: transform var(--transition-slow);
  
  .show & {
    transform: scale(1);
  }
  
  // Legacy JavaScript compatibility - handled by parent selector above
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-4);
  padding: var(--spacing-5) var(--spacing-6);
  border-bottom: 1px solid var(--color-border);
  
  h3 {
    margin: 0;
    font-size: var(--font-size-h3);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-primary);
  }
  
  .close-btn {
    @extend .btn-icon;
    @extend .btn-ghost;
    
    &::before {
      content: "âœ•";
      font-size: 1.25rem;
      line-height: 1;
    }
  }
}

.modal-body {
  padding: var(--spacing-6);
  overflow-y: auto;
  max-height: 60vh;
}

.modal-footer {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: var(--spacing-3);
  padding: var(--spacing-5) var(--spacing-6);
  border-top: 1px solid var(--color-border);
  background-color: rgba(0, 0, 0, 0.02);
  
  @include respond-below($breakpoint-sm) {
    flex-direction: column-reverse;
    
    .btn {
      width: 100%;
    }
  }
}

// 12. Responsive Utilities
.hide-sm {
  @include respond-below($breakpoint-sm) {
    display: none !important;
  }
}

.show-sm {
  display: none !important;
  
  @include respond-below($breakpoint-sm) {
    display: block !important;
  }
}

.hide-md {
  @include respond-below($breakpoint-md) {
    display: none !important;
  }
}

.show-md {
  display: none !important;
  
  @include respond-below($breakpoint-md) {
    display: block !important;
  }
}

// 13. Accessibility Utilities
.visually-hidden {
  @include sr-only;
}

// High contrast theme support
@media (prefers-contrast: high) {
  .main-container {
    border: 2px solid var(--color-text-primary);
  }
  
  .section-header {
    border-bottom: 2px solid var(--color-border);
    padding-bottom: var(--spacing-4);
  }
}

// Reduced motion support
@media (prefers-reduced-motion: reduce) {
  .modal-overlay,
  .modal-content {
    transition: none;
  }
  
  @keyframes fadeIn {
    from, to {
      opacity: 1;
      transform: none;
    }
  }
}